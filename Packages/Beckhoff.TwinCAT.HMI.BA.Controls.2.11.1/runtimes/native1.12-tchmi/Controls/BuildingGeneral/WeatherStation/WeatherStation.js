var TcHmi;!function(t){!function(e){!function(i){!function(s){let a,r,n,h;!function(t){t[t.Compact=0]="Compact",t[t.Normal=1]="Normal",t[t.NormalReduced=2]="NormalReduced"}(a||(a={})),function(t){t[t.Position=0]="Position",t[t.Temperature=1]="Temperature",t[t.AirPressure=2]="AirPressure",t[t.Humidity=3]="Humidity",t[t.Sun=4]="Sun",t[t.Brightness=5]="Brightness",t[t.Wind=6]="Wind",t[t.WindCompass=7]="WindCompass"}(r||(r={})),function(t){t.Latitude="Latd",t.Longitude="Lngt",t.TemperatureOutside="WthT",t.TemperatureDewPoint="DewPtT",t.AirPressureAbsolute="PrssAbs",t.AirPressureRelative="PrssRel",t.HumidityAbsolute="HumAbs",t.HumidityRelative="HumRel",t.Rain="Rain",t.SunAzimuth="SunAzm",t.SunElevation="SunElv",t.Dawn="Dawn",t.GlobalRadiation="GlobRadn",t.BrightnessNorth="Brightness_N",t.BrightnessEast="Brightness_E",t.BrightnessSouth="Brightness_S",t.BrightnessWest="Brightness_W",t.WindDirection="WndDir",t.WindSpeed="WndSpd"}(n||(n={})),function(t){t.BrightnessNorth="CompBrightNorth",t.BrightnessEast="CompBrightEast",t.BrightnessSouth="CompBrightSouth",t.BrightnessWest="CompBrightWest",t.WindDirection="CompWindDirection",t.WindSpeed="CompWindSpeed"}(h||(h={}));class o extends i.System.BaseTemplate{constructor(t,i,s){super(t,i,s),this.__defaultBaTemplateDescription=o.BaTemplateDescription,this.__displayMode=a.Compact,this.__htmlGroups=$("<div>").addClass("groups"),this.__dataWeather=new Map,this.__htmlDatasets=new Map,this.__babos=new Map,this.__reqIdents=[],this.__dataGroups=[],this.__element.append(this.__htmlGroups),e.System.SVGLoader.get(e.Icons.Outdoor.Compass.path).then((t=>{this.__svgCompass=$(t),this.__htmlCompass.append(this.__svgCompass)})).catch((t=>this.logger.warn(`Loading SVG failed! Path: ${e.Icons.Outdoor.Compass.path}`,t))),this.resizeHandler=new e.Components.ResizeHandler(this,this.__htmlGroups),this.__constructDataStructures(),this.__constructWeatherStation()}__previnit(){super.__previnit()}__init(){super.__init()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||(this.__babos&&(this.__babos.forEach(((t,e)=>{t.stopAllWatches()})),this.__babos.clear()),this.__dataWeather&&this.__dataWeather.clear(),this.__htmlDatasets&&this.__htmlDatasets.clear(),this.__reqIdents&&(this.__reqIdents.length=0),super.destroy())}onResized(){if(super.onResized(),this.__displayMode===a.Compact)return;let t=a.Normal;this.__element[0].clientWidth<260&&(t=a.NormalReduced),t!==this.__displayMode&&(this.__displayMode=t,this.__constructWeatherStation(),this.__addBaVarWatches())}__constructDataStructures(){let t;this.__dataWeather.clear(),this.__reqIdents.length=0,this.__dataGroups.length=0;let e=0;for(let e in n)t=n[e],this.__dataWeather.set(t,{Value:null,Unit:null}),this.__reqIdents.push(t);for(let t=0;t<Object.keys(r).length/2;t++)this.__dataGroups.push({Name:r[t],Visibility:!0,Children:[]});for(let i in n){switch(t=n[i],t){case n.Latitude:case n.Longitude:e=r.Position;break;case n.TemperatureOutside:case n.TemperatureDewPoint:e=r.Temperature;break;case n.AirPressureAbsolute:case n.AirPressureRelative:e=r.AirPressure;break;case n.HumidityAbsolute:case n.HumidityRelative:case n.Rain:e=r.Humidity;break;case n.SunAzimuth:case n.SunElevation:case n.Dawn:case n.GlobalRadiation:e=r.Sun;break;case n.BrightnessNorth:case n.BrightnessEast:case n.BrightnessSouth:case n.BrightnessWest:e=r.Brightness;break;case n.WindDirection:case n.WindSpeed:e=r.Wind;break;default:e=-1}e<0||(this.__dataGroups[e].Children.push(t),e===r.Wind&&this.__dataGroups[r.WindCompass].Children.push(t))}}__constructWeatherStation(){let t,i,s,o,_,l="",d=[],u="",p=$("<div>"),c=p,g=p,m=p,b=p,B=p,W=p,S=p,y=p;this.__lwiStatic&&(this.__lwiStatic.forEach((t=>t())),this.__lwiStatic.length=0),this.__htmlGroups.empty(),this.__htmlDatasets.clear(),this.__lwiStatic.push(e.Locale.Localization.watchText(e.Locale.LangKey.Yes,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&(this.__strYes=t.text,this.__updateValue(n.Rain))}))),this.__lwiStatic.push(e.Locale.Localization.watchText(e.Locale.LangKey.No,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&(this.__strNo=t.text,this.__updateValue(n.Rain))}))),this.__lwiStatic.push(e.Locale.Localization.watchText(e.Locale.LangKey.North,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&(this.__strNorth=t.text,this.__updateValue(n.BrightnessNorth),this.__updateValue(h.BrightnessNorth))}))),this.__lwiStatic.push(e.Locale.Localization.watchText(e.Locale.LangKey.East,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&(this.__strEast=t.text,this.__updateValue(n.BrightnessEast),this.__updateValue(h.BrightnessEast))}))),this.__lwiStatic.push(e.Locale.Localization.watchText(e.Locale.LangKey.South,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&(this.__strSouth=t.text,this.__updateValue(n.BrightnessSouth),this.__updateValue(h.BrightnessSouth))}))),this.__lwiStatic.push(e.Locale.Localization.watchText(e.Locale.LangKey.West,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&(this.__strWest=t.text,this.__updateValue(n.BrightnessWest),this.__updateValue(h.BrightnessWest))}))),this.__lwiStatic.push(e.Locale.Localization.watchText(e.Locale.LangKey.Brightness,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&(this.__strBrightness=t.text,this.__dataGroups[r.WindCompass].Visibility&&(this.__updateValue(n.BrightnessNorth),this.__updateValue(h.BrightnessNorth),this.__updateValue(n.BrightnessEast),this.__updateValue(h.BrightnessEast),this.__updateValue(n.BrightnessSouth),this.__updateValue(h.BrightnessSouth),this.__updateValue(n.BrightnessWest),this.__updateValue(h.BrightnessWest)))})));for(let V=0;V<this.__dataGroups.length;V++){if(!this.__dataGroups[V].Visibility)continue;if(i=this.__dataGroups[V].Name,i!==r[r.WindCompass])o=$("<div>").addClass("group");else{switch(this.__displayMode){case a.Compact:u="groupComp-c";break;case a.Normal:u="groupComp-n";break;case a.NormalReduced:u="groupComp-nr"}o=$("<div>").addClass(u)}let C=$("<div>").text("group").addClass("title");if(o.append(C),this.__htmlGroups.append(o),this.__htmlCompass=$("<div>").addClass("compass"),null!=this.__svgCompass&&this.__htmlCompass.append(this.__svgCompass),i===r[r.WindCompass])switch(this.__displayMode){case a.Normal:m=$("<div>").addClass("sideT"),o.append(m),y=$("<div>").addClass("mid"),W=$("<div>").addClass("sideL"),b=$("<div>").addClass("sideR"),y.append(W),y.append(this.__htmlCompass),y.append(b),o.append(y),B=$("<div>").addClass("sideB"),S=$("<div>").addClass("sideB"),o.append(B),o.append(S);break;case a.NormalReduced:S=$("<div>").addClass("sideB"),o.append(this.__htmlCompass),o.append(S);break;default:o.append(this.__htmlCompass)}l="KeyL_"+i,i===r[r.Sun]&&(l+="Star"),this.__lwiStatic.push(e.Locale.Localization.watchText(l,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&C.text(t.text)})));for(let u=0;u<this.__dataGroups[V].Children.length;u++){s=!1,t=this.__dataGroups[V].Children[u];let y=t;if(i!==r[r.WindCompass])_=$("<div>").addClass("dataset"),c=$("<div>").addClass("name"),g=$("<div>").addClass("value").text("-"),_.append(c),_.append(g),o.append(_);else{let e=p;switch(t){case n.WindDirection:y=h.WindDirection;break;case n.WindSpeed:y=h.WindSpeed,e=S;break;case n.BrightnessNorth:y=h.BrightnessNorth,e=m,s=!0;break;case n.BrightnessEast:y=h.BrightnessEast,e=b,s=!0;break;case n.BrightnessSouth:y=h.BrightnessSouth,e=B,s=!0;break;case n.BrightnessWest:y=h.BrightnessWest,e=W,s=!0}c=p,this.__displayMode===a.Compact?(_=$("<div>").addClass("dataset"),c=$("<div>").addClass("name"),g=$("<div>").addClass("value").text("-"),_.append(c),_.append(g),o.append(_)):g=e}this.__htmlDatasets.set(y,{Name:c,Value:g}),s?this.__updateValue(s?y:t):(d=Object.keys(n).filter((e=>n[e]===t)),d.length<=0||(l="KeyL_"+d[0],this.__lwiStatic.push(e.Locale.Localization.watchText(l,(t=>{if(e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text){let e=this.__htmlDatasets.get(y);if(!e)return;e.Name.text(t.text)}})))))}}}__updateValue(e){let i=this.__htmlDatasets.get(e),s=this.__dataWeather.get(e),a="-",r="";if(i){switch(e){case h.BrightnessNorth:s=this.__dataWeather.get(n.BrightnessNorth);break;case h.BrightnessEast:s=this.__dataWeather.get(n.BrightnessEast);break;case h.BrightnessSouth:s=this.__dataWeather.get(n.BrightnessSouth);break;case h.BrightnessWest:s=this.__dataWeather.get(n.BrightnessWest);break;case h.WindDirection:s=this.__dataWeather.get(n.WindDirection);break;case h.WindSpeed:s=this.__dataWeather.get(n.WindSpeed)}if(s){if(null!==s.Value&&(a=""+s.Value,e===h.WindDirection)){let e=t.ValueConverter.toNumber(s.Value);this.__setCompassDirection(e||0)}null!==s.Unit&&(r=s.Unit)}switch(e){case n.Rain:s&&null!=s.Value&&(a=s.Value?this.__strYes:this.__strNo),r="";break;case n.HumidityAbsolute:r=r.slice(0,4);break;case n.HumidityRelative:r=r.slice(0,1);break;case h.BrightnessNorth:case n.BrightnessNorth:i.Name.text(this.__strBrightness+" "+this.__strNorth);break;case h.BrightnessEast:case n.BrightnessEast:i.Name.text(this.__strBrightness+" "+this.__strEast);break;case h.BrightnessSouth:case n.BrightnessSouth:i.Name.text(this.__strBrightness+" "+this.__strSouth);break;case h.BrightnessWest:case n.BrightnessWest:i.Name.text(this.__strBrightness+" "+this.__strWest)}i.Value.text(a+" "+r)}}__adjustDisplayMode(){if(this.__displayMode=a.Normal,null!=this.__dataGroups&&this.__dataGroups.length>0)for(let t=0;t<this.__dataGroups.length;t++)if(this.__dataGroups[t].Name!==this.__dataGroups[r.WindCompass].Name&&this.__dataGroups[t].Visibility){this.__displayMode=a.Compact;break}this.__displayMode!==a.Compact&&this.__element[0].clientWidth<260&&(this.__displayMode=a.NormalReduced)}__updateWeatherStation(){this.__adjustDisplayMode(),this.__constructWeatherStation(),this.__addBaVarWatches()}__addBaVarWatches(){if(null==this.__babos||this.__babos.size<=0)return;let i,s;for(let a=0;a<this.__dataGroups.length;a++)if(this.__dataGroups[a].Visibility){i=this.__dataGroups[a];for(let a=0;a<i.Children.length;a++){let o=i.Children[a],_=o;if(s=this.__babos.get(o),!s)continue;if(!s.SubjectInfo)continue;if(null==s.SubjectInfo.Identifier)continue;if(i.Name===r[r.WindCompass])switch(o){case n.WindDirection:_=h.WindDirection;break;case n.WindSpeed:_=h.WindSpeed;break;case n.BrightnessNorth:_=h.BrightnessNorth;break;case n.BrightnessEast:_=h.BrightnessEast;break;case n.BrightnessSouth:_=h.BrightnessSouth;break;case n.BrightnessWest:_=h.BrightnessWest}let l=this.busyHandler.setBusy("Read "+o+" present value.");if(s.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{l&&(l(),l=null);let i=null;if(i=t.ValueConverter.toNumber(e),null==i)return;let s=this.__dataWeather.get(o);null!=s&&(s.Value=i,this.__updateValue(_))})),o===n.Rain)continue;let d=this.busyHandler.setBusy("Read "+o+" unit.");s.tryWatchBaVariable(e.BA.BaParameterId.eUnit,(t=>{d&&(d(),d=null);let i=e.Helper.convertUnitToString(t);if(null==i)return;let s=this.__dataWeather.get(o);null!=s&&(s.Unit=i,this.__updateValue(_))}))}}}__removeBaVarWatches(){this.__babos.forEach(((t,e)=>{t.stopAllWatches()})),this.__babos.clear()}__resetDataWeather(){for(let[t,e]of this.__dataWeather)e.Value=null,e.Unit=null,this.__updateValue(t);for(let t in h)this.__updateValue(h[t])}__setCompassDirection(t){t+=t>=0?180:-180,this.__htmlCompass.css("--tchmi-ba-icon-rotation",t+"deg")}setVisibilityPosition(t){t!==this.__dataGroups[r.Position].Visibility&&(this.__dataGroups[r.Position].Visibility=t,this.__updateWeatherStation())}getVisibilityPosition(){return this.__dataGroups[r.Position].Visibility}setVisibilityTemperature(t){t!==this.__dataGroups[r.Temperature].Visibility&&(this.__dataGroups[r.Temperature].Visibility=t,this.__updateWeatherStation())}getVisibilityTemperature(){return this.__dataGroups[r.Temperature].Visibility}setVisibilityAirPressure(t){t!==this.__dataGroups[r.AirPressure].Visibility&&(this.__dataGroups[r.AirPressure].Visibility=t,this.__updateWeatherStation())}getVisibilityAirPressure(){return this.__dataGroups[r.AirPressure].Visibility}setVisibilityHumidity(t){t!==this.__dataGroups[r.Humidity].Visibility&&(this.__dataGroups[r.Humidity].Visibility=t,this.__updateWeatherStation())}getVisibilityHumidity(){return this.__dataGroups[r.Humidity].Visibility}setVisibilitySun(t){t!==this.__dataGroups[r.Sun].Visibility&&(this.__dataGroups[r.Sun].Visibility=t,this.__updateWeatherStation())}getVisibilitySun(){return this.__dataGroups[r.Sun].Visibility}setVisibilityBrightness(t){t!==this.__dataGroups[r.Brightness].Visibility&&(this.__dataGroups[r.Brightness].Visibility=t,this.__updateWeatherStation())}getVisibilityBrightness(){return this.__dataGroups[r.Brightness].Visibility}setVisibilityWind(t){t!==this.__dataGroups[r.Wind].Visibility&&(this.__dataGroups[r.Wind].Visibility=t,this.__updateWeatherStation())}getVisibilityWind(){return this.__dataGroups[r.Wind].Visibility}setVisibilityWindCompass(t){t!==this.__dataGroups[r.WindCompass].Visibility&&(this.__dataGroups[r.WindCompass].Visibility=t,this.__updateWeatherStation())}getVisibilityWindCompass(){return this.__dataGroups[r.WindCompass].Visibility}processBaObject(){if(super.processBaObject(),this.__removeBaVarWatches(),this.__resetDataWeather(),null==this.baObjectHandler.baObject)return;if(!this.baObjectHandler.baObject.checkTemplate(o.BaTemplateDefinition,this.baTemplateHandler.baBaTemplateDescription,this,!0))return;let t,e;for(e in o.BaTemplateDescription)t=this.baObjectHandler.baObject.getTemplateChild(e),t&&this.__babos.set(e,t);this.__addBaVarWatches()}}s.WeatherStation=o,function(t){t.BaTemplateDefinition={Dstb:{optional:!0},Rain:{optional:!0},WthT:{optional:!0},DewPtT:{optional:!0},PrssAbs:{optional:!0},PrssRel:{optional:!0},HumAbs:{optional:!0},HumRel:{optional:!0},Brightness_N:{optional:!0},Brightness_E:{optional:!0},Brightness_S:{optional:!0},Brightness_W:{optional:!0},Dawn:{optional:!0},GlobRadn:{optional:!0},WndDir:{optional:!0},WndSpd:{optional:!0},Latd:{optional:!0},Lngt:{optional:!0},SunAzm:{optional:!0},SunElv:{optional:!0}},t.BaTemplateDescription={Dstb:{identifier:"Dstb"},Rain:{identifier:"Rain"},WthT:{identifier:"WthT"},DewPtT:{identifier:"DewPtT"},PrssAbs:{identifier:"PrssAbs"},PrssRel:{identifier:"PrssRel"},HumAbs:{identifier:"HumAbs"},HumRel:{identifier:"HumRel"},Brightness_N:{identifier:"Brightness_N"},Brightness_E:{identifier:"Brightness_E"},Brightness_S:{identifier:"Brightness_S"},Brightness_W:{identifier:"Brightness_W"},Dawn:{identifier:"Dawn"},GlobRadn:{identifier:"GlobRadn"},WndDir:{identifier:"WndDir"},WndSpd:{identifier:"WndSpd"},Latd:{identifier:"Latd"},Lngt:{identifier:"Lngt"},SunAzm:{identifier:"SunAzm"},SunElv:{identifier:"SunElv"}}}(o=s.WeatherStation||(s.WeatherStation={}))}(i.BuildingGeneral||(i.BuildingGeneral={}))}(e.Controls||(e.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("WeatherStation","TcHmi.BuildingAutomation.Controls.BuildingGeneral",TcHmi.BuildingAutomation.Controls.BuildingGeneral.WeatherStation);