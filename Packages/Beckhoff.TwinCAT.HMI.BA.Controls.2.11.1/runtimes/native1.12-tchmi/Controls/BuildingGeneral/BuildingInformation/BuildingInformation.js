var TcHmi;!function(e){!function(t){!function(a){!function(r){class n extends a.Common.Button{constructor(e,t,a){super(e,t,a)}__previnit(){this.__icon=t.Icons.Events.Event.Notification.path,super.__previnit(),n.BuildingInformationInstances||(n.BuildingInformationInstances=[]),n.BuildingInformationInstances.push(this)}__init(){super.__init()}__attach(){super.__attach(),this.__destroyersToCallOnDetach.push(this.__baFc.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,(()=>this.__onPressed())))}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}__onPressed(){this.__dialogContent||this.__createDialogContent();let e=105;if(this.__attrHandler.facades&&(e=e+70*this.__attrHandler.facades.length-5),e>380&&(e=380),this.__dialogContent){if(null==this.__dialog){this.__dialog=new t.Components.DialogWindow(this.__id+"-dialog",null).setAttributes({content:this.__dialogContent,modal:!1,buttons:t.Components.DialogWindow.Buttons.CancelSize,layout:{maxWidth:515,maxHeight:e}}),this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.GeneralBuildingInformation,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&this.__dialog?.setHeadlineText(e.text)})));let a=new t.Components.LegendIconHandler([t.Icons.convertIIconDataToIIconAttributes(t.Icons.Building.BurglarAlarm),t.Icons.convertIIconDataToIIconAttributes(t.Icons.Building.FireAlarm),t.Icons.convertIIconDataToIIconAttributes(t.Icons.Building.IceAlarm),t.Icons.convertIIconDataToIIconAttributes(t.Icons.Building.Maintenance),t.Icons.convertIIconDataToIIconAttributes(t.Icons.Building.StormAlarm),t.Icons.convertIIconDataToIIconAttributes(t.Icons.Building.SunProtection),t.Icons.convertIIconDataToIIconAttributes(t.Icons.Building.ThermalAutomation)]),r=this.__dialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onOpened,(()=>{a.show()})),n=this.__dialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,(()=>{a.hide()}));this.__dialog.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{a.destroy(),r(),n(),e.destroy()}))}this.__dialog.open()}}__createIconWithLabel(e,a,r,i){let l=new t.Components.Icon(e+"-icon",this).setAttributes({iconPath:n.getIcon(a).path,iconColor:n.getIconColor(a,i),iconHeight:100,iconHeightUnit:"%",iconWidth:100,iconWidthUnit:"%",cssClass:"icon"}),o=new t.Components.Textblock(e+"-label",this).setAttributes({textAttributes:{horizontalAlignment:"Left"},cssClass:"label"});this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(r,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&o.textHandler.setText(e.text)})));let s=$("<div>");return s.addClass(`icon-with-label ${n.Alarms[a]}`).append(l.getElement(),o.getElement()),s}__createDialogContent(){if(this.__dialogContent)return;this.__dialogContent=$("<div>").addClass("tchmi-ba-building-information-dialog-content");let e=$("<div>").addClass("general-information");this.__dialogContent.append(e);let a=this.__createIconWithLabel(this.__id+"-"+n.Alarms[n.Alarms.burglar],n.Alarms.burglar,t.Locale.LangKey.BurglarAlarm,this.__attrHandler.burglarAlarm),r=this.__createIconWithLabel(this.__id+"-"+n.Alarms[n.Alarms.fire],n.Alarms.fire,t.Locale.LangKey.FireAlarm,this.__attrHandler.fireAlarm),i=this.__createIconWithLabel(this.__id+"-"+n.Alarms[n.Alarms.ice],n.Alarms.ice,t.Locale.LangKey.IceAlarm,this.__attrHandler.iceAlarm),l=this.__createIconWithLabel(this.__id+"-"+n.Alarms[n.Alarms.thermal],n.Alarms.thermal,t.Locale.LangKey.ThermalAutomatic,this.__attrHandler.thermalAutomatic);e.append(r,a,i,l),this.__attrHandler.facades&&this.__processFacades(),this.__updateCountDisplay()}__updateCountDisplay(){let e=0;this.__attrHandler.fireAlarm&&e++,this.__attrHandler.burglarAlarm&&e++,this.__attrHandler.iceAlarm&&e++,this.__attrHandler.facades?.find((e=>1==e.maintenance))&&e++,this.__attrHandler.facades?.find((e=>1==e.stormProtection))&&e++,t.Components.Button.addBadge(this.__element,e)}static getIconColor(e,a){switch(e){case n.Alarms.burglar:case n.Alarms.fire:return a?t.Color.RGBAColor.Red:this.__defaultIconColor;case n.Alarms.ice:case n.Alarms.storm:return a?t.Color.RGBAColor.Blue:this.__defaultIconColor;case n.Alarms.maintenance:case n.Alarms.sun:case n.Alarms.thermal:return a?t.Color.RGBAColor.DarkOrange:this.__defaultIconColor;default:return this.__defaultIconColor}}static getIcon(e){switch(e){case n.Alarms.burglar:return t.Icons.Building.BurglarAlarm;case n.Alarms.fire:return t.Icons.Building.FireAlarm;case n.Alarms.ice:return t.Icons.Building.IceAlarm;case n.Alarms.maintenance:return t.Icons.Building.Maintenance;case n.Alarms.storm:return t.Icons.Building.StormAlarm;case n.Alarms.sun:return t.Icons.Building.SunProtection;case n.Alarms.thermal:return t.Icons.Building.ThermalAutomation}}setAttributes(e){return super.setAttributes(e),void 0!==e.fireAlarm&&this.setFireAlarm(e.fireAlarm),void 0!==e.burglarAlarm&&this.setBurglarAlarm(e.burglarAlarm),void 0!==e.iceAlarm&&this.setIceAlarm(e.iceAlarm),void 0!==e.facades&&this.setFacades(e.facades),this}getAttributes(){return this.__attrHandler}setFireAlarm(t){let a=e.ValueConverter.toBoolean(t);return null==a&&(a=this.getAttributeDefaultValueInternal("FireAlarm")),a===this.__attrHandler.fireAlarm||(null==a&&(a=!1),this.__attrHandler.fireAlarm=a,this.__processFireAlarm(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"FireAlarm"}),e.EventProvider.raise(n.BuildingInformantionEvents.onBuildingInformationChanged)),this}__processFireAlarm(){let e=this.childrenHandler.getChild(this.__id+"-"+n.Alarms[n.Alarms.fire]+"-icon");e&&e.iconHandler.setIconColor(n.getIconColor(n.Alarms.fire,this.__attrHandler.fireAlarm)),this.__updateCountDisplay()}getFireAlarm(){return this.__attrHandler.fireAlarm}setBurglarAlarm(t){let a=e.ValueConverter.toBoolean(t);return null==a&&(a=this.getAttributeDefaultValueInternal("BurglarAlarm")),a===this.__attrHandler.burglarAlarm||(null==a&&(a=!1),this.__attrHandler.burglarAlarm=a,this.__processBurglarAlarm(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"BurglarAlarm"}),e.EventProvider.raise(n.BuildingInformantionEvents.onBuildingInformationChanged)),this}__processBurglarAlarm(){let e=this.childrenHandler.getChild(this.__id+"-"+n.Alarms[n.Alarms.burglar]+"-icon");e&&e.iconHandler.setIconColor(n.getIconColor(n.Alarms.burglar,this.__attrHandler.burglarAlarm)),this.__updateCountDisplay()}getBurglarAlarm(){return this.__attrHandler.burglarAlarm}setIceAlarm(t){let a=e.ValueConverter.toBoolean(t);return null==a&&(a=this.getAttributeDefaultValueInternal("IceAlarm")),a===this.__attrHandler.iceAlarm||(null==a&&(a=!1),this.__attrHandler.iceAlarm=a,this.__processIceAlarm(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IceAlarm"}),e.EventProvider.raise(n.BuildingInformantionEvents.onBuildingInformationChanged)),this}__processIceAlarm(){let e=this.childrenHandler.getChild(this.__id+"-"+n.Alarms[n.Alarms.ice]+"-icon");e&&e.iconHandler.setIconColor(n.getIconColor(n.Alarms.ice,this.__attrHandler.iceAlarm)),this.__updateCountDisplay()}getIceAlarm(){return this.__attrHandler.iceAlarm}setThermalAutomatic(t){let a=e.ValueConverter.toBoolean(t);return null==a&&(a=this.getAttributeDefaultValueInternal("ThermalAutomatic")),a===this.__attrHandler.thermalAutomatic||(null==a&&(a=!1),this.__attrHandler.thermalAutomatic=a,this.__processThermalAutomatic(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ThermalAutomatic"}),e.EventProvider.raise(n.BuildingInformantionEvents.onBuildingInformationChanged)),this}__processThermalAutomatic(){let e=this.childrenHandler.getChild(this.__id+"-"+n.Alarms[n.Alarms.thermal]+"-icon");e&&e.iconHandler.setIconColor(n.getIconColor(n.Alarms.thermal,this.__attrHandler.thermalAutomatic))}getThermalAutomatic(){return this.__attrHandler.thermalAutomatic}setFacades(t){let a=e.ValueConverter.toObject(t);null==a&&(a=this.getAttributeDefaultValueInternal("Facades"));let r=this.__objectResolvers.get("facades");r&&(r.watchDestroyer&&r.watchDestroyer(),r.resolver.destroy());let n=new e.Symbol.ObjectResolver(a);return this.__objectResolvers.set("facades",{resolver:n,watchCallback:this.__onResolverForFacadesWatchCallback.bind(this),watchDestroyer:n.watch(this.__onResolverForFacadesWatchCallback.bind(this))}),this}__onResolverForFacadesWatchCallback(a){if(0!=this.logger.checkServerResult(t.Logger.Severity.error,a)&&!tchmi_equal(a.value,this.__attrHandler.facades)){if(this.__attrHandler.facades&&a.value?.length===this.__attrHandler.facades.length)for(let t=0;t<this.__attrHandler.facades.length;t++){let r=this.__attrHandler.facades[t],i=a.value[t];tchmi_equal(i,r)||(this.__attrHandler.facades[t]=i,e.EventProvider.raise(n.BuildingInformantionEvents.onBuildingInformationChanged))}else if(this.__attrHandler.facades=a.value,a.value){let t=[];for(let r=0;r<a.value.length;r++){let i=a.value[r];i.name?t.indexOf(i.name)>-1?this.logger.warn(`Duplicate facade name found '${i.name}'! Facade names must be unique in BuildingInformation instance.`):(t.push(i.name),e.EventProvider.raise(n.BuildingInformantionEvents.onBuildingInformationChanged)):this.logger.warn("Facade name was not set but is required!")}}this.__processFacades(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Facades"})}}__processFacades(){if(!this.__attrHandler.facades||!this.__dialogContent)return;let e=this.__dialogContent.children(".facades");null==e[0]&&(e=$("<div>").addClass("facades"),this.__dialogContent.append(e));for(let a=0;a<this.__attrHandler.facades.length;a++){let r=this.__attrHandler.facades[a];if(!r.name){this.logger.warn("Facade name was not set but is required!");continue}let i=this.__id+"-facades-"+t.Helper.String.removeAllWhiteSpaces(r.name),l=e.children(`#${i}`);null==l[0]&&(l=$("<div>").attr("id",i).addClass("facade-info"),e.append(l));let o=this.childrenHandler.getChild(i+"-name-field");o||(o=new t.Components.Textblock(i+"-name-field",this).setAttributes({cssClass:"name-field",layout:{width:100,widthUnit:"%",height:100,heightUnit:"%"},contentPadding:{left:0,top:0,right:0,bottom:0},textAttributes:{horizontalAlignment:"Left",fontWeight:"Bold",decorationLine:"underline",decorationStyle:"solid",fontSize:16}}),l.append(o.getElement())),this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Facade,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&o?.textHandler.setText(e.text+" "+r.name)})));let s=this.childrenHandler.getChild(i+"-"+n.Alarms[n.Alarms.maintenance]+"-icon");s||(l.append(this.__createIconWithLabel(i+"-"+n.Alarms[n.Alarms.maintenance],n.Alarms.maintenance,t.Locale.LangKey.Maintenance,r.maintenance)),s=this.childrenHandler.getChild(i+"-"+n.Alarms[n.Alarms.maintenance]+"-icon")),s?.iconHandler.setIconColor(n.getIconColor(n.Alarms.maintenance,r.maintenance));let c=this.childrenHandler.getChild(i+"-"+n.Alarms[n.Alarms.storm]+"-icon");c||(l.append(this.__createIconWithLabel(i+"-"+n.Alarms[n.Alarms.storm],n.Alarms.storm,t.Locale.LangKey.StormAlarm,r.stormProtection)),c=this.childrenHandler.getChild(i+"-"+n.Alarms[n.Alarms.storm]+"-icon")),c?.iconHandler.setIconColor(n.getIconColor(n.Alarms.storm,r.stormProtection));let d=this.childrenHandler.getChild(i+"-"+n.Alarms[n.Alarms.sun]+"-icon");d||(l.append(this.__createIconWithLabel(i+"-"+n.Alarms[n.Alarms.sun],n.Alarms.sun,t.Locale.LangKey.SunProtection,r.sunProtection)),d=this.childrenHandler.getChild(i+"-"+n.Alarms[n.Alarms.sun]+"-icon")),d?.iconHandler.setIconColor(n.getIconColor(n.Alarms.sun,r.sunProtection))}this.__updateCountDisplay()}getFacades(){return this.__attrHandler.facades}__processIcon(){null==this.__icon&&(this.__icon=t.Icons.Events.Event.Notification.path),super.__processIcon()}}n.__defaultIconColor=t.Color.RGBAColor.Gray,r.BuildingInformation=n,function(e){let t,a;!function(e){e[e.fire=0]="fire",e[e.burglar=1]="burglar",e[e.ice=2]="ice",e[e.maintenance=3]="maintenance",e[e.storm=4]="storm",e[e.sun=5]="sun",e[e.thermal=6]="thermal"}(t=e.Alarms||(e.Alarms={})),function(e){e.onBuildingInformationChanged="onBuildingInformationChanged"}(a=e.BuildingInformantionEvents||(e.BuildingInformantionEvents={}))}(n=r.BuildingInformation||(r.BuildingInformation={}))}(a.BuildingGeneral||(a.BuildingGeneral={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("BuildingInformation","TcHmi.BuildingAutomation.Controls.BuildingGeneral",TcHmi.BuildingAutomation.Controls.BuildingGeneral.BuildingInformation);