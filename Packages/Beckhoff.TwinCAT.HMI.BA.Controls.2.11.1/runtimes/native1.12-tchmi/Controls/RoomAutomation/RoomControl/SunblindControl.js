var TcHmi;!function(e){!function(t){!function(n){!function(n){!function(s){class i extends s.ControlUnit{constructor(e,t){super(e,t),this.__positionFeedbackReady=[],this.__angleFeedbackReady=[],this.__useCurrentPosition=!1,this.__useCurrentAngle=!1,this.__element.addClass("sunblind"),this.baInterfaceHandler.baInterfaceDefinition=n.Sunblind.BaInterfaceDef,this.setBaInterfaceSymbolNames(n.Sunblind.BaInterfaceSymbolNames)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__positionDisplay?.destroy(),this.__angleDisplay?.destroy(),super.destroy()}createElement(){super.createElement(),this.__icon||(this.__icon=new n.Sunblind.Icon(this.__id+"-sunblind",this),this.__icon.setAttributes(this.__attrHandler).setReadOnly(!0).getElement().addClass("icon"),this.__iconContainer?.append(this.__icon.getElement())),this.__positionDisplay||(this.__positionDisplay=new t.Components.Textblock(this.__id+"-position-display",this),this.__positionDisplay.getElement().css("order",2),this.__controlContainer?.addControl(this.__positionDisplay)),this.__attrHandler.usePosition&&this.__attrHandler.useAngle?this.__angleDisplay||(this.__angleDisplay=new t.Components.Textblock(this.__id+"-angle-display",this),this.__angleDisplay.getElement().css("order",3),this.__controlContainer?.addControl(this.__angleDisplay)):this.__angleDisplay&&(this.__controlContainer?.removeControl(this.__angleDisplay),delete this.__angleDisplay),this.__updateElements()}getSideControl(){return this.__sideControlContainer=super.getSideControl(),this.__sideControl&&(this.__sideControlContainer.addClass("sunblind"),this.__updateSideControl()),this.__sideControlContainer}writePosition(s){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=n.Sunblind.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(n.Sunblind.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&n.Sunblind.writePositionToPlc(s,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&n.Sunblind.writePositionToPlc(s,this.baInterfaceHandler),this.__attrHandler.positionMapping&&e.Server.writeSymbol(this.__attrHandler.positionMapping,s,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e,!1)})),this.__processChangedPosition(s)}writeOpenToPlc(){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=n.Sunblind.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(n.Sunblind.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&n.Sunblind.writeOpenToPlc(this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&n.Sunblind.writeOpenToPlc(this.baInterfaceHandler)}writeCloseToPlc(){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=n.Sunblind.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(n.Sunblind.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&n.Sunblind.writeCloseToPlc(this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&n.Sunblind.writeCloseToPlc(this.baInterfaceHandler)}writeAngle(s){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=n.Sunblind.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(n.Sunblind.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&n.Sunblind.writeAngleToPlc(s,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&n.Sunblind.writeAngleToPlc(s,this.baInterfaceHandler),this.__attrHandler.angleMapping&&e.Server.writeSymbol(this.__attrHandler.angleMapping,s,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e,!1)})),this.__processChangedAngle(s)}resetManualToPlc(){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=n.Sunblind.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(n.Sunblind.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&n.Sunblind.resetManualToPlc(this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&n.Sunblind.resetManualToPlc(this.baInterfaceHandler)}getIsLocked(){return n.Sunblind.getIsLocked(this.__attrHandler)}getPriorityIcon(e){return n.Sunblind.getPriorityDisplayIcon(e)}hasManualPriority(){return n.Sunblind.isManualPriority(this.__attrHandler.priority)}__processChangedPosition(e){if(1!=this.busyHandler.getIsBusy()&&void 0!==e&&(this.__useCurrentPosition=!0,this.setPosition(e),null!=this.__attrHandler.positionFeedback&&e!=this.__attrHandler.positionFeedback)){let e=()=>{this.__positionFeedbackReady.forEach((e=>e())),this.__positionFeedbackReady=[],this.setPosition(this.__attrHandler.positionFeedback)};this.__sideControlContainer&&0==this.busyHandler.getIsBusy()&&n.showBusyIndicator&&t.BusyHandler.appendBusyIndicator(this.__sideControlContainer);let s=this.logger.logPerformance(t.Logger.Severity.debug,"Position feedback response."),i=()=>{s(),this.__sideControlContainer&&t.BusyHandler.detachBusyIndicator(this.__sideControlContainer)};this.__positionFeedbackReady.push(this.busyHandler.setBusy("Waiting for PositionFeedback",{cbOnTimeout:e,cbOnReady:i,showIndicator:n.showBusyIndicator}))}}__processChangedAngle(e){if(1!=this.busyHandler.getIsBusy()&&void 0!==e&&(this.__useCurrentAngle=!0,this.setAngle(e),null!=this.__attrHandler.angleFeedback&&e!=this.__attrHandler.angleFeedback)){let e=()=>{this.__angleFeedbackReady.forEach((e=>e())),this.__angleFeedbackReady=[],this.setAngle(this.__attrHandler.angleFeedback)};this.__sideControlContainer&&0==this.busyHandler.getIsBusy()&&n.showBusyIndicator&&t.BusyHandler.appendBusyIndicator(this.__sideControlContainer);let s=this.logger.logPerformance(t.Logger.Severity.debug,"Angle feedback response."),i=()=>{s(),this.__sideControlContainer&&t.BusyHandler.detachBusyIndicator(this.__sideControlContainer)};this.__angleFeedbackReady.push(this.busyHandler.setBusy("Waiting for AngleFeedback",{cbOnTimeout:e,cbOnReady:i,showIndicator:n.showBusyIndicator}))}}__updateElements(){let e=0,t=0;if(this.__attrHandler.usePosition&&null!=this.__attrHandler.position)e=this.__attrHandler.position,null!=this.__attrHandler.positionFeedback&&0==this.__useCurrentPosition&&(e=this.__attrHandler.positionFeedback),this.__useCurrentPosition=!1,this.__elementCreated&&this.__positionDisplay?.textHandler.setText(n.Sunblind.getPercentagePosition(e,n.Sunblind.ClosePosition,n.Sunblind.OpenPosition)?.toFixed(0)+" %"),this.__sideControl&&(this.__sideControl.getControl(i.__positionSliderName)?.setValue(this.__attrHandler.position),null!=this.__attrHandler.positionFeedback&&this.__sideControl.getControl(i.__positionSliderName)?.setValueFeedback(this.__attrHandler.positionFeedback)),this.__attrHandler.useAngle&&null!=this.__attrHandler.angle&&(t=this.__attrHandler.angle,null!=this.__attrHandler.angleFeedback&&0==this.__useCurrentAngle&&(t=this.__attrHandler.angleFeedback),this.__useCurrentAngle=!1,!this.__angleDisplay&&this.__attrHandler.useAngle&&this.createElement(),this.__elementCreated&&this.__angleDisplay?.textHandler.setText(t.toFixed(0)+" &#8737"),this.__sideControl&&(this.__sideControl.getControl(i.__angleSliderName)?.setValue(this.__attrHandler.angle),null!=this.__attrHandler.angleFeedback&&this.__sideControl.getControl(i.__angleSliderName)?.setValueFeedback(this.__attrHandler.angleFeedback)));else{let s,i=(n.Sunblind.ClosePosition-n.Sunblind.OpenPosition)/2;switch(n.Sunblind.determinePositionState(this.__attrHandler.openFeedback,this.__attrHandler.closeFeedback)){case n.Sunblind.PositionState.opened:e=n.Sunblind.OpenPosition,s="Opened";break;case n.Sunblind.PositionState.closed:e=n.Sunblind.ClosePosition,s="Closed";break;default:e=i,s="Opened"}t=(n.Sunblind.MaximumAngle-n.Sunblind.MinimumAngle)/2,this.__elementCreated&&this.__positionDisplay?.textHandler.setText(s)}this.__elementCreated&&(this.__icon?.setPosition(e),this.__icon?.setAngle(t))}__updateSideControl(){if(null==this.__sideControl)return;if(null==this.__attrHandler)return;let e={type:t.Components.ComponentType.Button,name:i.__positionDownButtonName,settings:{order:1,iconPath:t.Icons.Standard.Down.path},callback:()=>{this.writeCloseToPlc()}},s={type:t.Components.ComponentType.Button,name:i.__positionUpButtonName,settings:{order:3,iconPath:t.Icons.Standard.Up.path,showBusyIndicator:n.showBusyIndicator},callback:()=>{this.writeOpenToPlc()}};if(this.__attrHandler.usePosition){e.settings.cssClass="fixed-size",s.settings.cssClass="fixed-size",null==this.__sideControl.getControl(i.__positionDownButtonName)&&this.__sideControl.addControl(e),null==this.__sideControl.getControl(i.__positionSliderName)&&this.__sideControl.addControl({type:t.Components.ComponentType.Slider,name:i.__positionSliderName,settings:{value:this.__attrHandler.position,order:2,layout:{maxHeight:19,minHeight:19,maxWidth:90},showBusyIndicator:n.showBusyIndicator},callback:e=>{this.writePosition(e)},cbOnCreated:e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Position,(n=>{t.Logger.checkServerResult(t.Logger.Severity.warn,n)&&e.textHandler.setText(n.text)})))}}),null==this.__sideControl.getControl(i.__positionUpButtonName)&&this.__sideControl.addControl(s);let a=this.__sideControl.getControl(i.__positionSliderName);if(null==a)throw new Error("Position slider could not be created!");if(a.setMinValue(n.Sunblind.ClosePosition).setMaxValue(n.Sunblind.OpenPosition),this.__attrHandler.useAngle)if(n.Sunblind.UseButtonsForAngle)null!=this.__sideControl.getControl(i.__angleSliderName)&&this.__sideControl.removeControl(i.__angleSliderName),null==this.__sideControl.getControl(i.__angleMinusButtonName)&&this.__sideControl.addControl({type:t.Components.ComponentType.Button,name:i.__angleMinusButtonName,settings:{order:4,cssClass:"fixed-size",iconPath:t.Icons.RoomAutomation.SunblindAngleAdjustmentDown.path},callback:(e,t,s)=>{if(null!=this.__attrHandler.angle){let e=this.__attrHandler.angle-(null!=this.__attrHandler.angleStep?this.__attrHandler.angleStep:5);n.Sunblind.MaximumAngle>n.Sunblind.MinimumAngle?e<=n.Sunblind.MinimumAngle&&(e=n.Sunblind.MinimumAngle,s?.setIsEnabled(!1)):e<=n.Sunblind.MaximumAngle&&(e=n.Sunblind.MaximumAngle,s?.setIsEnabled(!1)),this.writeAngle(e),this.__sideControl?.getControl(i.__anglePlusButtonName)?.setIsEnabled(!0)}}}),null==this.__sideControl.getControl(i.__anglePlusButtonName)&&this.__sideControl.addControl({type:t.Components.ComponentType.Button,name:i.__anglePlusButtonName,settings:{order:5,cssClass:"fixed-size",iconPath:t.Icons.RoomAutomation.SunblindAngleAdjustmentUp.path},callback:(e,t,s)=>{if(null!=this.__attrHandler.angle){let e=this.__attrHandler.angle+(null!=this.__attrHandler.angleStep?this.__attrHandler.angleStep:5);n.Sunblind.MaximumAngle>n.Sunblind.MinimumAngle?(e>n.Sunblind.MaximumAngle||e==n.Sunblind.MinimumAngle)&&(e=n.Sunblind.MaximumAngle,s?.setIsEnabled(!1)):(e>n.Sunblind.MinimumAngle||e==n.Sunblind.MaximumAngle)&&(e=n.Sunblind.MinimumAngle,s?.setIsEnabled(!1)),this.writeAngle(e),this.__sideControl?.getControl(i.__angleMinusButtonName)?.setIsEnabled(!0)}}});else{null!=this.__sideControl.getControl(i.__angleMinusButtonName)&&this.__sideControl.removeControl(i.__angleMinusButtonName),null!=this.__sideControl.getControl(i.__anglePlusButtonName)&&this.__sideControl.removeControl(i.__anglePlusButtonName);let e=this.__sideControl.getControl(i.__angleSliderName);if(null==e&&(this.__sideControl.addControl({type:t.Components.ComponentType.Slider,name:i.__angleSliderName,settings:{value:this.__attrHandler.angle,order:4,layout:{maxHeight:19,minHeight:19,maxWidth:90}},callback:e=>{this.writeAngle(e)},cbOnCreated:e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Angle,(n=>{t.Logger.checkServerResult(t.Logger.Severity.warn,n)&&e.textHandler.setText(n.text)})))}}),this.__sideControlContainer?.addClass("use-angle"),e=this.__sideControl.getControl(i.__angleSliderName)),null==e)throw new Error(this.logger.error("Angle slider could not be created!"));e.setMinValue(n.Sunblind.MinimumAngle).setMaxValue(n.Sunblind.MaximumAngle)}else null!=this.__sideControl.getControl(i.__angleSliderName)&&this.__sideControl.removeControl(i.__angleSliderName),null!=this.__sideControl.getControl(i.__angleMinusButtonName)&&this.__sideControl.removeControl(i.__angleMinusButtonName),null!=this.__sideControl.getControl(i.__anglePlusButtonName)&&this.__sideControl.removeControl(i.__anglePlusButtonName)}else null==this.__sideControl.getControl(i.__positionDownButtonName)&&this.__sideControl.addControl(e),null==this.__sideControl.getControl(i.__positionUpButtonName)&&this.__sideControl.addControl(s);this.__updateElements()}setAttributes(e){return super.setAttributes(e),void 0!==e.usePosition&&this.setUsePosition(e.usePosition),void 0!==e.useAngle&&this.setUseAngle(e.useAngle),void 0!==e.angleStep&&this.setAngleStep(e.angleStep),void 0!==e.openedColor&&this.setOpenedColor(e.openedColor),void 0!==e.closedColor&&this.setClosedColor(e.closedColor),void 0!==e.slatColor&&this.setSlatColor(e.slatColor),this.baObjectHandler.baObject||(this.__handleProperty(e,"openFeedback",this.setOpenFeedback,"boolean"),this.__handleProperty(e,"closeFeedback",this.setCloseFeedback,"boolean"),this.__handleProperty(e,"position",this.setPosition,"number"),this.__handleProperty(e,"positionFeedback",this.setPositionFeedback,"number"),this.__handleProperty(e,"angle",this.setAngle,"number"),this.__handleProperty(e,"angleFeedback",this.setAngleFeedback,"number")),this}getAttributes(){return this.__attrHandler.getRef()}__processBaInterface(){super.__processBaInterface(),n.Sunblind.processBaInterface(this,{processError:e=>this.setError(e),processPriority:e=>this.setPriority(e),processOpenFeedback:e=>this.setOpenFeedback(e),processCloseFeedback:e=>this.setCloseFeedback(e),processHasResetSymbol:e=>{this.__hasResetSymbol=e,this.__processPriority()},processUsePosition:e=>this.setUsePosition(e),processPosition:e=>this.setPosition(e),processPositionFeedback:e=>this.setPositionFeedback(e),processUseAngle:e=>this.setUseAngle(e),processAngle:e=>this.setAngle(e),processAngleFeedback:e=>this.setAngleFeedback(e)})}setOpenFeedback(e){return this.__attrHandler.checkAttribute(e,"openFeedback",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.openFeedback=e,this.__processOpenFeedback(),this):this}__processOpenFeedback(){this.__updateElements()}getCloseFeedback(){return this.__attrHandler.openFeedback}setCloseFeedback(e){return this.__attrHandler.checkAttribute(e,"closeFeedback",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.closeFeedback=e,this.__processCloseFeedback(),this):this}__processCloseFeedback(){this.__updateElements()}getOpenFeedback(){return this.__attrHandler.closeFeedback}setUsePosition(e){return this.__attrHandler.checkAttribute(e,"usePosition",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.usePosition=e,this.__processUsePosition(),this):this}__processUsePosition(){this.createElement(),this.__updateSideControl()}getUsePosition(){return this.__attrHandler.usePosition}setPosition(e){return this.__attrHandler.checkAttribute(e,"position",{validator:"number"})?(this.__attrHandler.position=e,this.__processPosition(),this):this}__processPosition(){this.__updateElements()}getPosition(){return this.__attrHandler.position}setPositionFeedback(e){return this.__attrHandler.checkAttribute(e,"positionFeedback",{validator:"number"})?(this.__attrHandler.positionFeedback=e,this.__processPositionFeedback(),this):this}__processPositionFeedback(){null!=this.__attrHandler.positionFeedback&&(this.__positionFeedbackReady.forEach((e=>e())),this.__positionFeedbackReady=[],this.__updateElements())}getPositionPositionFeedback(){return this.__attrHandler.positionFeedback}setUseAngle(e){return this.__attrHandler.checkAttribute(e,"useAngle",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.useAngle=e,this.__processUseAngle(),this):this}__processUseAngle(){this.createElement(),this.__updateSideControl()}getUseAngle(){return this.__attrHandler.useAngle}setAngle(e){return this.__attrHandler.checkAttribute(e,"angle",{validator:"number"})?(this.__attrHandler.angle=e,this.__processAngle(),this):this}__processAngle(){this.__updateElements()}getAngle(){return this.__attrHandler.angle}setAngleFeedback(e){return this.__attrHandler.checkAttribute(e,"angleFeedback",{validator:"number"})?(this.__attrHandler.angleFeedback=e,this.__processAngleFeedback(),this):this}__processAngleFeedback(){null!=this.__attrHandler.angleFeedback&&(this.__angleFeedbackReady.forEach((e=>e())),this.__angleFeedbackReady=[],this.__updateElements())}getAngleFeedback(){return this.__attrHandler.angleFeedback}setAngleStep(e){return this.__attrHandler.checkAttribute(e,"angleStep",{validator:"number"})?(this.__attrHandler.angleStep=e,this):this}getAngleStep(){return this.__attrHandler.angleStep}setOpenedColor(e){return this.__attrHandler.checkColorAttribute(e,"openedColor")?(this.__attrHandler.openedColor=e,this.__icon?.setOpenedColor(e),this):this}getOpenedColor(){return this.__attrHandler.openedColor}setClosedColor(e){return this.__attrHandler.checkColorAttribute(e,"closedColor")?(this.__attrHandler.closedColor=e,this.__icon?.setClosedColor(e),this):this}getClosedColor(){return this.__attrHandler.closedColor}setSlatColor(e){return this.__attrHandler.checkColorAttribute(e,"slatColor")?(this.__attrHandler.slatColor=e,this.__icon?.setSlatColor(e),this):this}getSlatColor(){return this.__attrHandler.slatColor}processBaObject(){super.processBaObject(),null!=this.baObjectHandler.baObject&&n.Sunblind.processBaObject(this,this.baInterfaceHandler.baInterfaceSymNames,{processError:e=>this.setError(e),processPriority:e=>this.setPriority(e),processOpenFeedback:e=>this.setOpenFeedback(e),processCloseFeedback:e=>this.setCloseFeedback(e),processHasResetSymbol:e=>{this.__hasResetSymbol=e,this.__processPriority()},processUsePosition:e=>this.setUsePosition(e),processPosition:e=>this.setPosition(e),processPositionFeedback:e=>this.setPositionFeedback(e),processUseAngle:e=>this.setUseAngle(e),processAngle:e=>this.setAngle(e),processAngleFeedback:e=>this.setAngleFeedback(e)})}}i.__positionSliderName="position-slider",i.__positionUpButtonName="position-up-button",i.__positionDownButtonName="position-down-button",i.__angleSliderName="angle-slider",i.__angleMinusButtonName="angle-minus-button",i.__anglePlusButtonName="angle-plus-button",s.SunblindControl=i}(n.RoomControl||(n.RoomControl={}))}(n.RoomAutomation||(n.RoomAutomation={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));