var TcHmi;!function(t){!function(o){!function(e){!function(e){!function(i){class n extends i.ControlUnit{constructor(t,o){super(t,o),this.__positionFeedbackReady=[],this.__useCurrentPosition=!1,this.__waitingForPositionFeedback=!1,this.baInterfaceHandler.baInterfaceDefinition=e.Window.BaInterfaceDef,this.setBaInterfaceSymbolNames(e.Window.BaInterfaceSymbolNames)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}createElement(){super.createElement(),this.__icon||(this.__icon=new e.Window.Icon(this.__id+"-window",this),this.__icon.setAttributes(this.__attrHandler).setReadOnly(!0).getElement().addClass("icon"),this.__iconContainer?.append(this.__icon.getElement())),this.__controlContainer?.getControl(n.__positionDisplayName)||this.__controlContainer?.addControl({type:o.Components.ComponentType.Textblock,name:n.__positionDisplayName,settings:{order:2}})}getSideControl(){return this.__sideControlContainer=super.getSideControl(),this.__sideControlContainer.addClass("window"),"boolean"==typeof this.__attrHandler.position&&this.__sideControlContainer.addClass("boolean-position"),this.__sideControl&&(this.__sideControl.getElement(),this.__updateSideControl()),this.__sideControlContainer}writePositionToPlc(i){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=e.Window.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(e.Window.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&e.Window.writePositionToPlc(i,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&e.Window.writePositionToPlc(i,this.baInterfaceHandler),this.__attrHandler.positionMapping&&t.Server.writeSymbol(this.__attrHandler.positionMapping,i,(t=>{this.logger.checkServerResult(o.Logger.Severity.warn,t,!1)})),this.__processChangedPosition(i)}getIsLocked(){return e.Window.getIsLocked(this.__attrHandler)}getPriorityIcon(t){return e.Window.getPriorityDisplayIcon(t)}hasManualPriority(){return e.Window.hasManualPriority(this.__attrHandler.priority)}__processChangedPosition(t){if(1!=this.busyHandler.getIsBusy()&&void 0!==t&&(this.__waitingForPositionFeedback=!0,this.__useCurrentPosition=!0,this.setPosition(t),null!=this.__attrHandler.positionFeedback&&t!=this.__attrHandler.positionFeedback)){let t=()=>{this.__positionFeedbackReady.forEach((t=>t())),this.__positionFeedbackReady=[],this.setPosition(this.__attrHandler.positionFeedback)};this.__sideControlContainer&&0==this.busyHandler.getIsBusy()&&e.showBusyIndicator&&o.BusyHandler.appendBusyIndicator(this.__sideControlContainer);let i=this.logger.logPerformance(o.Logger.Severity.debug,"Brightness feedback response."),n=()=>{i(),this.__sideControlContainer&&o.BusyHandler.detachBusyIndicator(this.__sideControlContainer)};this.__positionFeedbackReady.push(this.busyHandler.setBusy("Waiting for PositionFeedback",{cbOnTimeout:t,cbOnReady:n,showIndicator:e.showBusyIndicator}))}}__updateElements(){if(null==this.__attrHandler.position)return;let t=this.__attrHandler.position;if(null!=this.__attrHandler.positionFeedback&&0==this.__useCurrentPosition&&(t=this.__attrHandler.positionFeedback),this.__useCurrentPosition=!1,this.__elementCreated&&(this.__icon?.setPosition(t),e.Window.Icon.getPositionText(t,e.Window.ClosePosition,e.Window.OpenPosition,(t=>{this.__controlContainer?.getControl(n.__positionDisplayName)?.textHandler.setText(t)}))),this.__sideControl){let i=this.__sideControl.getControl(n.__positionCtrlName);"number"==typeof t?(i instanceof o.Components.Slider||(this.__sideControl.removeControl(n.__positionCtrlName),this.__updateSideControl(),i=this.__sideControl.getControl(n.__positionCtrlName)),i?.setValue(this.__attrHandler.position),null!=this.__attrHandler.positionFeedback&&i?.setValueFeedback(this.__attrHandler.positionFeedback),this.__sideControl.getControl(n.__positionSwitchName)?.setState(t>e.Window.ClosePosition)):"boolean"==typeof t&&(i instanceof o.Components.Checkbox||(this.__sideControl.removeControl(n.__positionCtrlName),this.__updateSideControl(),i=this.__sideControl.getControl(n.__positionCtrlName)),i?.setState(t))}}__updateSideControl(){if(this.__sideControl&&this.__attrHandler){let i=this.__sideControl.getControl(n.__positionCtrlName);if(!i){switch(typeof this.__attrHandler.position){case"number":if(1==e.Window.ShowQuickLinks){let i=o.Components.ContextMenu.createContextMenuAndButton({id:this.__id+"-context-menu",parent:this,rowEntryOptions:[{controls:[{type:o.Components.ComponentType.Button,callback:()=>{this.writePositionToPlc((e.Window.OpenPosition-e.Window.ClosePosition)/4+e.Window.ClosePosition),i.menu.close()}},{type:o.Components.ComponentType.Button,callback:()=>{this.writePositionToPlc((e.Window.OpenPosition-e.Window.ClosePosition)/2+e.Window.ClosePosition),i.menu.close()}},{type:o.Components.ComponentType.Button,callback:()=>{this.writePositionToPlc(3*(e.Window.OpenPosition-e.Window.ClosePosition)/4+e.Window.ClosePosition),i.menu.close()}}]}]});i.button.layoutHandler.setMaxWidth(30);for(let o=0;o<i.menu.getRowEntries()[0].controlContainer.getControls().length;o++){let e=i.menu.getRowEntries()[0].controlContainer.getControls()[o];switch(o){case 0:e.getElement().css("--tchmi-ba-window-position",10);break;case 1:e.getElement().css("--tchmi-ba-window-position",20);break;case 2:e.getElement().css("--tchmi-ba-window-position",30)}e.setAttributes({layout:{maxWidth:30,minWidth:30},iconPath:t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/RoofDome_small.svg",iconHeight:90,iconHeightUnit:"%",iconWidth:90,iconWidthUnit:"%"})}this.__sideControl.addControl(i.button)}this.__sideControl.addControls([{type:o.Components.ComponentType.Slider,name:n.__positionCtrlName,settings:{layout:{maxHeight:10,minHeight:10,maxWidth:90,minWidth:90},showBusyIndicator:e.showBusyIndicator,knobAppearance:o.Components.Slider.KnobAppearance.round},callback:t=>{this.writePositionToPlc(t)}},{type:o.Components.ComponentType.Checkbox,name:n.__positionSwitchName,settings:{appearance:o.Components.Checkbox.Appearance.toggleSlider,readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:35,minWidth:35}},callback:t=>{this.writePositionToPlc(1==t?e.Window.OpenPosition:e.Window.ClosePosition)}}]);break;case"boolean":this.__sideControl.addControl({type:o.Components.ComponentType.Checkbox,name:n.__positionCtrlName,settings:{cssClass:"fixed-size",readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:40,minWidth:40},appearance:o.Components.Checkbox.Appearance.toggleSlider},callback:t=>{this.writePositionToPlc(t)}})}i=this.__sideControl.getControl(n.__positionCtrlName),this.__updateElements()}if("number"==typeof this.__attrHandler.position){if(!(i instanceof o.Components.Slider))throw new Error("Position control should be a slider here!");i.setMinValue(e.Window.ClosePosition),i.setMaxValue(e.Window.OpenPosition)}}}setAttributes(t){return super.setAttributes(t),this.baObjectHandler.baObject||(this.__handleProperty(t,"position",this.setPosition,["number","boolean"]),this.__handleProperty(t,"positionFeedback",this.setPositionFeedback,["number","boolean"]),void 0!==t.displayMode&&this.setDisplayMode(t.displayMode),void 0!==t.iconRotation&&this.setIconRotation(t.iconRotation)),this}getAttributes(){return this.__attrHandler.getRef()}__processBaInterface(){super.__processBaInterface(),e.Window.processBaInterface(this,{processError:t=>this.setError(t),processPriority:t=>this.setPriority(t),processPosition:t=>this.setPosition(t),processPositionFeedback:t=>this.setPositionFeedback(t),processHasResetSymbol:t=>this.__hasResetSymbol=t})}setPosition(t){return this.__attrHandler.checkAttribute(t,"position",{validator:["number","boolean"]})?(this.__attrHandler.position=t,this.__processPosition(),this.__baParent.onWindowPositionChanged(),this):this}__processPosition(){this.__updateElements()}getPosition(){return this.__attrHandler.position}setPositionFeedback(t){return this.__attrHandler.checkAttribute(t,"positionFeedback",{validator:["number","boolean"]})?(this.__attrHandler.positionFeedback=t,this.__processPositionFeedback(),this):this}__processPositionFeedback(){if(null!=this.__attrHandler.positionFeedback){if(1==this.__waitingForPositionFeedback&&this.__attrHandler.positionFeedback!=this.__attrHandler.position)return;this.__positionFeedbackReady.forEach((t=>t())),this.__positionFeedbackReady=[],this.__updateElements(),this.__waitingForPositionFeedback=!1,this.__baParent.onWindowPositionChanged()}}getPositionFeedback(){return this.__attrHandler.positionFeedback}setDisplayMode(t){return this.__attrHandler.checkAttribute(t,"displayMode",{validator:"number"})?(this.__attrHandler.displayMode=t,this.__icon?.setDisplayMode(t),this):this}getDisplayMode(){return this.__attrHandler.displayMode}setIconRotation(t){return this.__attrHandler.checkAttribute(t,"iconRotation",{validator:"number"})?(this.__attrHandler.iconRotation=t,this.__icon?.iconHandler.setIconRotation(t),this):this}getIconRotation(){return this.__attrHandler.iconRotation}processBaObject(){super.processBaObject(),null!=this.baObjectHandler.baObject&&(e.Window.processBaObject(this,this.baInterfaceHandler.baInterfaceSymNames,{processError:t=>this.setError(t),processPriority:t=>this.setPriority(t),processPosition:t=>this.setPosition(t),processPositionFeedback:t=>this.setPositionFeedback(t),processHasResetSymbol:t=>this.__hasResetSymbol=t}),this.busyHandler.checkForBusyChildren())}}n.__positionDisplayName="position-display",n.__positionCtrlName="position-ctrl",n.__positionSwitchName="position-switch",i.WindowControl=n}(e.RoomControl||(e.RoomControl={}))}(e.RoomAutomation||(e.RoomAutomation={}))}(o.Controls||(o.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={}));