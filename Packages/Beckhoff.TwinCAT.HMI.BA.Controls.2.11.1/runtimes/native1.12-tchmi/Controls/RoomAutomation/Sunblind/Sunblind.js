var TcHmi;!function(e){!function(t){var o;(function(n){let s;!function(e){e.first="first",e.second="second"}(s||(s={}));class a extends o.System.BaseRoomControl{constructor(e,t,o){super(e,t,o),this.__positionStep=5,this.__angleMode=!1,this.__positionFeedbackReady=[],this.__angleFeedbackReady=[],this.__useCurrentPosition=!1,this.__useCurrentAngle=!1}__previnit(){null==this.__baFc&&(this.__baFc=new a.Icon(this.__id+"-ba-fc",this)),super.__previnit(),this.__element.append(this.__baFc.getElement()),this.baInterfaceHandler.baInterfaceDefinition=a.BaInterfaceDef,this.setBaInterfaceSymbolNames(a.BaInterfaceSymbolNames)}__init(){super.__init()}__attach(){super.__attach(),this.__processIsControllable(!0)}__detach(){super.__detach()}destroy(){this.__keepAlive||(this.__destroySliders(),super.destroy())}__destroyLayout(){this.__closeControlContainer(),this.__removeAllControls(s.first),this.__removeAllControls(s.second),this.__attrHandler.controls===a.Controls.sliderHorizontal&&this.__destroySliders()}__destroySliders(){null!=this.__positionSlider&&(this.__positionSlider.destroy(),delete this.__positionSlider),null!=this.__angleSlider&&(this.__angleSlider?.destroy(),delete this.__angleSlider),this.__destroyOnPositionSliderChanged&&(this.__destroyOnPositionSliderChanged(),delete this.__destroyOnPositionSliderChanged),this.__destroyOnPositionSliderFinished&&(this.__destroyOnPositionSliderFinished(),delete this.__destroyOnPositionSliderFinished),this.__destroyOnAngleSliderChanged&&(this.__destroyOnAngleSliderChanged(),delete this.__destroyOnAngleSliderChanged),this.__destroyOnAngleSliderFinished&&(this.__destroyOnAngleSliderFinished(),delete this.__destroyOnAngleSliderFinished)}__processChangedPosition(e){if(this.__useCurrentPosition=!0,this.setPosition(e),null!=this.__attrHandler.positionFeedback&&this.__attrHandler.position!=this.__attrHandler.positionFeedback){let e=()=>{this.__positionFeedbackReady.forEach((e=>e())),this.__positionFeedbackReady=[],this.setPosition(this.__attrHandler.positionFeedback)};this.__positionFeedbackReady.push(this.busyHandler.setBusy("Waiting for PositionFeedback",{cbOnTimeout:e,showIndicator:n.showBusyIndicator}))}}__processChangedAngle(e){if(this.__useCurrentAngle=!0,this.setAngle(e),null!=this.__attrHandler.angleFeedback&&this.__attrHandler.angle!=this.__attrHandler.angleFeedback){let e=()=>{this.__angleFeedbackReady.forEach((e=>e())),this.__angleFeedbackReady=[],this.setAngle(this.__attrHandler.angleFeedback)};this.__angleFeedbackReady.push(this.busyHandler.setBusy("Waiting for AngleFeedback",{cbOnTimeout:e,showIndicator:n.showBusyIndicator}))}}__updateElements(){let e=a.OpenPosition,t=a.MinimumAngle;if(this.__attrHandler.usePosition&&null!=this.__attrHandler.position)e=this.__attrHandler.position,null!=this.__attrHandler.positionFeedback&&0==this.__useCurrentPosition&&(e=this.__attrHandler.positionFeedback),this.__useCurrentPosition=!1,this.__attrHandler.controls===a.Controls.sliderHorizontal&&null!=this.__positionSlider&&(this.__positionSlider.setValue(this.__attrHandler.position),null!=this.__attrHandler.positionFeedback&&this.__positionSlider.setValueFeedback(this.__attrHandler.positionFeedback)),this.__attrHandler.useAngle&&null!=this.__attrHandler.angle?(t=this.__attrHandler.angle,null!=this.__attrHandler.angleFeedback&&0==this.__useCurrentAngle&&(t=this.__attrHandler.angleFeedback),this.__useCurrentAngle=!1,this.__attrHandler.controls===a.Controls.sliderHorizontal&&null!=this.__angleSlider&&(this.__angleSlider.setValue(this.__attrHandler.angle),null!=this.__attrHandler.angleFeedback&&this.__angleSlider.setValueFeedback(this.__attrHandler.angleFeedback))):t=(a.MaximumAngle-a.MinimumAngle)/2,this.__baFc.setAngle(t);else{let o=(a.ClosePosition-a.OpenPosition)/2;switch(a.determinePositionState(this.__attrHandler.openFeedback,this.__attrHandler.closeFeedback)){case a.PositionState.opened:e=a.OpenPosition;break;case a.PositionState.closed:e=a.ClosePosition;break;default:e=o}t=(a.MaximumAngle-a.MinimumAngle)/2}this.__updateDisplay(e,t),this.__baFc.setPosition(e)}__updateDisplay(e,t){if(null==e&&(e=a.OpenPosition),e=a.getPercentagePosition(e,a.OpenPosition,a.ClosePosition),this.__attrHandler.showValue)if(this.__element.addClass("show-displays"),this.__baFc.getElement().append(this.__baFc.textHandler.getTextElement()),this.__attrHandler.usePosition)this.__attrHandler.useAngle?(null==t&&(t=a.MinimumAngle),this.__baFc.textHandler.setText(e+" %  |  "+t.toFixed(0)+" &#8737")):this.__baFc.textHandler.setText(e+" %");else{let e;switch(a.determinePositionState(this.__attrHandler.openFeedback,this.__attrHandler.closeFeedback)){case a.PositionState.opened:e="Opened";break;case a.PositionState.closed:e="Closed";break;default:e="Opened"}this.__baFc.textHandler.setText(e)}else this.__element.removeClass("show-displays"),this.__baFc.textHandler.setText(null),this.__baFc.textHandler.getTextElement().detach()}static processBaObject(e,t,n){null==t&&(t=a.BaInterfaceSymbolNames),o.System.BaseRoomControl.processBaObject(e,t,n);let s=e.baObjectHandler;if(null!=s&&s.baObject?.checkParams(a.BaInterfaceDef,t,e,!0)){let e=s.baObject.tryGetBaVariable("fdbOpen");null!=e&&s.watchBaVariable(e,(e=>{n.processOpenFeedback(e)}));let t=s.baObject.tryGetBaVariable("fdbClose");null!=t&&s.watchBaVariable(t,(e=>{n.processCloseFeedback(e)})),n.processHasResetSymbol(null!=s.baObject.tryGetBaVariable("resetManual"));let o=s.baObject.tryGetBaVariable("positionCmd");if(null!=o){n.processUsePosition(!0),s.watchBaVariable(o,(e=>{n.processPosition(e)}));let e=s.baObject.tryGetBaVariable("positionFdb");null!=e&&s.watchBaVariable(e,(e=>{n.processPositionFeedback(e)}))}else n.processUsePosition(!1);let a=s.baObject.tryGetBaVariable("angleCmd");if(null!=a){n.processUseAngle(!0),s.watchBaVariable(a,(e=>{n.processAngle(e)}));let e=s.baObject.tryGetBaVariable("angleFdb");null!=e&&s.watchBaVariable(e,(e=>{n.processAngleFeedback(e)}))}else n.processUseAngle(!1)}}static writeOpenToPlc(e){e instanceof t.BA.BaBasicObject?e.tryGetBaVariable("cmdUp")?.write(!0,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)})):e instanceof t.BaInterfaceHandler&&e.writeSubSymbol("cmdUp",!0).then((e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)}))}writeOpenToPlc(){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=a.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(a.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&a.writeOpenToPlc(this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&a.writeOpenToPlc(this.baInterfaceHandler)}static writeCloseToPlc(e){e instanceof t.BA.BaBasicObject?e.tryGetBaVariable("cmdDown")?.write(!0,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)})):e instanceof t.BaInterfaceHandler&&e.writeSubSymbol("cmdDown",!0).then((e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)}))}writeCloseToPlc(){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=a.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(a.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&a.writeCloseToPlc(this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&a.writeCloseToPlc(this.baInterfaceHandler)}static writePositionToPlc(e,o){null!=e&&(o instanceof t.BA.BaBasicObject?o.tryGetBaVariable("positionCmd")?.write(e,(e=>t.Logger.checkServerResult(t.Logger.Severity.warn,e))):o instanceof t.BaInterfaceHandler&&o.writeSubSymbol("positionCmd",e).then((e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)})))}writePositionToPlc(e){1!=this.busyHandler.getIsBusy()&&null!=e&&(null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=a.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(a.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&a.writePositionToPlc(e,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&a.writePositionToPlc(e,this.baInterfaceHandler),this.__processChangedPosition(e))}static writeAngleToPlc(e,o){null!=e&&(o instanceof t.BA.BaBasicObject?o.tryGetBaVariable("angleCmd")?.write(e,(e=>t.Logger.checkServerResult(t.Logger.Severity.warn,e))):o instanceof t.BaInterfaceHandler&&o.hasSubSymbol("angleCmd")&&o.writeSubSymbol("angleCmd",e).then((e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)})))}writeAngleToPlc(e){1!=this.busyHandler.getIsBusy()&&null!=e&&(null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=a.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(a.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&a.writeAngleToPlc(e,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&a.writeAngleToPlc(e,this.baInterfaceHandler),this.__processChangedAngle(e))}static resetManualToPlc(e){e instanceof t.BA.BaBasicObject?e.tryWriteBaVariableValue("resetManual",!0):e instanceof t.BaInterfaceHandler&&e.hasSubSymbol("resetManual")&&e.writeSubSymbol("resetManual",!0)}resetManualToPlc(){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=a.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(a.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&a.resetManualToPlc(this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&a.resetManualToPlc(this.baInterfaceHandler)}static getPercentagePosition(e,o,n){return null!=e&&null!=o&&null!=n?Number(o>n?t.Helper.Number.toPercentage(e,n,o).toFixed(0):t.Helper.Number.toPercentage(e,o,n).toFixed(0)):null}static determinePositionState(e,t){return null==e&&(e=!1),null==t&&(t=!1),e||t?e&&t?a.PositionState.invalid:e||!t?a.PositionState.opened:!e||t?a.PositionState.closed:a.PositionState.invalid:a.PositionState.moving}static getPriorityDisplayIcon(e){if(null==e)return t.Logger.warn("No priority passed."),null;let o=a.PriorityIcons.get(e);return null==o?null:o}getPriorityIcon(e){return a.getPriorityDisplayIcon(e)}static getIsLocked(e){return!!o.System.BaseRoomControl.getIsLocked(e)||null!=e.priority&&e.priority<a.PriorityLockThreshold&&0!=e.priority}getIsLocked(){return a.getIsLocked(this.__attrHandler)}static isManualPriority(e){return e===a.PriorityManual}hasManualPriority(){return a.isManualPriority(this.__attrHandler.priority)}setBaObject(e){return this.baObjectHandler.setBaObject(e),this}getBaObject(){return this.baObjectHandler.baObject}setAttributes(e){return super.setAttributes(e),void 0!==e.openFeedback&&this.setOpenFeedback(e.openFeedback),void 0!==e.closeFeedback&&this.setCloseFeedback(e.closeFeedback),void 0!==e.usePosition&&this.setUsePosition(e.usePosition),void 0!==e.position&&this.setPosition(e.position),void 0!==e.positionFeedback&&this.setPositionFeedback(e.positionFeedback),void 0!==e.useAngle&&this.setUseAngle(e.useAngle),void 0!==e.angle&&this.setAngle(e.angle),void 0!==e.openedColor&&this.setOpenedColor(e.openedColor),void 0!==e.closedColor&&this.setClosedColor(e.closedColor),void 0!==e.slatColor&&this.setSlatColor(e.slatColor),void 0!==e.controls&&this.setControls(e.controls),void 0!==e.showValue&&this.setShowValue(e.showValue),this}getAttributes(){return this.__attrHandler}setBaInterface(e){return super.setBaInterface(e),this.baInterfaceHandler.setBaInterfaceSym(e,(()=>{a.processBaInterface(this,{processError:e=>this.setError(e),processPriority:e=>this.setPriority(e),processOpenFeedback:e=>this.setOpenFeedback(e),processCloseFeedback:e=>this.setCloseFeedback(e),processHasResetSymbol:e=>{this.__hasResetSymbol=e,this.__processPriority()},processUsePosition:e=>this.setUsePosition(e),processPosition:e=>this.setPosition(e),processPositionFeedback:e=>this.setPositionFeedback(e),processUseAngle:e=>this.setUseAngle(e),processAngle:e=>this.setAngle(e),processAngleFeedback:e=>this.setAngleFeedback(e)})})),this}setOpenFeedback(t){let o=e.ValueConverter.toBoolean(t);return null==o&&(o=this.getAttributeDefaultValueInternal("OpenFeedback")),o===this.__attrHandler.openFeedback||(this.__attrHandler.openFeedback=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"OpenFeedback"}),this.__processOpenFeedback()),this}__processOpenFeedback(){this.__updateElements()}getOpenFeedback(){return this.__attrHandler.openFeedback}setCloseFeedback(t){let o=e.ValueConverter.toBoolean(t);return null==o&&(o=this.getAttributeDefaultValueInternal("CloseFeedback")),o===this.__attrHandler.closeFeedback||(this.__attrHandler.closeFeedback=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"CloseFeedback"}),this.__processCloseFeedback()),this}__processCloseFeedback(){this.__updateElements()}getCloseFeedback(){return this.__attrHandler.closeFeedback}setUsePosition(t){let o=e.ValueConverter.toBoolean(t);return null==o&&(o=this.getAttributeDefaultValueInternal("UsePosition")),o===this.__attrHandler.usePosition||(this.__attrHandler.usePosition=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UsePosition"}),this.__processUsePosition()),this}__processUsePosition(){this.__processUseAngle(),this.__processControls(),this.__updateElements()}getUsePosition(){return this.__attrHandler.usePosition}setPosition(t){let o=e.ValueConverter.toNumber(t);return null==o&&(o=this.getAttributeDefaultValueInternal("Position")),o===this.__attrHandler.position||(this.__attrHandler.position=o,this.__processPosition(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Position"}),e.EventProvider.raise(this.__id+".onPositionChanged")),this}__processPosition(){this.__updateElements()}getPosition(){return this.__attrHandler.position}setPositionFeedback(t){let o=e.ValueConverter.toNumber(t);return null==o&&(o=this.getAttributeDefaultValueInternal("PositionFeedback")),o===this.__attrHandler.positionFeedback||(this.__attrHandler.positionFeedback=o,null!=this.__attrHandler.positionFeedback&&(this.__processPositionFeedback(),this.__positionFeedbackReady.forEach((e=>e())),this.__positionFeedbackReady=[],e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PositionFeedback"}))),this}__processPositionFeedback(){this.__updateElements()}getPositionFeedback(){return this.__attrHandler.positionFeedback}setUseAngle(t){let o=e.ValueConverter.toBoolean(t);return null==o&&(o=this.getAttributeDefaultValueInternal("UseAngle")),o===this.__attrHandler.useAngle||(this.__attrHandler.useAngle=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UseAngle"}),this.__processUseAngle()),this}__processUseAngle(){this.__attrHandler.useAngle&&this.__attrHandler.usePosition?this.__element.addClass("use-angle"):this.__element.removeClass("use-angle"),this.__processControls()}getUseAngle(){return this.__attrHandler.useAngle}setAngle(t){let o=e.ValueConverter.toNumber(t);return null==o&&(o=this.getAttributeDefaultValueInternal("Angle")),o===this.__attrHandler.angle||(this.__attrHandler.angle=o,this.__processAngle(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Angle"}),e.EventProvider.raise(this.__id+".onAngleChanged")),this}__processAngle(){this.__updateElements()}getAngle(){return this.__attrHandler.angle}setAngleFeedback(t){let o=e.ValueConverter.toNumber(t);return null==o&&(o=this.getAttributeDefaultValueInternal("AngleFeedback")),o===this.__attrHandler.angleFeedback||(this.__attrHandler.angleFeedback=o,null!=this.__attrHandler.angleFeedback&&(this.__attrHandler.angleFeedback=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AngleFeedback"}),this.__processAngleFeedback(),this.__angleFeedbackReady.forEach((e=>e())),this.__angleFeedbackReady=[])),this}__processAngleFeedback(){this.__updateElements()}getAngleFeedback(){return this.__attrHandler.angleFeedback}setAngleStep(t){let o=e.ValueConverter.toNumber(t);return null==o&&(o=this.getAttributeDefaultValueInternal("AngleStep")),o===this.__attrHandler.angleStep||(this.__attrHandler.angleStep=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AngleStep"})),this}getAngleStep(){return this.__attrHandler.angleStep}setOpenedColor(o){let n=e.ValueConverter.toObject(o);return null==n&&(n=this.getAttributeDefaultValueInternal("OpenedColor")),null!=n&&!t.Color.isSolidColor(n)||void 0===n||tchmi_equal(n,this.__attrHandler.openedColor)||(null!=n&&e.isSolidColor(n)&&(n=t.Color.RGBAColor.fromSolidColor(n)),null==n||n instanceof t.Color.RGBAColor||(n=new t.Color.RGBAColor(n)),this.__attrHandler.openedColor=n,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"OpenedColor"}),this.__processOpenedColor()),this}__processOpenedColor(){this.__baFc.setOpenedColor(this.__attrHandler.openedColor)}getOpenedColor(){return this.__attrHandler.openedColor?.toSolidColor()}setClosedColor(o){let n=e.ValueConverter.toObject(o);return null==n&&(n=this.getAttributeDefaultValueInternal("ClosedColor")),null!=n&&!t.Color.isSolidColor(n)||void 0===n||tchmi_equal(n,this.__attrHandler.closedColor)||(null!=n&&e.isSolidColor(n)&&(n=t.Color.RGBAColor.fromSolidColor(n)),null==n||n instanceof t.Color.RGBAColor||(n=new t.Color.RGBAColor(n)),this.__attrHandler.closedColor=n,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ClosedColor"}),this.__processClosedColor()),this}__processClosedColor(){this.__baFc.setClosedColor(this.__attrHandler.closedColor)}getClosedColor(){return this.__attrHandler.closedColor?.toSolidColor()}setSlatColor(o){let n=e.ValueConverter.toObject(o);return null==n&&(n=this.getAttributeDefaultValueInternal("SlatColor")),null!=n&&!t.Color.isSolidColor(n)||void 0===n||tchmi_equal(n,this.__attrHandler.slatColor)||(null!=n&&e.isSolidColor(n)&&(n=t.Color.RGBAColor.fromSolidColor(n)),null==n||n instanceof t.Color.RGBAColor||(n=new t.Color.RGBAColor(n)),this.__attrHandler.slatColor=n,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SlatColor"}),this.__processSlatColor()),this}__processSlatColor(){this.__baFc.setSlatColor(this.__attrHandler.slatColor)}getSlatColor(){return this.__attrHandler.slatColor?.toSolidColor()}setControls(t){let o=e.ValueConverter.toString(t);return null==o&&(o=this.getAttributeDefaultValueInternal("Controls")),o===this.__attrHandler.controls||(this.__destroyLayout(),this.__attrHandler.controls=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Controls"}),this.__processControls()),this}__processControls(){if(!0!==this.__baFc.getReadOnly()){if(this.__destroyLayout(),this.__attrHandler.controls===a.Controls.sliderHorizontal){this.__element.removeClass("buttons-layout");let e={type:t.Components.ComponentType.Button,name:a.__positionDownButtonName,settings:{iconPath:t.Icons.Standard.Down.path},callback:()=>{this.writeCloseToPlc()}},o={type:t.Components.ComponentType.Button,name:a.__positionUpButtonName,settings:{iconPath:t.Icons.Standard.Up.path},callback:()=>{this.writeOpenToPlc()}};this.__attrHandler.usePosition?(this.__positionSlider=new t.Components.Slider(this.__id+"-position-slider",this),this.__positionSlider.setMinValue(a.ClosePosition).setMaxValue(a.OpenPosition).setShowScale(!1).setShowValue(!1).setShowBusyIndicator(n.showBusyIndicator).layoutHandler.setMaxHeight(19).setMinHeight(19),this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Position,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&this.__positionSlider?.textHandler.setText(e.text)}))),this.__destroyOnPositionSliderChanged=this.__positionSlider.eventHandler.register(t.Components.Slider.SliderEvents.onValueChanged,(()=>{null!=this.__positionSlider&&(this.__baFc.setPosition(this.__positionSlider.getValue()),this.__updateDisplay(this.__positionSlider.getValue(),this.__attrHandler.angle))})),this.__destroyOnPositionSliderFinished=this.__positionSlider.eventHandler.register(t.Components.Slider.SliderEvents.onUserInteractionFinished,(()=>{null!=this.__positionSlider&&this.writePositionToPlc(this.__positionSlider.getValue())})),this.__addControls(s.first,[e,this.__positionSlider,o],1),this.__attrHandler.useAngle&&(a.UseButtonsForAngle?this.__addControls(s.second,[{type:t.Components.ComponentType.Button,name:a.__angleMinusButtonName,settings:{iconPath:t.Icons.RoomAutomation.SunblindAngleAdjustmentDown.path},callback:(e,t,o)=>{if(null!=this.__attrHandler.angle){let e=this.__attrHandler.angle-(null!=this.__attrHandler.angleStep?this.__attrHandler.angleStep:15);a.MaximumAngle>a.MinimumAngle?e<=a.MinimumAngle&&(e=a.MinimumAngle,o?.setIsEnabled(!1)):e<=a.MaximumAngle&&(e=a.MaximumAngle,o?.setIsEnabled(!1)),this.writeAngleToPlc(e),this.__getControl(s.second,a.__anglePlusButtonName)?.setIsEnabled(!0)}}},{type:t.Components.ComponentType.Button,name:a.__anglePlusButtonName,settings:{iconPath:t.Icons.RoomAutomation.SunblindAngleAdjustmentUp.path},callback:(e,t,o)=>{if(null!=this.__attrHandler.angle){let e=this.__attrHandler.angle+(null!=this.__attrHandler.angleStep?this.__attrHandler.angleStep:15);a.MaximumAngle>a.MinimumAngle?(e>a.MaximumAngle||e==a.MinimumAngle)&&(e=a.MaximumAngle,o?.setIsEnabled(!1)):(e>a.MinimumAngle||e==a.MaximumAngle)&&(e=a.MinimumAngle,o?.setIsEnabled(!1)),this.writeAngleToPlc(e),this.__getControl(s.second,a.__angleMinusButtonName)?.setIsEnabled(!0)}}}],2):(null==this.__angleSlider&&(this.__angleSlider=new t.Components.Slider(this.__id+"-angle-slider",this),this.__angleSlider.setShowScale(!1).setShowValue(!1).setSwitchMinMax(!0).setShowBusyIndicator(n.showBusyIndicator).layoutHandler.setMaxHeight(19).setMinHeight(19),this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Angle,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&this.__angleSlider?.textHandler.setText(e.text)}))),this.__destroyOnAngleSliderChanged=this.__angleSlider.eventHandler.register(t.Components.Slider.SliderEvents.onValueChanged,(()=>{null!=this.__angleSlider&&(this.__baFc.setAngle(this.__angleSlider.getValue()),this.__updateDisplay(this.__attrHandler.position,this.__angleSlider.getValue()))})),this.__destroyOnAngleSliderFinished=this.__angleSlider.eventHandler.register(t.Components.Slider.SliderEvents.onUserInteractionFinished,(()=>{null!=this.__angleSlider&&this.writeAngleToPlc(this.__angleSlider.getValue())})),this.__addControl(s.second,this.__angleSlider,2)),this.__angleSlider.setMinValue(a.MinimumAngle).setMaxValue(a.MaximumAngle)))):this.__addControls(s.first,[e,o],1)}else{this.__element.addClass("buttons-layout");let e=["up-button-step","up-button-complete","down-button-step","down-button-complete"],o=0;for(let n of e){if(null==this.__getControl(s.first,n)&&null==this.__getControl(s.second,n)){let e="",i=t.Components.ComponentType.Button;switch(n){case"up-button-step":e=t.Icons.Standard.Up.path;break;case"up-button-complete":e=t.Icons.Standard.Up_double.path;break;case"down-button-step":e=t.Icons.Standard.Down.path;break;case"down-button-complete":e=t.Icons.Standard.Down_double.path}let r={type:i,name:n,settings:{iconPath:e},callback:()=>{switch(n){case"up-button-step":this.__angleMode?null!=this.__attrHandler.angle&&null!=this.__attrHandler.angleStep&&this.writeAngleToPlc(t.Helper.Number.addStep(this.__attrHandler.angle,a.MinimumAngle,a.MaximumAngle,this.__attrHandler.angleStep)):null!=this.__attrHandler.position&&null!=this.__positionStep&&this.writePositionToPlc(t.Helper.Number.addStep(this.__attrHandler.position,a.OpenPosition,a.ClosePosition,this.__positionStep));break;case"up-button-complete":this.__angleMode?this.writeAngleToPlc(a.MaximumAngle):this.writePositionToPlc(a.ClosePosition);break;case"down-button-step":this.__angleMode?null!=this.__attrHandler.angle&&null!=this.__attrHandler.angleStep&&this.writeAngleToPlc(t.Helper.Number.removeStep(this.__attrHandler.angle,a.MinimumAngle,a.MaximumAngle,this.__attrHandler.angleStep)):null!=this.__attrHandler.position&&null!=this.__positionStep&&this.writePositionToPlc(t.Helper.Number.removeStep(this.__attrHandler.position,a.OpenPosition,a.ClosePosition,this.__positionStep));break;case"down-button-complete":this.__angleMode?this.writeAngleToPlc(a.MinimumAngle):this.writePositionToPlc(a.OpenPosition)}}};o<=1?this.__addControl(s.first,r,1):this.__addControl(s.second,r,2)}o++}}this.__updateElements()}}getControls(){return this.__attrHandler.controls}setShowValue(t){let o=e.ValueConverter.toBoolean(t);return null==o&&(o=this.getAttributeDefaultValueInternal("ShowValue")),o===this.__attrHandler.showValue||(this.__attrHandler.showValue=o,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowValue"}),this.__processShowValue()),this}__processShowValue(){this.__updateElements()}getShowValue(){return this.__attrHandler.showValue}processBaObject(){super.processBaObject(),a.processBaObject(this,this.baInterfaceHandler.baInterfaceSymNames,{processError:e=>this.setError(e),processPriority:e=>this.setPriority(e),processOpenFeedback:e=>this.setOpenFeedback(e),processCloseFeedback:e=>this.setCloseFeedback(e),processHasResetSymbol:e=>{this.__hasResetSymbol=e,this.__processPriority()},processUsePosition:e=>this.setUsePosition(e),processPosition:e=>this.setPosition(e),processPositionFeedback:e=>this.setPositionFeedback(e),processUseAngle:e=>this.setUseAngle(e),processAngle:e=>this.setAngle(e),processAngleFeedback:e=>this.setAngleFeedback(e)})}__processReadOnly(){super.__processReadOnly(),!0===this.__baFc.getReadOnly()?this.__destroyLayout():this.__processControls()}static processBaInterface(e,t){o.System.BaseRoomControl.processBaInterface(e,t),e.baInterfaceHandler.hasSubSymbol("fdbOpen")&&e.baInterfaceHandler.watchSubSymbol("fdbOpen",(e=>{t.processOpenFeedback(e)})),e.baInterfaceHandler.hasSubSymbol("fdbClose")&&e.baInterfaceHandler.watchSubSymbol("fdbClose",(e=>{t.processCloseFeedback(e)})),t.processHasResetSymbol(e.baInterfaceHandler.hasSubSymbol("resetManual")),e.baInterfaceHandler.hasSubSymbol("positionCmd")?(t.processUsePosition(!0),e.baInterfaceHandler.watchSubSymbol("positionCmd",(e=>{t.processPosition(e)})),e.baInterfaceHandler.hasSubSymbol("positionFdb")&&e.baInterfaceHandler.watchSubSymbol("positionFdb",(e=>{t.processPositionFeedback(e)}))):t.processUsePosition(!1),e.baInterfaceHandler.hasSubSymbol("angleCmd")?(t.processUseAngle(!0),e.baInterfaceHandler.watchSubSymbol("angleCmd",(e=>{t.processAngle(e)})),e.baInterfaceHandler.hasSubSymbol("angleFdb")&&e.baInterfaceHandler.watchSubSymbol("angleFdb",(e=>{t.processAngleFeedback(e)}))):t.processUseAngle(!1)}}a.__positionUpButtonName="position-up-button",a.__positionDownButtonName="position-down-button",a.__anglePlusButtonName="angle-plus-button",a.__angleMinusButtonName="angle-minus-button",n.Sunblind=a,function(n){let s,a,i;n.OpenPosition=0,n.ClosePosition=100,n.MinimumAngle=0,n.MaximumAngle=100,n.UseButtonsForAngle=!0,n.BaInterfaceDef={...o.System.BaseRoomControl.BaInterfaceDef,cmdUp:{type:"boolean"},cmdDown:{type:"boolean"},fdbOpen:{type:"boolean",optional:!0},fdbClose:{type:"boolean",optional:!0},resetManual:{type:"boolean",optional:!0},positionCmd:{type:"number",optional:!0},positionFdb:{type:"number",optional:!0},angleCmd:{type:"number",optional:!0},angleFdb:{type:"number",optional:!0}},n.BaInterfaceSymbolNames={...o.System.BaseRoomControl.BaInterfaceSymbolNames,cmdUp:{symbolName:"bUp_In"},cmdDown:{symbolName:"bDown_In"},fdbOpen:{symbolName:"bOpened_Out"},fdbClose:{symbolName:"bClosed_Out"},resetManual:{symbolName:"bResetManual_In"},positionCmd:{symbolName:"fSunblindPosition_In"},positionFdb:{symbolName:"fSunblindPosition_Out"},angleCmd:{symbolName:"fSunblindAngle_In"},angleFdb:{symbolName:"fSunblindAngle_Out"}},function(e){e.buttons="buttons",e.sliderHorizontal="sliderHorizontal"}(s=n.Controls||(n.Controls={})),function(e){e[e.invalid=0]="invalid",e[e.closed=1]="closed",e[e.opened=2]="opened",e[e.moving=3]="moving"}(a=n.PositionState||(n.PositionState={})),function(e){e[e.none=0]="none",e[e.fire=1]="fire",e[e.storm=2]="storm",e[e.ice=3]="ice",e[e.commError=4]="commError",e[e.burglary=5]="burglary",e[e.maintenance=6]="maintenance",e[e.referencing=7]="referencing",e[e.manualActuator=8]="manualActuator",e[e.manualGroup=9]="manualGroup",e[e.allDown=10]="allDown",e[e.allUp=11]="allUp",e[e.scene1=12]="scene1",e[e.facadeThermoAutomatic=13]="facadeThermoAutomatic",e[e.facadeTwilightAutomatic=14]="facadeTwilightAutomatic",e[e.parkPosition=15]="parkPosition",e[e.scene2=16]="scene2",e[e.scene3=17]="scene3",e[e.sunProtection=18]="sunProtection",e[e.groupThermoAuto=19]="groupThermoAuto",e[e.groupTwiLightAuto=20]="groupTwiLightAuto"}(i=n.Priority||(n.Priority={})),n.PriorityIcons=new Map([[i.fire,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.Building.FireAlarm,color:t.Color.RGBAColor.Red})],[i.storm,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.Building.StormAlarm,color:t.Color.RGBAColor.Blue})],[i.ice,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.Building.IceAlarm,color:t.Color.RGBAColor.Blue})],[i.commError,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.Events.Flag.Fault,color:t.Color.RGBAColor.Red})],[i.burglary,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.Building.BurglarAlarm,color:t.Color.RGBAColor.Red})],[i.maintenance,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.Building.Maintenance,color:t.Color.RGBAColor.DarkOrange})],[i.manualActuator,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.RoomAutomation.Manual,color:t.Color.RGBAColor.DarkOrange})],[i.manualGroup,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.RoomAutomation.Manual,color:t.Color.RGBAColor.DarkOrange})],[i.facadeThermoAutomatic,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.RoomAutomation.Automatic,color:t.Color.RGBAColor.TcHmiGreen})],[i.facadeTwilightAutomatic,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.RoomAutomation.Automatic,color:t.Color.RGBAColor.TcHmiGreen})],[i.sunProtection,t.Icons.convertIIconDataToIIconAttributes({...t.Icons.RoomAutomation.Automatic,color:t.Color.RGBAColor.TcHmiGreen})]]),n.PriorityLockThreshold=i.manualGroup,n.PriorityManual=i.manualGroup;class r extends t.Components.Button{constructor(o,n){super(o,n),this.smallMode=!1,this.__useSmallImage=!1,this.__element.addClass("sunblind-icon"),this.resizeHandler=new t.Components.ResizeHandler(this),this.iconHandler.setIconHeight(95,"%"),this.iconHandler.setIconWidth(95,"%"),this.iconHandler.setIcon(e.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Sunblind")+"/Images/SunblindSlats.svg",!0),this.__legendIconHandler.icon=t.Icons.convertIIconDataToIIconAttributes(t.Icons.RoomAutomation.Sunblind)}__attach(){this.__isAttached||(this.eventHandler.register(t.Components.BackgroundStyler.Events.onSvgLoaded,(e=>{e.destroy(),this.__animatePosition(),this.__animateAngle(),this.__animateSunExposure(),this.__processSlatColor()})),super.__attach(),this.__legendIconHandler.show())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}onResized(){let o=this.__element[0].getBoundingClientRect(),n=o.height;o.width<70||n<70?(this.iconHandler.setIcon(e.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Sunblind")+"/Images/SunblindSlats_small.svg",!0),this.__useSmallImage=!0):(this.iconHandler.setIcon(e.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Sunblind")+"/Images/SunblindSlats.svg",!0),this.__useSmallImage=!1),this.eventHandler.register(t.Components.BackgroundStyler.Events.onSvgLoaded,(e=>{this.__animatePosition(),this.__animateAngle()}))}__animatePosition(){if(!this.__isAttached)return;let e=this.iconHandler.getSvg();if(null==e)return;let t=e.find(".sunblind-slats");if(null==t[0])return;let o=0;null!=this.__attrHandler.position&&(o=100/(n.ClosePosition-n.OpenPosition)*this.__attrHandler.position-n.ClosePosition),(o>0||isNaN(o))&&(o=-100),t.css("transform",`translate(0px, ${o}px)`),t.css("transition","transform 200ms linear")}__animateAngle(){if(!this.__isAttached)return;null==this.__attrHandler.angle&&(this.__attrHandler.angle=(n.MaximumAngle-n.MinimumAngle)/2);let e=this.iconHandler.getSvg();if(null==e)return;let t=6;this.__useSmallImage&&(t=16),null!=this.__attrHandler.angle&&(t=t/(n.MaximumAngle-n.MinimumAngle)*(this.__attrHandler.angle-n.MinimumAngle),!this.__useSmallImage&&t<2&&(t=2),this.__useSmallImage&&t<4&&(t=4)),e.css("--tchmi-ba-sunblind-slat-stroke-width",t+"px")}__animateSunExposure(){let e=this.iconHandler.getSvg();if(e)if(null==this.__attrHandler.closedColor||null==this.__attrHandler.openedColor)e.css("background","");else if(null==this.__attrHandler.position)e.css("background",this.__attrHandler.closedColor.toString());else{let o=100/(n.OpenPosition-n.ClosePosition)*(this.__attrHandler.position-n.OpenPosition);null!=this.__attrHandler.angle&&(o=o+40-40/(n.MaximumAngle-n.MinimumAngle)*(this.__attrHandler.angle-n.MinimumAngle)),e.css("background",t.Color.getFadeColor(this.__attrHandler.closedColor,0,this.__attrHandler.openedColor,100,o).toString())}}setAttributes(e){return super.setAttributes(e),void 0!==e.position&&this.setPosition(e.position),void 0!==e.angle&&this.setAngle(e.angle),void 0!==e.openedColor&&this.setOpenedColor(e.openedColor),void 0!==e.closedColor&&this.setClosedColor(e.closedColor),void 0!==e.slatColor&&this.setSlatColor(e.slatColor),this}getAttributes(){return this.__attrHandler.getRef()}setPosition(e){return this.__attrHandler.checkAttribute(e,"position",{validator:"number"})?(this.__attrHandler.position=e,this.__processPosition(),this):this}__processPosition(){this.__animatePosition(),this.__animateSunExposure()}getPosition(){return this.__attrHandler.position}setAngle(e){return this.__attrHandler.checkAttribute(e,"angle",{validator:"number"})?(this.__attrHandler.angle=e,this.__processAngle(),this):this}__processAngle(){this.__animateAngle(),this.__animateSunExposure()}getAngle(){return this.__attrHandler.angle}setOpenedColor(e){return this.__attrHandler.checkColorAttribute(e,"openedColor")?(this.__attrHandler.openedColor=e,this.__processOpenedColor(),this):this}__processOpenedColor(){this.__animateSunExposure()}getOpenedColor(){return this.__attrHandler.openedColor}setClosedColor(e){return this.__attrHandler.checkColorAttribute(e,"closedColor")?(this.__attrHandler.closedColor=e,this.__processClosedColor(),this):this}__processClosedColor(){this.__animateSunExposure()}getClosedColor(){return this.__attrHandler.closedColor}setSlatColor(e){return this.__attrHandler.checkColorAttribute(e,"slatColor")?(this.__attrHandler.slatColor=e,this.__processSlatColor(),this):this}__processSlatColor(){let e=this.iconHandler.getSvg();if(null==e)return;let t=e.find(".sunblind-slats");if(null==t[0])return;let o=this.__attrHandler.slatColor?.toString();o?t.css("stroke",o):t.css("stroke","rgb(120, 120. 120)")}getSlatColor(){return this.__attrHandler.slatColor}__processReadOnly(){super.__processReadOnly(),!0===this.__attrHandler.readOnly?this.__element.removeClass("button"):this.__element.addClass("button")}__updateLegendIcon(){}}n.Icon=r}(a=n.Sunblind||(n.Sunblind={}))})((o=t.Controls||(t.Controls={})).RoomAutomation||(o.RoomAutomation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("Sunblind","TcHmi.BuildingAutomation.Controls.RoomAutomation",TcHmi.BuildingAutomation.Controls.RoomAutomation.Sunblind);