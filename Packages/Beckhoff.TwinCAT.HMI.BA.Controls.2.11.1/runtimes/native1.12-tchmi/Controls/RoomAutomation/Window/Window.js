var TcHmi;!function(t){!function(e){!function(i){!function(o){let s;!function(t){t.detail="detail",t.quickLinks="quickLinks"}(s||(s={}));class n extends i.System.BaseRoomControl{constructor(t,i,o){super(t,i,o),this.__positionFeedbackReady=[],this.__useCurrentPosition=!1,this.__waitingForPositionFeedback=!1,this.__uiFinishedHandler=(t,i)=>{i instanceof e.Components.Slider?this.__positionSlider&&this.writePositionToPlc(this.__positionSlider.getValue()):i instanceof e.Components.Checkbox&&this.__positionSwitch&&this.writePositionToPlc(this.__positionSwitch.getState())}}__previnit(){null==this.__baFc&&(this.__baFc=new n.Icon(this.__id+"-ba-fc",this)),super.__previnit(),this.__element.append(this.__baFc.getElement()),void 0===this.__attrHandler.readOnly&&this.setReadOnly(!1),this.baInterfaceHandler.baInterfaceDefinition=n.BaInterfaceDef,this.setBaInterfaceSymbolNames(n.BaInterfaceSymbolNames)}__init(){super.__init()}__attach(){super.__attach(),this.__baFc.setPosition(null!=this.__attrHandler.positionFeedback?this.__attrHandler.positionFeedback:this.__attrHandler.position),this.__processIsControllable(!0)}__detach(){super.__detach()}destroy(){this.__keepAlive||(null!=this.__destroyOnPositionSliderChanged&&(this.__destroyOnPositionSliderChanged(),delete this.__destroyOnPositionSliderChanged),null!=this.__destroyOnPositionSwitchUIFinised&&(this.__destroyOnPositionSwitchUIFinised(),delete this.__destroyOnPositionSwitchUIFinised),null!=this.__destroyOnPositionSliderUIFinised&&(this.__destroyOnPositionSliderUIFinised(),delete this.__destroyOnPositionSliderUIFinised),this.__positionSlider?.destroy(),this.__positionSwitch?.destroy(),super.destroy())}__processChangedPosition(t){if(this.__useCurrentPosition=!0,this.__waitingForPositionFeedback=!0,this.setPosition(t),null!=this.__attrHandler.positionFeedback&&this.__attrHandler.position!=this.__attrHandler.positionFeedback){let t=()=>{this.__positionFeedbackReady.forEach((t=>t())),this.__positionFeedbackReady=[],this.setPosition(this.__attrHandler.positionFeedback)},i=this.logger.logPerformance(e.Logger.Severity.debug,"Position feedback response."),s=()=>{i()};this.__positionFeedbackReady.push(this.busyHandler.setBusy("Waiting for PositionFeedback",{cbOnTimeout:t,cbOnReady:s,showIndicator:o.showBusyIndicator}))}}__createOrUpdateElements(){if(null==this.__attrHandler.position)return;let t=this.__attrHandler.position;switch(null!=this.__attrHandler.positionFeedback&&0==this.__useCurrentPosition&&(t=this.__attrHandler.positionFeedback),this.__useCurrentPosition=!1,typeof t){case"number":this.__positionSwitch&&(this.__removeControl(s.detail,this.__positionSwitch),delete this.__positionSwitch,null!=this.__destroyOnPositionSwitchUIFinised&&(this.__destroyOnPositionSwitchUIFinised(),delete this.__destroyOnPositionSwitchUIFinised)),null==this.__positionSlider&&(this.__positionSlider=new e.Components.Slider(this.__id+"-position-slider",this),this.__positionSlider.setShowScale(!1).setShowValue(!1).setKnobAppearance(e.Components.Slider.KnobAppearance.round).setShowBusyIndicator(o.showBusyIndicator).layoutHandler.setMaxHeight(10).setMinHeight(10),this.__addControl(s.detail,this.__positionSlider,1),this.__destroyOnPositionSliderUIFinised=this.__positionSlider.eventHandler.register(e.Components.Slider.SliderEvents.onUserInteractionFinished,this.__uiFinishedHandler),this.__destroyOnPositionSliderChanged=this.__positionSlider.eventHandler.register(e.Components.Slider.SliderEvents.onValueChanged,(()=>{null!=this.__positionSlider&&(this.__baFc.setPosition(this.__positionSlider.getValue()),this.__updateDisplay(this.__positionSlider.getValue()))}))),this.__positionSlider.setMinValue(n.ClosePosition).setMaxValue(n.OpenPosition),this.__createOrUpdateQuickLinks(),this.__positionSlider.setValue(this.__attrHandler.position),null!=this.__attrHandler.positionFeedback&&this.__positionSlider.setValueFeedback(this.__attrHandler.positionFeedback);let i=this.__getControl(s.quickLinks,"toggle");i&&i.setState(t>n.ClosePosition);break;case"boolean":this.__positionSlider&&(this.__removeControl(s.detail,this.__positionSlider),delete this.__positionSlider),null==this.__positionSwitch&&(this.__positionSwitch=new e.Components.Checkbox(this.__id+"-position-switch",this),this.__positionSwitch.setActiveText(null).setInactiveText(null).setAppearance(e.Components.Checkbox.Appearance.toggleSlider).setReadOnly(!1).layoutHandler.setMaxHeight(25).setMinHeight(25).setMaxWidth(50).setMinWidth(50),this.__addControl(s.detail,this.__positionSwitch,1),this.__destroyOnPositionSwitchUIFinised=this.__positionSwitch.eventHandler.register(e.Components.Checkbox.CheckboxEvents.onUserInteractionFinished,this.__uiFinishedHandler)),this.__element.removeClass("has-quick-links"),this.__removeAllControls(s.quickLinks),this.__positionSwitch.setState(t)}this.__baFc.setPosition(t),this.__updateDisplay(t)}__createOrUpdateQuickLinks(){if(0!=n.ShowQuickLinks&&!this.__element.hasClass("has-quick-links")){this.__element.addClass("has-quick-links"),this.__addControls(s.quickLinks,[{type:e.Components.ComponentType.Checkbox,name:"toggle",settings:{appearance:e.Components.Checkbox.Appearance.toggleSlider,readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:35,minWidth:35}},callback:t=>{this.writePositionToPlc(1==t?n.OpenPosition:n.ClosePosition)}},{type:e.Components.ComponentType.Button,callback:()=>{this.writePositionToPlc((n.OpenPosition-n.ClosePosition)/4+n.ClosePosition)}},{type:e.Components.ComponentType.Button,callback:()=>{this.writePositionToPlc((n.OpenPosition-n.ClosePosition)/2+n.ClosePosition)}},{type:e.Components.ComponentType.Button,callback:()=>{this.writePositionToPlc(3*(n.OpenPosition-n.ClosePosition)/4+n.ClosePosition)}}],2);for(let e=1;e<this.__getControls(s.quickLinks).length;e++){let i=this.__getControls(s.quickLinks)[e];switch(e){case 1:i.getElement().css("--tchmi-ba-window-position",10);break;case 2:i.getElement().css("--tchmi-ba-window-position",20);break;case 3:i.getElement().css("--tchmi-ba-window-position",30)}i.setAttributes({iconPath:this.__attrHandler.displayMode===n.Icon.DisplayMode.roofDome?t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/RoofDome_small.svg":t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/Window_small.svg",iconHeight:90,iconHeightUnit:"%",iconWidth:90,iconWidthUnit:"%"})}}}__updateDisplay(t){null==t&&(t=0),this.__attrHandler.showValue?(this.__element.addClass("show-displays"),n.Icon.getPositionText(t,n.ClosePosition,n.OpenPosition,(t=>{this.__attrHandler.showValue?this.__baFc.textHandler.setText(t):this.__baFc.textHandler.setText(null)})),this.__baFc.getElement().append(this.__baFc.textHandler.getTextElement())):(this.__element.removeClass("show-displays"),this.__baFc.textHandler.setText(null),this.__baFc.textHandler.getTextElement().detach())}static processBaObject(t,e,o){null==e&&(e=n.BaInterfaceSymbolNames),i.System.BaseRoomControl.processBaObject(t,e,o);let s=t.baObjectHandler;if(null!=s&&s.baObject?.checkParams(n.BaInterfaceDef,e,t,!0)){let t=s.baObject.tryGetBaVariable("commandOpen");null!=t&&s.watchBaVariable(t,(t=>{o.processPosition(t)}));let e=s.baObject.tryGetBaVariable("feedback");null!=e&&s.watchBaVariable(e,(t=>{o.processPositionFeedback(t)})),null!=s.baObject.tryGetBaVariable("resetManual")&&o.processHasResetSymbol(!0)}}static writePositionToPlc(t,i){null!=t&&"boolean"==typeof t&&(i instanceof e.BA.BaBasicObject?t?i.tryGetBaVariable("commandOpen")?.write(!0,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)})):i.tryGetBaVariable("commandClose")?.write(!0,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)})):i instanceof e.BaInterfaceHandler&&(t?i.writeSubSymbol("commandOpen",!0).then((t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)})):i.writeSubSymbol("commandClose",!0).then((t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)}))))}writePositionToPlc(t){1!=this.busyHandler.getIsBusy()&&null!=t&&(null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=n.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(n.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&n.writePositionToPlc(t,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&n.writePositionToPlc(t,this.baInterfaceHandler),this.__processChangedPosition(t))}static getIsLocked(t){return!!i.System.BaseRoomControl.getIsLocked(t)||null!=t.priority&&(t.priority<o.Sunblind.PriorityLockThreshold&&0!=t.priority)}getIsLocked(){return n.getIsLocked(this.__attrHandler)}static getPriorityDisplayIcon(t){if(null==t)return e.Logger.warn("No priority passed."),null;let i=o.Sunblind.PriorityIcons.get(t);return null==i?null:i}getPriorityIcon(t){return n.getPriorityDisplayIcon(t)}static hasManualPriority(t){return t===o.Sunblind.PriorityManual}hasManualPriority(){return n.hasManualPriority(this.__attrHandler.priority)}setBaObject(t){return this.baObjectHandler.setBaObject(t),this}getBaObject(){return this.baObjectHandler.baObject}setAttributes(t){return super.setAttributes(t),void 0!==t.position&&this.setPosition(t.position),void 0!==t.positionFeedback&&this.setPositionFeedback(t.positionFeedback),void 0!==t.showValue&&this.setShowValue(t.showValue),this}getAttributes(){return this.__attrHandler}setBaInterface(t){return super.setBaInterface(t),this.baInterfaceHandler.setBaInterfaceSym(t,(()=>{n.processBaInterface(this,{processError:t=>this.setError(t),processPriority:t=>this.setPriority(t),processPosition:t=>this.setPosition(t),processPositionFeedback:t=>this.setPositionFeedback(t),processHasResetSymbol:t=>{this.__hasResetSymbol=t,this.__processPriority()}})})),this}setPosition(e){let i=null;if(null!=e)switch(typeof e){case"boolean":case"number":i=e;break;default:i=t.ValueConverter.toNumber(e),null==i&&(i=t.ValueConverter.toBoolean(e))}return null==i&&(i=this.getAttributeDefaultValueInternal("Position")),i===this.__attrHandler.position||(this.__attrHandler.position=i,this.__processPosition(),t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Position"}),t.EventProvider.raise(this.__id+".onPositionChanged")),this}__processPosition(){this.__createOrUpdateElements()}getPosition(){return this.__attrHandler.position}setPositionFeedback(e){let i=null;if(null!=e)switch(typeof e){case"boolean":case"number":i=e;break;default:i=t.ValueConverter.toNumber(e),null==i&&(i=t.ValueConverter.toBoolean(e))}if(null==i&&(i=this.getAttributeDefaultValueInternal("PositionFeedback")),i===this.__attrHandler.positionFeedback)return this;if(this.__attrHandler.positionFeedback=i,null!=this.__attrHandler.positionFeedback){if(1==this.__waitingForPositionFeedback&&this.__attrHandler.positionFeedback!=this.__attrHandler.position)return this;this.__processPositionFeedback(),this.__positionFeedbackReady.forEach((t=>t())),this.__positionFeedbackReady=[],this.__waitingForPositionFeedback=!1,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PositionFeedback"})}return this}__processPositionFeedback(){this.__createOrUpdateElements()}getPositionFeedback(){return this.__attrHandler.positionFeedback}setDisplayMode(e){let i=t.ValueConverter.toNumber(e);return null==i&&(i=this.getAttributeDefaultValueInternal("DisplayMode")),i===this.__attrHandler.displayMode||(this.__attrHandler.displayMode=i,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"DisplayMode"}),this.__processDisplayMode()),this}__processDisplayMode(){this.__baFc.setDisplayMode(this.__attrHandler.displayMode),this.__createOrUpdateElements()}getDisplayMode(){return this.__attrHandler.displayMode}setIconRotation(e){let i=t.ValueConverter.toNumber(e);return null==i&&(i=this.getAttributeDefaultValueInternal("IconRotation")),i===this.__baFc.iconHandler.getIconRotation()||(this.__baFc.iconHandler.setIconRotation(i),t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IconRotation"})),this}getIconRotation(){return this.__baFc.iconHandler.getIconRotation()}setShowValue(e){let i=t.ValueConverter.toBoolean(e);return null==i&&(i=this.getAttributeDefaultValueInternal("ShowValue")),i===this.__attrHandler.showValue||(this.__attrHandler.showValue=i,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowValue"}),this.__processShowValue()),this}__processShowValue(){this.__createOrUpdateElements()}getShowValue(){return this.__attrHandler.showValue}processBaObject(){super.processBaObject(),n.processBaObject(this,this.baInterfaceHandler.baInterfaceSymNames,{processError:t=>this.setError(t),processPriority:t=>this.setPriority(t),processPosition:t=>this.setPosition(t),processPositionFeedback:t=>this.setPositionFeedback(t),processHasResetSymbol:t=>{this.__hasResetSymbol=t,this.__processPriority()}})}static processBaInterface(t,e){i.System.BaseRoomControl.processBaInterface(t,e),t.baInterfaceHandler.watchSubSymbol("commandOpen",(t=>{e.processPosition(t)})),t.baInterfaceHandler.hasSubSymbol("feedback")&&t.baInterfaceHandler.watchSubSymbol("feedback",(t=>{e.processPositionFeedback(t)})),e.processHasResetSymbol(t.baInterfaceHandler.hasSubSymbol("resetManual"))}__updateLegendIcon(){}}o.Window=n,function(o){o.BaInterfaceDef={...i.System.BaseRoomControl.BaInterfaceDef,commandOpen:{type:"boolean"},commandClose:{type:"boolean"},feedback:{type:"boolean",optional:!0},resetManual:{type:"boolean",optional:!0}},o.BaInterfaceSymbolNames={...i.System.BaseRoomControl.BaInterfaceSymbolNames,commandOpen:{symbolName:"bOpen"},commandClose:{symbolName:"bClose"},feedback:{symbolName:"bFeedback"},resetManual:{symbolName:"bReset"}},o.ShowQuickLinks=!1,o.ClosePosition=0,o.OpenPosition=100;class s extends e.Components.Button{constructor(t,i){super(t,i),this.resizeHandler=new e.Components.ResizeHandler(this),this.setDisplayMode(s.DisplayMode.standard),this.iconHandler.setIconHeight(90,"%"),this.iconHandler.setIconWidth(90,"%")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.resizeHandler.destroy(),super.destroy()}onResized(){let i=this.__element[0].getBoundingClientRect(),o=i.height,n=i.width;if(this.eventHandler.register(e.Components.BackgroundStyler.Events.onSvgLoaded,(t=>{t.destroy(),this.__animatePosition()})),this.__attrHandler.displayMode===s.DisplayMode.roofDome)n<70||o<70?this.iconHandler.setIcon(t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/RoofDome_small.svg",!0):this.iconHandler.setIcon(t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/RoofDome.svg",!0),this.__legendIconHandler.icon=e.Icons.convertIIconDataToIIconAttributes(e.Icons.RoomAutomation.RoofDome);else n<70||o<70?this.iconHandler.setIcon(t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/Window_small.svg",!0):this.iconHandler.setIcon(t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/Window.svg",!0),this.__legendIconHandler.icon=e.Icons.convertIIconDataToIIconAttributes(e.Icons.RoomAutomation.Window);this.__isAttached&&this.__legendIconHandler.show()}__animatePosition(){let t=this.iconHandler.getSvg();if(null!=t){let e=t.find(".tchmi-ba-window-icon");if(null==e[0])return;let i=0,n=80;this.__attrHandler.displayMode===s.DisplayMode.roofDome&&(n=20),"number"==typeof this.__attrHandler.position?null!=this.__attrHandler.position&&(i=n/(o.OpenPosition-o.ClosePosition)*(this.__attrHandler.position-o.ClosePosition)):i=this.__attrHandler.position?n:0,(i<0||isNaN(i))&&(i=0),e.css("--tchmi-ba-window-position",i),e.css("transition","transform 200ms linear")}}static getPositionText(t,i,o,s){if(null!=t&&null!=i&&null!=o&&"number"==typeof t)s(e.Helper.Number.toPercentage(t,i,o).toFixed(0)+" %");else if(null!=t&&null!=i&&null!=o&&"boolean"==typeof t){let i=t?e.Locale.LangKey.Open:e.Locale.LangKey.Closed;e.Locale.Localization.watchText(i,(t=>{e.Logger.checkServerResult(e.Logger.Severity.warn,t)&&null!=t.text&&s(t.text)}))}else s("?")}setAttributes(t){return super.setAttributes(t),void 0!==t.position&&this.setPosition(t.position),void 0!==t.displayMode&&this.setDisplayMode(t.displayMode),this}getAttributes(){return this.__attrHandler.getRef()}setPosition(t){return this.__attrHandler.checkAttribute(t,"position",{validator:["boolean","number"]})?(this.__attrHandler.position=t,this.__processPosition(),this):this}__processPosition(){this.__animatePosition()}getPosition(){return this.__attrHandler.position}setDisplayMode(t){return this.__attrHandler.checkAttribute(t,"displayMode",{validator:"number"})?(this.__attrHandler.displayMode=t,this.__processDisplayMode(),this):this}__processDisplayMode(){this.onResized(),this.__animatePosition()}getDisplayMode(){return this.__attrHandler.displayMode}__processReadOnly(){super.__processReadOnly(),!0===this.__attrHandler.readOnly?this.__element.removeClass("button"):this.__element.addClass("button")}__updateLegendIcon(){}}o.Icon=s,function(t){let e;!function(t){t[t.standard=0]="standard",t[t.roofDome=1]="roofDome"}(e=t.DisplayMode||(t.DisplayMode={}))}(s=o.Icon||(o.Icon={}))}(n=o.Window||(o.Window={}))}(i.RoomAutomation||(i.RoomAutomation={}))}(e.Controls||(e.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("Window","TcHmi.BuildingAutomation.Controls.RoomAutomation",TcHmi.BuildingAutomation.Controls.RoomAutomation.Window);