var TcHmi;!function(t){!function(e){!function(i){!function(a){class s extends i.System.BaseControl{constructor(t,i,a){super(t,i,a),this.__loadBaChildren=!0,this.__data=null,this.__xAxisExtension=null,this.__title=null,this.__showHeader=null,this.__contentWindow=new e.Components.ContentWindow(this.__id+"-content-window",this),this.__contentContainer=this.__contentWindow.getContentContainer(),this.__setpointsContainer=$("<div>").addClass("setpoint-container"),this.__parameterListContainer=$("<div>").addClass("parameter-list-container"),this.__parameterList=new e.Navigation.ParameterList(this.__id+".parameter-list",this),this.__contextMenu=this.__contentWindow.addMenu(),this.__scales=[],this.__lineChartYAxis=[],this.__lineGraphDescriptions=[],this.__lineChartData=[],this.__saveButtonPressedHandler=()=>{this.__contextMenu.close(),this.eventHandler.raise(s.ScaleEvents.onSave)},this.__resetButtonPressedHandler=()=>{this.__contextMenu.close(),this.eventHandler.raise(s.ScaleEvents.onReset)},this.__limitValueChangedHandler=(t,i)=>{if(null===this.__data)return;let a=t.getValue();if("number"==typeof a){let s=t.getId(),n=this.__data[i];if(s.indexOf("y-max")>-1){let t=this.__normalizeAxisTicks(this.__lineChartYAxis[i].mainTickMinValue,a+n.YAxisExtension);if(null!=t&&(this.__lineChartYAxis[i].mainTickMinValue=t.min,this.__lineChartYAxis[i].mainTickMaxValue=t.max),n.YMax=a,null!=this.__scales){let t=this.__scales[i];t.LimitInputs?.YMax.setValue(a),t.LimitInputs?.YMin.setMaxValue(a);for(let e=0;e<t.Setpoints.length;e++)t.Setpoints[e].setpoint.setYAxisMax(this.__lineChartYAxis[i].mainTickMaxValue),t.Setpoints[e].setpoint.setYAxisMin(this.__lineChartYAxis[i].mainTickMinValue),t.Setpoints[e].setpoint.setYMax(a);if(null!=this.baObjectHandler.baObject){if(!this.baObjectHandler.baObject.getIsValid())return void e.Logger.warn(this.baObjectHandler.baObject.isNotValidText);switch(this.baObjectHandler.baObject.SubjectInfo.Identifier){case e.BA.SubjectInfos.HtgCrv:case e.BA.SubjectInfos.HeatgCrv:break;case e.BA.SubjectInfos.SpTRm:case e.BA.SubjectInfos.SpRoomTemp:t.Setpoints[3].setpoint.setValue({x:t.Setpoints[3].setpoint.getValue().x,y:a})}}}}else if(s.indexOf("y-min")>-1){let t=this.__normalizeAxisTicks(a-n.YAxisExtension,this.__lineChartYAxis[i].mainTickMaxValue);if(null!=t&&(this.__lineChartYAxis[i].mainTickMinValue=t.min,this.__lineChartYAxis[i].mainTickMaxValue=t.max),n.YMin=a,null!=this.__scales){let t=this.__scales[i];t.LimitInputs?.YMin.setValue(a),t.LimitInputs?.YMax.setMinValue(a);for(let e=0;e<t.Setpoints.length;e++)t.Setpoints[e].setpoint.setYAxisMin(this.__lineChartYAxis[i].mainTickMinValue),t.Setpoints[e].setpoint.setYAxisMax(this.__lineChartYAxis[i].mainTickMaxValue),t.Setpoints[e].setpoint.setYMin(a);if(null!=this.baObjectHandler.baObject){if(!this.baObjectHandler.baObject.getIsValid())return void e.Logger.warn(this.baObjectHandler.baObject.isNotValidText);switch(this.baObjectHandler.baObject.SubjectInfo.Identifier){case e.BA.SubjectInfos.HtgCrv:case e.BA.SubjectInfos.HeatgCrv:break;case e.BA.SubjectInfos.SpTRm:case e.BA.SubjectInfos.SpRoomTemp:t.Setpoints[1].setpoint.setValue({x:t.Setpoints[1].setpoint.getValue().x,y:a}),t.Setpoints[2].setpoint.setValue({x:t.Setpoints[2].setpoint.getValue().x,y:a})}}}}else console.log(`Value of unknown limit input has changed in ${this.__id}!`);this.__updateLineChart()}}}__previnit(){super.__previnit(),this.baObjectHandler=new e.BaObjectHandler(this),this.resizeHandler=new e.Components.ResizeHandler(this),this.__element.append(this.__contentWindow.getElement()),this.__contextMenu.addRowEntry({controlsHorizontalAlignment:"Right",controls:[{type:e.Components.ComponentType.Button,callback:this.__saveButtonPressedHandler,settings:{textAttributes:{text:"Save"},layout:{maxWidth:100}}},{type:e.Components.ComponentType.Button,callback:this.__resetButtonPressedHandler,settings:{textAttributes:{text:"Reset"},layout:{maxWidth:100}}}]}),this.__lineChart=t.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiLineChart",this.__id+"-line-chart",{"data-tchmi-show-x-axis":!0,"data-tchmi-show-x-axis-name":!0,"data-tchmi-x-axis-name":"Outside temperature","data-tchmi-x-axis-unit":"Â°C","data-tchmi-x-axis-decimal-places":2,"data-tchmi-x-main-tick-min-value":0,"data-tchmi-x-main-tick-max-value":100,"data-tchmi-x-main-tick-steps":11,"data-tchmi-y-main-tick-steps":11,"data-tchmi-graph-background-color":{color:"rgb(255,255,255)"},"data-tchmi-show-grid":!0,"data-tchmi-subgrid-show-horizontal-lines":!0,"data-tchmi-subgrid-show-vertical-lines":!0,"data-tchmi-show-x-sub-ticks":!0,"data-tchmi-show-y-sub-ticks":!0},this),null!=this.__lineChart&&(this.__lineChart.getElement().addClass("line-chart"),this.__lineChart.setXAxisDecimalPlaces(0),this.__contentContainer.append(this.__lineChart.getElement()),this.__lineChart.getElement().append(this.__setpointsContainer)),this.__contentContainer.append(this.__parameterListContainer),this.__parameterList.getElement().addClass("parameter-list"),this.__parameterListContainer.append(this.__parameterList.getElement())}__init(){super.__init()}__attach(){if(super.__attach(),this.__destroyersToCallOnDetach.push(this.eventHandler.register(s.ScaleEvents.onSave,(()=>{if(null==this.__data)return;let t=this.__data[0];if(null==t)return;let i,a=this.__baFc.getReadOnly();if(null!=this.baObjectHandler.baObject&&!a&&this.baObjectHandler.baObject instanceof e.BA.BaView){if(!this.baObjectHandler.baObject.getIsValid())return void e.Logger.warn(this.baObjectHandler.baObject.isNotValidText);switch(this.baObjectHandler.baObject.SubjectInfo.Identifier){case e.BA.SubjectInfos.HtgCrv:case e.BA.SubjectInfos.HeatgCrv:i=this.baObjectHandler.baObject.Children,i.get("Y1")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[3].y),i.get("X1")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[3].x),i.get("Y2")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[2].y),i.get("X2")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[2].x),i.get("Y3")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[1].y),i.get("X3")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[1].x),i.get("Y4")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[0].y),i.get("X4")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[0].x),i.get("YMax")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.YMax),i.get("YMin")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.YMin);break;case e.BA.SubjectInfos.SpTRm:case e.BA.SubjectInfos.SpRoomTemp:i=this.baObjectHandler.baObject.Children,i.get("Y1")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[0].y),i.get("Y2_3")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[1].y),i.get("Y4")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[3].y),i.get("X1")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[0].x),i.get("X2")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[1].x),i.get("X3")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[2].x),i.get("X4")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.write(t.ScaleSetpoints[3].x)}}}))),this.__destroyersToCallOnDetach.push(this.eventHandler.register(s.ScaleEvents.onReset,(()=>{this.processBaObject()}))),this.__lineChart){let e=t.EventProvider.register(this.__lineChart.getId()+".onAttached",(()=>{e(),this.__updateLineChart()}))}}__detach(){super.__detach()}destroy(){if(!this.__keepAlive){for(let t=0;t<this.__scales.length;t++)for(let e=0;e<this.__scales[t].Setpoints.length;e++){let i=this.__scales[t].Setpoints[e].destroyOnChanged;null!=i&&i()}this.childrenHandler.getChildren().forEach((t=>t.destroy())),this.resizeHandler.destroy(),this.baObjectHandler.destroy(),super.destroy()}}__onSetPointValueChanged(i,a){if(null===this.__data)return;let n=a.getId(),l=a.getValue();if(null===l)return;let _=n.replace(this.__id+"-scale-setpoint-",""),h=Number(_.slice(_.indexOf("-")+1));_=Number(_.slice(0,_.indexOf("-"))),this.__data[_].ScaleSetpoints[h]=JSON.parse(JSON.stringify(l));let r=this.__data[_];switch(r.Behavior){case s.Behavior.onlyDecreasing:0===h?a.setYMax(r.YMax).setYMin(r.ScaleSetpoints[h+1].y).setXMax(r.ScaleSetpoints[h+1].x):h===r.ScaleSetpoints.length-1?a.setYMax(r.ScaleSetpoints[h-1].y).setYMin(r.YMin).setXMin(r.ScaleSetpoints[h-1].x):a.setYMax(r.ScaleSetpoints[h-1].y).setYMin(r.ScaleSetpoints[h+1].y).setXMin(r.ScaleSetpoints[h-1].x).setXMax(r.ScaleSetpoints[h+1].x);break;case s.Behavior.onlyIncreasing:0===h?a.setYMin(r.YMin).setYMax(r.ScaleSetpoints[h+1].y).setXMax(r.ScaleSetpoints[h+1].x):h===r.ScaleSetpoints.length-1?a.setYMin(r.ScaleSetpoints[h-1].y).setYMax(r.YMax).setXMin(r.ScaleSetpoints[h-1].x):a.setYMax(r.ScaleSetpoints[h+1].y).setYMin(r.ScaleSetpoints[h-1].y).setXMin(r.ScaleSetpoints[h-1].x).setXMax(r.ScaleSetpoints[h+1].x)}if(null!=this.baObjectHandler.baObject){if(!this.baObjectHandler.baObject.getIsValid())return void e.Logger.warn(this.baObjectHandler.baObject.isNotValidText);switch(this.baObjectHandler.baObject.SubjectInfo.Identifier){case e.BA.SubjectInfos.HtgCrv:case e.BA.SubjectInfos.HeatgCrv:break;case e.BA.SubjectInfos.SpTRm:case e.BA.SubjectInfos.SpRoomTemp:if(0===_&&1===h){let t=this.__scales[_].Setpoints[h+1]?.setpoint,e=t?.getValue();null!=e&&(t.setValue({x:e.x,y:l.y}),this.__data[_].ScaleSetpoints[h+1].y=l.y)}else if(0===_&&2===h){let t=this.__scales[_].Setpoints[h-1]?.setpoint,e=t?.getValue();null!=e&&(t.setValue({x:e.x,y:l.y}),this.__data[_].ScaleSetpoints[h-1].y=l.y)}}}t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Data"}),this.__updateLineChart(),this.onResized()}onResized(){let t=this.__setpointsContainer.outerHeight(),e=this.__setpointsContainer.outerWidth();if(!(null==t||null==e||t<=0||e<=0)){for(let i=0;i<this.__scales.length;i++)for(let a=0;a<this.__scales[i].Setpoints.length;a++)this.__scales[i].Setpoints[a].setpoint.setRange({Height:t,Width:e});for(let t=0;t<this.__lineChartYAxis.length;t++)this.__updateLimitIdentifiers(t)}}__normalizeAxisTicks(t,e){let i=0;if(null==t||null==e)return null;for(;(e-t)%10!=0;)i%2==0?t--:e++,i++;return{min:t,max:e}}__updateLineChart(){if(this.__isAttached&&this.__lineChart?.getIsAttached()&&null!=this.__lineChart&&null!=this.__dataXMin&&null!=this.__dataXMax&&null!=this.__lineChartYAxis&&null!=this.__lineGraphDescriptions&&null!=this.__data&&this.__lineChartYAxis.length===this.__data.length&&this.__lineGraphDescriptions.length===this.__data.length){for(let t=0;t<this.__lineChartYAxis.length;t++){let e=this.__lineChartYAxis[t];if(null!=e.mainTickMinValue&&null!=e.mainTickMaxValue){let t=this.__normalizeAxisTicks(e.mainTickMinValue,e.mainTickMaxValue);null!=t&&(e.mainTickMinValue=t.min,e.mainTickMaxValue=t.max)}}this.__lineChart.setYAxis(this.__lineChartYAxis),this.__lineChart.setLineGraphDescriptions(this.__lineGraphDescriptions),this.__lineChartData=[];let t=this.__dataXMin-(null!=this.__xAxisExtension?this.__xAxisExtension:0),e=this.__dataXMax+(null!=this.__xAxisExtension?this.__xAxisExtension:0),i=this.__normalizeAxisTicks(t,e);if(null!=i&&(t=i.min,e=i.max),this.__lineChart.setXMainTickMinValue(t),this.__lineChart.setXMainTickMaxValue(e),null==t||null==e)return;for(let i=0;i<this.__data.length;i++){let a=this.__data[i];if(null==a.YMax||null==a.YMin)return;this.__lineChartData.push(JSON.parse(JSON.stringify(a.ScaleSetpoints)));let n=a.ScaleSetpoints[1].y,l=a.ScaleSetpoints[0].y,_=a.ScaleSetpoints[1].x,h=a.ScaleSetpoints[0].x,r=(l-n)/(h-_),o=a.ScaleSetpoints.length,u=a.ScaleSetpoints[o-2].y,c=a.ScaleSetpoints[o-1].y,x=a.ScaleSetpoints[o-2].x,d=a.ScaleSetpoints[o-1].x,p=(c-u)/(d-x),M=this.__lineChartYAxis[i].mainTickMinValue,m=this.__lineChartYAxis[i].mainTickMaxValue;if(null==M||null==m)return;switch(a.Ending){case s.Ending.direct:break;case s.Ending.infinity:let o;r===-1/0?this.__lineChartData[i].unshift({x:_,y:M}):r===1/0?this.__lineChartData[i].unshift({x:_,y:m}):_>h?(o=r*(t-_)+n,this.__lineChartData[i].unshift({x:t,y:o})):(o=r*(e-_)+n,this.__lineChartData[i].unshift({x:e,y:o})),p===-1/0?this.__lineChartData[i].push({x:x,y:M}):p===1/0?this.__lineChartData[i].push({x:x,y:m}):x<d?(o=p*(e-x)+u,this.__lineChartData[i].push({x:e,y:o})):(o=p*(t-x)+u,this.__lineChartData[i].push({x:t,y:o}));break;case s.Ending.limits:switch(a.Behavior){case s.Behavior.onlyIncreasing:if(isFinite(r)){let e=r*(t-_)+n;if(e>=a.YMin)this.__lineChartData[i].unshift({x:t,y:e});else{let e=(a.YMin+r*_-n)/r;this.__lineChartData[i].unshift({x:e,y:a.YMin}),this.__lineChartData[i].unshift({x:t,y:a.YMin})}}else this.__lineChartData[i].unshift({x:_,y:a.YMin}),this.__lineChartData[i].unshift({x:t,y:a.YMin});if(isFinite(p)){let t=p*(e-x)+u;if(t<=a.YMax)this.__lineChartData[i].push({x:e,y:t});else{let t=(a.YMax+p*x-u)/p;this.__lineChartData[i].push({x:t,y:a.YMax}),this.__lineChartData[i].push({x:e,y:a.YMax})}}else this.__lineChartData[i].push({x:x,y:a.YMax}),this.__lineChartData[i].push({x:e,y:a.YMax});break;case s.Behavior.onlyDecreasing:if(isFinite(r)){let e=r*(t-_)+n;if(e<=a.YMax)this.__lineChartData[i].unshift({x:t,y:e});else{let e=(a.YMax+r*_-n)/r;this.__lineChartData[i].unshift({x:e,y:a.YMax}),this.__lineChartData[i].unshift({x:t,y:a.YMax})}}else this.__lineChartData[i].unshift({x:_,y:a.YMax}),this.__lineChartData[i].unshift({x:t,y:a.YMax});if(isFinite(p)){let t=p*(e-x)+u;if(t>=a.YMin)this.__lineChartData[i].push({x:e,y:t});else{let t=(a.YMin+p*x-u)/p;this.__lineChartData[i].push({x:t,y:a.YMin}),this.__lineChartData[i].push({x:e,y:a.YMin})}}else this.__lineChartData[i].push({x:x,y:a.YMin}),this.__lineChartData[i].push({x:e,y:a.YMin});break;case s.Behavior.any:let l;if(r===1/0)this.__lineChartData[i].unshift({x:_,y:a.YMax}),this.__lineChartData[i].unshift({x:t,y:a.YMax});else if(r===-1/0)this.__lineChartData[i].unshift({x:_,y:a.YMin}),this.__lineChartData[i].unshift({x:t,y:a.YMin});else if(r<0){if(_>h)if(l=r*(t-_)+n,l<=a.YMax)this.__lineChartData[i].unshift({x:t,y:l});else{let e=(a.YMax+r*_-n)/r;this.__lineChartData[i].unshift({x:e,y:a.YMax}),this.__lineChartData[i].unshift({x:t,y:a.YMax})}}else if(_>h){let e=r*(t-_)+n;if(e>=a.YMin)this.__lineChartData[i].unshift({x:t,y:e});else{let e=(a.YMin+r*_-n)/r;this.__lineChartData[i].unshift({x:e,y:a.YMin}),this.__lineChartData[i].unshift({x:t,y:a.YMin})}}if(p===1/0)this.__lineChartData[i].push({x:x,y:a.YMax}),this.__lineChartData[i].push({x:e,y:a.YMax});else if(p===-1/0)this.__lineChartData[i].push({x:x,y:a.YMin}),this.__lineChartData[i].push({x:e,y:a.YMin});else if(p<0){if(x<d)if(l=p*(e-x)+u,l>=a.YMin)this.__lineChartData[i].push({x:e,y:l});else{let t=(a.YMin+p*x-u)/p;this.__lineChartData[i].push({x:t,y:a.YMin}),this.__lineChartData[i].push({x:e,y:a.YMin})}}else if(x<d)if(l=p*(e-x)+u,l<=a.YMax)this.__lineChartData[i].push({x:e,y:l});else{let t=(a.YMax+p*x-u)/p;this.__lineChartData[i].push({x:t,y:a.YMax}),this.__lineChartData[i].push({x:e,y:a.YMax})}}break;case s.Ending.cutOff:this.__lineChartData[i].unshift({x:t,y:l}),this.__lineChartData[i].push({x:e,y:c})}}this.__lineChart.setLineGraphData(this.__lineChartData),this.__updateSetpointContainer()}}__updateSetpointContainer(){let t=15;for(let e=0;e<this.__lineChartYAxis.length;e++){t+=73;let i=this.__lineChartYAxis[e].mainTickMaxValue,a=this.__lineChartYAxis[e].mainTickMinValue;null!=a&&null!=i&&(i<=-100||a<=-100?t+=11:i>=100||a>=100?t+=6:(i<0||a<0)&&(t+=4)),this.__updateLimitIdentifiers(e)}this.__setpointsContainer.css({left:t})}__updateLimitIdentifiers(t){if(null==this.__data)return;let e=this.__data[t].Ending,i=this.__id+"-min-identifier-"+t,a=this.__setpointsContainer.find("#"+i);null==a[0]&&(e!==s.Ending.infinity?(a=$("<div>").addClass("scale-limit-identifier").attr("id",i),this.__setpointsContainer.append(a)):a.detach());let n=this.__setpointsContainer.find("#"+this.__id+"-max-identifier-"+t);if(null==n[0]&&(e!==s.Ending.infinity?(n=$("<div>").addClass("scale-limit-identifier").attr("id",this.__id+"-max-identifier-"+t),this.__setpointsContainer.append(n)):n.detach()),e==s.Ending.infinity)return;let l=this.__lineChartYAxis[t].mainTickMinValue,_=this.__lineChartYAxis[t].mainTickMaxValue,h=this.__setpointsContainer.outerHeight(),r=this.__lineChartYAxis[t].axisColor,o=this.__data[t].YMin,u=this.__data[t].YMax;null!=h&&null!=_&&null!=l&&null!=o&&null!=u&&null!=r&&(a.css({bottom:h/(_-l)*(o-l)-2,"border-color":r.color}),n.css({bottom:h/(_-l)*(u-l)-1,"border-color":r.color}))}setBaObject(t){return this.baObjectHandler.setBaObject(t),this}getBaObject(){return this.baObjectHandler.baObject}setData(t){return null===t||tchmi_equal(t,this.__data)||(this.__data=t,this.__processData()),this}__processData(){if(null==this.__data)return;for(let i=0;i<this.__data.length;i++){let a=this.__data[i];null==this.__scales[i]&&(this.__scales[i]={Setpoints:[]});let n,l,_=this.__scales[i];"string"==typeof a.Behavior&&(a.Behavior=Number(a.Behavior)),"string"==typeof a.Ending&&(a.Ending=Number(a.Ending));for(let t=0;t<a.ScaleSetpoints.length;t++){let e=a.ScaleSetpoints[t],h=_.Setpoints[t]?.setpoint,r=_.Setpoints[t]?.destroyOnChanged;!1===a.ReadOnly?(null==h&&(h=new s.Setpoint(this.__id+"-scale-setpoint-"+i+"-"+t,this),r=h.eventHandler.register(s.Setpoint.SetpointEvents.onSetpointValueChanged,((t,e)=>this.__onSetPointValueChanged(t,e))),this.__setpointsContainer.append(h.getElement()),_.Setpoints.push({setpoint:h,destroyOnChanged:r})),null!=h&&h.setValue(e).setSnapPeriode(a.SnapPeriode).setAllowHorizontalMovement(a.AllowHorizontalMovement).setAllowVerticalMovement(a.AllowVerticalMovement)):(null!=h&&(h.getElement().detach(),h.destroy()),null!=r&&r()),this.__dataXMin=Math.min(null!=this.__dataXMin?this.__dataXMin:e.x,e.x),this.__dataXMax=Math.max(null!=this.__dataXMax?this.__dataXMax:e.x,e.x),n=Math.min(null!=n?n:e.y,e.y),l=Math.max(null!=l?l:e.y,e.y)}!0===a.ReadOnly&&(_.Setpoints=[]),null==!a.YMax&&(a.YMax=l),null==a.YMin&&(a.YMin=n),null!=a.YMax&&null!=a.YMin&&a.YMax<=a.YMin&&console.error(`YMax should be bigger than YMin in data of ${this.__id}!`),null==a.Title&&(a.Title="Scale "+i),null==a.YAxisExtension&&(a.YAxisExtension=0);let h={color:e.Color.getPastelColor(i)};null==this.__lineChartYAxis[i]&&(this.__lineChartYAxis.push({id:i,position:0,decimalPlaces:2,showAxis:!0,showLabels:!0,showAxisName:!0,axisNameFontSize:15,axisNameFontSizeUnit:"px",axisNameFontWeight:"Bold",axisNameFontColor:h.color?.toSolidColor(),axisColor:h.color?.toSolidColor(),labelFontColor:h.color?.toSolidColor(),unit:a.Unit,logarithmicScale:!1,axisLabeling:t.Controls.Beckhoff.TcHmiLineChart.AxisLabeling.Auto}),this.__lineGraphDescriptions.push({yAxisId:i,lineColor:h.color?.toSolidColor(),lineWidth:1,pointDot:!1,pointDotFillColor:h.color?.toSolidColor(),pointDotRadius:3,pointDotStrokeColor:h.color?.toSolidColor(),pointDotStrokeWidth:1}));let r=null!=a.YMin?a.YMin-a.YAxisExtension:0,o=null!=a.YMax?a.YMax+a.YAxisExtension:0,u=this.__normalizeAxisTicks(r,o);null!=u&&(this.__lineChartYAxis[i].mainTickMinValue=u.min,this.__lineChartYAxis[i].mainTickMaxValue=u.max),this.__lineChartYAxis[i].axisName=a.Title;for(let t=0;t<_.Setpoints.length;t++){let e=_.Setpoints[t].setpoint;switch(e.setYAxisMin(this.__lineChartYAxis[i].mainTickMinValue).setYAxisMax(this.__lineChartYAxis[i].mainTickMaxValue),a.Behavior){case s.Behavior.any:e.setYMax(a.YMax).setYMin(a.YMin);break;case s.Behavior.onlyDecreasing:0===t?e.setYMax(a.YMax).setYMin(a.ScaleSetpoints[t+1].y).setXMax(a.ScaleSetpoints[t+1].x):t===_.Setpoints.length-1?e.setYMax(a.ScaleSetpoints[t-1].y).setYMin(a.YMin).setXMin(a.ScaleSetpoints[t-1].x):e.setYMax(a.ScaleSetpoints[t-1].y).setYMin(a.ScaleSetpoints[t+1].y).setXMin(a.ScaleSetpoints[t-1].x).setXMax(a.ScaleSetpoints[t+1].x);break;case s.Behavior.onlyIncreasing:0===t?e.setYMin(a.YMin).setYMax(a.ScaleSetpoints[t+1].y).setXMax(a.ScaleSetpoints[t+1].x):t===_.Setpoints.length-1?e.setYMin(a.ScaleSetpoints[t-1].y).setYMax(a.YMax).setXMin(a.ScaleSetpoints[t-1].x):e.setYMax(a.ScaleSetpoints[t+1].y).setYMin(a.ScaleSetpoints[t-1].y).setXMin(a.ScaleSetpoints[t-1].x).setXMax(a.ScaleSetpoints[t+1].x)}}let c=_.LimitInputs;if(a.Ending!==s.Ending.infinity&&null==c){let t=t=>{let a=t.eventHandler.register(e.Navigation.ParameterList.ParameterListEntry.ParameterListEntryEvents.onValueChanged,((t,e)=>{this.__limitValueChangedHandler(e,i)}));t.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,(t=>{a()}))};c={YMax:this.__parameterList.addEntry(this.__id+"-scale-"+i+"-y-max-limit-input",{DataType:e.DataType.number,Title:"Y max "+i,Unit:a.Unit,MinValue:a.YMin,ReadOnly:a.ReadOnly,cbOnCreated:[t]}),YMin:this.__parameterList.addEntry(this.__id+"-scale-"+i+"-y-min-limit-input",{DataType:e.DataType.number,Title:"Y min "+i,Unit:a.Unit,MaxValue:a.YMax,ReadOnly:a.ReadOnly,cbOnCreated:[t]})},c.YMax.backgroundStyler.setColor(h.color),c.YMin.backgroundStyler.setColor(h.color),_.LimitInputs=c}null!=c&&(a.Ending!==s.Ending.infinity?(c.YMax.setValue(a.YMax),c.YMax.setReadOnly(a.ReadOnly),c.YMin.setValue(a.YMin),c.YMin.setReadOnly(a.ReadOnly)):(this.__parameterList.removeEntry(c.YMin.getId()),this.__parameterList.removeEntry(c.YMax.getId())))}let i=this.__normalizeAxisTicks(this.__dataXMin,this.__dataXMax);if(null!=i&&(this.__dataXMin=i.min,this.__dataXMax=i.max),this.__updateLineChart(),null!=this.__dataXMin&&null!=this.__dataXMax)for(let t=0;t<this.__scales.length;t++)for(let e=0;e<this.__scales[t].Setpoints.length;e++)this.__scales[t].Setpoints[e].setpoint.setXAxisMin(this.__dataXMin-(null!=this.__xAxisExtension?this.__xAxisExtension:0)),this.__scales[t].Setpoints[e].setpoint.setXAxisMax(this.__dataXMax+(null!=this.__xAxisExtension?this.__xAxisExtension:0));this.onResized()}getData(){return this.__data}setXAxisExtension(e){let i=t.ValueConverter.toNumber(e);return null==i&&(i=this.getAttributeDefaultValueInternal("XAxisExtension")),i===this.__xAxisExtension||(this.__xAxisExtension=i,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"XAxisExtension"}),this.__processXAxisExtension()),this}__processXAxisExtension(){null!==this.__xAxisExtension&&this.__processData()}getXAxisExtension(){return this.__xAxisExtension}setTitle(e){let i=t.ValueConverter.toString(e);return null==i&&(i=this.getAttributeDefaultValueInternal("Title")),i===this.__title||(this.__title=i,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Title"}),this.__processTitle()),this}__processTitle(){this.__contentWindow.setHeadlineText(this.__title)}getTitle(){return this.__title}setShowHeader(e){let i=t.ValueConverter.toBoolean(e);return null==i&&(i=this.getAttributeDefaultValueInternal("ShowHeader")),i===this.__showHeader||(this.__showHeader=i,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowHeader"}),this.__processShowHeader()),this}__processShowHeader(){this.__contentWindow.setShowHeader(this.__showHeader)}getShowHeader(){return this.__showHeader}processBaObject(){if(null==this.baObjectHandler.baObject)return;if(!(this.baObjectHandler.baObject instanceof e.BA.BaView))return void console.warn("Passed object in Scale is not a BaView",this.baObjectHandler.baObject);let t,i,a,n=!0,l={ScaleSetpoints:[],YMax:0,YMin:0,Title:"",Behavior:s.Behavior.onlyDecreasing,Ending:s.Ending.limits,SnapPeriode:1,AllowVerticalMovement:!0,AllowHorizontalMovement:!0,YAxisExtension:10,ReadOnly:!0};if(this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eDescription,(t=>{this.setTitle(t)})),this.setXAxisExtension(10),null==this.__data&&(this.__data=[],this.__data[0]=JSON.parse(JSON.stringify(l))),this.baObjectHandler.baObject instanceof e.BA.BaView){if(!this.baObjectHandler.baObject.getIsValid())return void e.Logger.warn(this.baObjectHandler.baObject.isNotValidText);switch(this.baObjectHandler.baObject.SubjectInfo.Identifier){case e.BA.SubjectInfos.HtgCrv:case e.BA.SubjectInfos.HeatgCrv:i=["X1","X2","X3","X4","Y1","Y2","Y3","Y4","YMin","YMax","Y"],t=new Map;for(let e=0;e<i.length;e++){let a=this.baObjectHandler.baObject.Children.get(i[e]);a?t.set(i[e],a):console.warn(`Passed BaObject does not contain a child with subject identifier ${i[e]}!`,{requiredChildren:i,baObj:this.baObjectHandler.baObject})}for(let[i,a]of t){let t=i[0].toLowerCase();if("x"!==t&&"y"!==t)continue;if("Y"===i||"YMin"===i||"YMax"===i)continue;let s=Number(i.toLowerCase().replace(t,""));isNaN(s)||(s=-(s-4),this.baObjectHandler.tryWatchChildrenBaVariable(a,e.BA.BaParameterId.ePresentValue,(e=>{null!=e&&("x"!==t&&"y"!==t||null!=this.__data&&(null==this.__data[0].ScaleSetpoints[s]&&(this.__data[0].ScaleSetpoints[s]={x:0,y:0}),this.__data[0].ScaleSetpoints[s][t]=e,n||this.__processData()))})))}a=t.get("YMin")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.Access.Write,null!=a&&e.Server.BaSite.UserManagement.checkAccess(a)?this.__data[0].ReadOnly=!1:this.__data[0].ReadOnly=!0,this.baObjectHandler.tryWatchChildrenBaVariable(t.get("YMin"),e.BA.BaParameterId.ePresentValue,(t=>{if(null!=t&&null!=this.__data){for(let e=0;e<this.__data.length;e++)this.__data[e].YMin=t;n||this.__processData()}})),this.baObjectHandler.tryWatchChildrenBaVariable(t.get("YMax"),e.BA.BaParameterId.ePresentValue,(t=>{if(null!=t&&null!=this.__data){for(let e=0;e<this.__data.length;e++)this.__data[e].YMax=t;n||this.__processData()}})),this.baObjectHandler.tryWatchChildrenBaVariable(t.get("Y"),e.BA.BaParameterId.eUnit,(t=>{if(null==t||null==this.__data)return;let i=e.Functions.ConvertUnitToString(t);if(null!=i){for(let t=0;t<this.__data.length;t++)this.__data[t].Unit=i;n||this.__processData()}})),this.__processData(),n=!1;break;case e.BA.SubjectInfos.SpTRm:case e.BA.SubjectInfos.SpRoomTemp:i=["X1","X2","X3","X4","Y1","Y2_3","Y4","Sp"],t=new Map;for(let e=0;e<i.length;e++){let a=this.baObjectHandler.baObject.Children.get(i[e]);a?t.set(i[e],a):console.warn(`Passed BaObject does not contain a child with subject identifier ${i[e]}!`,{requiredChildren:i,baObj:this.baObjectHandler.baObject})}this.__data[0].Ending=s.Ending.cutOff,this.__data[0].Behavior=s.Behavior.any,this.__data[0].YAxisExtension=0;for(let[i,a]of t){let t=i[0].toLowerCase();if("x"!==t&&"y"!==t)continue;let s=i.toLowerCase().replace(t,"");s="y"===t&&"2_3"===s?2:Number(s),"number"==typeof s&&(s-=1,this.baObjectHandler.tryWatchChildrenBaVariable(a,e.BA.BaParameterId.ePresentValue,(e=>{null!=e&&("x"!==t&&"y"!==t||null!=this.__data&&(null==this.__data[0].ScaleSetpoints[s]&&(this.__data[0].ScaleSetpoints[s]={x:0,y:0}),"y"===t&&1===s?(this.__data[0].ScaleSetpoints[s][t]=e,this.__data[0].ScaleSetpoints[s+1][t]=e):this.__data[0].ScaleSetpoints[s][t]=e,3===s&&"y"===t?this.__data[0].YMax=e:1===s&&"y"===t&&(this.__data[0].YMin=e),n||this.__processData()))})))}a=t.get("X1")?.tryGetBaVariable(e.BA.BaParameterId.ePresentValue)?.Access.Write,null!=a&&e.Server.BaSite.UserManagement.checkAccess(a)?this.__data[0].ReadOnly=!1:this.__data[0].ReadOnly=!0,this.baObjectHandler.tryWatchChildrenBaVariable(t.get("Sp"),e.BA.BaParameterId.eUnit,(t=>{if(null==t||null==this.__data)return;let i=e.Functions.ConvertUnitToString(t);if(null!=i){for(let t=0;t<this.__data.length;t++)this.__data[t].Unit=i;n||this.__processData()}})),this.__processData(),n=!1;break;default:console.warn("Unknown SubjectInfo passed into Scale!",{subjectIdentifier:this.baObjectHandler.baObject.SubjectInfo,baObj:this.baObjectHandler.baObject})}}}}a.Scale=s,function(t){let i,a,s;!function(t){t.onSave="onScaleSave",t.onReset="onScaleReset"}(i=t.ScaleEvents||(t.ScaleEvents={})),function(t){t[t.any=0]="any",t[t.onlyDecreasing=1]="onlyDecreasing",t[t.onlyIncreasing=2]="onlyIncreasing"}(a=t.Behavior||(t.Behavior={})),function(t){t[t.direct=0]="direct",t[t.infinity=1]="infinity",t[t.limits=2]="limits",t[t.cutOff=3]="cutOff"}(s=t.Ending||(t.Ending={}));class n extends e.Components.Base{constructor(t,e){super(t,e),this.__value=null,this.__snapToValue=!0,this.__snapPeriode=null,this.__range=null,this.__yAxisMax=null,this.__yAxisMin=null,this.__xAxisMax=null,this.__xAxisMin=null,this.__yMax=null,this.__yMin=null,this.__xMax=null,this.__xMin=null,this.__allowVerticalMovement=null,this.__allowHorizontalMovement=null,this.__curMoveX=0,this.__curMoveY=0,this.__selector=$("<div>").addClass("selector"),this.__display=$("<div>").addClass("display"),this.__onElementMovedHandler=(t,e,i,a)=>this.__onElementMoved(e,i,a),this.__pressedHandler=t=>this.__onEditValue(t),this.__element.addClass("scale-setpoint"),this.__element.append(this.__selector),this.__display.append($("<span>")),this.__element.append(this.__display)}__attach(){this.__isAttached||(this.__makeDragable(),this.__element.on(e.Helper.DragableElement.DragableElementEvents.onElementMoved,this.__onElementMovedHandler),this.__display.on("click",this.__pressedHandler),this.__updatePosition(),super.__attach())}__detach(){this.__isAttached&&(this.__element.off(e.Helper.DragableElement.DragableElementEvents.onElementMoved,this.__onElementMovedHandler),this.__display.off("click",this.__pressedHandler),super.__detach())}destroy(){super.destroy()}__onElementMoved(t,i,a){if(null===this.__value)return;let s=this.__value.y,n=this.__value.x,l=JSON.parse(JSON.stringify(this.__value));if(0!==i&&this.__allowHorizontalMovement){let e=this.__element.position().left,a=this.__element.parent();if(null!=a){let s=a.offset();if(null!=s){let a=0;switch(t.type){case"mousemove":a=t.pageX-s.left;break;case"touchmove":a=t.touches[0].pageX-s.left}if(i>0)a>e&&(this.__curMoveX=this.__curMoveX+i);else if(i<0){let t=this.__element.outerWidth();null!=t&&a<e+t&&(this.__curMoveX=this.__curMoveX+i)}}}null!==this.__xAxisMax&&null!==this.__xAxisMin&&null!==this.__range&&(n=this.__value.x+(this.__xAxisMax-this.__xAxisMin)/this.__range.Width*this.__curMoveX)}if(0!==a&&this.__allowVerticalMovement){let e=this.__element.position().top,i=this.__element.parent();if(null!=i){let s=i.offset();if(null!=s){let i=0;switch(t.type){case"mousemove":i=t.pageY-s.top;break;case"touchmove":i=t.touches[0].pageY-s.top}if(a>0)i>e&&(this.__curMoveY=this.__curMoveY+a);else if(a<0){let t=this.__element.outerHeight();null!=t&&i<e+t&&(this.__curMoveY=this.__curMoveY+a)}}}null!==this.__yAxisMax&&null!==this.__yAxisMin&&null!==this.__range&&(s=this.__value.y-(this.__yAxisMax-this.__yAxisMin)/this.__range.Height*this.__curMoveY)}null!=n&&(isNaN(n)||null!==this.__snapToValue&&!0===this.__snapToValue&&null!==this.__snapPeriode&&(n=e.Helper.Number.snapToPeriode(n,this.__snapPeriode)),null!==this.__xAxisMax&&null!==this.__xAxisMin&&(null===this.__xMax&&(this.__xMax=this.__xAxisMax),null===this.__xMin&&(this.__xMin=this.__xAxisMin),n>this.__xMax?(n=this.__xMax,this.__curMoveX=0):n<this.__xMin&&(n=this.__xMin,this.__curMoveX=0)),n!==this.__value.x&&(l.x=n,this.__curMoveX=0)),null!=s&&(isNaN(s)||null!==this.__snapToValue&&!0===this.__snapToValue&&null!==this.__snapPeriode&&(s=e.Helper.Number.snapToPeriode(s,this.__snapPeriode)),null!==this.__yAxisMax&&null!==this.__yAxisMin&&(null===this.__yMax&&(this.__yMax=this.__yAxisMax),null===this.__yMin&&(this.__yMin=this.__yAxisMin),s>this.__yMax?(s=this.__yMax,this.__curMoveY=0):s<this.__yMin&&(s=this.__yMin,this.__curMoveY=0)),s!==this.__value.y&&(l.y=s,this.__curMoveY=0)),tchmi_equal(l,this.__value)?this.__updatePosition():this.setValue(l)}async __onEditValue(t){return new Promise((async(i,a)=>{if(t.stopPropagation(),"click"===t.type&&t.button!==e.MouseButtons.left)return void i();if(null===this.__value||null===this.__xAxisMin||null===this.__xAxisMax||null===this.__yAxisMin||null===this.__yAxisMax)return void i();let s={x:this.__value.x,y:this.__value.y};null===this.__xMax&&(this.__xMax=this.__xAxisMax),null===this.__xMin&&(this.__xMin=this.__xAxisMin);let n=await e.Components.DialogWindow.promptNumericWithLimits(await"New x value",this.__value.x,this.__xMin,this.__xMax);null!=n&&(s.x=n),null===this.__yMax&&(this.__yMax=this.__yAxisMax),null===this.__yMin&&(this.__yMin=this.__yAxisMin);let l=await e.Components.DialogWindow.promptNumericWithLimits(await"New y value",this.__value.x,this.__xMin,this.__xMax);null!=l&&(s.y=l),this.setValue(s),i()}))}__updatePosition(){if(null!=this.__range&&null!==this.__value&&null!==this.__yAxisMin&&null!==this.__yAxisMax&&null!==this.__xAxisMin&&null!==this.__xAxisMax){let t=this.__element.outerHeight(),e=this.__element.outerWidth();null!=t&&null!=e&&t>0&&e>0&&this.__element.css({top:this.__range.Height-(this.__range.Height/(this.__yAxisMax-this.__yAxisMin)*(this.__value.y-this.__yAxisMin)+t/2),left:this.__range.Width/(this.__xAxisMax-this.__xAxisMin)*(this.__value.x-this.__xAxisMin)-e/2-2})}}__makeDragable(){e.Helper.DragableElement.makeDragable(this.__element,this.__element,{minRightDistance:-10,minLeftDistance:-10,minBottomDistance:-10,minTopDistance:-10,allowHorizontalMovement:this.__allowHorizontalMovement,allowVerticalMovement:this.__allowVerticalMovement})}setValue(t){return null===t||tchmi_equal(t,this.__value)||(this.__value=t,this.eventHandler.raise(n.SetpointEvents.onSetpointValueChanged,this),this.__processValue()),this}__processValue(){null!==this.__value&&(this.__display.find("span").text("x: "+this.__value.x+" | y: "+this.__value.y),this.__updatePosition())}getValue(){return this.__value}setSnapPeriode(t){return null===t||tchmi_equal(t,this.__snapPeriode)||(this.__snapPeriode=t,this.__updatePosition()),this}getSnapPeriode(){return this.__snapPeriode}setRange(t){return null==t||tchmi_equal(t,this.__range)||(this.__range=t,this.__updatePosition()),this}getRange(){return this.__range}setYAxisMax(t){return null==t||tchmi_equal(t,this.__yAxisMax)||(this.__yAxisMax=t,this.__updatePosition()),this}getYAxisMax(){return this.__yAxisMax}setYAxisMin(t){return null==t||tchmi_equal(t,this.__yAxisMin)||(this.__yAxisMin=t,this.__updatePosition()),this}getYAxisMin(){return this.__yAxisMin}setXAxisMax(t){return null===t||tchmi_equal(t,this.__xAxisMax)||(this.__xAxisMax=t,this.__updatePosition()),this}getXAxisMax(){return this.__xAxisMax}setXAxisMin(t){return null===t||tchmi_equal(t,this.__xAxisMin)||(this.__xAxisMin=t,this.__updatePosition()),this}getXAxisMin(){return this.__xAxisMin}setYMax(t){return null==t||tchmi_equal(t,this.__yMax)||(this.__yMax=t,null!==this.__value&&this.__value.y>this.__yMax&&this.setValue({x:this.__value.x,y:this.__yMax})),this}getYMax(){return this.__yMax}setYMin(t){return null==t||tchmi_equal(t,this.__yMin)||(this.__yMin=t,null!==this.__value&&this.__value.y<this.__yMin&&this.setValue({x:this.__value.x,y:this.__yMin})),this}getYMin(){return this.__yMin}setXMax(t){return null===t||tchmi_equal(t,this.__xMax)||(this.__xMax=t,null!==this.__value&&this.__value.x>this.__xMax&&this.setValue({x:this.__xMax,y:this.__value.y})),this}getXMax(){return this.__xMax}setXMin(t){return null===t||tchmi_equal(t,this.__xMin)||(this.__xMin=t,null!==this.__value&&this.__value.x<this.__xMin&&this.setValue({x:this.__xMin,y:this.__value.y})),this}getXMin(){return this.__xMin}setAllowVerticalMovement(t){return null===t||tchmi_equal(t,this.__allowVerticalMovement)||(this.__allowVerticalMovement=t,this.__makeDragable()),this}getAllowVerticalMovement(){return this.__allowVerticalMovement}setAllowHorizontalMovement(t){return null===t||tchmi_equal(t,this.__allowHorizontalMovement)||(this.__allowHorizontalMovement=t,this.__makeDragable()),this}getAllowHorizontalMovement(){return this.__allowHorizontalMovement}}t.Setpoint=n,function(t){let e;!function(t){t.onSetpointValueChanged="onSetpointValueChanged"}(e=t.SetpointEvents||(t.SetpointEvents={}))}(n=t.Setpoint||(t.Setpoint={}))}(s=a.Scale||(a.Scale={}))}(i.Common||(i.Common={}))}(e.Controls||(e.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("Scale","TcHmi.BuildingAutomation.Controls.Common",TcHmi.BuildingAutomation.Controls.Common.Scale);