var TcHmi;!function(t){!function(e){!function(s){!function(s){class i extends t.Controls.System.TcHmiControl{constructor(t,s,i){super(t,s,i),this.resizeHandler=new e.Components.ResizeHandler(this),this.__selectedSolidColor=null,this.__selectedRgbaColor=null,this.__plateType=null,this.__hslRingThickness=80,this.__lastPos={x:0,y:0},this.__outerHeight=null,this.__outerWidth=null,this.__canvasPosOffset=[0,0],this.__ratio=4,this.__pressedHandler=t=>this.__onPressed(t),this.__moveHandler=t=>this.__onMove(t),this.__endHandler=()=>this.__onEnd()}__previnit(){super.__previnit(),this.__canvas=$("<canvas>"),this.__element.append(this.__canvas),this.__selector=$("<i>").addClass("selector"),this.__element.append(this.__selector);let t=this.__canvas[0].getContext("2d",{willReadFrequently:!0});if(null==t)throw new Error("CanvasRenderingContext2D was not found!");this.__ctx=t}__init(){super.__init()}__attach(){super.__attach(),this.__canvas.on("mousedown touchstart",this.__pressedHandler),$((()=>this.__onDocumentReady()))}__detach(){super.__detach(),this.__canvas.off("mousedown touchstart",this.__pressedHandler)}destroy(){this.__keepAlive||(this.resizeHandler.destroy(),super.destroy())}onResized(){let t,e,s=this.__element.parent().outerHeight(),i=this.__element.parent().outerWidth();t=null==this.getHeight()?this.__element.height():this.getHeight(),"%"===this.getHeightUnit()&&null!=s&&null!=t&&(t*=s/100),e=null==this.getWidth()?this.__element.width():this.getWidth(),"%"===this.getWidthUnit()&&null!=i&&null!=e&&(e*=i/100),0===t&&console.warn("Height is 0. Is this intended?"),null!=t?this.__outerHeight=t:console.warn("Height was not set!"),0===e&&console.warn("Width is 0. Is this intended?"),null!=e?this.__outerWidth=e:console.warn("Height was not set!"),this.__updateSize()}__onPressed(t){let e,s;if("mousedown"===t.type?(e=t.clientX,s=t.clientY,$(document).on("mousemove",this.__moveHandler),$(document).on("mouseup",this.__endHandler)):"touchstart"===t.type&&(e=t.targetTouches[0].clientX,s=t.targetTouches[0].clientY,$(document).on("touchmove",this.__moveHandler),$(document).on("touchend",this.__endHandler)),null!=e&&null!=s){if((this.__plateType===i.ColorPlateType.hsvCircle||this.__plateType===i.ColorPlateType.hslRing)&&null!=this.__outerWidth&&null!=this.__outerHeight){let t=Math.floor(this.__outerWidth/2);this.__outerWidth>this.__outerHeight&&(t=Math.floor(this.__outerHeight/2));let o=$(this.__canvas).offset();if(null!=o){let _={x:e-o.left,y:s-o.top},l={x:this.__ctx.canvas.offsetWidth/2,y:this.__ctx.canvas.offsetHeight/2},h=Math.sqrt(Math.pow(_.x-l.x,2)+Math.pow(_.y-l.x,2));if(this.__plateType===i.ColorPlateType.hsvCircle&&h>t)return;if(this.__plateType===i.ColorPlateType.hslRing&&(h>t||h<t-this.__hslRingThickness/this.__ratio))return}}this.__lastPos=this.__calcInnerPos(e,s),this.__setSelectorPos(this.__lastPos),this.__setSelectedRgbaColor(this.__calcSelectedColor(this.__lastPos))}}__onMove(t){let e,s;t.stopPropagation(),"mousemove"===t.type?(e=t.clientX,s=t.clientY):"touchmove"===t.type&&(e=t.targetTouches[0].clientX,s=t.targetTouches[0].clientY),null!=e&&null!=s&&(this.__lastPos=this.__calcInnerPos(e,s),this.__setSelectorPos(this.__lastPos),this.__setSelectedRgbaColor(this.__calcSelectedColor(this.__lastPos)))}__onEnd(){$(document).off("mousemove mouseup touchmove touchend",this.__moveHandler)}__onDocumentReady(){if(null!=this.__selector){let t=this.__element.width(),e=this.__selector.width();null!=t&&null!=e&&(this.__plateType===i.ColorPlateType.hslRect1||this.__plateType===i.ColorPlateType.hslRectAll?(this.__lastPos.x=t-1,this.__lastPos.y=0):this.__plateType===i.ColorPlateType.hsvCircle?(this.__lastPos.x=Math.floor(this.__ctx.canvas.offsetWidth/2),this.__lastPos.y=Math.floor(this.__ctx.canvas.offsetHeight/2)):this.__plateType===i.ColorPlateType.hslRing&&(this.__lastPos.x=e/2+1,this.__lastPos.y=Math.floor(this.__ctx.canvas.offsetHeight/2)),this.__setSelectorPos(this.__lastPos),this.__setSelectedRgbaColor(this.__calcSelectedColor(this.__lastPos)))}}__updateSize(){null!=this.__outerWidth&&null!=this.__outerHeight&&(this.__plateType===i.ColorPlateType.hslRect1||this.__plateType===i.ColorPlateType.hslRectAll?(this.__ctx.canvas.width=Math.floor(this.__outerWidth)*this.__ratio,this.__ctx.canvas.height=Math.floor(this.__outerHeight)*this.__ratio,$(this.__canvas).css({width:Math.floor(this.__outerWidth),height:Math.floor(this.__outerHeight)})):this.__plateType!==i.ColorPlateType.hsvCircle&&this.__plateType!==i.ColorPlateType.hslRing||(this.__outerWidth>this.__outerHeight?(this.__ctx.canvas.width=Math.floor(this.__outerHeight)*this.__ratio,this.__ctx.canvas.height=Math.floor(this.__outerHeight)*this.__ratio,$(this.__canvas).css({width:Math.floor(this.__outerHeight),height:Math.floor(this.__outerHeight)})):(this.__ctx.canvas.width=Math.floor(this.__outerWidth)*this.__ratio,this.__ctx.canvas.height=Math.floor(this.__outerWidth)*this.__ratio,$(this.__canvas).css({width:Math.floor(this.__outerWidth),height:Math.floor(this.__outerWidth)}))),$(this.__canvas).css({top:this.__outerHeight/2-this.__ctx.canvas.offsetHeight/2+"px",left:this.__outerWidth/2-this.__ctx.canvas.offsetWidth/2+"px"}),this.__canvasPosOffset=[this.__outerWidth/2-this.__ctx.canvas.offsetWidth/2,this.__outerHeight/2-this.__ctx.canvas.offsetHeight/2],this.__draw())}__calcInnerPos(t,s){let o=$(this.__canvas).offset(),_={x:0,y:0};if(null!=o&&null!=this.__outerWidth&&null!=this.__outerHeight)if(_.x=t-o.left,_.y=s-o.top,this.__plateType===i.ColorPlateType.hslRect1||this.__plateType===i.ColorPlateType.hslRectAll)_.x>=this.__outerWidth?_.x=this.__outerWidth-1:_.x<=0&&(_.x=0),_.y>=this.__outerHeight?_.y=this.__outerHeight:_.y<=0&&(_.y=0);else if(this.__plateType===i.ColorPlateType.hsvCircle||this.__plateType===i.ColorPlateType.hslRing){let t=Math.floor(this.__outerWidth/2);this.__outerWidth>this.__outerHeight&&(t=Math.floor(this.__outerHeight/2));let s={x:this.__ctx.canvas.offsetWidth/2,y:this.__ctx.canvas.offsetHeight/2},o=Math.sqrt(Math.pow(_.x-s.x,2)+Math.pow(_.y-s.y,2)),l=_.x-t,h=_.y-t,a=Math.atan2(h-0,l-0);this.__plateType===i.ColorPlateType.hsvCircle?o>t&&(_.x=Math.floor(e.Helper.Color.convertPolarToXY(t-2,a)[0]+this.__ctx.canvas.offsetWidth/2),_.y=Math.floor(e.Helper.Color.convertPolarToXY(t-2,a)[1]+this.__ctx.canvas.offsetHeight/2)):this.__plateType===i.ColorPlateType.hslRing&&(_.x=Math.floor(e.Helper.Color.convertPolarToXY(t-this.__hslRingThickness/this.__ratio/2,a)[0]+this.__ctx.canvas.offsetWidth/2),_.y=Math.floor(e.Helper.Color.convertPolarToXY(t-this.__hslRingThickness/this.__ratio/2,a)[1]+this.__ctx.canvas.offsetHeight/2))}return _}__setSelectorPos(t){if(null==this.__selector)return;let e=this.__canvasPosOffset[0],s=this.__canvasPosOffset[1],o=this.__selector.width(),_=this.__selector.height();null!=o&&null!=_&&(this.__plateType===i.ColorPlateType.hslRect1||this.__plateType===i.ColorPlateType.hslRectAll?(e=t.x<=o/2-1?e+0-o/2-1:t.x>this.__ctx.canvas.offsetWidth-o/2-1?e+this.__ctx.canvas.offsetWidth-o/2-1:e+t.x-o/2-1,s=t.y<=_/2-1?s+0-_/2-1:t.y>this.__ctx.canvas.offsetHeight-_/2-1?s+this.__ctx.canvas.offsetHeight-_/2-1:s+t.y-_/2-1):this.__plateType!==i.ColorPlateType.hsvCircle&&this.__plateType!==i.ColorPlateType.hslRing||(e=e+t.x-o/2-1,s=s+t.y-_/2-1),$(this.__selector).css({left:e+"px",top:s+"px"}))}__calcSelectedColor(t){let s=this.__ctx.getImageData(t.x*this.__ratio,t.y*this.__ratio,1,1).data;return new e.Color.RGBAColor({r:s[0],g:s[1],b:s[2],a:1})}__draw(){if(0!==this.__ctx.canvas.width)if(0!==this.__ctx.canvas.height){if(this.__plateType===i.ColorPlateType.hslRect1&&null!=this.__ctx.canvas.width&&null!=this.__ctx.canvas.height){let t=e.Functions.ConvertRgbaToHslColor(e.Functions.ConvertSolidToRgbaColor(this.__background.color))?.h;if(null==t)return void this.__ctx.clearRect(0,0,this.__ctx.canvas.width,this.__ctx.canvas.height);let s=this.__ctx.createLinearGradient(1,0,this.__ctx.canvas.width-1,0);s.addColorStop(0,"#fff"),s.addColorStop(1,"hsl("+360*t+", 100%, 50%)"),this.__ctx.fillStyle=s,this.__ctx.fillRect(0,0,this.__ctx.canvas.width,this.__ctx.canvas.height);let i=this.__ctx.createLinearGradient(0,1,0,this.__ctx.canvas.height);i.addColorStop(0,"rgba(0,0,0,0)"),i.addColorStop(1,"#000"),this.__ctx.fillStyle=i,this.__ctx.fillRect(0,0,this.__ctx.canvas.width,this.__ctx.canvas.height)}else if(this.__plateType===i.ColorPlateType.hslRectAll){let t=this.__ctx.createLinearGradient(1,0,this.__ctx.canvas.width-1,0);t.addColorStop(0,"hsl(360, 100%, 50%)"),t.addColorStop(1/6,"hsl(60, 100%, 50%)"),t.addColorStop(2/6,"hsl(120, 100%, 50%)"),t.addColorStop(.5,"hsl(180, 100%, 50%)"),t.addColorStop(4/6,"hsl(240, 100%, 50%)"),t.addColorStop(5/6,"hsl(300, 100%, 50%)"),t.addColorStop(1,"hsl(360, 100%, 50%)"),this.__ctx.fillStyle=t,this.__ctx.fillRect(0,0,this.__ctx.canvas.width,this.__ctx.canvas.height);let e=this.__ctx.createLinearGradient(0,1,0,this.__ctx.canvas.height);e.addColorStop(0,"rgba(0,0,0,0)"),e.addColorStop(1,"#000"),this.__ctx.fillStyle=e,this.__ctx.fillRect(0,0,this.__ctx.canvas.width,this.__ctx.canvas.height)}else if(this.__plateType===i.ColorPlateType.hsvCircle||this.__plateType===i.ColorPlateType.hslRing){let t=Math.floor(this.__ctx.canvas.width/2);this.__ctx.canvas.width>this.__ctx.canvas.height&&(t=Math.floor(this.__ctx.canvas.height/2));let s=this.__ctx.createImageData(2*t,2*t),o=s.data;for(let s=-t;s<t;s++)for(let _=-t;_<t;_++){let[l,h]=e.Helper.Color.convertXYToPolar(s,_);if(this.__plateType===i.ColorPlateType.hsvCircle){if(l>t)continue}else if(this.__plateType===i.ColorPlateType.hslRing&&(l>t||l<t-this.__hslRingThickness))continue;let a=(s+t+(_+t)*(2*t))*4,r=e.Helper.Color.convertRadToDeg(h),n=1;this.__plateType===i.ColorPlateType.hsvCircle&&(n=l/t);let c=1,[d,p,u]=e.Color.convertHSVToRGB(r,n,c),C=255;l<=t&&(o[a]=d,o[a+1]=p,o[a+2]=u,o[a+3]=C)}this.__ctx.putImageData(s,0,0)}}else console.warn("Canvas height is 0 which is not allowed!");else console.warn("Canvas width is 0 which is not allowed!")}setPlateType(e){if("string"==typeof e&&(e=Number(e),isNaN(e)))return this;let s=t.ValueConverter.toNumber(e);return null==s&&(s=this.getAttributeDefaultValueInternal("PlateType")),s==this.__plateType||(this.__plateType=s,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PlateType"}),this.__processPlateType()),this}__processPlateType(){if(null!=this.__outerWidth&&null!=this.__outerHeight){let t=this.__ctx.createImageData(this.__ctx.canvas.width,this.__ctx.canvas.height);for(let e=t.data.length;e>=0;e--)t.data[e]=0;null!=this.__outerWidth&&null!=this.__outerHeight&&(this.__ctx.putImageData(t,0,0),this.__plateType===i.ColorPlateType.hslRect1||this.__plateType===i.ColorPlateType.hslRectAll?(this.__lastPos.x=this.__outerWidth-1,this.__lastPos.y=0):this.__plateType!==i.ColorPlateType.hsvCircle&&this.__plateType!==i.ColorPlateType.hslRing||(this.__lastPos.x=this.__outerWidth/2,this.__lastPos.y=this.__outerHeight/2),this.__setSelectorPos(this.__lastPos),this.__setSelectedRgbaColor(this.__calcSelectedColor(this.__lastPos)),this.__draw())}}getPlateType(){return this.__plateType}__setSelectedRgbaColor(s){return void 0===s||tchmi_equal(s,this.__selectedRgbaColor)?this:null==s||e.Color.isRGBAColor(s)?(this.__selectedRgbaColor=s,this.__setSelectedSolidColor(e.Functions.ConvertRgbaToSolidColor(this.__selectedRgbaColor)),t.EventProvider.raise(this.__id+".onSelectedColorChanged"),t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SelectedRgbaColor"}),this):this}getSelectedRgbaColor(){return this.__selectedRgbaColor}__setSelectedSolidColor(e){return void 0===e||tchmi_equal(e,this.__selectedSolidColor)?this:null==e||t.isSolidColor(e)?(this.__selectedSolidColor=e,t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SelectedSolidColor"}),this):this}getSelectedSolidColor(){return this.__selectedSolidColor}__processBackgroundColor(){super.__processBackgroundColor(),this.__plateType===i.ColorPlateType.hslRect1&&(this.__draw(),this.__setSelectedRgbaColor(this.__calcSelectedColor(this.__lastPos)))}}s.ColorPicker=i,function(t){let e;!function(t){t[t.hslRect1=0]="hslRect1",t[t.hslRectAll=1]="hslRectAll",t[t.hsvCircle=2]="hsvCircle",t[t.hslRing=3]="hslRing"}(e=t.ColorPlateType||(t.ColorPlateType={}))}(i=s.ColorPicker||(s.ColorPicker={}))}(s.Common||(s.Common={}))}(e.Controls||(e.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("ColorPicker","TcHmi.BuildingAutomation.Controls.Common",TcHmi.BuildingAutomation.Controls.Common.ColorPicker);