var TcHmi;!function(e){!function(t){!function(n){let o,a;!function(o){function a(e){return null!=e&&!e.IsTop&&(e.getIsValid()?!!(t.Globals.SubjectInfosWithDialogs.indexOf(e.SubjectInfo.Identifier)>-1||e.hasSpecialVisu())&&!!(e.SubjectInfo.Identifier!=n.SubjectInfos.SpTRm||e instanceof n.BaView&&e.Children.has("X1")):(t.Logger.warn(e.isNotValidText),!1))}o.hasSpecialVisu=a,o.getSpecialVisu=function(o,i,l,s=!1){if(null==o||o.IsTop||!a(o))return;if(!o.getIsValid())return void t.Logger.warn(o.isNotValidText);let r,c,u,d,g,p,m=!1;if(null==i){let t=e.ControlFactory.createEx("TcHmi.BuildingAutomation.Controls.System.BaseControl",o.InstancePath+"-base-control",null,e.View.get());null!=t&&(i=t,m=!0)}switch(o.SubjectInfo.Identifier){case n.SubjectInfos.HtgCrv:case n.SubjectInfos.HeatgCrv:case n.SubjectInfos.SpTRm:case n.SubjectInfos.SpRoomTemp:let a=e.Controls.get(o.InstancePath+"-scale");if(null==a&&(a=e.ControlFactory.createEx("TcHmi.BuildingAutomation.Controls.Common.Scale",o.InstancePath+"-scale",null,i),null!=a&&a.setShowHeader(!1)),null!=a){let e=t.Components.ContextMenu.createContextMenuAndButton({id:a.getId(),rowEntryOptions:[{cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.Save,(n=>{t.Logger.checkServerResult(t.Logger.Severity.warn,n)&&e.textHandler.setText(n.text)}))},onPressed:()=>{a?.eventHandler.raise(t.Controls.Common.Scale.ScaleEvents.onSave),e.menu.close()}},{cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.Reset,(n=>{t.Logger.checkServerResult(t.Logger.Severity.warn,n)&&e.textHandler.setText(n.text)}))},onPressed:()=>{a?.eventHandler.raise(t.Controls.Common.Scale.ScaleEvents.onReset),e.menu.close()}}]});l?.controlContainer.addControl(e.button),a.setBaObject(o),l?.setContent(a.getElement()),c=()=>{a?.eventHandler.raise(t.Controls.Common.Scale.ScaleEvents.onSave)},1==s&&l?.setButtons(t.Components.DialogWindow.Buttons.OkCancelSize),g=()=>{a?.destroy(),m&&i?.destroy(),e.button.destroy(),e.menu.destroy()},r=a}break;default:if(o instanceof n.BaTrendObject){let e=o.InstancePath+"-trend",n=1;for(;t.Globals.CreatedBaseNodes.has(e);)e=o.InstancePath+"-trend-"+n,n++;let a=new t.Charting.Trend(e,i);a.baObjectHandler.setBaObject(o,{notifyOwnerParent:!1}),l?.setContent(a.getElement()),l?.controlContainer.addControl(a.getMenuButton()),a.getElement().addClass("tchmi-ba-trend-in-dialog"),g=()=>{l?.controlContainer.removeControl(a.getMenuButton()),l?.setContent(null),a.destroy(),m&&i?.destroy()},r=a}else if(o.Identifier.ObjectType===n.ObjectType.eSchedule){let n,a=e.Controls.get(o.InstancePath+"-schedule");null==a&&(a=e.ControlFactory.createEx("TcHmi.BuildingAutomation.Controls.Management.Schedule",o.InstancePath+"-schedule",null,i),null!=a&&a.setShowHeader(!1)),null!=a&&(a.setBaObject(o),l?.setContent(a.getElement())),1==s&&(l?.setButtons(t.Components.DialogWindow.Buttons.Cancel),n=a?.eventHandler.register(t.Controls.Management.Schedule.ScheduleEvents.onChanged,(()=>{1==a?.hasChanges()?l?.setButtons(t.Components.DialogWindow.Buttons.OkCancel):l?.setButtons(t.Components.DialogWindow.Buttons.Cancel)}))),c=async()=>{l?.stopClosing(),await t.Components.DialogWindow.confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmSaveChangesToPlc))&&1==await(a?.writeScheduleToPlc())&&l?.close()},d=async()=>{a?.hasChanges()&&(l?.stopClosing(),await t.Components.DialogWindow.confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmSaveChangesToPlc))?(await(a?.writeScheduleToPlc()),l?.close()):(a.resetChanges(),l?.close()))},g=()=>{a?.destroy(),m&&i?.destroy(),null!=n&&n()},r=a}else if(o.Identifier.ObjectType===n.ObjectType.eCalendar){let e=t.Globals.CreatedBaseNodes.get(o.InstancePath+"-calendar-list");null==e&&(e=new t.Components.CalendarList(o.InstancePath+"-calendar-list",i)),e.baObjectHandler.setBaObject(o),l?.setContent(e.getElement()),1==s&&l?.setButtons(t.Components.DialogWindow.Buttons.Cancel),r=e}else console.warn("Unknown SubjectInfo passed into getSpecialVisu()!",{subjectIdentifier:o.SubjectInfo,baObj:o})}return c&&(u=l?.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onConfirmed,c)),d&&(p=l?.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosing,d)),g&&(p=l?.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,g)),l?.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,(e=>{e.destroy(),null!=p&&p(),null!=u&&u(),null!=d&&d()})),null!=r&&r.getElement().css({position:"relative",height:"100%",width:"100%"}),r?.getElement()}}(o=n.Helper||(n.Helper={}));class i{constructor(e){this.__defaultBaTemplateDescription=e}static getResultingBaTemplateDescription(e,t){return this.__mergeDesignerDescIntoDefaultDesc(e,JSON.parse(JSON.stringify(t)))}static __mergeDesignerDescIntoDefaultDesc(e,t){let o;for(let a in e){o=e[a];let i=t[a];"string"==typeof o?""!==o&&(i.identifier=o):null!=o&&(null!=o.identifier&&""!==o.identifier&&(i.identifier=o.identifier),null!=o.subTemplate&&n.BaView.isBaTemplateDescriptionWithSubTemplate(i)&&this.__mergeDesignerDescIntoDefaultDesc(o.subTemplate,i.subTemplate))}return t}set defaultBaTemplateDescription(e){this.__defaultBaTemplateDescription=e}get baBaTemplateDescription(){if(null==this.__baBaTemplateDescription){if(null==this.__defaultBaTemplateDescription)throw new Error("Template description must be set before consuming it.");return this.__defaultBaTemplateDescription}return this.__baBaTemplateDescription}setBaTemplateDescriptionInternal(e){return this.__baBaTemplateDescription=e,this}setBaTemplateDescription(e){let n=null;if(null!=e){if(null==this.__defaultBaTemplateDescription)return t.Logger.warn("Default template description must be defined, before setting template description!"),this;n={},n=i.getResultingBaTemplateDescription(e,this.__defaultBaTemplateDescription)}return tchmi_equal(n,this.__baBaTemplateDescription)||void 0===n||null!=n&&"object"!=typeof n||(this.__baBaTemplateDescription=n),this}getBaTemplateDescription(){return this.__baBaTemplateDescription}}n.BaTemplateHandler=i,function(e){e.DefaultNavigationDialogWidth=1e3,e.AutoCollapseNavigationDialogEntries=!0}(a=n.BaBasicObject||(n.BaBasicObject={})),a.prototype.openNavigationDialog=function(o=!1){let i=t.Globals.CreatedBaseNodes.get(this.Mapping+"-nav-dialog");if(null==i){let l;if(i=new t.Components.DialogWindow(this.Mapping+"-nav-dialog",null).setAttributes({buttons:o?t.Components.DialogWindow.Buttons.Cancel:t.Components.DialogWindow.Buttons.CancelSize,layout:{width:a.DefaultNavigationDialogWidth},modal:o}),this.IsTop||i.controlContainer.addControl({type:t.Components.ComponentType.Button,settings:{iconPath:t.Icons.ObjectType.StructuredView.path},callback:()=>{this.openParameterDialog()}}),0==this.IsTop)l=this.tryWatchBaVariable(n.BaParameterId.eDescription,(e=>{i?.getHeadline().textHandler.setText(e)}));else{let e=t.Locale.Localization.getText(t.Locale.LangKey.ProjectStructure);i?.getHeadline().textHandler.setText(e+" "+this.Device.Description)}if(i.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,(e=>{e.destroy(),i?.destroy(),null!=l&&this.stopWatchBaVariable(l)})),n.Helper.hasSpecialVisu(this))n.Helper.getSpecialVisu(this,null,i,!0);else{let n=e.Controls.get(this.Mapping+"-nav-list");n||(n=e.ControlFactory.createEx("TcHmi.BuildingAutomation.Controls.Management.ProjectNavigationTextual",this.Mapping+"-nav-list",null,e.View.get()),null!=n&&(n.setShowHeader(!1).setBaObject(this).setAutoCollapse(a.AutoCollapseNavigationDialogEntries).setContentPadding({left:0,leftUnit:"px",top:0,topUnit:"px",right:0,rightUnit:"px",bottom:0,bottomUnit:"px"}).getElement().css({position:"relative",height:"100%",width:"100%"}),i.setContent(n.getElement()),i.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,(e=>{e.destroy(),n?.closeAllEntries(),n?.destroy()}))))}}i.open()}}(t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));