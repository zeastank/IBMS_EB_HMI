var TcHmi;!function(e){!function(t){let a,n,i,s,r,o,l;function d(e){return null!=e.code&&"number"==typeof e.code}!function(e){e[e.left=0]="left",e[e.middle=1]="middle",e[e.right=2]="right"}(a=t.MouseButtons||(t.MouseButtons={})),function(e){e[e.left=0]="left",e[e.top=1]="top",e[e.right=2]="right",e[e.bottom=3]="bottom"}(n=t.Position||(t.Position={})),t.isPosition=function(e){return"number"==typeof e&&(e>=n.left&&e<=n.bottom)},function(e){e[e.topRight=0]="topRight",e[e.bottomRight=1]="bottomRight",e[e.bottomLeft=2]="bottomLeft",e[e.topLeft=3]="topLeft"}(i=t.CornerPosition||(t.CornerPosition={})),t.isCornerPosition=function(e){return"number"==typeof e&&(e>=i.topLeft&&e<=i.bottomLeft)},function(e){e[e.vertical=0]="vertical",e[e.horizontal=1]="horizontal"}(s=t.Orientation||(t.Orientation={})),function(e){e[e.invalid=-1]="invalid",e[e.unknown=0]="unknown",e[e.string=1]="string",e[e.number=2]="number",e[e.integer=3]="integer",e[e.boolean=4]="boolean",e[e.object=5]="object",e[e.array=6]="array",e[e.enum=7]="enum",e[e.dateTime=8]="dateTime"}(r=t.DataType||(t.DataType={})),function(e){e[e.Collapsed=0]="Collapsed",e[e.Hidden=1]="Hidden",e[e.Visible=2]="Visible"}(o=t.Visibility||(t.Visibility={})),function(e){e[e.invalid=0]="invalid",e[e.alarm=1]="alarm",e[e.disturb=2]="disturb",e[e.maintenance=3]="maintenance",e[e.notification=4]="notification",e[e.other=5]="other"}(l=t.EventType||(t.EventType={})),t.isFourSidedString=function(e){if(null==e||"object"!=typeof e)return!1;{let a=new Map;if(a.set("top","string"),a.set("right","string"),a.set("bottom","string"),a.set("left","string"),!t.TypeGuards.validateProperties(e,a))return!1}return!0},t.isIErrorDetails=d;class h extends Error{constructor(e,t){super(e,t),this.cause=t?.cause,this.name=this.constructor.name}__log(e,a){null==a&&(a=new t.Logger);let n=`${this.name}: ${this.message}\n`;if(null!=this.cause){let t=this.cause;if(t instanceof h){let e=this.cause,a="\t";for(;e instanceof h&&e.cause instanceof h&&(n+=`${a}by ${t.name}: ${t.message}\n`,a+="\t",t.cause instanceof h);)t=t.cause,e=t}a.log(e,`${n}Cause:\n`,t)}else a.log(e,this)}logDebug(e){this.__log(t.Logger.Severity.debug,e)}logInfo(e){this.__log(t.Logger.Severity.info,e)}logWarn(e){this.__log(t.Logger.Severity.warn,e)}logError(e){this.__log(t.Logger.Severity.error,e)}static __log(e,a,n){e instanceof h?e.__log(a,n):(null==n&&(n=new t.Logger),n.log(a,e))}static debug(e,a){h.__log(e,t.Logger.Severity.debug,a)}static info(e,a){h.__log(e,t.Logger.Severity.info,a)}static warn(e,a){h.__log(e,t.Logger.Severity.warn,a)}static error(e,a){h.__log(e,t.Logger.Severity.error,a)}}t.BaseError=h;t.PropertyNotAvailableError=class extends h{constructor(e,t){super(`Property '${e}' not available!`,t)}};t.InvalidTypeError=class extends h{constructor(e,t){super(`Variable '${e}' should be of type '${t.requiredType}' but is type of '${t.actualType}'!`,t)}};t.TcHmiError=class extends h{constructor(t,a,n){super(t=t+"\n"+e.Log.buildMessage(a),n),this.details=a}static hasError(t){return null!=t&&(!!d(t)&&t.code!==e.Errors.NONE)}};t.InvalidTcHmiInstanceError=class extends h{constructor(e,t){super(e,t)}};t.NotImplementedError=class extends h{constructor(e,t){let a;a=null==e?"Not implemented method!":`Method '${e}' not implemented!`,super(a,t)}};t.NullOrUndefinedVariableError=class extends h{constructor(e,t){super(`Variable '${e}' was null or undefined!`,t)}}}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){let a,n,i;!function(e){let a,n;e.CreatedBaseNodes=new Map,e.HostRegionName="TargetRegion",e.HTMLSymbols={Link:"&#x1F517"},e.OverlayContainerZIndex=6e3,function(e){let t;!function(e){e.English="en-EN",e.German="de-DE"}(t=e.KBLayouts||(e.KBLayouts={}))}(a=e.Locale||(e.Locale={})),function(a){function n(e){switch(e){case s.Digit0:case s.Digit1:case s.Digit2:case s.Digit3:case s.Digit4:case s.Digit5:case s.Digit6:case s.Digit7:case s.Digit8:case s.Digit9:return!0}return!1}function i(e){switch(e){case s.Numpad0:case s.Numpad1:case s.Numpad2:case s.Numpad3:case s.Numpad4:case s.Numpad5:case s.Numpad6:case s.Numpad7:case s.Numpad8:case s.Numpad9:return!0}return!1}let s;a.Layout=e.Locale.KBLayouts.English,a.InputType=t.DataType.string,a.isCodeNumber=function(e){return n(e)||i(e)},a.isCodeNumberDigit=n,a.isCodeNumberPad=i,a.isCodeLetterLatin=function(e){switch(e){case s.KeyA:case s.KeyB:case s.KeyC:case s.KeyD:case s.KeyE:case s.KeyF:case s.KeyG:case s.KeyH:case s.KeyI:case s.KeyJ:case s.KeyK:case s.KeyL:case s.KeyM:case s.KeyN:case s.KeyO:case s.KeyP:case s.KeyQ:case s.KeyR:case s.KeyS:case s.KeyT:case s.KeyU:case s.KeyV:case s.KeyW:case s.KeyX:case s.KeyY:case s.KeyZ:return!0}return!1},a.isCodeShift=function(e){switch(e){case s.ShiftLeft:case s.ShiftRight:return!0}return!1},a.isCodeAlt=function(e){switch(e){case s.AltLeft:case s.AltRight:return!0}return!1},a.isCodeArrow=function(e){switch(e){case s.ArrowLeft:case s.ArrowUp:case s.ArrowRight:case s.ArrowDown:return!0}return!1},a.isCodeEnter=function(e){switch(e){case s.Enter:case s.NumpadEnter:return!0}return!1},a.isCodeComma=function(t){switch(t){case e.Keyboard.Code.Comma:case e.Keyboard.Code.NumpadDecimal:return!0}return!1},a.isCodeMeta=function(t){switch(t){case e.Keyboard.Code.MetaLeft:case e.Keyboard.Code.MetaRight:return!0}return!1},a.isCodeMinus=function(t){switch(t){case e.Keyboard.Code.NumpadSubtract:case e.Keyboard.Code.Slash:case e.Keyboard.Code.Minus:case e.Keyboard.Code.TcHmiPlusMinus:return!0}return!1},function(e){e.KeyA="KeyA",e.KeyB="KeyB",e.KeyC="KeyC",e.KeyD="KeyD",e.KeyE="KeyE",e.KeyF="KeyF",e.KeyG="KeyG",e.KeyH="KeyH",e.KeyI="KeyI",e.KeyJ="KeyJ",e.KeyK="KeyK",e.KeyL="KeyL",e.KeyM="KeyM",e.KeyN="KeyN",e.KeyO="KeyO",e.KeyP="KeyP",e.KeyQ="KeyQ",e.KeyR="KeyR",e.KeyS="KeyS",e.KeyT="KeyT",e.KeyU="KeyU",e.KeyV="KeyV",e.KeyW="KeyW",e.KeyX="KeyX",e.KeyY="KeyY",e.KeyZ="KeyZ",e.Digit1="Digit1",e.Digit2="Digit2",e.Digit3="Digit3",e.Digit4="Digit4",e.Digit5="Digit5",e.Digit6="Digit6",e.Digit7="Digit7",e.Digit8="Digit8",e.Digit9="Digit9",e.Digit0="Digit0",e.Numpad0="Numpad0",e.Numpad1="Numpad1",e.Numpad2="Numpad2",e.Numpad3="Numpad3",e.Numpad4="Numpad4",e.Numpad5="Numpad5",e.Numpad6="Numpad6",e.Numpad7="Numpad7",e.Numpad8="Numpad8",e.Numpad9="Numpad9",e.F1="F1",e.F2="F2",e.F3="F3",e.F4="F4",e.F5="F5",e.F6="F6",e.F7="F7",e.F8="F8",e.F9="F9",e.F10="F10",e.F11="F11",e.F12="F12",e.F13="F13",e.F14="F14",e.F15="F15",e.F16="F16",e.F17="F17",e.F18="F18",e.F19="F19",e.F20="F20",e.F21="F21",e.F22="F22",e.F23="F23",e.F24="F24",e.Escape="Escape",e.Minus="Minus",e.Equal="Equal",e.Backspace="Backspace",e.Tab="Tab",e.BracketLeft="BracketLeft",e.BracketRight="BracketRight",e.Enter="Enter",e.ControlLeft="ControlLeft",e.Semicolon="Semicolon",e.Quote="Quote",e.Backquote="Backquote",e.ShiftLeft="ShiftLeft",e.Backslash="Backslash",e.Comma="Comma",e.Period="Period",e.Slash="Slash",e.ShiftRight="ShiftRight",e.NumpadMultiply="NumpadMultiply",e.AltLeft="AltLeft",e.Space="Space",e.CapsLock="CapsLock",e.Pause="Pause",e.ScrollLock="ScrollLock",e.NumpadSubtract="NumpadSubtract",e.NumpadAdd="NumpadAdd",e.NumpadDecimal="NumpadDecimal",e.IntlBackslash="IntlBackslash",e.NumpadEqual="NumpadEqual",e.KanaMode="KanaMode",e.Lang2="Lang2",e.Lang1="Lang1",e.IntlRo="IntlRo",e.Convert="Convert",e.NonConvert="NonConvert",e.IntlYen="IntlYen",e.NumpadComma="NumpadComma",e.MediaTrackPrevious="MediaTrackPrevious",e.MediaTrackNext="MediaTrackNext",e.NumpadEnter="NumpadEnter",e.ControlRight="ControlRight",e.AudioVolumeMute="AudioVolumeMute",e.LaunchApp2="LaunchApp2",e.MediaPlayPause="MediaPlayPause",e.MediaStop="MediaStop",e.AudioVolumeDown="AudioVolumeDown",e.AudioVolumeUp="AudioVolumeUp",e.BrowserHome="BrowserHome",e.NumpadDivide="NumpadDivide",e.PrintScreen="PrintScreen",e.AltRight="AltRight",e.NumLock="NumLock",e.Home="Home",e.ArrowUp="ArrowUp",e.PageUp="PageUp",e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.End="End",e.ArrowDown="ArrowDown",e.PageDown="PageDown",e.Insert="Insert",e.Delete="Delete",e.MetaLeft="MetaLeft",e.MetaRight="MetaRight",e.ContextMenu="ContextMenu",e.Power="Power",e.Sleep="Sleep",e.WakeUp="WakeUp",e.BrowserSearch="BrowserSearch",e.BrowserFavorites="BrowserFavorites",e.BrowserRefresh="BrowserRefresh",e.BrowserStop="BrowserStop",e.BrowserForward="BrowserForward",e.BrowserBack="BrowserBack",e.LaunchApp1="LaunchApp1",e.LaunchMail="LaunchMail",e.MediaSelect="MediaSelect",e.TcHmiPlusMinus="PlusMinus"}(s=a.Code||(a.Code={}))}(n=e.Keyboard||(e.Keyboard={}))}(a=t.Globals||(t.Globals={})),function(e){e.onWebSocketOpened="onWebSocketOpened",e.onInitialized="onInitialized",e.onWebSocketClosed="onWebSocketClosed",e.onLocaleChanged="onLocaleChanged",e.onThemeDataChanged="onThemeDataChanged"}(n=t.TcHmiEvents||(t.TcHmiEvents={})),function(e){e.onStartInitializing="onTcHmiBaStartInitializing",e.onOverrideSettings="onTcHmiBaOverrideSettings",e.onInitialized="onTcHmiBaInitialized",e.onNewPulse="onTcHmiBaNewPulse"}(i=t.TcHmiBaEvents||(t.TcHmiBaEvents={})),0==TCHMI_DESIGNER&&e.EventProvider.register(n.onInitialized,(t=>{t.destroy(),e.EventProvider.raise(i.onStartInitializing),e.EventProvider.raise(i.onOverrideSettings),e.EventProvider.raise(i.onInitialized)}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),setInterval((()=>{TcHmi.EventProvider.raise(TcHmi.BuildingAutomation.TcHmiBaEvents.onNewPulse)}),1300),function(e){!function(t){!function(a){let n,i,s,r,o,l,d,h,_,c,u,g,p,b,m,y,v,f,D,C,H,w,S,T,E,B,A;!function(e){e[e.Invalid=0]="Invalid",e[e.eAlarm=1]="eAlarm",e[e.eDisturb=2]="eDisturb",e[e.eMaintenance=3]="eMaintenance",e[e.eNotification=4]="eNotification",e[e.eOther=5]="eOther"}(n=a.EventType||(a.EventType={})),function(e){e[e.Invalid=0]="Invalid",e[e.eTypeAlarm=1]="eTypeAlarm",e[e.eTypeDisturb=2]="eTypeDisturb",e[e.eTypeMaintenance=3]="eTypeMaintenance",e[e.eTypeNotification=4]="eTypeNotification",e[e.eTypeOther=5]="eTypeOther",e[e.eFlagOverridden=6]="eFlagOverridden",e[e.eFlagOutOfService=7]="eFlagOutOfService",e[e.eFlagFault=8]="eFlagFault",e[e.eFlagActiveEvent=9]="eFlagActiveEvent",e[e.ePrioLifeSafety=10]="ePrioLifeSafety",e[e.ePrioCritical=11]="ePrioCritical",e[e.ePrioManualLocal=12]="ePrioManualLocal",e[e.ePrioManualRemote=13]="ePrioManualRemote",e[e.eLockPrioLocalMedium=14]="eLockPrioLocalMedium",e[e.eLockPrioLocalHigh=15]="eLockPrioLocalHigh",e[e.eLockPrioMedium=16]="eLockPrioMedium",e[e.eLockPrioHigh=17]="eLockPrioHigh",e[e.eEventIconDisplayed=18]="eEventIconDisplayed"}(i=a.EventCondition||(a.EventCondition={})),function(e){e[e.Invalid=0]="Invalid",e[e.eNone=1]="eNone",e[e.eIndicated=2]="eIndicated",e[e.eGoneAcked=3]="eGoneAcked",e[e.eGone=4]="eGone",e[e.ePresentAcked=5]="ePresentAcked",e[e.ePresent=6]="ePresent"}(s=a.EventIconState||(a.EventIconState={})),function(e){e[e.Invalid=0]="Invalid",e[e.eVarInput=1]="eVarInput",e[e.eParameter=2]="eParameter"}(r=a.ProcessSignalSource||(a.ProcessSignalSource={})),function(e){e[e.Invalid=0]="Invalid",e[e.eSimple=1]="eSimple",e[e.eStandard=2]="eStandard",e[e.eExtended=3]="eExtended",e[e.First=1]="First",e[e.Last=3]="Last",e[e.Count=3]="Count"}(o=a.AlarmMode||(a.AlarmMode={})),function(e){e[e.Invalid=0]="Invalid",e[e.Undefined=1]="Undefined",e[e.eAnalogInput=10]="eAnalogInput",e[e.eAnalogOutput=11]="eAnalogOutput",e[e.eAnalogValue=12]="eAnalogValue",e[e.eBinaryInput=15]="eBinaryInput",e[e.eBinaryOutput=16]="eBinaryOutput",e[e.eBinaryValue=17]="eBinaryValue",e[e.eMultiStateInput=20]="eMultiStateInput",e[e.eMultiStateOutput=21]="eMultiStateOutput",e[e.eMultiStateValue=22]="eMultiStateValue",e[e.eObject=25]="eObject",e[e.eStructuredView=26]="eStructuredView",e[e.eProject=27]="eProject",e[e.eEventClass=28]="eEventClass",e[e.eCalendar=29]="eCalendar",e[e.eSchedule=30]="eSchedule",e[e.eLoop=31]="eLoop",e[e.eTrend=32]="eTrend"}(l=a.ObjectType||(a.ObjectType={})),function(e){e[e.Invalid=0]="Invalid",e[e.eNoLock=1]="eNoLock",e[e.eLocalMedium=2]="eLocalMedium",e[e.eLocalHigh=3]="eLocalHigh",e[e.eMedium=4]="eMedium",e[e.eHigh=5]="eHigh"}(d=a.LockPriority||(a.LockPriority={})),function(e){e[e.Invalid=0]="Invalid",e[e.eDefault=1]="eDefault",e[e.eProgram=2]="eProgram",e[e.eManualRemote=3]="eManualRemote",e[e.eManualLocal=4]="eManualLocal",e[e.eCritical=5]="eCritical",e[e.eLifeSafety=6]="eLifeSafety"}(h=a.Priority||(a.Priority={})),function(e){e[e.Invalid=0]="Invalid",e[e.eNone=1]="eNone",e[e.eStandard=2]="eStandard",e[e.eManual=3]="eManual",e[e.ePrioritized=4]="ePrioritized"}(_=a.ParamCOVMode||(a.ParamCOVMode={})),function(e){e[e.Invalid=0]="Invalid",e[e.eFix=1]="eFix",e[e.eTab=2]="eTab",e[e.eMaxIndc=3]="eMaxIndc"}(c=a.PosMod||(a.PosMod={})),function(e){e[e.Invalid=0]="Invalid",e[e.eTetragon=1]="eTetragon",e[e.eGlobe=2]="eGlobe"}(u=a.ShdObjType||(a.ShdObjType={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eJanuary=1]="eJanuary",e[e.eFebruary=2]="eFebruary",e[e.eMarch=3]="eMarch",e[e.eApril=4]="eApril",e[e.eMay=5]="eMay",e[e.eJune=6]="eJune",e[e.eJuly=7]="eJuly",e[e.eAugust=8]="eAugust",e[e.eSeptember=9]="eSeptember",e[e.eOctober=10]="eOctober",e[e.eNovember=11]="eNovember",e[e.eDecember=12]="eDecember",e[e.odd=13]="odd",e[e.even=14]="even"}(g=a.Month||(a.Month={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eDay01=1]="eDay01",e[e.eDay02=2]="eDay02",e[e.eDay03=3]="eDay03",e[e.eDay04=4]="eDay04",e[e.eDay05=5]="eDay05",e[e.eDay06=6]="eDay06",e[e.eDay07=7]="eDay07",e[e.eDay08=8]="eDay08",e[e.eDay09=9]="eDay09",e[e.eDay10=10]="eDay10",e[e.eDay11=11]="eDay11",e[e.eDay12=12]="eDay12",e[e.eDay13=13]="eDay13",e[e.eDay14=14]="eDay14",e[e.eDay15=15]="eDay15",e[e.eDay16=16]="eDay16",e[e.eDay17=17]="eDay17",e[e.eDay18=18]="eDay18",e[e.eDay19=19]="eDay19",e[e.eDay20=20]="eDay20",e[e.eDay21=21]="eDay21",e[e.eDay22=22]="eDay22",e[e.eDay23=23]="eDay23",e[e.eDay24=24]="eDay24",e[e.eDay25=25]="eDay25",e[e.eDay26=26]="eDay26",e[e.eDay27=27]="eDay27",e[e.eDay28=28]="eDay28",e[e.eDay29=29]="eDay29",e[e.eDay30=30]="eDay30",e[e.eDay31=31]="eDay31",e[e.eLastDayOfMonth=32]="eLastDayOfMonth",e[e.eOddDaysOfMonth=33]="eOddDaysOfMonth",e[e.eEvenDaysOfMonth=34]="eEvenDaysOfMonth"}(p=a.Day||(a.Day={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eMonday=1]="eMonday",e[e.eTuesday=2]="eTuesday",e[e.eWednesday=3]="eWednesday",e[e.eThursday=4]="eThursday",e[e.eFriday=5]="eFriday",e[e.eSaturday=6]="eSaturday",e[e.eSunday=7]="eSunday"}(b=a.Weekday||(a.Weekday={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eWeek1=1]="eWeek1",e[e.eWeek2=2]="eWeek2",e[e.eWeek3=3]="eWeek3",e[e.eWeek4=4]="eWeek4",e[e.eWeek5=5]="eWeek5"}(m=a.Week||(a.Week={})),function(e){e[e.Invalid=0]="Invalid",e[e.eDate=1]="eDate",e[e.eDateRange=2]="eDateRange",e[e.eWeekNDay=3]="eWeekNDay"}(y=a.DateValChoice||(a.DateValChoice={})),function(e){e[e.Invalid=0]="Invalid",e[e.eUndefined=1]="eUndefined",e[e.eValue=2]="eValue",e[e.eNull=3]="eNull"}(v=a.SchedEntryState||(a.SchedEntryState={})),function(e){e[e.eUndefined=0]="eUndefined",e[e.eInternal=1]="eInternal",e[e.eStructurize=2]="eStructurize",e[e.eDescriptive=3]="eDescriptive",e[e.eGeneral=10]="eGeneral",e[e.eOperation=11]="eOperation",e[e.eValue=12]="eValue",e[e.eInput=13]="eInput",e[e.eOutput=14]="eOutput",e[e.eManagement=20]="eManagement",e[e.eAggregate=21]="eAggregate"}(f=a.ObjectPurpose||(a.ObjectPurpose={})),function(e){e[e.eOutOfService=1]="eOutOfService",e[e.eOverridden=2]="eOverridden"}(D=a.ObjectStateFlags||(a.ObjectStateFlags={})),function(e){e[e.Invalid=-1]="Invalid",e[e.eArea_SquareMeters=0]="eArea_SquareMeters",e[e.eArea_SquareFeet=1]="eArea_SquareFeet",e[e.eElectrical_Milliamperes=2]="eElectrical_Milliamperes",e[e.eElectrical_Amperes=3]="eElectrical_Amperes",e[e.eElectrical_Ohms=4]="eElectrical_Ohms",e[e.eElectrical_Volts=5]="eElectrical_Volts",e[e.eElectrical_Kilovolts=6]="eElectrical_Kilovolts",e[e.eElectrical_Megavolts=7]="eElectrical_Megavolts",e[e.eElectrical_VoltAmperes=8]="eElectrical_VoltAmperes",e[e.eElectrical_KilovoltAmperes=9]="eElectrical_KilovoltAmperes",e[e.eElectrical_MegavoltAmperes=10]="eElectrical_MegavoltAmperes",e[e.eElectrical_VoltAmperesReactive=11]="eElectrical_VoltAmperesReactive",e[e.eElectrical_KilovoltAmperesReactive=12]="eElectrical_KilovoltAmperesReactive",e[e.eElectrical_MegavoltAmperesReactive=13]="eElectrical_MegavoltAmperesReactive",e[e.eElectrical_DegreesPhase=14]="eElectrical_DegreesPhase",e[e.eElectrical_PowerFactor=15]="eElectrical_PowerFactor",e[e.eEnergy_Joules=16]="eEnergy_Joules",e[e.eEnergy_Kilojoules=17]="eEnergy_Kilojoules",e[e.eEnergy_WattHours=18]="eEnergy_WattHours",e[e.eEnergy_KilowattHours=19]="eEnergy_KilowattHours",e[e.eEnergy_Btus=20]="eEnergy_Btus",e[e.eEnergy_Therms=21]="eEnergy_Therms",e[e.eEnergy_TonHours=22]="eEnergy_TonHours",e[e.eEnthalpy_JoulesPerKilogramDryAir=23]="eEnthalpy_JoulesPerKilogramDryAir",e[e.eEnthalpy_BtusPerPoundDryAir=24]="eEnthalpy_BtusPerPoundDryAir",e[e.eFrequency_CyclesPerHour=25]="eFrequency_CyclesPerHour",e[e.eFrequency_CyclesPerMinute=26]="eFrequency_CyclesPerMinute",e[e.eFrequency_Hertz=27]="eFrequency_Hertz",e[e.eHumidity_GramsOfWaterPerKilogramDryAir=28]="eHumidity_GramsOfWaterPerKilogramDryAir",e[e.eHumidity_PercentRelativeHumidity=29]="eHumidity_PercentRelativeHumidity",e[e.eLength_Millimeters=30]="eLength_Millimeters",e[e.eLength_Meters=31]="eLength_Meters",e[e.eLength_Inches=32]="eLength_Inches",e[e.eLength_Feet=33]="eLength_Feet",e[e.eLight_WattsPerSquareFoot=34]="eLight_WattsPerSquareFoot",e[e.eLight_WattsPerSquareMeter=35]="eLight_WattsPerSquareMeter",e[e.eLight_Lumens=36]="eLight_Lumens",e[e.eLight_Luxes=37]="eLight_Luxes",e[e.eLight_FootCandles=38]="eLight_FootCandles",e[e.eMass_Kilograms=39]="eMass_Kilograms",e[e.eMass_PoundsMass=40]="eMass_PoundsMass",e[e.eMass_Tons=41]="eMass_Tons",e[e.eMassFlow_KilogramsPerSecond=42]="eMassFlow_KilogramsPerSecond",e[e.eMassFlow_KilogramsPerMinute=43]="eMassFlow_KilogramsPerMinute",e[e.eMassFlow_KilogramsPerHour=44]="eMassFlow_KilogramsPerHour",e[e.eMassFlow_PoundsMassPerMinute=45]="eMassFlow_PoundsMassPerMinute",e[e.eMassFlow_PoundsMassPerHour=46]="eMassFlow_PoundsMassPerHour",e[e.ePower_Watts=47]="ePower_Watts",e[e.ePower_Kilowatts=48]="ePower_Kilowatts",e[e.ePower_Megawatts=49]="ePower_Megawatts",e[e.ePower_BtusPerHour=50]="ePower_BtusPerHour",e[e.ePower_Horsepower=51]="ePower_Horsepower",e[e.ePower_TonsRefrigeration=52]="ePower_TonsRefrigeration",e[e.ePressure_Pascals=53]="ePressure_Pascals",e[e.ePressure_Kilopascals=54]="ePressure_Kilopascals",e[e.ePressure_Bars=55]="ePressure_Bars",e[e.ePressure_PoundsForcePerSquareInch=56]="ePressure_PoundsForcePerSquareInch",e[e.ePressure_CentimetersOfWater=57]="ePressure_CentimetersOfWater",e[e.ePressure_InchesOfWater=58]="ePressure_InchesOfWater",e[e.ePressure_MillimetersOfMercury=59]="ePressure_MillimetersOfMercury",e[e.ePressure_CentimetersOfMercury=60]="ePressure_CentimetersOfMercury",e[e.ePressure_InchesOfMercury=61]="ePressure_InchesOfMercury",e[e.eTemperature_DegreesCelsius=62]="eTemperature_DegreesCelsius",e[e.eTemperature_DegreesKelvin=63]="eTemperature_DegreesKelvin",e[e.eTemperature_DegreesFahrenheit=64]="eTemperature_DegreesFahrenheit",e[e.eTemperature_DegreeDaysCelsius=65]="eTemperature_DegreeDaysCelsius",e[e.eTemperature_DegreeDaysFahrenheit=66]="eTemperature_DegreeDaysFahrenheit",e[e.eTime_Years=67]="eTime_Years",e[e.eTime_Months=68]="eTime_Months",e[e.eTime_Weeks=69]="eTime_Weeks",e[e.eTime_Days=70]="eTime_Days",e[e.eTime_Hours=71]="eTime_Hours",e[e.eTime_Minutes=72]="eTime_Minutes",e[e.eTime_Seconds=73]="eTime_Seconds",e[e.eVelocity_MetersPerSecond=74]="eVelocity_MetersPerSecond",e[e.eVelocity_KilometersPerHour=75]="eVelocity_KilometersPerHour",e[e.eVelocity_FeetPerSecond=76]="eVelocity_FeetPerSecond",e[e.eVelocity_FeetPerMinute=77]="eVelocity_FeetPerMinute",e[e.eVelocity_MilesPerHour=78]="eVelocity_MilesPerHour",e[e.eVolume_CubicFeet=79]="eVolume_CubicFeet",e[e.eVolume_CubicMeters=80]="eVolume_CubicMeters",e[e.eVolume_ImperialGallons=81]="eVolume_ImperialGallons",e[e.eVolume_Liters=82]="eVolume_Liters",e[e.eVolume_UsGallons=83]="eVolume_UsGallons",e[e.eVolumetricFlow_CubicFeetPerMinute=84]="eVolumetricFlow_CubicFeetPerMinute",e[e.eVolumetricFlow_CubicMetersPerSecond=85]="eVolumetricFlow_CubicMetersPerSecond",e[e.eVolumetricFlow_ImperialGallonsPerMinute=86]="eVolumetricFlow_ImperialGallonsPerMinute",e[e.eVolumetricFlow_LitersPerSecond=87]="eVolumetricFlow_LitersPerSecond",e[e.eVolumetricFlow_LitersPerMinute=88]="eVolumetricFlow_LitersPerMinute",e[e.eVolumetricFlow_UsGallonsPerMinute=89]="eVolumetricFlow_UsGallonsPerMinute",e[e.eOther_DegreesAngular=90]="eOther_DegreesAngular",e[e.eOther_DegreesCelsiusPerHour=91]="eOther_DegreesCelsiusPerHour",e[e.eOther_DegreesCelsiusPerMinute=92]="eOther_DegreesCelsiusPerMinute",e[e.eOther_DegreesFahrenheitPerHour=93]="eOther_DegreesFahrenheitPerHour",e[e.eOther_DegreesFahrenheitPerMinute=94]="eOther_DegreesFahrenheitPerMinute",e[e.eOther_NoUnits=95]="eOther_NoUnits",e[e.eOther_PartsPerMillion=96]="eOther_PartsPerMillion",e[e.eOther_PartsPerBillion=97]="eOther_PartsPerBillion",e[e.eOther_Percent=98]="eOther_Percent",e[e.eOther_PercentPerSecond=99]="eOther_PercentPerSecond",e[e.eOther_PerMinute=100]="eOther_PerMinute",e[e.eOther_PerSecond=101]="eOther_PerSecond",e[e.eOther_PsiPerDegreeFahrenheit=102]="eOther_PsiPerDegreeFahrenheit",e[e.eOther_Radians=103]="eOther_Radians",e[e.eOther_RevolutionsPerMinute=104]="eOther_RevolutionsPerMinute",e[e.eCurrency_Currency1=105]="eCurrency_Currency1",e[e.eCurrency_Currency2=106]="eCurrency_Currency2",e[e.eCurrency_Currency3=107]="eCurrency_Currency3",e[e.eCurrency_Currency4=108]="eCurrency_Currency4",e[e.eCurrency_Currency5=109]="eCurrency_Currency5",e[e.eCurrency_Currency6=110]="eCurrency_Currency6",e[e.eCurrency_Currency7=111]="eCurrency_Currency7",e[e.eCurrency_Currency8=112]="eCurrency_Currency8",e[e.eCurrency_Currency9=113]="eCurrency_Currency9",e[e.eCurrency_Currency10=114]="eCurrency_Currency10",e[e.eArea_SquareInches=115]="eArea_SquareInches",e[e.eArea_SquareCentimeters=116]="eArea_SquareCentimeters",e[e.eEnthalpy_BtusPerPound=117]="eEnthalpy_BtusPerPound",e[e.eLength_Centimeters=118]="eLength_Centimeters",e[e.eMassFlow_PoundsMassPerSecond=119]="eMassFlow_PoundsMassPerSecond",e[e.eTemperature_DeltaDegreesFahrenheit=120]="eTemperature_DeltaDegreesFahrenheit",e[e.eTemperature_DeltaDegreesKelvin=121]="eTemperature_DeltaDegreesKelvin",e[e.eElectrical_Kilohms=122]="eElectrical_Kilohms",e[e.eElectrical_Megohms=123]="eElectrical_Megohms",e[e.eElectrical_Millivolts=124]="eElectrical_Millivolts",e[e.eEnergy_KilojoulesPerKilogram=125]="eEnergy_KilojoulesPerKilogram",e[e.eEnergy_Megajoules=126]="eEnergy_Megajoules",e[e.eEntropy_JoulesPerDegreeKelvin=127]="eEntropy_JoulesPerDegreeKelvin",e[e.eEntropy_JoulesPerKilogramDegreeKelvin=128]="eEntropy_JoulesPerKilogramDegreeKelvin",e[e.eFrequency_Kilohertz=129]="eFrequency_Kilohertz",e[e.eFrequency_Megahertz=130]="eFrequency_Megahertz",e[e.eFrequency_PerHour=131]="eFrequency_PerHour",e[e.ePower_Milliwatts=132]="ePower_Milliwatts",e[e.ePressure_Hectopascals=133]="ePressure_Hectopascals",e[e.ePressure_Millibars=134]="ePressure_Millibars",e[e.eVolumetricFlow_CubicMetersPerHour=135]="eVolumetricFlow_CubicMetersPerHour",e[e.eVolumetricFlow_LitersPerHour=136]="eVolumetricFlow_LitersPerHour",e[e.eOther_KilowattHoursPerSquareMeter=137]="eOther_KilowattHoursPerSquareMeter",e[e.eOther_KilowattHoursPerSquareFoot=138]="eOther_KilowattHoursPerSquareFoot",e[e.eOther_MegajoulesPerSquareMeter=139]="eOther_MegajoulesPerSquareMeter",e[e.eOther_MegajoulesPerSquareFoot=140]="eOther_MegajoulesPerSquareFoot",e[e.eOther_WattsPerSquareMeterDegreeKelvin=141]="eOther_WattsPerSquareMeterDegreeKelvin",e[e.eVolumetricFlow_CubicFeetPerSecond=142]="eVolumetricFlow_CubicFeetPerSecond",e[e.eOther_PercentObscurationPerFoot=143]="eOther_PercentObscurationPerFoot",e[e.eOther_PercentObscurationPerMeter=144]="eOther_PercentObscurationPerMeter",e[e.eElectrical_Milliohms=145]="eElectrical_Milliohms",e[e.eEnergy_MegawattHours=146]="eEnergy_MegawattHours",e[e.eEnergy_KiloBtus=147]="eEnergy_KiloBtus",e[e.eEnergy_MegaBtus=148]="eEnergy_MegaBtus",e[e.eEnthalpy_KilojoulesPerKilogramDryAir=149]="eEnthalpy_KilojoulesPerKilogramDryAir",e[e.eEnthalpy_MegajoulesPerKilogramDryAir=150]="eEnthalpy_MegajoulesPerKilogramDryAir",e[e.eEntropy_KilojoulesPerDegreeKelvin=151]="eEntropy_KilojoulesPerDegreeKelvin",e[e.eEntropy_MegajoulesPerDegreeKelvin=152]="eEntropy_MegajoulesPerDegreeKelvin",e[e.eForce_Newton=153]="eForce_Newton",e[e.eMassFlow_GramsPerSecond=154]="eMassFlow_GramsPerSecond",e[e.eMassFlow_GramsPerMinute=155]="eMassFlow_GramsPerMinute",e[e.eMassFlow_TonsPerHour=156]="eMassFlow_TonsPerHour",e[e.ePower_KiloBtusPerHour=157]="ePower_KiloBtusPerHour",e[e.eTime_HundredthsSeconds=158]="eTime_HundredthsSeconds",e[e.eTime_Milliseconds=159]="eTime_Milliseconds",e[e.eTorque_NewtonMeters=160]="eTorque_NewtonMeters",e[e.eVelocity_MillimetersPerSecond=161]="eVelocity_MillimetersPerSecond",e[e.eVelocity_MillimetersPerMinute=162]="eVelocity_MillimetersPerMinute",e[e.eVelocity_MetersPerMinute=163]="eVelocity_MetersPerMinute",e[e.eVelocity_MetersPerHour=164]="eVelocity_MetersPerHour",e[e.eVolumetricFlow_CubicMetersPerMinute=165]="eVolumetricFlow_CubicMetersPerMinute",e[e.eAcceleration_MetersPerSecondPerSecond=166]="eAcceleration_MetersPerSecondPerSecond",e[e.eElectrical_AmperesPerMeter=167]="eElectrical_AmperesPerMeter",e[e.eElectrical_AmperesPerSquareMeter=168]="eElectrical_AmperesPerSquareMeter",e[e.eElectrical_AmpereSquareMeters=169]="eElectrical_AmpereSquareMeters",e[e.eElectrical_Farads=170]="eElectrical_Farads",e[e.eElectrical_Henrys=171]="eElectrical_Henrys",e[e.eElectrical_OhmMeters=172]="eElectrical_OhmMeters",e[e.eElectrical_Siemens=173]="eElectrical_Siemens",e[e.eElectrical_SiemensPerMeter=174]="eElectrical_SiemensPerMeter",e[e.eElectrical_Teslas=175]="eElectrical_Teslas",e[e.eElectrical_VoltsPerDegreeKelvin=176]="eElectrical_VoltsPerDegreeKelvin",e[e.eElectrical_VoltsPerMeter=177]="eElectrical_VoltsPerMeter",e[e.eElectrical_Webers=178]="eElectrical_Webers",e[e.eLight_Candelas=179]="eLight_Candelas",e[e.eLight_CandelasPerSquareMeter=180]="eLight_CandelasPerSquareMeter",e[e.eTemperature_DegreesKelvinPerHour=181]="eTemperature_DegreesKelvinPerHour",e[e.eTemperature_DegreesKelvinPerMinute=182]="eTemperature_DegreesKelvinPerMinute",e[e.eOther_JouleSeconds=183]="eOther_JouleSeconds",e[e.eOther_RadiansPerSecond=184]="eOther_RadiansPerSecond",e[e.eOther_SquareMetersPerNewton=185]="eOther_SquareMetersPerNewton",e[e.eOther_KilogramsPerCubicMeter=186]="eOther_KilogramsPerCubicMeter",e[e.eOther_NewtonSeconds=187]="eOther_NewtonSeconds",e[e.eOther_NewtonsPerMeter=188]="eOther_NewtonsPerMeter",e[e.eOther_WattsPerMeterPerDegreeKelvin=189]="eOther_WattsPerMeterPerDegreeKelvin",e[e.eMicro_Siemens=190]="eMicro_Siemens",e[e.eCubic_FeetPerHour=191]="eCubic_FeetPerHour",e[e.eUs_GallonsPerHour=192]="eUs_GallonsPerHour",e[e.eKilometers=193]="eKilometers",e[e.eMicrometers=194]="eMicrometers",e[e.eGrams=195]="eGrams",e[e.eMilligrams=196]="eMilligrams",e[e.eMilliliters=197]="eMilliliters",e[e.eMillilitersPerSecond=198]="eMillilitersPerSecond",e[e.eDecibels=199]="eDecibels",e[e.eDecibelsMillivolt=200]="eDecibelsMillivolt",e[e.eDecibelsVolt=201]="eDecibelsVolt",e[e.eMillisiemens=202]="eMillisiemens",e[e.eWatt_HoursReactive=203]="eWatt_HoursReactive",e[e.eKilowattHoursReactive=204]="eKilowattHoursReactive",e[e.eMegawattHoursReactive=205]="eMegawattHoursReactive",e[e.eMillimetersOfWater=206]="eMillimetersOfWater",e[e.ePer_Mille=207]="ePer_Mille",e[e.eGrams_PerGram=208]="eGrams_PerGram",e[e.eKilograms_PerKilogram=209]="eKilograms_PerKilogram",e[e.eGrams_PerKilogram=210]="eGrams_PerKilogram",e[e.eMilligrams_PeGram=211]="eMilligrams_PeGram",e[e.eMilligrams_PeKilogram=212]="eMilligrams_PeKilogram",e[e.eGrams_PerMilliliter=213]="eGrams_PerMilliliter",e[e.eGrams_PerLiter=214]="eGrams_PerLiter",e[e.eMilligrams_PerLiter=215]="eMilligrams_PerLiter",e[e.eMicrograms_PerLiter=216]="eMicrograms_PerLiter",e[e.eGrams_PerCubicMeter=217]="eGrams_PerCubicMeter",e[e.eMilligrams_PerCubicMeter=218]="eMilligrams_PerCubicMeter",e[e.eMicrograms_PerCubicMeter=219]="eMicrograms_PerCubicMeter",e[e.eNanograms_PerCubicMeter=220]="eNanograms_PerCubicMeter",e[e.eGrams_PerCubicCentimeter=221]="eGrams_PerCubicCentimeter",e[e.eBecquerels=222]="eBecquerels",e[e.eKilobecquerels=223]="eKilobecquerels",e[e.eMegabecquerels=224]="eMegabecquerels",e[e.eGray=225]="eGray",e[e.eMilligray=226]="eMilligray",e[e.eMicrogray=227]="eMicrogray",e[e.eSieverts=228]="eSieverts",e[e.eMillisieverts=229]="eMillisieverts",e[e.eMicrosieverts=230]="eMicrosieverts",e[e.eMicrosievertsPerHour=231]="eMicrosievertsPerHour",e[e.eDecibels_A=232]="eDecibels_A",e[e.eNephelometric_TurbidityUnit=233]="eNephelometric_TurbidityUnit",e[e.ePH=234]="ePH",e[e.eGrams_PerSquareMeter=235]="eGrams_PerSquareMeter",e[e.eMinutes_PerDegreeKelvin=236]="eMinutes_PerDegreeKelvin"}(C=a.Unit||(a.Unit={})),function(e){e[e.Undefined=0]="Undefined",e[e.eGuest=1]="eGuest",e[e.eBasic=2]="eBasic",e[e.eAdvanced=3]="eAdvanced",e[e.eExpert=4]="eExpert",e[e.eInternal=5]="eInternal",e[e.eLocked=6]="eLocked"}(H=a.Role||(a.Role={})),function(e){e[e.read=0]="read",e[e.write=1]="write"}(w=a.Scope||(a.Scope={})),function(e){e[e.Invalid=0]="Invalid",e[e.eConfigurate=1]="eConfigurate",e[e.eToggleMode=2]="eToggleMode",e[e.eStepDelay=3]="eStepDelay",e[e.eCovIncrement=4]="eCovIncrement",e[e.eAction=5]="eAction",e[e.eMinOffTime=6]="eMinOffTime",e[e.eMinOnTime=7]="eMinOnTime",e[e.eStateChangeCount=11]="eStateChangeCount",e[e.eStateChangeTime=12]="eStateChangeTime",e[e.eStateChangeResetPoint=13]="eStateChangeResetPoint",e[e.eActiveTimeElapsed=14]="eActiveTimeElapsed",e[e.eActiveTimeResetPoint=15]="eActiveTimeResetPoint",e[e.eEventChangeTime=16]="eEventChangeTime",e[e.eInstructionText=20]="eInstructionText",e[e.eAckedTransitions=21]="eAckedTransitions",e[e.eAcknowledgeRm=22]="eAcknowledgeRm",e[e.eEnPlantLock=23]="eEnPlantLock",e[e.eAlarmValue=24]="eAlarmValue",e[e.eAlarmValues=25]="eAlarmValues",e[e.eFaultValues=26]="eFaultValues",e[e.eTimeDelay=27]="eTimeDelay",e[e.eLowLimit=28]="eLowLimit",e[e.eHighLimit=29]="eHighLimit",e[e.eLimitDeadband=30]="eLimitDeadband",e[e.eEventDetectionEnable=31]="eEventDetectionEnable",e[e.eEventEnable=32]="eEventEnable",e[e.eEventClassID=33]="eEventClassID",e[e.eEventMessage=34]="eEventMessage",e[e.eEventMessageFormat=35]="eEventMessageFormat",e[e.eEventTransitionText=36]="eEventTransitionText",e[e.eEventState=37]="eEventState",e[e.eStatusFlags=38]="eStatusFlags",e[e.eReliability=39]="eReliability",e[e.eEventAlgorithmInhibit=40]="eEventAlgorithmInhibit",e[e.eEnable=45]="eEnable",e[e.eOutOfService=46]="eOutOfService",e[e.eTrigger=47]="eTrigger",e[e.eInactiveText=55]="eInactiveText",e[e.eActiveText=56]="eActiveText",e[e.eStateText=57]="eStateText",e[e.eStateCount=58]="eStateCount",e[e.eUnit=59]="eUnit",e[e.ePresentValue=60]="ePresentValue",e[e.eDefaultValue=61]="eDefaultValue",e[e.eTag=62]="eTag",e[e.eAssignAsTrendReference=63]="eAssignAsTrendReference",e[e.eDeviceType=80]="eDeviceType",e[e.ePolarity=81]="ePolarity",e[e.eMappingMode=82]="eMappingMode",e[e.eFeedbackMappingMode=83]="eFeedbackMappingMode",e[e.eFeedbackPolarity=84]="eFeedbackPolarity",e[e.eOverriddenPolarity=85]="eOverriddenPolarity",e[e.eScaleOffset=86]="eScaleOffset",e[e.eResolution=87]="eResolution",e[e.eFeedbackValue=88]="eFeedbackValue",e[e.eRawValue=89]="eRawValue",e[e.eRawFeedback=90]="eRawFeedback",e[e.eRawOverride=91]="eRawOverride",e[e.eRawState=92]="eRawState",e[e.eTerminal=93]="eTerminal",e[e.eSensor=94]="eSensor",e[e.eAddress=95]="eAddress",e[e.eCommissioningState=96]="eCommissioningState",e[e.eSymbolPath=105]="eSymbolPath",e[e.eSymbolName=106]="eSymbolName",e[e.eInstanceID=107]="eInstanceID",e[e.eObjectName=108]="eObjectName",e[e.eDescription=109]="eDescription",e[e.eObjectType=110]="eObjectType",e[e.ePurpose=111]="ePurpose",e[e.eNodeType=112]="eNodeType",e[e.ePriorityArray=120]="ePriorityArray",e[e.eActivePriority=121]="eActivePriority",e[e.eProjectInfo=124]="eProjectInfo",e[e.eOperatorInfo=125]="eOperatorInfo",e[e.eTechnicalStaffInfo=126]="eTechnicalStaffInfo",e[e.eEngineerInfo=127]="eEngineerInfo",e[e.eRebuildSegments=134]="eRebuildSegments",e[e.eDateList=137]="eDateList",e[e.eEventType=140]="eEventType",e[e.eAlarmMode=141]="eAlarmMode",e[e.ePriority=142]="ePriority",e[e.eAcknowledgeRequired=143]="eAcknowledgeRequired",e[e.eSetpoint=145]="eSetpoint",e[e.eControlledValue=146]="eControlledValue",e[e.eCtrlDeviation=147]="eCtrlDeviation",e[e.eProportionalConstant=148]="eProportionalConstant",e[e.eIntegralConstant=149]="eIntegralConstant",e[e.eDerivativeConstant=150]="eDerivativeConstant",e[e.eDampConstant=151]="eDampConstant",e[e.eOutputUnit=152]="eOutputUnit",e[e.eOpMode=153]="eOpMode",e[e.eNeutralZone=154]="eNeutralZone",e[e.eSynchronizedLoop=155]="eSynchronizedLoop",e[e.eMinOutput=156]="eMinOutput",e[e.eMaxOutput=157]="eMaxOutput",e[e.eWeek=160]="eWeek",e[e.eCalendar=161]="eCalendar",e[e.eException=162]="eException",e[e.eReferencedParam=165]="eReferencedParam",e[e.eBufferSize=166]="eBufferSize",e[e.eLogBuffer=167]="eLogBuffer",e[e.eLoggingType=168]="eLoggingType",e[e.eLogInterval=169]="eLogInterval",e[e.eStartTime=170]="eStartTime",e[e.eStopTime=171]="eStopTime",e[e.eStopOnFull=172]="eStopOnFull",e[e.eNotificationThreshold=173]="eNotificationThreshold",e[e.eRecordCount=174]="eRecordCount",e[e.eTotalRecordCount=175]="eTotalRecordCount",e[e.eInstObjectName=1e3]="eInstObjectName",e[e.eInstDescription=1001]="eInstDescription",e[e.eActiveEvent=1002]="eActiveEvent",e[e.Additional=2e3]="Additional",e[e.eEnManualRm=1500]="eEnManualRm",e[e.eValManualRm=1501]="eValManualRm"}(S=a.BaParameterId||(a.BaParameterId={})),a.isBaTextAddressingParameter=function(e){return e===S.eDescription||e===S.eInstDescription||e===S.eObjectName||e===S.eInstObjectName||e===S.eSymbolName||e===S.eSymbolPath},function(e){e[e.addressing=0]="addressing",e[e.dataExchange=1]="dataExchange",e[e.configuration=2]="configuration",e[e.operationalData=3]="operationalData",e[e.eventManagement=4]="eventManagement",e[e.trending=5]="trending",e[e.scheduling=6]="scheduling",e[e.controlling=7]="controlling",e[e.deviceManagement=8]="deviceManagement",e[e.networkManagement=9]="networkManagement",e[e.hardware=10]="hardware",e[e.additional=99]="additional",e[e.miscellaneous=999]="miscellaneous"}(T=a.BaParameterCategory||(a.BaParameterCategory={})),a.HiddenBaParameterIds=[],a.BaParameterCategories=new Map([[T.addressing,[S.eInstanceID,S.eObjectName,S.eObjectType,S.eDescription,S.eSymbolPath,S.eSymbolName,S.eInstObjectName,S.eInstDescription,S.eNodeType,S.eTag]],[T.dataExchange,[S.ePresentValue,S.eDeviceType,S.eUnit,S.eOutOfService,S.eResolution,S.eScaleOffset,S.eCovIncrement,S.eInactiveText,S.eActiveText,S.ePolarity,S.eStateText,S.eStateCount,S.eActivePriority,S.ePriorityArray,S.eDefaultValue,S.eEnManualRm,S.eValManualRm,S.eDampConstant]],[T.configuration,[S.eConfigurate,S.eToggleMode,S.eStepDelay,S.eMinOffTime,S.eMinOnTime]],[T.operationalData,[S.eStateChangeTime,S.eStateChangeCount,S.eStateChangeResetPoint,S.eActiveTimeElapsed,S.eActiveTimeResetPoint,S.eReliability]],[T.eventManagement,[S.eActiveEvent,S.eEventState,S.eStatusFlags,S.eEventClassID,S.eEventDetectionEnable,S.eEventEnable,S.eEventMessage,S.eTimeDelay,S.eEventAlgorithmInhibit,S.eLowLimit,S.eHighLimit,S.eAlarmValue,S.eAlarmValues,S.eLimitDeadband,S.eEventMessageFormat,S.eEventTransitionText,S.eEventChangeTime,S.eAckedTransitions,S.eEventType,S.ePriority,S.eAlarmMode,S.eAcknowledgeRm,S.eAcknowledgeRequired,S.eEnPlantLock]],[T.trending,[S.eEnable,S.eLoggingType,S.eStopOnFull,S.eNotificationThreshold,S.eLogInterval,S.eStartTime,S.eStopTime,S.eBufferSize,S.eLogBuffer,S.eAssignAsTrendReference,S.eRecordCount,S.eTotalRecordCount]],[T.scheduling,[S.eWeek,S.eCalendar,S.eDateList,S.eException]],[T.controlling,[S.eSetpoint,S.eControlledValue,S.eCtrlDeviation,S.eMinOutput,S.eMaxOutput,S.eOutputUnit,S.eAction,S.eProportionalConstant,S.eIntegralConstant,S.eDerivativeConstant,S.eNeutralZone,S.eOpMode,S.eSynchronizedLoop]],[T.deviceManagement,[S.eProjectInfo,S.eOperatorInfo,S.eTechnicalStaffInfo,S.eEngineerInfo]],[T.networkManagement,[]],[T.hardware,[S.eMappingMode,S.eFeedbackMappingMode,S.eRawFeedback,S.eFeedbackPolarity,S.eFeedbackValue,S.eRawOverride,S.eOverriddenPolarity,S.eRawValue,S.eRawState,S.eTerminal,S.eSensor,S.eAddress,S.eCommissioningState]],[T.additional,[S.Additional]],[T.miscellaneous,[S.Invalid,S.eInstructionText,S.eFaultValues,S.eTrigger,S.ePurpose,S.eRebuildSegments,S.eReferencedParam]]]),e.EventProvider.register(t.TcHmiBaEvents.onInitialized,(e=>{e.destroy();let n=Object.keys(S).filter((e=>isNaN(Number(e)))).map((e=>S[e]));for(const e of a.BaParameterCategories.values())for(const a of e)-1==n.indexOf(a)&&t.Logger.log(t.Logger.Severity.warn,`Parameter ${S[a]} is categorized in another category!`),n=n.filter((e=>e!=a));if(n.length>0){let e=a.BaParameterCategories.get(T.miscellaneous);e||(e=[],a.BaParameterCategories.set(T.miscellaneous,e));for(const t of n)e.push(t);const t={};for(const[e,n]of a.BaParameterCategories){t[T[e]]=[];for(const a of n)t[T[e]].push(S[a])}console.warn("Found not categorized BaParameterIds! IDs will be displayed in Miscellaneous category!",t)}})),function(e){e[e.Invalid=-1]="Invalid",e[e.eNone=0]="eNone",e[e.eSetpoint=1]="eSetpoint",e[e.eDisplayValue=2]="eDisplayValue"}(E=a.OperationType||(a.OperationType={})),function(e){e[e.Undefined=0]="Undefined",e[e.eUnknown=10]="eUnknown",e[e.eOther=11]="eOther",e[e.eGeneral=12]="eGeneral",e[e.eLocation=13]="eLocation",e[e.eBuilding=14]="eBuilding",e[e.eBuildingElement=15]="eBuildingElement",e[e.eInformationFocus=16]="eInformationFocus",e[e.eControlCabinet=17]="eControlCabinet",e[e.eTrade=18]="eTrade",e[e.eFloor=19]="eFloor",e[e.eRoom=20]="eRoom",e[e.ePlant=21]="ePlant",e[e.eComponent=22]="eComponent",e[e.eAggregate=23]="eAggregate",e[e.eFunction=24]="eFunction"}(B=a.NodeType||(a.NodeType={})),function(e){let t;!function(e){e[e.Invalid=0]="Invalid",e[e.en_US=1]="en_US",e[e.de_DE=2]="de_DE"}(t=e.EChoice||(e.EChoice={}))}(A=a.LanguageManager||(a.LanguageManager={}))}(t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){function a(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("ObjectType","number"),n.set("InstanceID","number"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}function n(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("bVal","boolean"),n.set("rVal","number"),n.set("udiVal","number"),n.set("bByteVal","array"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}function i(){return{bVal:!1,rVal:0,udiVal:0}}function s(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("nYear","number"),n.set("eMonth","number"),n.set("nDay","number"),n.set("eDayOfWeek","number"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}function r(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("nHour","number"),n.set("nMinute","number"),n.set("nSecond","number"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}t.isBaScope=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("Read","number"),n.set("Write","number"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.isBaIdentifier=a,t.isBaIdentifierEx=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("instancePath","string"),n.set("deviceName","string"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.isBaSubjectInfo=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("Identifier","string"),n.set("Index","number"),n.set("Hash","number"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.isBaObjectParameterAttributes=function(n){let i=!0;if(null!=n&&"object"==typeof n){let s=new Map;s.set("ReferenceObject",t.BaBasicObject.isIBaBasicObjectAttributes),s.set("ReferenceObjectIdentifier",a),s.set("ReferencedParameter",["string","number"]),s.set("OwnerObject",t.BaBasicObject.isIBaBasicObjectAttributes),e.TypeGuards.validateProperties(n,s)||(i=!1)}else i=!1;return i},t.isClassValue=n,t.createEmptyClassValue=i,t.isStatusFlagBits=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("InAlarm","boolean"),n.set("Fault","boolean"),n.set("Overridden","boolean"),n.set("OutOfService","boolean"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.isBaDate=s,t.createEmptyIBaDate=function(){return{nYear:255,eMonth:t.Month.Invalid,nDay:t.Day.Invalid,eDayOfWeek:t.Weekday.Invalid}},t.isBaDateTime=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("stDate",s),n.set("stTime",r),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.isBaTime=r,t.isSchedEntry=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("eState","number"),i.set("stTime",r),i.set("uValue",n),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.createEmptySchedEntry=function(){return{eState:t.SchedEntryState.Invalid,stTime:{nHour:0,nMinute:0,nSecond:0},uValue:{bVal:!1,rVal:0,udiVal:0}}}}(e.BA||(e.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(e){class t{static init(){this.__mutationOberserverHandler||(this.__mutationOberserverHandler=(e,t)=>{this.__filterMutations(e)}),this.__mutationObserver||(this.__mutationObserver=new MutationObserver(this.__mutationOberserverHandler),this.__mutationObserver.observe(document,{childList:!0,subtree:!0}))}static add(e,t){let a=this.__nodes.get(e.getId());null==a&&(a=new Map,this.__nodes.set(e.getId(),a));let n=0;for(;a.has(n);)n++;return a.set(n,t),!t.omitCbWhenAlreadyAttached&&this.getIsAttached(e)&&t.attachedCb&&t.attachedCb(),n}static remove(e,t){let a=this.__nodes.get(e.getId());if(null==a)return!1;let n=a.get(t);return!!n&&(n.detachedCb&&n.detachedCb(),a.delete(t),a.size<=0&&this.__nodes.delete(e.getId()),!0)}static getIsAttached(e){return e.getElement()[0].isConnected}static __filterMutations(e){e.forEach((e=>{if("childList"===e.type)e.addedNodes.forEach((e=>{this.__filterNode(e,!0)})),e.removedNodes.forEach((e=>{this.__filterNode(e,!1)}))}))}static __filterNode(e,t){e.childNodes.forEach((e=>{this.__filterNode(e,t)})),e instanceof HTMLElement&&this.__invokeCallbacks(e.id,t)}static __invokeCallbacks(e,t){let a=this.__nodes.get(e);if(null!=a)for(let e of a.values())t?e.attachedCb&&e.attachedCb():e.detachedCb&&e.detachedCb()}}t.__nodes=new Map,e.AttachObserver=t}(e.System||(e.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),window.onload=()=>{TcHmi.BuildingAutomation.System.AttachObserver.init()},function(e){!function(e){!function(t){class a{static set(e,t){return null==this.__container.children(".tchmi-ba-overlay-backdrop")[0]&&(this.__container.append(this.__backdrop),this.__backdrop.on("click touchstart",this.__backdropPressedHandler),$("body").on("click touchstart pointerdown",this.__preventHandler),$(window).on("click touchstart pointerdown",this.__preventHandler)),t?.onBackdropPressed&&e.data("onBackdropPressedCallback",t.onBackdropPressed),null==$("body").children(".tchmi-ba-overlay-container")[0]&&$("body").append(this.__container),this.__backdrop.append(e),void 0!==t?.dimBackground&&!0!==t.dimBackground||this.__backdrop.addClass("dim-background"),this.__backdrop}static remove(e){if(e){if(e.detach(),e.data("onBackdropPressedCallback")&&e.data("onBackdropPressedCallback",null),this.__backdrop.children().length>0)return}this.__container.empty(),this.__container.detach(),this.__backdrop.removeClass("dim-background"),this.__backdrop.off("click touchstart",this.__backdropPressedHandler),$("body").off("click touchstart pointerdown",this.__preventHandler),$(window).off("click touchstart pointerdown",this.__preventHandler)}}a.__container=$("<div>").addClass("tchmi-ba-overlay-container"),a.__backdrop=$("<div>").addClass("tchmi-ba-overlay-backdrop"),a.__backdropPressedHandler=t=>{if("mousedown"===t.type&&t.button!==e.MouseButtons.left)return;let n=a.__backdrop.children();for(let e=0;e<n.length;e++){let a=$(n[e]).data("onBackdropPressedCallback");a&&"function"==typeof a&&a(t)}},a.__preventHandler=e=>{e.stopPropagation()},t.OverlayContainer=a}(e.System||(e.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a{static get(t){return new Promise(((n,i)=>{let s=this.__loadedSVGs.get(t);if(s){if(s.content)return void n(s.content);s.resolver.push(n)}else{this.__loadedSVGs.set(t,{resolver:[n]});let i=new e.Logger({name:"SVGLoader"}).logPerformance(e.Logger.Severity.debug,"Loading SVG: "+t);a.__readSVGFile(t).then((a=>{i();let n=this.__loadedSVGs.get(t);if(n)return n.content=a,n.resolver.forEach((e=>e(a))),void(n.resolver=[]);throw new Error(new e.Logger({name:"SVGLoader"}).warn("Finished loading of not requested SVG image? What happened?"))})).catch((t=>e.Logger.warn(t)))}}))}static __readSVGFile(e){return new Promise(((t,a)=>{let n=new XMLHttpRequest;n.open("GET",e),n.setRequestHeader("Content-Type","image/svg+xml"),n.addEventListener("load",(i=>{null!=i.currentTarget&&i.currentTarget instanceof XMLHttpRequest&&200==n.status?t(i.currentTarget.responseText):a(`Reading of svg file ${e} failed! Status: ${n.status} | Status text: ${n.statusText}`)})),n.send()}))}}a.__loadedSVGs=new Map,t.SVGLoader=a}(e.System||(e.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){a.ValueHandler=class{constructor(e,a){this.__parent=e,this.logger=new t.Logger({name:"ValueHandler: "+e.getId()}),this.__attrHandler=new t.AttrHandler(this),null!=a&&this.setAttributes(a)}__removeValueSubscription(){null!=this.__valueSubscriptionId&&(t.Server.subscriptionCollector.remove(this.__valueSubscriptionId),delete this.__valueSubscriptionId)}processChangedValue(a){if(this.__parent.getAttributes().readOnly)return;let n;if(t.BaObjectHandler.isIUsesBaObject(this.__parent)&&(n=this.__parent.baObjectHandler.baObject),this.__attrHandler.baVariable)this.__attrHandler.autoWrite?this.__attrHandler.baVariable.write(a):this.__attrHandler.baVariable.editedValue=a;else if(null!=n&&this.__attrHandler.autoWrite)switch(n.OperationType){case t.BA.OperationType.eSetpoint:let e=n.tryGetBaVariable(t.BA.BaParameterId.ePresentValue);null!=e?e.Access.Write!=t.BA.Role.eLocked?e.write(a):this.logger.warn("PresentValue is not editable!"):this.logger.warn(`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.ePresentValue]}' failed because BaVariable was not found in BaObject!`,n);break;case t.BA.OperationType.eNone:let i=n.tryGetBaVariable(t.BA.BaParameterId.eEnManualRm);null!=i?i.read().then((()=>{!1===i?.Value&&i.write(!0);let e=n?.tryGetBaVariable(t.BA.BaParameterId.eValManualRm);null!=e?e.write(a):this.logger.warn(`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.eValManualRm]}' failed because BaVariable was not found in BaObject!`,n)})):this.logger.warn(`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.eEnManualRm]}' failed because BaVariable was not found in BaObject!`,n);break;case t.BA.OperationType.eDisplayValue:this.logger.warn(`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.eEnManualRm]}' failed because of operation type ${t.BA.OperationType[n.OperationType]}!`,n);break;default:this.logger.warn(`BaObject has unknown operation type '${n.OperationType}!`)}else this.__valueMapping&&this.__attrHandler.autoWrite&&e.Server.writeSymbol(this.__valueMapping,a,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e,!1)}))}setAttributes(e){return null==e||(void 0!==e.autoWrite&&(this.__attrHandler.autoWrite=e.autoWrite),void 0!==e.symbolExpression&&this.setSymbolExpression(e.symbolExpression),void 0!==e.baVariable&&this.setBaVariable(e.baVariable)),this}getAttributes(){return this.__attrHandler.getRef()}setSymbolExpression(a){if(!this.__attrHandler.checkAttribute(a,"symbolExpression",{validator:()=>a instanceof e.SymbolExpression}))return this;if(this.__attrHandler.symbolExpression=a,this.__removeValueSubscription(),null!=a){if(a.getType()!=e.SymbolType.Server)return this.logger.warn("Passed symbol expression is not a server symbol expression!",a),this;this.__valueMapping=a.getName(),this.__valueSubscriptionId=t.Server.subscriptionCollector.add(this.__valueMapping,(e=>{this.__parent.onValueChanged(e)}))}return this}getSymbolExpression(){return this.__attrHandler.symbolExpression}setBaVariable(e){return this.__attrHandler.checkAttribute(e,"baVariable",{validator:()=>e instanceof t.BA.BaVariable})?(null!=this.__attrHandler.baVariable&&null!=this.__baVarWatchId&&this.__attrHandler.baVariable.stopWatch(this.__baVarWatchId),this.__attrHandler.baVariable=e,null!=this.__attrHandler.baVariable?this.__baVarWatchId=this.__attrHandler.baVariable.watch((e=>{this.__parent.onValueChanged(e)})):this.__parent.onValueChanged(null),this):this}getBaVariable(){return this.__attrHandler.baVariable}destroy(){this.__removeValueSubscription(),null!=this.__attrHandler.baVariable&&null!=this.__baVarWatchId&&this.__attrHandler.baVariable?.stopWatch(this.__baVarWatchId)}}}(t.System||(t.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){class t{constructor(e){this.__owner=e}getRef(){return this}getCopy(){const e={};for(let a in this){if(a.indexOf("__")>-1)continue;const n=this[a];"function"!=typeof n&&(e[a]=n instanceof t?n.getCopy():n)}return e}invalidAttribute(e,t){this.__owner.logger.invalidAttribute(e,t)}equalAttribute(e,t){this.__owner.logger.equalAttribute(e,t)}checkAttribute(t,a,n){if(void 0===t)return!1;if(null!=t&&null!=n&&!e.TypeGuards.validateAttribute(t,n.validator))return n.doNotlogError||this.invalidAttribute(String(a),t),!1;if(null!=n&&!n.skipEqualityCheck){let e=this[a];if(void 0===e&&n.oldVal&&(e=n.oldVal),void 0!==e&&a&&!this.checkEquality(t,e,String(a)))return!1}return!0}checkColorAttribute(t,a,n){return null==n&&(n={validator:[e.Color.isRGBAColor,e.Color.isILinearGradient]}),a?(n.validator?n.validator instanceof Array?n.validator.push(e.Color.isRGBAColor,e.Color.isILinearGradient):n.validator=[n.validator,e.Color.isRGBAColor,e.Color.isILinearGradient]:n.validator=[e.Color.isRGBAColor,e.Color.isILinearGradient],!!this.checkAttribute(t,a,n)):(n.doNotlogError||this.__owner.logger.warn("The name of the attributes must be passed to check RGBAColor attribute"),!1)}checkEquality(e,t,a){return!tchmi_equal(e,t)||(this.equalAttribute(a,e),!1)}}e.AttrHandler=t,function(t){t.convertToRGBAColor=function(t){let a;return a=null==t?null:t instanceof e.Color.RGBAColor?t:new e.Color.RGBAColor(t),a},t.convertToLinearGradient=function(t){let a;return a=null==t?null:t instanceof e.Color.LinearGradient?t:new e.Color.LinearGradient(t),a},t.convertToColor=function(t){let a;return a=null==t?null:t instanceof e.Color.RGBAColor||t instanceof e.Color.LinearGradient?t:e.Color.isRGBAColor(t)?new e.Color.RGBAColor(t):new e.Color.LinearGradient(t),a}}(t=e.AttrHandler||(e.AttrHandler={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(a){this.__baInterfaceSymNames=null,this.__baInterfaceValidated=null,this.logger=new t.Logger({name:"BaInterfaceHandler of "+a.getId(),className:this.constructor.name}),this.__parent=a;let n=e=>{e.destroy(),this.destroy()};this.__parent instanceof e.Controls.System.baseTcHmiControl?e.EventProvider.register(this.__parent.getId()+".onDestroyed",n):t.isIEventHandler(this.__parent)&&this.__parent.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,n)}watchSubSymbol(a,n,i=!0){if(null==this.__baInterfaceSym||null==this.__baInterfaceValidated)return;if(null==this.__baInterfaceValidated[a])throw new Error(`Property '${String(a)}' does not exist in BaInterfaceDescription`);let s=this.__baInterfaceValidated[a].symbolName;(-1==s.indexOf("::")||s.indexOf("::")>0)&&(s="::"+s);let r=this.__baInterfaceSym.getExpression();this.__baInterfaceWatches||(this.__baInterfaceWatches=new Map);let o=this.__baInterfaceWatches.get(s);null==o&&(o={sym:new e.Symbol(r.getSubSymbolExpression(s).toString())},this.__baInterfaceWatches.set(s,o));let l=o.watchDf;null!=l&&(l(),null!=o.readyFunction&&(o.readyFunction(),delete o.readyFunction)),i&&(o.readyFunction=this.__parent.busyHandler.setBusy(`Watching '${s}' of BaInterface`)),o.watchDf=o.sym.watch((e=>{null!=o&&(null!=o.readyFunction&&(o.readyFunction(),delete o.readyFunction),this.logger.checkServerResult(t.Logger.Severity.warn,e)&&n(e.value))}))}writeSubSymbol(a,n){return new Promise(((i,s)=>{if(null==this.__baInterfaceSym||null==this.__baInterfaceValidated)return;if(null==this.__baInterfaceValidated[a])return void s(`Property '${String(a)}' does not exist in BaInterfaceDescription`);let r=this.__baInterfaceValidated[a].symbolName;(-1==r.indexOf("::")||r.indexOf("::")>0)&&(r="::"+r);let o=this.__baInterfaceSym.getExpression();this.__baInterfaceWatches||(this.__baInterfaceWatches=new Map);let l=this.__baInterfaceWatches.get(r);null==l&&(l={sym:new e.Symbol(o.getSubSymbolExpression(r).toString())},this.__baInterfaceWatches.set(r,l)),l.sym.write(n,(e=>{this.logger.checkServerResult(t.Logger.Severity.error,e),i(e)}))}))}getSubSymbolSchema(e){if(null==this.__schema||null==this.__schema.properties||null==this.__baInterfaceValidated||null==this.__baInterfaceValidated[e])return null;let t=this.__baInterfaceValidated[e].symbolName;return a.getTargetProp(this.__schema,t.split("::"))}hasSubSymbol(e){return null!=this.getSubSymbolSchema(e)}subSymbolHasType(e,t){const a=this.getSubSymbolSchema(e);if(null==a)return!1;if(a.type instanceof Array){for(let e of a.type)if(e===t)return!0}else if(a.type===t)return!0;return!1}getSubSymbol(t){return null==this.__baInterfaceSym||null==this.__baInterfaceValidated?null:new e.Symbol(this.getSubSymbolExpression(t).toString())}getSubSymbolExpression(e){if(null!=this.__baInterfaceSym&&null!=this.__baInterfaceValidated){if(null==this.__baInterfaceValidated[e])throw new Error(`Property '${String(e)} does not exist in BaInterfaceDescription`);return this.__baInterfaceSym.getExpression().getSubSymbolExpression(this.__baInterfaceValidated[e].symbolName)}}__updateSymbolNames(e){if(null==this.__baInterfaceDefinition)throw new Error("Default BaInterfaceDescription was not set");null==this.__baInterface&&(this.__baInterface=a.joinDefAndDesc(this.baInterfaceDefinition,e,this.logger)),null==this.__baInterfaceSymNames&&(this.__baInterfaceSymNames=e);for(let t in this.__baInterface)null!=e[t]&&e[t].symbolName!==this.__baInterface[t].symbolName&&(this.__baInterface[t].symbolName=e[t].symbolName);for(let t in e)this.__baInterfaceSymNames[t]=e[t];this.__processBaInterfaceSym()}destroy(){if(this.__baInterfaceWatches)for(let e of this.__baInterfaceWatches?.values())e.sym.destroy(),e.watchDf&&(e.watchDf(),null!=e.readyFunction&&(e.readyFunction(),delete e.readyFunction))}setBaInterfaceSym(t,a){if(void 0===t||!(t instanceof e.Symbol)||tchmi_equal(t,this.__baInterfaceSym))return this;if(null!=this.__baInterfaceSym&&null!=this.__baInterfaceWatches){for(let e of this.__baInterfaceWatches.values())e.sym.destroy(),e.watchDf&&(e.watchDf(),null!=e.readyFunction&&(e.readyFunction(),delete e.readyFunction));delete this.__baInterfaceWatches}return null==t||(this.__baInterfaceSym=t,this.__processor=a,this.__processBaInterfaceSym()),this}__processBaInterfaceSym(){null!=this.__baInterfaceSym&&null!=this.__baInterface&&this.__baInterfaceSym.resolveSchema((e=>{if(null!=this.__baInterfaceSym&&null!=this.__baInterface&&this.logger.checkServerResult(t.Logger.Severity.warn,e)){if(null==e.schema)return this.logger.warn("No schema resolved!"),void this.__parent.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.connection);if(this.__baInterfaceValidated=a.validateSchemaAndCreateBaInterface(e.schema,this.__baInterface,this.logger),null==this.__baInterfaceValidated)return this.logger.warn("Passed symbol does not match the interface!",{schema:e.schema,baInterfaceDescription:this.__baInterface}),void this.__parent.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.connection);this.__parent.errorIndicator.reset(),this.__schema=e.schema,this.__processor&&!TCHMI_DESIGNER&&this.__processor(this.__baInterfaceSym,this.__baInterface)}}))}getBaInterfaceSym(){return this.__baInterfaceSym}set baInterfaceDefinition(e){tchmi_equal(e,this.__baInterfaceDefinition)||(this.__baInterfaceDefinition=e,delete this.__baInterface)}get baInterfaceDefinition(){if(null==this.__baInterfaceDefinition)throw new Error("BaInterfaceDescription not set!");return this.__baInterfaceDefinition}get baInterfaceDescription(){return this.__baInterface}set baInterfaceSymNames(e){null!=e?this.__updateSymbolNames(e):this.__baInterfaceSymNames=null}get baInterfaceSymNames(){return this.__baInterfaceSymNames}static validateSchemaAndCreateBaInterface(e,t,a){if(null==e.properties)return a?.warn("Schema to be validated does not have any properties!",{schema:e,baInterface:t}),null;let n={};for(let i in t){let s=t[i].symbolName;if(null==s){if(t[i].optional)continue;return a?.warn("Symbol name of BaInterface not set!"),null}let r=null,o=null;if(s instanceof Array){for(let t of s)if(r=this.getTargetProp(e,t.split("::")),null!=r){o=t;break}}else r=this.getTargetProp(e,s.split("::")),o=s;if(n[i]={...t[i],symbolName:o},null==r||null==o){if(t[i].optional)continue;return a?.warn(`Property '${s}' not found!`,{schema:e,baInterface:t}),null}if(!this.compareType(r,t[i].type,a)){if(t[i].optional)continue;return a?.warn(`Schema of property '${t[i].symbolName}' does not fit to the type.`,{schema:r,expectedType:t[i].type}),null}}return n}static validateSchema(e,t,a){return null!=this.validateSchemaAndCreateBaInterface(e,t,a)}static joinDefAndDesc(e,t,a){let n={};for(let i in e)if(null==t[i]){if(0==e[i].optional)return void a?.warn(`Symbol name of property '${i}' was not set!`)}else{let a={symbolName:t[i].symbolName,type:e[i].type,optional:e[i].optional};n[i]=a}return n}static convertToBaInterfaceSymbolNames(e){let t={};for(let a in e)null!=e[a].symbolName?t[a]=e[a]:t[a]={symbolName:e[a]};return t}static convertToBaInterfaceSymbolNamesDesigner(e){let t={};for(let a in e)t[a]=e[a].symbolName;return t}static getTargetProp(e,t){let a=0,n=e;do{if(null==n.properties||null==n.properties[t[a]])return null;n=n.properties[t[a]],a++}while(a<t.length);return n}static compareType(e,t,a){if(null!=e.type){let a=!1;if(t instanceof Array){for(let n=0;n<t.length;n++)if(e.type===t[n]){a=!0;break}}else e.type===t&&(a=!0);return a}if(null!=e.anyOf){let n=!1;for(let i=0;i<e.anyOf.length;i++)if(this.compareType(e.anyOf[i],t,a)){n=!0;break}return n}return a?.warn("This kind of JsonSchema is not known.",e),!1}}t.BaInterfaceHandler=a,function(e){e.isBaInterfaceDefinition=function(e){if(null==e||"object"!=typeof e)return!1;let a=new Map;a.set("type",["string","array"]);for(let n in e)if(!t.TypeGuards.validateProperties(e[n],a))return!1;return!0},e.isBaInterfaceSymbolNames=function(e){if(null==e||"object"!=typeof e)return!1;let a=new Map;a.set("symbolName","string");for(let n in e)if(!t.TypeGuards.validateProperties(e[n],a))return!1;return!0}}(a=t.BaInterfaceHandler||(t.BaInterfaceHandler={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(e){this.__name="",e?.name&&(this.__name=e.name),this.__prefix=e?.className?`[${e.className}] ${this.__name}\n`:`${this.__name}\n`}static __processMessage(e,t){let a;return a="string"==typeof e?t+e:t,a}static __resetMessage(e,t){return e.slice(t.length,e.length)}static log(t,n,...i){let s=a.__processMessage(n,this.__prefix);switch("string"!=typeof n&&i.push(n),t){case a.Severity.debug:e.Log.debugEx(s,...i);break;case a.Severity.info:e.Log.infoEx(s,...i);break;case a.Severity.warn:e.Log.warnEx(s,...i);break;case a.Severity.error:e.Log.errorEx(s,...i);break;default:throw new Error("Invalid severity")}return a.__resetMessage(s,this.__prefix)}static debug(e,...t){return this.log(a.Severity.debug,e,...t)}static info(e,...t){return this.log(a.Severity.info,e,...t)}static warn(e,...t){return this.log(a.Severity.warn,e,...t)}static error(e,...t){return this.log(a.Severity.error,e,...t)}log(e,t,...n){return a.log.bind(this)(e,t,...n)}debug(e,...t){return a.debug.bind(this)(e,...t)}info(e,...t){return a.info.bind(this)(e,...t)}warn(e,...t){return a.warn.bind(this)(e,...t)}error(e,...t){return a.error.bind(this)(e,...t)}static logPerformance(e,t){if(a.TcHmiBaLogPerformance){let n=performance.now();return(...i)=>{a.TcHmiBaLogPerformance&&a.log(e,a.hourGlass+`Operation took ${((performance.now()-n)/1e3).toFixed(2)} seconds\n`+t,...i)}}return()=>{}}logPerformance(e,t){return a.logPerformance.bind(this)(e,t)}static checkServerResult(t,n,i,s=!0){if(void 0===i&&(i=new a({name:"Check server result"})),n.error!==e.Errors.NONE||null!=n.details)return n.error===e.Errors.E_WEBSOCKET_CLOSED||(i?.log(t,a.crossMark+e.Log.buildMessage(n.details),n),!1);if(!0===s)return!0;const r=n;if(null!=r.results&&r.results.length>0){let e=!1;for(const a of r.results)this.checkServerResult(t,a)||(e=!0);if(e)return!1}return!0}static checkServerCommand(t,n,i){return void 0===i&&(i=new a({name:"Check server command"})),null==n.error||(n.error.code===e.Errors.NONE||(n.error.code===e.Errors.E_WEBSOCKET_CLOSED||(i?.log(t,a.crossMark+e.Log.buildMessage(n.error),n),!1)))}checkServerResult(e,t,n=!0){return a.checkServerResult(e,t,this,n)}checkServerCommand(e,t){return a.checkServerCommand(e,t,this)}invalidAttribute(e,n){this.warn(a.crossMark+`Invalid value was set for attribute '${t.Helper.String.capitalizeFirstLetter(String(e))} ': `+a.arrowRight,n)}equalAttribute(e,t){}}a.__prefix="\n",a.checkMark="✅ ",a.crossMark="❌ ",a.warning="⚠ ",a.arrowRight="→ ",a.arrowLeft="← ",a.arrowTop="↑ ",a.arrowBottom="↓ ",a.hourGlass="⌛ ",t.Logger=a,function(e){let t;!function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error"}(t=e.Severity||(e.Severity={})),e.isILogger=function(t){return null!=t&&"object"==typeof t&&t.logger instanceof e},e.TcHmiBaLogPerformance=!0}(a=t.Logger||(t.Logger={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;function a(e){return"px"===e||"%"===e}function n(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("top","number"),n.set("right","number"),n.set("bottom","number"),n.set("left","number"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a}function i(e){return"Solid"===e||"Dashed"===e||"Dotted"===e||"None"===e}!function(e){let t;!function(e){function t(e,t,n){return a(e[t],n)}function a(e,t){if(t instanceof Array){for(let a=0;a<t.length;a++)if(n(e,t[a]))return!0;return!1}return n(e,t)}function n(e,t){if("function"==typeof t){if(t(e))return!0}else if("any"===t&&null!=e||typeof e===t||null===t&&null===e||"date"===t&&e instanceof Date||"array"===t&&e instanceof Array||"function"===t&&e instanceof globalThis.Function||"object"===t&&e instanceof globalThis.Object)return!0;return!1}e.validateProperties=function(e,a){for(let[n,i]of a)if(i instanceof Array){let a=!1;for(let s=0;s<i.length;s++){if(t(e,n,i[s])){a=!0;break}}if(0==a)return!1}else if(!t(e,n,i))return!1;return!0},e.validateAttribute=a}(t=e.TypeGuards||(e.TypeGuards={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={})),e.isDimensionUnit=a,e.isHorizontalAlignment=function(e){return"Left"===e||"Center"===e||"Right"===e},e.isVerticalAlignment=function(e){return"Top"===e||"Center"===e||"Bottom"===e},e.isFourSidedCss=n,e.isPartialFourSidedCss=function(e){return(null==e.top||"number"==typeof e.top)&&(!(null!=e.topUnit&&!a(e.topUnit))&&((null==e.right||"number"==typeof e.right)&&(!(null!=e.rightUnit&&!a(e.rightUnit))&&((null==e.bottom||"number"==typeof e.bottom)&&(!(null!=e.bottomUnit&&!a(e.bottomUnit))&&((null==e.left||"number"==typeof e.left)&&!(null!=e.leftUnit&&!a(e.leftUnit))))))))},e.isBorderStyleValue=i,e.isBorderStyle=function(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("top",i),n.set("right",i),n.set("bottom",i),n.set("left",i),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},e.isBorderWidth=function(e){let t=!0;if(null!=e&&"object"==typeof e){if(!n(e))return!1;if(e.leftUnit&&"px"!=e.leftUnit)return!1;if(e.topUnit&&"px"!=e.topUnit)return!1;if(e.rightUnit&&"px"!=e.rightUnit)return!1;if(e.bottomUnit&&"px"!=e.bottomUnit)return!1}else t=!1;return t},e.isBorderRadius=function(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("topLeft","number"),n.set("topRight","number"),n.set("bottomRight","number"),n.set("bottomLeft","number"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},e.isJsonDataTypeNames=function(e){return null!=e&&"string"==typeof e&&("string"===e||"number"===e||"object"===e||"array"===e||"boolean"===e||"null"===e||"integer"===e)},e.isFontWeight=function(e){return"Normal"===e||"Bold"===e||"Auto"===e},e.isFontStyle=function(e){return"Normal"===e||"Italic"===e||"Oblique"===e||"Auto"===e}}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a{constructor(e){r(e)?e?r(e)&&(this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a):(this.r=0,this.g=0,this.b=0,this.a=1):console.warn("Passed color has not the right format",e)}static fromSolidColor(e){return null==e?null:o(e)&&null!=e.color?"None"===e.color?null:a.fromCssString(e.color):null}static fromCssString(e){try{let t;if(e.indexOf("rgba(")>-1){t=e,t=t.replace("rgba(","").replace(")","");let n=t.split(",");return new a({r:Number(n[0]),g:Number(n[1]),b:Number(n[2]),a:Number(n[3])})}if(e.indexOf("rgb(")>-1){t=e,t=t.replace("rgb(","").replace(")","");let n=t.split(",");return new a({r:Number(n[0]),g:Number(n[1]),b:Number(n[2]),a:1})}if(e.indexOf("#")>-1){t=e.replace("#","");let n={r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16),a:1};return t.length>6&&(n.a=parseInt(t.slice(6,8),16)),new a(n)}throw"failed"}catch(e){throw new Error("Converting CSS string into RGBAColor failed! "+e)}}static fromHexString(e){if(0!==e.indexOf("#"))throw new Error('Hex color strings must start with "#"!');return a.fromCssString(e)}toString(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}toSolidColor(){return{color:this.toString()}}}t.RGBAColor=a,function(e){e.Black=e.fromHexString("#000000"),e.Gray=e.fromHexString("#B0B0B0"),e.MetallicSilver=e.fromHexString("#BCC6CC"),e.White=e.fromHexString("#FFFFFF"),e.Red=e.fromHexString("#FF0000"),e.Blue=e.fromHexString("#0000FF"),e.Goldenrod=e.fromHexString("#EDDA74"),e.Yellow=e.fromHexString("#FFFF00"),e.CornYellow=e.fromHexString("#FFF380"),e.Cantaloupe=e.fromHexString("#FFA62F"),e.Gold=e.fromHexString("#FFD700"),e.DarkOrange=e.fromHexString("#F88017"),e.FirebrickRed=e.fromHexString("#B22222"),e.PurpurRed=e.fromHexString("#DC143C"),e.RedFox=e.fromHexString("#C35817"),e.ChilliPepper=e.fromHexString("#C11B17"),e.LimeGreen=e.fromHexString("#41A317"),e.GreenApple=e.fromHexString("#4CC417"),e.Green=e.fromHexString("#00FF00"),e.DarkSeaGreen=e.fromHexString("#8FBC8F"),e.LightSkyBlue=e.fromHexString("#87CeFa"),e.PowderBlue=e.fromHexString("#b0E0E6"),e.PlumVelvet=e.fromHexString("#7D0552"),e.BurntPink=e.fromHexString("#C12267"),e.MediumTurquoise=e.fromHexString("#48d1CC"),e.TcHmiBlue=e.fromHexString("#4794da"),e.TcHmiGreen=e.fromHexString("#00AE40")}(a=t.RGBAColor||(t.RGBAColor={}));let n;function i(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("color",r),n.set("stop","number"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}function s(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;if(n.set("direction",["number","string"]),n.set("type","number"),n.set("stops","array"),e.TypeGuards.validateProperties(t,n)||(a=!1),a)for(let e=0;e<t.stops.length;e++)if(!i(t.stops[e]))return!1}else a=!1;return a}function r(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("r","number"),n.set("g","number"),n.set("b","number"),n.set("a","number"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}function o(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("color","string"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}t.LinearGradient=class{constructor(e){this.type=n.linear,e?(null!=e.type?this.type=e.type:this.type=n.linear,this.stops=e.stops):(this.type=n.linear,this.stops=[])}toString(){let e="linear-gradient(";"string"==typeof this.direction?e+=this.direction:e=e+this.direction+"deg";for(let t=0;t<this.stops.length;t++)e=`${e}, ${this.stops[t].color} ${this.stops[t].stop}${this.stops[t].stopUnit?this.stops[t].stopUnit:"px"}`;return e+")"}},function(e){e[e.invalid=-1]="invalid",e[e.linear=0]="linear",e[e.repeatingLinear=1]="repeatingLinear",e[e.radial=2]="radial"}(n=t.GradientType||(t.GradientType={})),t.isIGradientStop=i,t.isILinearGradient=s,t.isIFourSidedColor=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;null!=t.top&&n.set("top",[r,s,null]),null!=t.right&&n.set("right",[r,s,null]),null!=t.bottom&&n.set("bottom",[r,s,null]),null!=t.left&&n.set("left",[r,s,null]),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.isRGBAColor=r,t.isSolidColor=o,t.getPastelColor=function(e){let t=(e=Number(e.toFixed(0))).toString();return e=parseInt(t[t.length-1]),[a.FirebrickRed,a.LimeGreen,a.DarkOrange,a.LightSkyBlue,a.PlumVelvet,a.MediumTurquoise,a.PurpurRed,a.PowderBlue,a.Gold,a.DarkSeaGreen][e]},t.convertHSVToRGB=function(e,t,a){let n=a*t,i=e/60,s=n*(1-Math.abs(i%2-1)),r=0,o=0,l=0;i>=0&&i<=1?[r,o,l]=[n,s,0]:i>=1&&i<=2?[r,o,l]=[s,n,0]:i>=2&&i<=3?[r,o,l]=[0,n,s]:i>=3&&i<=4?[r,o,l]=[0,s,n]:i>=4&&i<=5?[r,o,l]=[s,0,n]:i>=5&&i<=6&&([r,o,l]=[n,0,s]);let d=a-n,[h,_,c]=[r+d,o+d,l+d];return[255*h,255*_,255*c]},t.getFadeColor=function(e,t,n,i,s){s<t&&(s=t),s>i&&(s=i);let r=i-t,o=new a({r:0,g:0,b:0,a:1});for(let a in e){let i=e[a],l=n[a];o[a]=(l-i)/r*(s-t)+i,isNaN(o[a])&&(o[a]=0)}return o}}(e.Color||(e.Color={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){let a,n;!function(e){class a{constructor(e){e?(this.nHour=e.nHour,this.nMinute=e.nMinute,this.nSecond=e.nSecond):(this.nHour=0,this.nMinute=0,this.nSecond=0)}static fromSeconds(e){return new a(t.Helper.DateTime.convertSecondsToSTTime(e))}static fromDate(e){return new a({nHour:e.getHours(),nMinute:e.getMinutes(),nSecond:e.getSeconds()})}fromSeconds(e){let t=a.fromSeconds(e);return this.nHour=t.nHour,this.nMinute=t.nMinute,this.nSecond=t.nSecond,this}toSeconds(){return t.Helper.DateTime.convertSTTimeToSeconds(this)}toDate(){return new Date(0,0,0,this.nHour,this.nMinute,this.nSecond,0)}toString(e){switch(e){case a.TimeStringFormat.milliSeconds:return("00"+this.nHour).slice(-2)+":"+("00"+this.nMinute).slice(-2)+":"+("00"+this.nSecond).slice(-2)+".000Z";case a.TimeStringFormat.seconds:return("00"+this.nHour).slice(-2)+":"+("00"+this.nMinute).slice(-2)+":"+("00"+this.nSecond).slice(-2);default:return("00"+this.nHour).slice(-2)+":"+("00"+this.nMinute).slice(-2)}}toIBaTime(){return{nHour:this.nHour,nMinute:this.nMinute,nSecond:this.nSecond}}compare(e){if(this.nHour<e.nHour)return-1;if(this.nHour>e.nHour)return 1;if(this.nHour===e.nHour){if(this.nMinute<e.nMinute)return-1;if(this.nMinute>e.nMinute)return 1;if(this.nMinute===e.nMinute){if(this.nSecond<e.nSecond)return-1;if(this.nSecond>e.nSecond)return 1}}return 0}equals(e){return null!=e&&0===this.compare(e)}snapToPeriode(e){return this.fromSeconds(t.Helper.Number.snapToPeriode(this.toSeconds(),e))}addSeconds(e){return this.fromSeconds(this.toSeconds()+e)}subtractSeconds(e){let t=this.toSeconds()-e;if(t<0)throw new Error("Can not subtract the amount of seconds, because result will be smaller than 0 which is not allowed!");return this.fromSeconds(t)}}e.BaTime=a,function(e){let t;!function(e){e[e.minutes=0]="minutes",e[e.seconds=1]="seconds",e[e.milliSeconds=2]="milliSeconds"}(t=e.TimeStringFormat||(e.TimeStringFormat={}))}(a=e.BaTime||(e.BaTime={}));class n{constructor(t){t?(this.nYear=t.nYear,this.eMonth=t.eMonth,this.nDay=t.nDay,this.eDayOfWeek=t.eDayOfWeek):(this.nYear=0,this.eMonth=e.Month.eJanuary,this.nDay=1,this.eDayOfWeek=e.Weekday.eMonday)}toDate(){return this.nYear===e.BaDate.YearUnspecified||this.eMonth>e.Month.odd||this.nDay>e.Day.eLastDayOfMonth?new Date:new Date(this.nYear+n.YearOffset,this.eMonth-1,this.nDay,0,0,0,0)}static fromDate(e){let a=t.Helper.Date.getWeekday(e);return new n({nYear:e.getFullYear()-n.YearOffset,eMonth:e.getMonth()+1,nDay:e.getDate(),eDayOfWeek:a})}toString(a=n.Format.din5008){let i,s,r;switch(i=this.nYear===e.BaDate.YearUnspecified?"*":(this.nYear+n.YearOffset).toString(),this.eMonth){case e.Month.Unspecified:s="*";break;case e.Month.odd:case e.Month.even:s="?";break;default:if(this.eMonth>e.Month.eDecember||this.eMonth<e.Month.Invalid)s="?";else switch(a){case n.Format.din1355_1:case n.Format.din5008:s=("00"+this.eMonth).slice(-2);break;case n.Format.din5008_long:s=t.Components.CalendarList.MonthNames[this.eMonth-1];break;case n.Format.din5008_short:s=t.Components.CalendarList.MonthNamesShort[this.eMonth-1]+"."}}switch(this.nDay){case e.Day.Unspecified:r="*";break;case e.Day.eLastDayOfMonth:r=this.nYear===e.BaDate.YearUnspecified||this.eMonth>e.Month.eDecember||this.eMonth<e.Month.Invalid?"?":new Date(this.nYear+n.YearOffset,this.eMonth,0).getDate().toString();break;case e.Day.eOddDaysOfMonth:case e.Day.eEvenDaysOfMonth:r="?";break;default:r=this.nDay>e.Day.eDay31||this.nDay<e.Day.Invalid?"?":("00"+this.nDay).slice(-2)}switch(a){case n.Format.din1355_1:return`${r}.${s}.${i}`;case n.Format.din5008_long:case n.Format.din5008_short:return`${r}. ${s} ${i}`;default:return`${i}-${s}-${r}`}}}e.BaDate=n,function(e){let t;e.YearOffset=1900,e.YearUnspecified=255,function(e){e[e.din1355_1=0]="din1355_1",e[e.din5008=1]="din5008",e[e.din5008_long=2]="din5008_long",e[e.din5008_short=3]="din5008_short"}(t=e.Format||(e.Format={}))}(n=e.BaDate||(e.BaDate={}));class i{constructor(e){e?(this.stDate=new n(e.stDate),this.stTime=new a(e.stTime)):(this.stDate=new n,this.stTime=new a)}toDate(){return new Date(this.stDate.nYear+n.YearOffset,this.stDate.eMonth-1,this.stDate.nDay,this.stTime.nHour,this.stTime.nMinute,this.stTime.nSecond,0)}static fromDate(e){let t=n.fromDate(e),s=a.fromDate(e);return new i({stDate:t,stTime:s})}toString(){return this.stDate.toString()+"T"+this.stTime.toString(a.TimeStringFormat.milliSeconds)}}e.BaDateTime=i}(a=t.BA||(t.BA={})),function(t){let n,i;!function(e){function n(e){return("00"+e.nHour).slice(-2)+":"+("00"+e.nMinute).slice(-2)+":"+("00"+e.nSecond).slice(-2)+".000Z"}function i(e){return e.nYear+a.BaDate.YearOffset+"-"+("00"+e.eMonth).slice(-2)+"-"+("00"+e.nDay).slice(-2)}e.getCurrentWeek=function(e){let t=new globalThis.Date;t.setHours(0,0,0,0);let a=t.getDay(),n="Monday"===e?1:0,i=new globalThis.Date(t.getTime()-86400*(a-n)*1e3),s=new globalThis.Date(i.getTime()+6048e5-1);return{start:i,end:s}},e.createTimeString=function(e){return null==e?"":("00"+e.nHour).slice(-2)+":"+("00"+e.nMinute).slice(-2)},e.convertSecondsToSTTime=function(e){if(e<0)throw Error("Seconds to be converted to BaTime must be greater than or equal to 0!");let t,a={nHour:0,nMinute:0,nSecond:0};return 0===e||(a.nHour=Math.floor(e/3600),t=e-60*a.nHour*60,a.nMinute=Math.floor(t/60),a.nSecond=t-60*a.nMinute),a},e.convertSTTimeToSeconds=function(e){return 60*e.nHour*60+60*e.nMinute+e.nSecond},e.convertBaTimeToDate=function(e){return new globalThis.Date(0,0,0,e.nHour,e.nMinute,e.nSecond,0)},e.convertDateToBaTime=function(e){return{nHour:e.getHours(),nMinute:e.getMinutes(),nSecond:e.getSeconds()}},e.convertBaTimeToString=n,e.convertBaDateToString=i,e.convertBaDateToDate=function(e){let n=new globalThis.Date,i=e.nDay>=a.Day.eDay01&&e.nDay<=a.Day.eDay31?e.nDay:n.getDate(),s=e.eMonth>=1&&e.eMonth<=t.Date.MonthsMax?e.eMonth-1:n.getMonth(),r=e.nYear!==a.BaDate.YearUnspecified?e.nYear+a.BaDate.YearOffset:n.getFullYear();return new globalThis.Date(r,s,i,0,0,0,0)},e.convertBaDateTimeToDate=function(e){return new globalThis.Date(e.stDate.nYear+a.BaDate.YearOffset,e.stDate.eMonth-1,e.stDate.nDay,e.stTime.nHour,e.stTime.nMinute,e.stTime.nSecond,0)},e.convertDateToBaDateTime=function(e){return{stDate:{nYear:e.getFullYear()-a.BaDate.YearOffset,eMonth:e.getMonth()+1,nDay:e.getDate(),eDayOfWeek:e.getDay()},stTime:{nHour:e.getHours(),nMinute:e.getMinutes(),nSecond:e.getSeconds()}}},e.convertBaDateTimeToString=function(e){return i(e.stDate)+"T"+n(e.stTime)},e.convertTimeStampToSeconds=function(e){let t={};return t.nHour=parseInt(e.slice(0,e.indexOf(":"))),e=e.slice(e.indexOf(":")+1,e.length),t.nMinute=parseInt(e.slice(0,e.indexOf(":"))),t.nSecond=parseInt(e.slice(e.lastIndexOf(":")+1,e.length)),60*t.nHour*60+60*t.nMinute+t.nSecond},e.convertDaysToMilliseconds=function(e){return e<=0?0:24*e*60*60*1e3},e.convertMillisecondsToDays=function(e){return e<=0?0:e/1e3/60/60/24},e.compareBaTime=function(e,t){if(e.nHour<t.nHour)return-1;if(e.nHour>t.nHour)return 1;if(e.nHour===t.nHour){if(e.nMinute<t.nMinute)return-1;if(e.nMinute>t.nMinute)return 1;if(e.nMinute===t.nMinute){if(e.nSecond<t.nSecond)return-1;if(e.nSecond>t.nSecond)return 1}}return 0}}(n=t.DateTime||(t.DateTime={})),function(n){n.WeekdaysMax=7,n.DaysMax=31,n.MonthsMax=12,n.getWeekday=function(e){return 0===e.getDay()?a.Weekday.eSunday:e.getDay()},n.getWeeksOfMonth=function(e,a){if(!t.Date.isDate(e))return 0;let n=0,i=0,s=t.Date.getMaxDaysOfMonth(e),r=new globalThis.Date(e.getTime());return a=t.Date.validateDow(a),r.setDate(s),i=t.Date.adjustDayOfWeek(r.getDay()),i-=a-1,0===i?i=t.Date.WeekdaysMax:i<0&&(i=t.Date.WeekdaysMax+i),i!=t.Date.WeekdaysMax&&(s-=i,n++),r.setDate(1),i=t.Date.adjustDayOfWeek(r.getDay()),i-=a-1,0===i?i=t.Date.WeekdaysMax:i<0&&(i=t.Date.WeekdaysMax+i),1!=i&&(s-=t.Date.WeekdaysMax- --i,n++),n+=s/t.Date.WeekdaysMax,n},n.getMaxDaysOfMonth=function(e){let a=0,n=1904,i=0;if(e instanceof globalThis.Date){if(!t.Date.isDate(e))return 0;a=e.getMonth(),n=e.getFullYear()}else{if(null==e.month)return 0;if(e.month<1||e.month>t.Date.MonthsMax)return 0;a=e.month-1,e.year&&(n=e.year)}switch(a){case 1:i=28,29===new globalThis.Date(n,a,29).getDate()&&i++;break;case 3:case 5:case 8:case 10:i=30;break;default:i=t.Date.DaysMax}return i},n.adjustDayOfWeek=function(t){return 0===t?e.BuildingAutomation.Helper.Date.WeekdaysMax:t},n.validateDow=function(e){if(null==e||isNaN(e))return a.Weekday.eMonday;let t=e;return t<a.Weekday.eMonday&&(t=a.Weekday.eMonday),t>a.Weekday.eSunday&&(t=a.Weekday.eSunday),t},n.isDate=function(e){if(null==e)return!1;let t=null;return e instanceof globalThis.Date||"string"==typeof e||"number"==typeof e?t=new globalThis.Date(e):"object"==typeof e&&e.year&&e.month&&e.day&&(t=new globalThis.Date(e.year,e.month-1,e.day)),!!t&&!isNaN(t.getTime())}}(i=t.Date||(t.Date={}))}(n=t.Helper||(t.Helper={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){let a;!function(t){let a;!function(e){e.onElementMoved="onElementMoved"}(a=t.DragableElementEvents||(t.DragableElementEvents={})),t.makeDragable=function(t,a,i){let s;s=t instanceof e.Components.Base?t.getElement():t,s.off("mousedown touchstart",n),null!=a?(a.off("mousedown touchstart",n),a.on("mousedown touchstart",{element:t,options:i},n)):s.on("mousedown touchstart",{element:t,options:i},n)},t.resetDragable=function(t,a){let i;i=t instanceof e.Components.Base?t.getElement():t,i.off("mousedown touchstart",n),null!=a?a.off("mousedown touchstart",n):i.off("mousedown touchstart",n)};const n=t=>{if("mousedown"===t.type&&t.button!==e.MouseButtons.left)return;t.stopPropagation();let a=0,n=0;"mousedown"===t.type?t.button===e.MouseButtons.left&&(a=t.pageX,n=t.pageY):"touchstart"===t.type&&null!=t.touches&&(a=t.touches[0].pageX,n=t.touches[0].pageY),$(document).on("mousemove touchmove",{element:t.data.element,options:t.data.options,originalX:a,originalY:n},i),$(document).on("mouseup touchend",s)},i=t=>{t.stopPropagation(),$(":root").addClass("no-user-select");let n=0,i=0;if("mousemove"===t.type)n=t.pageX-t.data.originalX,i=t.pageY-t.data.originalY,t.data.originalX=t.pageX,t.data.originalY=t.pageY;else{if("touchmove"!==t.type)return;null!=t.touches&&(n=t.touches[0].pageX-t.data.originalX,i=t.touches[0].pageY-t.data.originalY,t.data.originalX=t.touches[0].pageX,t.data.originalY=t.touches[0].pageY)}!function(t,n,i){let s,r=i.data.options,o=i.data.element;s=o instanceof e.Components.Base?o.getElement():o;if(null!=r){if(null==r.allowHorizontalMovement||!0===r.allowHorizontalMovement){let a=s.position().left+t,n=r.limitingContainer?.width(),i=s.width();if(null==i)throw new e.BaseError("Element width must be available here!");if(null!=n){let e=n-i;null!=r.minRightDistance&&(e-=r.minRightDistance),a>e&&(a=e)}if(null!=n){let e=0;null!=r.minLeftDistance&&(e+=r.minLeftDistance),a<e&&(a=e)}o instanceof e.Components.Base?o.layoutHandler.setLeft(a):o.css("left",a+"px")}if(null==r.allowVerticalMovement||!0===r.allowVerticalMovement){let t=s.position().top+n,a=r.limitingContainer?.height(),i=s.height();if(null==i)throw new e.BaseError("Element height must be available here!");if(null!=a){let e=a-i;null!=r.minBottomDistance&&(e-=r.minBottomDistance),t>e&&(t=e)}if(null!=a){let e=0;null!=r.minTopDistance&&(e+=r.minTopDistance),t<e&&(t=e)}o instanceof e.Components.Base?o.layoutHandler.setTop(t):o.css("top",t+"px")}}else o instanceof e.Components.Base?(o.layoutHandler.setLeft(s.position().left+t),o.layoutHandler.setTop(s.position().top+n)):(o.css("left",o.position().left+t+"px"),o.css("top",o.position().top+n+"px"));s.trigger(a.onElementMoved,[i,t,n])}(n,i,t)},s=()=>{$(document).off("mousemove touchmove",i),$(document).off("mouseup touchend",s),$(":root").removeClass("no-user-select")}}(a=t.DragableElement||(t.DragableElement={}))}(e.Helper||(e.Helper={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(e){this.__owner=e}register(t,a){return e.EventProvider.register(this.__owner.getId()+"."+t,a)}raise(t,...a){e.EventProvider.raise(this.__owner.getId()+"."+t,this.__owner,...a)}}t.EventHandler=a,t.isIEventHandler=function(e){return null!=e&&(null!=e.eventHandler&&e.eventHandler instanceof a)},function(e){e.stopPropagationHandler=function(e){e.stopPropagation()}}(a=t.EventHandler||(t.EventHandler={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;e.SymbolExpression.prototype.getSubSymbolExpression=function(t){if(this.getType()!=e.SymbolType.Server)throw new Error("Only server symbol expressions are allowed!");return(-1==t.indexOf("::")||t.indexOf("::")>0)&&(t="::"+t),new e.SymbolExpression(`%${this.getTag()}%${this.getName()}${t}%/${this.getTag()}%`)},function(t){let a;!function(a){let n,i,s,r,o,l,d,h,_;!function(t){t.replaceEx=function(e,t,a,n){let i=e;return i=e.slice(0,t),i+=n,i+=e.slice(a),i},t.toSymbolExpression=function(e,t){return e.indexOf(`%${t}%`)>-1?e:`%${t}%`+e+`%/${t}%`},t.toLanguageKey=function(e){return e.indexOf("%l%")>-1?e:"%l%"+e+"%/l%"},t.toServerMapping=function(t){if("string"==typeof t){if(!e.Symbol.isSymbolExpression(t))throw new Error(`Passed string '${t}' is not a symbol expression!`);t=new e.SymbolExpression(t)}t.getType()!=e.SymbolType.Server&&console.warn(`Passed string '${t}' is not a server symbol!`);let a=t.getName();if(null==a)throw new Error("Unknown error!");return a},t.removeAllWhiteSpaces=function(e){return e.replace(/\s+/g,"")},t.capitalizeFirstLetter=function(e){return e.length>0&&(e=e[0].toUpperCase()+e.slice(1)),e},t.lowercaseFirstLetter=function(e){return e[0].toLowerCase()+e.slice(1)},t.hasLowerCaseLetter=function(e){for(let t=0;t<e.length;t++)if(isNaN(parseInt(e[t]))&&-1==="~`!#$%^&*+=-[]\\';,/{}|\":<>?_".indexOf(e[t])&&e[t]===e[t].toLowerCase())return!0;return!1},t.hasUpperCaseLetter=function(e){for(let t=0;t<e.length;t++)if(isNaN(parseInt(e[t]))&&-1==="~`!#$%^&*+=-[]\\';,/{}|\":<>?_".indexOf(e[t])&&e[t]===e[t].toUpperCase())return!0;return!1},t.hasSpecialChar=function(e){for(let t=0;t<e.length;t++)if(-1!=="~`!#$%^&*+=-[]\\';,/{}|\":<>?_".indexOf(e[t]))return!0;return!1},t.hasNumber=function(e){return/\d/.test(e)},t.hasOnlyNumbers=function(e){if(null==e)return!1;for(let t=0;t<e.length;t++)if(isNaN(parseInt(e[t])))return!1;return!0},t.validateFilePath=function(e,t){if(t instanceof globalThis.Array||(t=[t]),null!=e&&"string"==typeof e){e=e.toLowerCase();for(let a=0;a<t.length;a++){let n=t[a].toLowerCase();if(e.indexOf("."+n)==e.length-(n.length+1))return!0}}return!1}}(n=a.String||(a.String={})),function(e){e.calcLinearFunctionValue=function(e,t,a,n,i){let s=(t-e)/(n-a);return s*i+(t-s*n)},e.toPercentage=function(e,t,a){return(e-t)/(a-t)*100},e.snapToPeriode=function(e,t){if(t<=0)return e;let a=Math.floor(e/t)*t,n=a+t;return Math.abs(e-a)>=Math.abs(e-n)?n:a},e.addStep=function(e,t,a,n){let i=e.valueOf();return null!=a&&null!=t&&null!=n&&(a>t&&e<a?i=e+n:a<t&&e>a&&(i=e-n),a>=t?(i>a&&(i=a),i<t&&(i=t)):(i<a&&(i=a),i>t&&(i=t))),i},e.removeStep=function(e,t,a,n){let i=e.valueOf();return null!=a&&null!=t&&null!=n&&(a>t&&e>t?i=e-n:a<t&&e<t&&(i=e+n),a>=t?(i>a&&(i=a),i<t&&(i=t)):(i<a&&(i=a),i>t&&(i=t))),i}}(i=a.Number||(a.Number={})),function(e){e.toNumberDictionary=function(e){let t=new globalThis.Map;for(let a in e){let n=globalThis.Number(a);isNaN(n)?console.warn(`Key ${a} of property ${e[a]} is NaN! It was not added to the number dictionary!`):t.set(n,e[a])}return t},e.clone=function e(t){if(null==t)return t;if("object"==typeof t){const e=t.constructor.name;if("Object"!=e)throw new Error(`It's only possible to clone plain objects. You tried to clone the class ${e}.\nPlease create a dedicated method or constructor that creates a clone of ${e}.`)}let a={};if(globalThis.Object.keys(t).length>0)for(let n in t){let i=t[n];i instanceof globalThis.Array?a[n]=r.clone(i):a[n]="object"==typeof i?e(i):i}else a=t;return a},e.merge=function(e,t,a){if(null!=e&&null!=t)for(let n in e)a&&a.indexOf(n)>-1||void 0!==e[n]&&(t[n]=e[n])},e.deleteProperties=function(e,t){return t.forEach((t=>{void 0!==e[t]&&delete e[t]})),e}}(s=a.Object||(a.Object={})),function(e){function t(e,t,a){return e[t]=e.splice(a,1,e[t])[0],e}e.clone=function e(t){if("object"!=typeof t[0])return t.slice(0);{let a=[];for(let n=0;n<t.length;n++){let i=t[n];i instanceof globalThis.Array?a.push(e(i)):i instanceof globalThis.Object?a.push(s.clone(i)):a.push(i)}return a}},e.verifyEntries=function(e){for(let t=0;t<e.length;t++)if(void 0===e[t])return!1;return!0},e.equals=function(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!tchmi_equal(e[a],t[a]))return!1;return!0},e.swapItems=t,e.selectionSort=function(e,a,n){let i=0,s=e.length;for(var r=0;r<s;r++){i=r;for(var o=r+1;o<s;o++)(a&&!n(e[o],e[i])||!a&&n(e[o],e[i]))&&(i=o);t(e,r,i)}return e},e.bubbleSort=function(e,a,n){for(let i=e.length-1;i>=0;i--)for(let s=1;s<=i;s++)a&&n(e[s-1],e[s])?t(e,s-1,s):a||n(e[s-1],e[s])||t(e,s,s-1);return e},e.mergeSort=function e(t,a,n){let i=t.length;if(i<2)return t;let s=Math.floor(i/2),r=t.slice(0,s),o=t.slice(s);return function(e,t,a,n){let i=[],s=e.length,r=t.length,o=0,l=0;for(;o<s&&l<r;)a&&n(e[o],t[l])?i.push(e[o++]):a||n(e[o],t[l])?i.push(t[l++]):i.push(e[o++]);return i.concat(e.slice(o)).concat(t.slice(l))}(e(r,a,n),e(o,a,n),a,n)}}(r=a.Array||(a.Array={})),function(e){e.filter=function(e,t){let a=new globalThis.Map;for(let[n,i]of e)t(n,i)&&a.set(n,i);return a},e.findByValue=function(e,t){for(let[a,n]of e)if(t(n))return{key:a,value:n};return null},e.findByKey=function(e,t){for(let[a,n]of e)if(t(a))return{key:a,value:n};return null},e.indexOf=function(e,t){let a=0;for(let n of e.keys()){if(n===t)return a;a++}return-1},e.first=function(e){for(let[t,a]of e)return{key:t,value:a}},e.last=function(e){let t;for(let[a,n]of e)t={key:a,value:n};return t},e.getPrevious=function(e,t){let a;for(let[n,i]of e){if(t===n)break;a={key:n,value:i}}return a},e.getNext=function(e,t){let a,n,i=!1,s=0;for(let[r,o]of e)if(t===r&&(i=!0),a={key:r,value:o},i&&(s++,s>1)){n=a;break}return n}}(o=a.Map||(a.Map={})),function(e){e.registerEvent=function(e,t,a){return e.on(t,a),()=>{e.off(t,a)}}}(l=a.Dom||(a.Dom={})),function(e){e.AnimationColor=t.Color.RGBAColor.TcHmiBlue.toString(),e.AnimationRadius=20,e.AnimationLineWidth=5,e.init=function(a,n){const i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=i;const s=2*Math.PI,r=Math.PI/2,o=e.AnimationRadius,l=e.AnimationRadius,d=$("<canvas>").css({position:"absolute","z-index":t.Globals.OverlayContainerZIndex+1}),h=d[0].getContext("2d");h.canvas.width=2*e.AnimationRadius,h.canvas.height=2*e.AnimationRadius;let _,c=0,u=0,g=0,p=!1;function b(t,a){p?(d.css({top:u-e.AnimationRadius+"px",left:c-e.AnimationRadius+"px"}),h.clearRect(0,0,d[0].width,d[0].height),h.lineWidth=e.AnimationLineWidth,h.strokeStyle=e.AnimationColor,h.beginPath(),h.arc(o,l,e.AnimationRadius-e.AnimationLineWidth/2,-r,s*t-r,!1),h.stroke(),g+=2,g<100?i((function(){b(g/100,a)})):(v(),n(a))):v()}const m=e=>{p=!0,_=setTimeout((()=>{p?(c=e.clientX,u=e.clientY,$("body").append(d),b(0,e)):v()}),500),a.on("pointerup",v),a.on("pointermove",y),d.on("pointerup",v),d.on("pointermove",y)},y=t=>{c=t.clientX,u=t.clientY,d.css({top:u-e.AnimationRadius+"px",left:c-e.AnimationRadius+"px"})},v=()=>{p=!1,c=0,u=0,g=0,clearTimeout(_),_=void 0,a.off("pointerup",v),a.off("pointermove",v),d.off("pointerup",v),d.off("pointermove",y),d.detach()};return a.on("pointerdown",m),{release:v,stop:()=>{v(),a.off("pointerdown",m)},resume:()=>{a.on("pointerdown",m)},isPressed:()=>p}}}(d=a.PressAndHold||(a.PressAndHold={})),function(e){function a(e,a,n){a instanceof globalThis.Array||(a=[a]);let i=new t.Logger({name:"Helper.appendBadgeElements"});a.length>4&&i.warn("You tried to append more than four elements around the target. Only four elements will be appended.",{target:e,elements:a});let s=[],r=0,o=t.Components.UiIcon.EventIconSize,l=t.Components.UiIcon.EventIconSize/2;null==n&&(n={}),null!=n.distance&&(l=n.distance),!0===n.autoScale&&(r=e[0].clientWidth,e[0].clientHeight<r&&(r=e[0].clientHeight),r<t.Components.UiIcon.AutoScaleEventIconThreshold&&(o=r/2,l=o/2));for(let r=0;r<a.length;r++){let d=a[r];if(s.indexOf(d.position)>-1)i.warn(`An element was already appended on position '${t.CornerPosition[d.position]}'. Make sure to only use every position only once.`);else{switch(d.element.css("width",o),d.element.css("height",o),null!=n.positioning&&d.element.css({position:n.positioning}),d.element.css({right:"",bottom:"",left:"",top:""}),d.position){case t.CornerPosition.topRight:d.element.css({right:-l,top:-l});break;case t.CornerPosition.bottomRight:d.element.css({right:-l,bottom:-l});break;case t.CornerPosition.bottomLeft:d.element.css({left:-l,bottom:-l});break;case t.CornerPosition.topLeft:d.element.css({left:-l,top:-l})}if(e.append(d.element),s.push(d.position),3===r)break}}}e.ShowBadgeElementsDimensionRectangle=!0,e.appendBadgeElements=a,e.appendBadgeElementsDimensionRectangle=function(t,a){if(TCHMI_DESIGNER&&e.ShowBadgeElementsDimensionRectangle){let e=$("<div>").addClass("tchmi-ba-badge-elements-dimensions-rectangle");e.css("--tchmi-ba-badge-elements-distance",a+"px"),t.append(e)}};class n{constructor(e){this.__icons=new globalThis.Map,this.__config=e}updateConfig(e){for(let t in e)this.__config[t]=e[t];this.__processIcons()}hasIcons(){return this.__icons.size>0}addIcon(e){e instanceof globalThis.Array||(e=[e]),this.__removeIcon(e);for(let a of e){const e=new t.Components.Icon(this.__config.id+"-icon-"+this.__icons.size,null).setAttributes({...a,cssClass:this.__config.iconCssClass});this.__icons.set(a.iconPath,e)}this.__processIcons()}removeIcon(e){this.__removeIcon(e),this.__processIcons()}removeAllIcons(){for(let[e,t]of this.__icons)t.destroy(),this.__icons.delete(e)}__removeIcon(e){if(e instanceof globalThis.Array||(e=[e]),e.length>0)for(let t of e){const e=this.__icons.get(t.iconPath);null!=e&&(e.destroy(),this.__icons.delete(t.iconPath))}}__processIcons(){if(this.__icons.size>0)if(this.__config.attachingMode===n.AttachingMode.corners){const e=[];let n=t.CornerPosition.topRight;for(let t of this.__icons.values())e.push({element:t.getElement(),position:n}),n++;a(this.__config.container,e)}else for(let e of this.__icons.values())this.__config.container.append(e.getElement())}destroy(){this.removeAllIcons()}}e.Handler=n,function(e){let t;!function(e){e[e.default=0]="default",e[e.corners=1]="corners"}(t=e.AttachingMode||(e.AttachingMode={}))}(n=e.Handler||(e.Handler={}))}(h=a.IconBadges||(a.IconBadges={})),function(e){function a(e,a){switch(a){case t.DataType.boolean:return{bVal:e.bVal};case t.DataType.number:return{rVal:e.rVal};case t.DataType.enum:return{udiVal:e.udiVal};default:return{bVal:!1}}}function n(e,n,i){const s=[];for(let r=0;r<n;r++){const n={eState:t.BA.SchedEntryState.Invalid,stTime:{nHour:0,nMinute:0,nSecond:0},uValue:{bVal:!1}};null!=e[r]&&(n.eState=e[r].eState,n.stTime=e[r].stTime,n.uValue=a(e[r].uValue,i)),s.push(n)}return s}e.toSchedWeek=function(e,t,a){const i=[];if(null!=t)for(const s of e)i.push(n(s,t,a));return i},e.toSchedExceptionList=function(e,a,i,s){const r=[];if(null!=a)for(let o=0;o<a;o++){const a={eType:t.BA.DateValChoice.Invalid,uDate:{stDate:t.BA.createEmptyIBaDate()},aEntry:n([],i,s)};if(null!=e[o]&&e[o].eType!==t.BA.DateValChoice.Invalid){switch(a.eType=e[o].eType,e[o].eType){case t.BA.DateValChoice.eDate:a.uDate={stDate:e[o].uDate.stDate};break;case t.BA.DateValChoice.eDateRange:a.uDate={stDateRange:e[o].uDate.stDateRange};break;case t.BA.DateValChoice.eWeekNDay:a.uDate={stWeekNDay:e[o].uDate.stWeekNDay}}a.aEntry=n(e[o].aEntry,i,s)}r.push(a)}return r},e.toSchedCalendarList=function(e,a,i,s){const r=[];if(null!=a)for(let o=0;o<a;o++){const a={stRefCalendarID:{eObjectType:t.BA.ObjectType.Invalid,nInstanceID:0},aEntry:n([],i,s)};null!=e[o]&&(a.stRefCalendarID=e[o].stRefCalendarID,a.aEntry=n(e[o].aEntry,i,s)),r.push(a)}return e}}(_=a.SymbolPrepare||(a.SymbolPrepare={})),a.convertUnitToString=function(e){if(null==e)return null;if(t.Server.BaSite.Units.size>0){if(e==t.BA.Unit.eOther_NoUnits)return"";let a=t.Server.BaSite.Units.get(e);if(void 0!==a)return a}return"No unit found"},a.detectDataType=function(e){if(e instanceof globalThis.Date)return t.DataType.dateTime;if(e instanceof globalThis.Array)return t.DataType.array;switch(typeof e){case"number":return t.DataType.number;case"boolean":return t.DataType.boolean;case"string":return t.DataType.string}return globalThis.Object.keys(e).length>0?t.DataType.object:t.DataType.unknown},a.convertToType=function(t,a){switch(a){case"string":return e.ValueConverter.toString(t);case"bigint":case"number":return e.ValueConverter.toNumber(t);case"boolean":let n=e.ValueConverter.toBoolean(t);return"boolean"==typeof n?n:(n=e.ValueConverter.toNumber(t),null!=n?(n=n>0,n):null);case"date":return"string"!=typeof t||"number"!=typeof t?null:new globalThis.Date(t);default:return console.warn("[TODO] implement converting of type "+a+"!"),null}}}(a=t.Helper||(t.Helper={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.EventProvider.register(TcHmi.BuildingAutomation.TcHmiEvents.onThemeDataChanged,(()=>{"Base-Dark"===TcHmi.Theme.get()?TcHmi.BuildingAutomation.Helper.PressAndHold.AnimationColor=TcHmi.BuildingAutomation.Color.RGBAColor.White.toString():TcHmi.BuildingAutomation.Helper.PressAndHold.AnimationColor=TcHmi.BuildingAutomation.Color.RGBAColor.TcHmiBlue.toString()})),function(e){!function(t){!function(a){function n(a){return!(Object.keys(a).length<1)&&(null!=a.iconPath&&"string"==typeof a.iconPath&&(!(null!=a.iconColor&&!t.Color.isRGBAColor(a.iconColor))&&((null==a.iconColorChangeDuration||"number"==typeof a.iconColorChangeDuration)&&((null==a.iconRotation||"number"==typeof a.iconRotation)&&(!(null!=a.iconRotationDirection&&!t.Components.BackgroundStyler.isRotationDirection(a.iconRotationDirection))&&((null==a.iconStrokeWidth||"number"==typeof a.iconStrokeWidth)&&(!(null!=a.iconStrokeWidthUnit&&!e.isDimensionUnit(a.iconStrokeWidthUnit))&&(null==a.useSVG||"boolean"==typeof a.useSVG))))))))}function i(t){return(null==t.iconWidth||"number"==typeof t.iconWidth)&&(!(null!=t.iconWidthUnit&&!e.isDimensionUnit(t.iconWidthUnit))&&((null==t.iconHeight||"number"==typeof t.iconHeight)&&!(null!=t.iconHeightUnit&&!e.isDimensionUnit(t.iconHeightUnit))))}function s(t){return!(null!=t.iconHorizontalAlignment&&!e.isHorizontalAlignment(t.iconHorizontalAlignment))&&!(null!=t.iconVerticalAlignment&&!e.isVerticalAlignment(t.iconVerticalAlignment))}function r(a){return!(Object.keys(a).length<1)&&(!(null!=a.backgroundColor&&!t.Color.isRGBAColor(a.backgroundColor))&&((null==a.backgroundColorChangeDuration||"number"==typeof a.backgroundColorChangeDuration)&&((null==a.width||"number"==typeof a.width)&&(!(null!=a.widthUnit&&!e.isDimensionUnit(a.widthUnit))&&((null==a.height||"number"==typeof a.height)&&(!(null!=a.heightUnit&&!e.isDimensionUnit(a.heightUnit))&&(!(null!=a.position&&!e.isPartialFourSidedCss(a.position))&&(!(null!=a.horizontalAlignment&&!e.isHorizontalAlignment(a.horizontalAlignment))&&(!(null!=a.verticalAlignment&&!e.isVerticalAlignment(a.verticalAlignment))&&(!(null!=a.margin&&!e.isFourSidedCss(a.margin)&&"number"!=typeof a.margin)&&!!n(a)))))))))))}function o(e){if(!(e instanceof Array))return!1;for(let t of e)if(!r(t))return!1;return!0}a.convertIIconDataToIIconAttributes=function(e){return{iconPath:e.path,iconCategory:e.category,iconDescription:e.description,iconColor:e.color}},a.isIIconBaseAttributes=n,a.isIIconDimensionAttributes=i,a.isIIconPositioningAttributes=s,a.isIIconAttributes=function(e){return!(Object.keys(e).length<2)&&(null!=e.iconCategory&&"string"==typeof e.iconCategory&&((null==e.iconDescription||"string"==typeof e.iconDescription)&&(!(null!=e.iconOverlays&&!o(e.iconOverlays))&&(!!n(e)&&(!!i(e)&&!!s(e))))))},a.isIIconOverlay=r,a.isIIconOverlays=o;class l{constructor(e){this.__owner=e,this.__attrHandler=new t.AttrHandler(this),this.setIconHeight(80,"%"),this.setIconWidth(80,"%"),this.setIconVerticalAlignment("Center"),this.setIconHorizontalAlignment("Center")}get logger(){return this.__owner.logger}destroy(){if(null!=this.__overlayIcons&&this.__overlayIcons.length>0){for(const e of this.__overlayIcons)e.destroy();delete this.__overlayIcons}}getSvg(){return this.__owner.backgroundStyler.getSvg()}setAttributes(e){return void 0!==e.useSVG&&(this.__attrHandler.useSVG=e.useSVG),void 0!==e.iconPath&&(void 0===e.useSVG&&null!=e.iconPath&&e.iconPath.indexOf(".svg")>0&&(e.useSVG=!0),this.setIcon(e.iconPath,void 0!==e.useSVG?e.useSVG:this.__attrHandler.useSVG)),void 0!==e.iconHeight&&(void 0===e.iconHeightUnit&&this.__attrHandler.iconHeightUnit&&(e.iconHeightUnit=this.__attrHandler.iconHeightUnit),this.setIconHeight(e.iconHeight,e.iconHeightUnit)),void 0!==e.iconWidth&&(void 0===e.iconWidthUnit&&this.__attrHandler.iconWidthUnit&&(e.iconWidthUnit=this.__attrHandler.iconWidthUnit),this.setIconWidth(e.iconWidth,e.iconWidthUnit)),void 0!==e.iconHorizontalAlignment&&this.setIconHorizontalAlignment(e.iconHorizontalAlignment),void 0!==e.iconVerticalAlignment&&this.setIconVerticalAlignment(e.iconVerticalAlignment),void 0!==e.iconColor&&this.setIconColor(e.iconColor),void 0!==e.iconRotation&&this.setIconRotation(e.iconRotation),void 0!==e.iconRotationSpeed&&this.setIconRotationSpeed(e.iconRotationSpeed),void 0!==e.iconRotationDirection&&this.setIconRotationDirection(e.iconRotationDirection),void 0!==e.iconStrokeWidth&&(void 0===e.iconStrokeWidthUnit&&this.__attrHandler.iconStrokeWidthUnit&&(e.iconStrokeWidthUnit=this.__attrHandler.iconStrokeWidthUnit),this.setIconStrokeWidth(e.iconStrokeWidth,e.iconStrokeWidthUnit)),void 0!==e.iconOverlays&&this.setIconOverlays(e.iconOverlays),this}getAttributes(){return this.__attrHandler.getRef()}setIcon(t,a=!1){return this.__owner.backgroundStyler.setImage(t,a),this.__processIcon(),e.EventProvider.raise(l.IconHandlerEvents.onIconChanged),this}__processIcon(){}getIcon(){return this.__owner.backgroundStyler.getImage()}setIconHeight(e,t){return this.__owner.backgroundStyler.setImageHeight(e,t),this.__processIconHeight(),this}__processIconHeight(){}getIconHeight(){return this.__owner.backgroundStyler.getImageHeight()}getIconHeightUnit(){return this.__owner.backgroundStyler.getImageHeightUnit()}setIconWidth(e,t){return this.__owner.backgroundStyler.setImageWidth(e,t),this.__processIconWidth(),this}__processIconWidth(){}getIconWidth(){return this.__owner.backgroundStyler.getImageWidth()}getIconWidthUnit(){return this.__owner.backgroundStyler.getImageWidthUnit()}setIconHorizontalAlignment(e){return this.__owner.backgroundStyler.setImageHorizontalAlignment(e),this.__processIconHorizontalAlignment(),this}__processIconHorizontalAlignment(){}getIconHorizontalAlignment(){return this.__owner.backgroundStyler.getImageHorizontalAlignment()}setIconVerticalAlignment(e){return this.__owner.backgroundStyler.setImageVerticalAlignment(e),this.__processIconVerticalAlignment(),this}__processIconVerticalAlignment(){}getIconVerticalAlignment(){return this.__owner.backgroundStyler.getImageVerticalAlignment()}setIconColor(e,t=200){return this.__owner.backgroundStyler.setImageColor(e,t),this.__processIconColor(),this}__processIconColor(){}getIconColor(){return this.__owner.backgroundStyler.getImageColor()}setIconRotation(e){return this.__owner.backgroundStyler.setImageRotation(e),this.__processIconRotation(),this}__processIconRotation(){}getIconRotation(){return this.__owner.backgroundStyler.getImageRotation()}setIconRotationSpeed(e){return this.__owner.backgroundStyler.setImageRotationSpeed(e),this.__processIconRotationSpeed(),this}__processIconRotationSpeed(){}getIconRotationSpeed(){return this.__owner.backgroundStyler.getImageRotationSpeed()}setIconRotationDirection(e){return this.__owner.backgroundStyler.setImageRotationDirection(e),this.__processIconRotationDirection(),this}__processIconRotationDirection(){}getIconRotationDirection(){return this.__owner.backgroundStyler.getImageRotationDirection()}setIconStrokeWidth(e,t){return this.__owner.backgroundStyler.setImageStrokeWidth(e,t),this.__processIconStrokeWidth(),this}__processIconStrokeWidth(){}getIconStrokeWidth(){return this.__owner.backgroundStyler.getImageStrokeWidth()}getIconStrokeWidthUnit(){return this.__owner.backgroundStyler.getImageStrokeWidthUnit()}setIconOverlays(e){return this.__attrHandler.checkAttribute(e,"iconOverlays",{validator:o})?(this.__attrHandler.iconOverlays=e,this.__processIconOverlays(),this):this}__processIconOverlays(){if(null!=this.__attrHandler.iconOverlays&&0!==this.__attrHandler.iconOverlays.length){for(let e=0;e<this.__attrHandler.iconOverlays.length;e++){let a=this.__attrHandler.iconOverlays[e];null==this.__overlayIcons&&(this.__overlayIcons=[]);let n=this.__overlayIcons[e];if(null==n&&(n=new t.Components.Icon(this.__owner.getId()+"-overlay-"+e,this.__owner).setAttributes({cssClass:"overlay-icon"}),this.__overlayIcons.push(n)),n.layoutHandler.setHeight(a.height,a.heightUnit).setWidth(a.width,a.widthUnit),n.iconHandler.setAttributes(a),null!=a.verticalAlignment||null!=a.horizontalAlignment){if(null!=a.verticalAlignment)switch(a.verticalAlignment){case"Top":n.layoutHandler.setTop(0),n.layoutHandler.setBottom(null);break;case"Center":if(null==a.height)throw new t.BaseError("Can not apply vertical alignment when width and height of overlay have not been set!");null==a.heightUnit&&(a.heightUnit="px"),n.getElement().css("top","calc(50% - "+a.height/2+a.heightUnit),n.layoutHandler.setBottom(null);break;case"Bottom":n.layoutHandler.setBottom(0),n.layoutHandler.setTop(null)}if(null!=a.horizontalAlignment)switch(a.horizontalAlignment){case"Left":n.layoutHandler.setLeft(0),n.layoutHandler.setRight(null);break;case"Center":if(null==a.width)throw new t.BaseError("Can not apply horizontal alignment when width and height of overlay have not been set!");null==a.widthUnit&&(a.widthUnit="px"),n.getElement().css("left","calc(50% - "+a.width/2+a.widthUnit),n.layoutHandler.setRight(null);break;case"Right":n.layoutHandler.setRight(0),n.layoutHandler.setLeft(null)}}else null!=a.position&&n.layoutHandler.setPosition(a.position);null!=a.margin&&t.Helper.StyleProvider.processMargin(n.getElement(),a.margin),null!=a.backgroundColor&&n.backgroundStyler.setColor(a.backgroundColor,a.backgroundColorChangeDuration)}if(null!=this.__overlayIcons&&this.__overlayIcons.length>0)for(const e of this.__overlayIcons)this.__owner.getElement().append(e.getElement())}else if(null!=this.__overlayIcons){for(const e of this.__overlayIcons)e.destroy();delete this.__overlayIcons}}getIconOverlays(){return this.__attrHandler.iconOverlays}}a.IconHandler=l,function(e){let t;!function(e){e.onIconChanged="onIconHandlerIconChanged"}(t=e.IconHandlerEvents||(e.IconHandlerEvents={}))}(l=a.IconHandler||(a.IconHandler={}))}(t.Icons||(t.Icons={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){!function(a){function n(e){return e="data-tchmi-"+(e=(e=e.slice(e.lastIndexOf(":")+1)).slice(0,e.indexOf("%"))).toLowerCase()}a.resolvePartialParam=function(a,i){let s=null,r=null;if(a instanceof e.Controls.System.baseTcHmiControl)s=a.getParent();else{if(!(a instanceof t.Components.Base))throw new t.BaseError(`Control '${a.getId()}' has not handled type.`);{let n=a.getBaParent();for(;!(n instanceof e.Controls.System.baseTcHmiControl);){if(null==n)throw new t.BaseError("Component was used in TcHmiControl without setting the TcHmiControl as the parent of the component!");n=n.getBaParent()}s=n}}if(null==s)throw new t.BaseError(`No parent was found for component/control '${a.getId()}'.`);for(;s;){if(s instanceof e.Controls.System.TcHmiUserControl){r=s;break}s=s.getParent()}if(null==r)throw new t.BaseError(`No TcHmiUserControl found in parents of ${a.getId()}`);if(TCHMI_DESIGNER)return i;let o=r.getParent();if(null==o)throw new t.BaseError(`TcHmiUserControl ${r.getId()} does not have a parent!`);if("TcHmi.Controls.System.TcHmiContainer"===r.getType()||"TcHmi.Controls.System.TcHmiContainer"===o.getType())throw new t.BaseError("Placing controls into a container is currently not supported in a UserControl. Please place controls outside of containers.");let l,d,h,_,c,u,g=i.toString(),p=g.split("::"),b="";if(p.length<3)l=n(g);else{for(let e=p.length-1;e>1;e--)b=e===p.length-1?"::"+p[e].slice(0,p[e].indexOf("%"))+b:"::"+p[e]+b;l="data-tchmi-"+p[1].toLowerCase()}let m=r;for(;"TcHmi.Controls.System.TcHmiUserControl"===m.getType()&&(o=m.getParent(),null!=o);){if("TcHmi.Controls.System.TcHmiUserControlHost"===o.getType()){if(d=o.getAttrs(),h=d[l],void 0===h)throw new t.BaseError(`Attribute with name '${l}' was not found for UserControl '${m.getId()}'`);if(_=h,g=_.value,!e.Symbol.isSymbolExpression(g))throw new t.BaseError(`No symbol was bound to partial param '${i}'`)}if(c=o.getParent(),null!==c&&"TcHmi.Controls.System.TcHmiUserControl"===c.getType()&&(o=c,null!==o))if(p=g.split("::"),p.length<3)l=n(g);else{for(let e=p.length-1;e>1;e--)b=e===p.length-1?"::"+p[e].slice(0,p[e].indexOf("%"))+b:"::"+p[e]+b;l="data-tchmi-"+p[1].toLowerCase()}m=o}if(void 0===_)throw new t.BaseError(`Attribute with name '${l}' was not found for UserControl '${r.getId()}'`);if(b.length>0&&(g=function(e,t){let a=e.lastIndexOf("%",e.length-2),n=e.slice(a,e.length),i=e.slice(0,a);return i=i+t+n,i}(g,b)),u=new e.SymbolExpression(g),u.getType()!==e.SymbolType.Server)throw t.Logger.warn("PLC symbol expression could not be obtained.",{foundSymbolExpression:g,userControl:r,symbolExpression:i}),new t.BaseError("PLC symbol expression could not be obtained.");return u}}(a.Mapping||(a.Mapping={}))}(t.Helper||(t.Helper={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){a.ResizeHandler=class{constructor(e,a){this.__resizeObserver=new ResizeObserver((()=>{this.__ctrl.onResized()})),this.__ctrl=e,this.__element=a,this.__attachId=t.System.AttachObserver.add(e,{attachedCb:()=>this.__attach(),detachedCb:()=>this.__detach()})}__attach(){if(this.__element)this.__resizeObserver.observe(this.__element[0]);else try{this.__resizeObserver.observe(this.__ctrl.getElement()[0])}catch(e){t.Logger.error(`Observing element of control ${this.__ctrl.getId()} failed! Did you forget to destroy the resize handler before detaching?`)}this.__destroyOnThemeDataChanged=e.EventProvider.register(t.TcHmiEvents.onThemeDataChanged,(()=>{this.__ctrl.onResized()}))}__detach(){if(this.__element)this.__resizeObserver.unobserve(this.__element[0]);else try{this.__resizeObserver.unobserve(this.__ctrl.getElement()[0])}catch(e){t.Logger.error(`Unobserving element of control ${this.__ctrl.getId()} failed! Did you forget to destroy the resize handler before detaching?`)}null!=this.__destroyOnThemeDataChanged&&(this.__destroyOnThemeDataChanged(),delete this.__destroyOnThemeDataChanged)}destroy(){t.System.AttachObserver.remove(this.__ctrl,this.__attachId),null!=this.__destroyOnThemeDataChanged&&(this.__destroyOnThemeDataChanged(),delete this.__destroyOnThemeDataChanged)}}}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(t){!function(t){t.processMargin=function(t,a){if(null==a||null==t)return;const n=["top","right","bottom","left"];let i="";if("number"==typeof a)i+=a+"px";else for(const e of n)null!=a[e]?0===a[e]?i+="0":i+=a[e]+(null!=a[e+"Unit"]?a[e+"Unit"]:"px"):i+="0",i+=" ";e.StyleProvider.setSimpleElementStyle(t,"margin",i)}}(t.StyleProvider||(t.StyleProvider={}))}(t.Helper||(t.Helper={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){let n,i;!function(e){e[e.baSite=0]="baSite",e[e.localeStorage=1]="localeStorage"}(n=a.Location||(a.Location={})),function(a){let i;a.LastContentStorageLocation=n.baSite,a.LastThemeStorageLocation=n.baSite,a.TrendSettingsStorageLocation=n.baSite,a.TrendCollectionStorageLocation=n.baSite,a.TrendCollectionSelectionStorageLocation=n.baSite,a.saveLastContentAsync=async function(e){switch(a.LastContentStorageLocation){case n.localeStorage:i.saveLastContent(e);break;case n.baSite:await t.Server.BaSite.UserData.saveLastContentAsync(e)}},a.loadLastContentAsync=async function(){let e;switch(a.LastContentStorageLocation){case n.localeStorage:e=i.loadLastContent();break;case n.baSite:e=await t.Server.BaSite.UserData.loadLastContentAsync()}return e},a.saveLastThemeAsync=async function(e){switch(a.LastThemeStorageLocation){case n.localeStorage:i.saveLastTheme(e);break;case n.baSite:await t.Server.BaSite.UserData.saveLastThemeAsync(e)}},a.loadLastThemeAsync=async function(){let e;switch(a.LastThemeStorageLocation){case n.localeStorage:e=i.loadLastTheme();break;case n.baSite:e=await t.Server.BaSite.UserData.loadLastThemeAsync()}return e},a.saveTrendSettingsAsync=async function(e,s){switch(a.TrendSettingsStorageLocation){case n.localeStorage:i.saveTrendSettings(e,s);break;case n.baSite:await t.Server.BaSite.UserData.saveTrendSettingsAsync(e,s)}},a.loadTrendSettingsAsync=async function(e){let s;switch(a.TrendSettingsStorageLocation){case n.localeStorage:s=i.loadTrendSettings(e);break;case n.baSite:s=await t.Server.BaSite.UserData.loadTrendSettingsAsync(e)}return s},a.saveAxisOptionsAsync=async function(e,s){switch(a.TrendSettingsStorageLocation){case n.localeStorage:i.saveAxisOptions(e,s);break;case n.baSite:await t.Server.BaSite.UserData.saveAxisOptionsAsync(e,s)}},a.loadAxisOptionsAsync=async function(e){let s;switch(a.TrendSettingsStorageLocation){case n.localeStorage:s=i.loadAxisOptions(e);break;case n.baSite:s=await t.Server.BaSite.UserData.loadAxisOptionsAsync(e)}return s},a.saveTrendCollectionAsync=async function(e,s){switch(a.TrendCollectionSelectionStorageLocation){case n.localeStorage:i.saveTrendCollection(e,s);break;case n.baSite:await t.Server.BaSite.UserData.saveTrendCollectionAsync(e,s)}},a.loadTrendCollectionsAsync=async function(){let e;switch(a.TrendCollectionStorageLocation){case n.localeStorage:e=i.loadTrendCollections();break;case n.baSite:e=await t.Server.BaSite.UserData.loadTrendCollectionsAsync()}return e},a.deleteTrendCollectionAsync=async function(e){switch(a.TrendCollectionStorageLocation){case n.localeStorage:i.deleteTrendCollection(e);break;case n.baSite:await t.Server.BaSite.UserData.deleteTrendCollectionAsync(e)}},a.saveTrendCollectionSelectionAsync=async function(e){switch(a.TrendCollectionSelectionStorageLocation){case n.localeStorage:i.saveTrendCollectionSelection(e);break;case n.baSite:await t.Server.BaSite.UserData.saveTrendCollectionSelectionAsync(e)}},a.loadTrendCollectionSelectionAsync=async function(){let e;switch(a.TrendCollectionSelectionStorageLocation){case n.localeStorage:e=i.loadTrendCollectionSelection();break;case n.baSite:e=await t.Server.BaSite.UserData.loadTrendCollectionSelectionAsync()}return e},a.deleteTrendCollectionSelectionAsync=async function(e){switch(a.TrendCollectionSelectionStorageLocation){case n.localeStorage:i.deleteTrendCollectionSelection(e);break;case n.baSite:await t.Server.BaSite.UserData.deleteTrendCollectionSelectionAsync(e)}},a.clearUserDataAsync=async function(){i.clear(),t.Server.BaSite.UserData.clearUserData()},function(t){t.storage=new e.LocalStorage("TcHmi.BuildingAutomation.Storage.UserData",{}),t.saveLastContent=function(e){t.storage.set("lastContent",e)},t.loadLastContent=function(){return t.storage.get("lastContent")},t.saveLastTheme=function(e){t.storage.set("lastTheme",e)},t.loadLastTheme=function(){return t.storage.get("lastTheme")},t.saveTrendSettings=function(e,a){let n=t.storage.get("trendSettings");null==n&&(n={}),n[e]=a,t.storage.set("trendSettings",n)},t.loadTrendSettings=function(e){const a=t.storage.get("trendSettings");return null!=a?a[e]:void 0},t.saveAxisOptions=function(e,a){let n=t.storage.get("axisOptions");null==n&&(n={}),n[e]=a,t.storage.set("axisOptions",n)},t.loadAxisOptions=function(e){const a=t.storage.get("axisOptions");return null!=a?a[e]:void 0},t.saveTrendCollection=function(e,a){let n=t.storage.get("trendCollections");null==n&&(n={}),n[e]=a,t.storage.set("trendCollections",n)},t.loadTrendCollections=function(){return t.storage.get("trendCollections")},t.deleteTrendCollection=function(e){let a=t.storage.get("trendCollections");null!=a&&null!=a[e]&&(delete a[e],t.storage.set("trendCollections",a))},t.saveTrendCollectionSelection=function(e){let a=t.storage.get("trendCollectionSelection");null==a&&(a=[]),-1===a.indexOf(e)&&(a.push(e),t.storage.set("trendCollectionSelection",a))},t.loadTrendCollectionSelection=function(){return t.storage.get("trendCollectionSelection")},t.deleteTrendCollectionSelection=function(e){let a=t.storage.get("trendCollectionSelection");null==a&&(a=[]),a=a.filter((t=>t!==e)),t.storage.set("trendCollectionSelection",a)},t.clear=function(){t.storage.delete("axisOptions"),t.storage.delete("lastContent"),t.storage.delete("lastTheme"),t.storage.delete("trendCollections"),t.storage.delete("trendCollectionSelection"),t.storage.delete("trendSettings")}}(i=a.Local||(a.Local={}))}(i=a.UserData||(a.UserData={}))}(t.Storage||(t.Storage={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){async function n(a,n){if(TCHMI_DESIGNER)throw new t.InvalidTcHmiInstanceError("Calling server function is not available in designer instance.");try{return new Promise(((i,s)=>{let r={requestType:"ReadWrite",commands:[{symbol:a,writeValue:n,commandOptions:["SendErrorMessage"]}]};e.Server.requestEx(r,{parallel:!0},(a=>{if(t.TcHmiError.hasError(a.details)||null==a.results)if(a.error===e.Errors.NONE&&a.results){let n=a.results.filter((t=>t.error!==e.Errors.NONE))[0];s(new t.BaseError(e.Log.buildMessage(n.details)))}else s(new t.BaseError(e.Log.buildMessage(a.details)));else i(a.results[0].value)}))}))}catch(e){throw new o("Calling server function failed!",{cause:e})}}async function i(a){return new Promise(((n,i)=>{e.Server.writeSymbol("ListSymbolNames",{domain:a},(e=>{if(t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.response)return n(e.response.commands[0].readValue);i(new t.BaseError("Getting available symbol names failed!"))}))}))}a.callServerFunctionAsync=n,a.callServerFunction=function(e,a,i){if("function"!=typeof i)throw new t.InvalidTypeError("callback",{requiredType:"function",actualType:typeof i});n(e,a).then((e=>{null!=i&&i(null,e)})).catch((e=>{i(e)}))},a.getAvailableSymbolNamesAsync=i,a.symbolExistsAsync=async function(e,a){try{return(await i(a.domain)).indexOf(e)>-1}catch(e){throw new t.BaseError("Checking is symbol exists failed!",{cause:e})}};class s{constructor(e){this.__requests=[],this.__logger=new t.Logger({name:"SubscriptionCollector"}),null==e&&(e=s.DefaultWaitTime),this.__wait=e}add(e,t){null==this.__timeoutId&&0==TCHMI_DESIGNER&&(this.__timeoutId=setTimeout((()=>{this.__updateSubscription(),this.__timeoutId=void 0}),this.__wait));let a=this.__requests.find((t=>t.symbol===e));return null==a?(a={symbol:e,commandOptions:["SendErrorMessage"],callbacks:[]},this.__requests.push(a)):void 0!==a.oldResult&&t(a.oldResult),a.callbacks.push(t),{id:a.callbacks.length-1,mapping:e}}remove(t){null==this.__timeoutId&&(this.__timeoutId=setTimeout((()=>{this.__updateSubscription(),this.__timeoutId=void 0}),this.__wait));let a=this.__requests.find((e=>e.symbol===t.mapping));null!=a&&(a.callbacks.splice(t.id,1),0===a?.callbacks.length&&(this.__requests=this.__requests.filter((e=>e.symbol!==t.mapping)),0===this.__requests.length&&null!=this.__subscriptionId&&(e.Server.unsubscribeEx(this.__subscriptionId,{parallel:!0}),delete this.__subscriptionId)))}__updateSubscription(){if(this.__requests.length<=0)return;let a=this.__logger.logPerformance(t.Logger.Severity.debug,"Executing request");null!=this.__subscriptionId&&(e.Server.unsubscribeEx(this.__subscriptionId,{parallel:!0}),delete this.__subscriptionId),this.__subscriptionId=e.Server.subscribeEx(this.__requests,s.Interval,{parallel:!0},(e=>{if(this.__logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.response?.commands){let n=e.response.commands;for(let e=0;e<n.length;e++)if(this.__logger.checkServerCommand(t.Logger.Severity.warn,n[e])){let a=this.__requests.find((t=>t.symbol===n[e].symbol)),i=n[e].readValue;if(!a){t.Logger.warn(`Got result for '${n[e]}' but did not find request!`,n[e]);continue}if(tchmi_equal(a.oldResult,i))continue;a.oldResult=i;for(let e=0;e<a.callbacks.length;e++)a.callbacks[e](i)}a({results:n})}}))}}let r;a.SubscriptionCollector=s,function(e){e.DefaultWaitTime=100,e.Interval=500}(s=a.SubscriptionCollector||(a.SubscriptionCollector={})),a.subscriptionCollector=new s,function(e){e.observe="observe",e.operate="operate"}(r=a.AccessRight||(a.AccessRight={}));class o extends t.BaseError{constructor(e,t){super(e,t)}}a.Error=o}(t.Server||(t.Server={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){!function(n){async function i(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Getting user level groups.");try{const e=await a.callServerFunctionAsync(n.DomainName+".GetUserLevelGroups");let i=new Map;for(let n in e)switch(n){case"LEVEL_ADVANCED":i.set(t.BA.Role.eAdvanced,e[n]);break;case"LEVEL_BASIC":i.set(t.BA.Role.eBasic,e[n]);break;case"LEVEL_EXPERT":i.set(t.BA.Role.eExpert,e[n]);break;case"LEVEL_GUEST":i.set(t.BA.Role.eGuest,e[n]);break;case"LEVEL_INTERNAL":i.set(t.BA.Role.eInternal,e[n]);break;default:throw new a.Error(`Not handled user level ${n}!`)}return i}catch(e){throw new A("Getting user level groups failed!",{cause:e})}finally{e()}}async function s(e){try{await a.callServerFunctionAsync(n.DomainName+".ChangeLocale",e)}catch(a){throw new A(`Changing locale to '${t.BA.LanguageManager.EChoice[e]}' failed!`,{cause:a})}}async function r(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading units.");try{const e=await a.callServerFunctionAsync(n.DomainName+".GetUnits");let i=t.Helper.Object.toNumberDictionary({...e});if(i&&i.size<=0)throw new A("No units were returned!");return i}catch(e){throw new A("Getting units failed!",{cause:e})}finally{e()}}async function o(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaStandardParameterInformation.");try{const e=await a.callServerFunctionAsync(n.DomainName+".GetBaStandardParameterInformation");let t=new Map;for(let a in e)t.set(a,e[a]);return t}catch(e){throw new A("Getting BaStandardParameterInformation failed!",{cause:e})}finally{e()}}async function l(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaAdditionalParameterInformation.");try{const e=await a.callServerFunctionAsync(n.DomainName+".GetBaAdditionalParameterInformation");let t=new Map;for(let a in e){let n=e[a],i=new Map;for(let e in n){let t=n[e],a=new Map;for(let e in t)a.set(e,t[e]);i.set(e,a)}t.set(a,i)}return t}catch(e){throw new A("Getting BaStandardParameterInformation failed!",{cause:e})}finally{e()}}async function d(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Getting periodically updated variable IDs.");try{const e=await a.callServerFunctionAsync(n.DomainName+".GetPeriodicallyUpdatedVariableIDs");if(null==e||e.length<=0)throw new A("No periodically updated variable IDs returned!");return e.push(t.BA.BaParameterId.eSymbolPath),e.push(t.BA.BaParameterId.eInstanceID),e}catch(e){throw new A("Getting periodically updated variable IDs failed!",{cause:e})}finally{e()}}async function h(e){try{if(e.RefObject instanceof t.BA.BaVariable)throw new A("Child of a BaVariable was passed!");let i={DeviceName:e.RefObject.Device.Description,BaObjectInstancePath:e.RefObject.InstancePath,BaVarId:e.ID,BaVarInstName:e.InstanceName};const s=await a.callServerFunctionAsync(n.DomainName+".GetValueRange",i);if(null==s)throw new A("No value range returned!");return t.Helper.Object.toNumberDictionary(s)}catch(t){throw new A(`Getting value range of BaVariable '${e.Mapping}' failed!`,{cause:t})}}async function _(e){try{let i=[];for(let t of e)i.push({DeviceName:t.RefObject.Device.Description,BaObjectInstancePath:t.RefObject.InstancePath,BaVarId:t.ID,BaVarInstName:t.InstanceName});const s=await a.callServerFunctionAsync(n.DomainName+".GetValueRanges",i);if(null==s)throw new A("No value ranges returned!");const r=new Map;for(let a of e){let e=s[a.RefObject.Device.Description+"."+a.RefObject.InstancePath+"."+a.InstanceName];if(null==e)throw new A(`No value range found for BaVariable '${a.Mapping}'!`);r.set(a,t.Helper.Object.toNumberDictionary(e))}return r}catch(e){throw new A("Getting value ranges failed!",{cause:e})}}async function c(e){let i={DeviceName:e.RefObject.Device.Description,BaObjectInstancePath:e.RefObject.InstancePath,BaVarId:e.ID,BaVarInstName:e.InstanceName};try{if(e.RefObject instanceof t.BA.BaVariable)throw new A("Child of a BaVariable was passed!");const s=await a.callServerFunctionAsync(n.DomainName+".GetDecoratingInfo",i);if(null==s)throw new A("No decorating info returned!");return s}catch(t){throw new A(`Getting decorating info for BaVariable '${e.Mapping}' failed!`,{cause:t})}}async function u(e){let i=t.Logger.logPerformance(t.Logger.Severity.debug,`Reading BaDevice '${e}'.`);try{return await a.callServerFunctionAsync(n.DomainName+".GetBaDeviceProjectStructure",e)}catch(t){throw new A(`Reading project structure '${e}' failed!`,{cause:t})}finally{i()}}async function g(e){let i=t.Logger.logPerformance(t.Logger.Severity.debug,"Read BaDevice.");try{const t=await a.callServerFunctionAsync(n.DomainName+".GetBaDevice",e);if(null==t)throw new A("No BaDevice returned!");return{ProjectStructure:N(t.PS,e.DeviceName)}}catch(t){throw new A(`Reading of device '${e.DeviceName}' failed!`,{cause:t})}finally{i()}}async function p(e){let i=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaDevices.");try{const t=await a.callServerFunctionAsync(n.DomainName+".GetBaDevices",e);let i={};for(let e in t)i[e]={ProjectStructure:N(t[e].PS,e)};return i}catch(e){throw new A("Reading of devices failed!",{cause:e})}finally{i()}}async function b(e){try{return await a.callServerFunctionAsync(n.DomainName+".CheckBaDeviceMapping",e)}catch(e){throw new A("Checking of BaDevice mapping failed!",{cause:e})}}async function m(e,i=!1,s=!1){let r,o=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaObject.");r=e instanceof t.BA.BaBasicObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath,IncludeChildren:i,IncludeTexts:s}:e;try{const e=await a.callServerFunctionAsync(n.DomainName+".GetBaObject",r);if(null==e)throw new A("No BaObject returned!");let o;if(V(e)?o=N(e,r.DeviceName):o=M(e)?F(e,r.DeviceName):j(e,r.DeviceName),!t.BA.BaBasicObject.isIBaBasicObjectAttributes(o))throw new A("Result does not fit to interface IBaBasicObjectAttributes!");let l=t.BA.BaDevices?.get(r.DeviceName);if(!l)throw new A(`Load BaDevice '${r.DeviceName}' before accessing BaObjects in it!`);let d=l.findBaObject(r.BaObjectInstancePath);if(!d)throw new A(`Could not find BaObject '${r.BaObjectInstancePath}' in ${r.DeviceName}!`);if(d.setAttributes(o),0==d.getIsValid(i,s))throw new A(`BaObject '${r.BaObjectInstancePath}' was not loaded correctly!`);return d}catch(e){throw new A("Getting BaObject failed!",{cause:e})}finally{o()}}async function y(e,i=!1){let s;s=e instanceof t.BA.BaBasicObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath,IncludeChildren:i}:e;try{const e=await a.callServerFunctionAsync(n.DomainName+".GetBaObjectTexts",s);if(null==e)throw new A("No BaObjectTexts returned!");return function e(t){let a={description:t.description,instDescription:t.instDescription,instObjectName:t.instObjectName,objectName:t.objectName};if(null!=t.children){a.children=new Map;for(let n in t.children)a.children.set(n,e(t.children[n]))}return a}(e)}catch(e){throw new A(`Getting object texts for BaObject '${s.BaObjectInstancePath}' failed!`,{cause:e})}}async function v(e){let t={DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath};try{await a.callServerFunctionAsync(n.DomainName+".AcknowledgeBaObject",t)}catch(t){throw new A(`Acknowledging of BaObject '${e.InstancePath}' failed!`,{cause:t})}}async function f(e){let i,s=t.Logger.logPerformance(t.Logger.Severity.debug,"Getting referring objects.");i=e instanceof t.BA.BaObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath}:e;try{const e=await a.callServerFunctionAsync(n.DomainName+".GetReferringObjects",i);if(null==e)throw new A("No referring objects returned!");let s=[];if(Object.keys(e).length>0){for(let a in e){let n=e[a];const i=await t.BA.BaVariable.processBaObjectParameter(n);null!=i&&s.push(i)}return s}return s}catch(e){throw new A("Getting referring objects failed!",{cause:e})}finally{s()}}async function D(e){let i;i=e instanceof t.BA.BaObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath}:e;try{if(!await a.callServerFunctionAsync(n.DomainName+".AssignBaObjectToUnusedTrend",i))throw new A(`Assigning of BaObject '${i.BaObjectInstancePath}' to unused trend failed! No unused trend found!`);{let a;if(a=e instanceof t.BA.BaObject?e:t.BA.BaDevices?.get(e.DeviceName)?.findBaObject(e.BaObjectInstancePath),!(null!=a&&a instanceof t.BA.BaObject))throw new A("BaObject should be an instance of BaObject here.");{const e=await a.getReferringObjectsAsync();if(null==e||e.length<=0)throw new A(`BaObject '${a?.InstancePath}' has no referring objects, which should not be possible at this stage!`);let n=e[0].OwnerObject;try{await n.tryReadBaVariable(t.BA.BaParameterId.eEnable)||await t.Components.DialogWindow.confirm(`You assigned BaObject '${a?.InstancePath}' to a new trend which is not yet enabled.\nDo you want to enable the trend?`)&&await n.tryWriteBaVariableValueAsync(t.BA.BaParameterId.eEnable,!0)}catch(e){throw new A(`Checking if trend object '${n.InstancePath}' is enabled failed!`,{cause:e})}}}}catch(e){throw new A(`Could not assign BaObject '${i.BaObjectInstancePath}' to unused trend!`,{cause:e})}}async function C(e){let i;i=e instanceof t.BA.BaObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath}:e;try{if(!await a.callServerFunctionAsync(n.DomainName+".RemoveBaObjectFromAssignedTrends",i))throw new A(`Removing BaObject '${i.BaObjectInstancePath}' from trend failed!`)}catch(e){throw new A(`Could not remove BaObject '${i.BaObjectInstancePath}' from assigned trends!`,{cause:e})}}async function H(){try{const e=await a.callServerFunctionAsync(n.EventsSymbols.List);if(null==e)throw new A("No event list returned!");return P(e)}catch(e){throw new A("Reading events failed!",{cause:e})}}async function w(){try{const e=await a.callServerFunctionAsync(n.EventHistorySymbols.List);if(null==e)throw new A("No event history returned!");return P(e)}catch(e){throw new a.Error("Reading event history failed!",{cause:e})}}let S,T;function E(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("ts",["string",null]),n.set("a","boolean"),n.set("h","boolean"),n.set("l","number"),n.set("d","string"),n.set("id",t.BA.isBaIdentifier),n.set("ip","string"),n.set("desc","string"),n.set("o","string"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a}function B(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("deviceName","string"),n.set("address","string"),n.set("connectionStateDescription","string"),n.set("connectionState","number"),n.set("nameSpace",["string","undefined"]),n.set("components",["object","undefined"]),n.set("statistics",["object","undefined"]),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a}n.extensionAvailable=!1,n.devicesLoaded=!1,n.DomainName="BaSite",n.ProjectStructureName="Top",n.Units=new Map,n.BaStandardParameterInformation=new Map,n.BaAdditionalParameterInformation=new Map,n.PeriodicallyUpdatedVariableIds=[],n.SuppressNotAvailableLog=!1,n.AvailableSymbolNames=[],n.Diagnostics={siteApiVersion:"N/A",adsDllVersion:"N/A",tcHmiSrvExtVersion:"N/A",compatibleSiteServerVersion:"N/A"},n.EventsSymbols={List:n.DomainName+".Events::List",Count:n.DomainName+".Events::Count",AcknowledgeableCount:n.DomainName+".Events::AcknowledgeableCount"},n.EventHistorySymbols={List:n.DomainName+".EventHistory::List",Count:n.DomainName+".EventHistory::Count"},n.PrimitveBaObjects=[t.BA.ObjectType.eAnalogInput,t.BA.ObjectType.eAnalogOutput,t.BA.ObjectType.eAnalogValue,t.BA.ObjectType.eBinaryInput,t.BA.ObjectType.eBinaryOutput,t.BA.ObjectType.eBinaryValue,t.BA.ObjectType.eMultiStateInput,t.BA.ObjectType.eMultiStateOutput,t.BA.ObjectType.eMultiStateValue,t.BA.ObjectType.eSchedule,t.BA.ObjectType.eLoop],n.ImplementedNonPrimitiveValues=[t.BA.BaParameterId.eStateText,t.BA.BaParameterId.eLogBuffer,t.BA.BaParameterId.eReferencedParam,t.BA.BaParameterId.eStatusFlags],n.getUserLevelGroupsAsync=i,n.getUserLevelGroups=function(e){i().then((t=>{e(null,t)})).catch((t=>{e(t)}))},n.changeLocaleAsync=s,n.changeLocale=function(e,t){s(e).then((()=>{t(null)})).catch((e=>{t(e)}))},n.getUnitsAsync=r,n.getUnits=function(e){r().then((t=>{e(null,t)})).catch((t=>{e(t)}))},n.getBaStandardParameterInformationAsync=o,n.getBaStandardParameterInformation=function(e){o().then((t=>{e(null,t)})).catch((t=>{e(t)}))},n.getBaAdditionalParameterInformationAsync=l,n.getBaAdditionalParameterInformation=function(e){l().then((t=>{e(null,t)})).catch((t=>{e(t)}))},n.getPeriodicallyUpdatedVariableIDsAsync=d,n.getPeriodicallyUpdatedVariableIDs=function(e){d().then((t=>{e(null,t)})).catch((t=>{e(t)}))},n.getValueRangeAsync=h,n.getValueRange=function(e,t){h(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.getValueRangesAsync=_,n.getValueRanges=function(e,t){_(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.getDecoratingInfoAsync=c,n.getDecoratingInfo=function(e,t){c(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.getBaDeviceProjectStructureAsync=u,n.getBaDeviceProjectStructure=function(e,t){u(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.getBaDeviceAsync=g,n.getBaDevice=function(e,t){g(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.getBaDevicesAsync=p,n.getBaDevices=function(e,t){p(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.checkBaDeviceMappingAsync=b,n.checkBaDeviceMapping=function(e,t){b(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.getBaObjectAsync=m,n.getBaObject=async function(e,t,a,n){m(e,t,a).then((e=>{n(null,e)})).catch((e=>{n(e)}))},n.getBaObjectTextsAsync=y,n.getBaObjectTexts=async function(e,t,a){y(e,t).then((e=>{a(e)})).catch((e=>{a(e)}))},n.acknowledgeBaObjectAsync=v,n.acknowledgeBaObject=function(e,t){v(e).then((()=>{t(null)})).catch((e=>{t(e)}))},n.getReferringObjectsAsync=f,n.getReferringObjects=async function(e,t){f(e).then((e=>{t(null,e)})).catch((e=>{t(e)}))},n.assignBaObjectToUnusedTrendAsync=D,n.assignBaObjectToUnusedTrend=function(e,t){D(e).then((()=>{t(null)})).catch((e=>{t(e)}))},n.removeBaObjectFromAssignedTrendsAsync=C,n.removeBaObjectFromAssignedTrends=function(e,t){C(e).then((()=>{t(null)})).catch((e=>{t(e)}))},n.getEventListAsync=H,n.getEventList=function(e){H().then((t=>{e(null,t)})).catch((t=>{e(t)}))},n.getEventHistoryAsync=w,n.getEventHistory=function(e){w().then((t=>{e(null,t)})).catch((t=>{e(t)}))},n.watchEventCountPerType=function(i,s,r){let o={History:i};null!=s&&(o=s instanceof t.BA.BaBasicObject?{...o,DeviceName:s.Device.Description,BaObjectInstancePath:s.InstancePath}:{...o,...s});const l={commandOptions:["SendErrorMessage"],symbol:n.DomainName+".EventCountPerType",writeValue:o},d=e.Server.subscribeEx([l],a.SubscriptionCollector.Interval,{parallel:!0},(e=>{if(t.Logger.checkServerResult(t.Logger.Severity.warn,e)){if(null!=e.response?.commands){let t=new Map;for(let a in e.response.commands[0].readValue)t.set(Number(a),e.response.commands[0].readValue[a]);r(null,t)}}else r(new A("Loading event count per event type counts failed!"))}));return()=>{null!=d&&e.Server.unsubscribeEx(d,{parallel:!0})}},n.watchAcknowledgeableEventCountPerType=function(i,s){let r;null!=i&&(r=i instanceof t.BA.BaBasicObject?{DeviceName:i.Device.Description,BaObjectInstancePath:i.InstancePath}:i);const o={commandOptions:["SendErrorMessage"],symbol:n.DomainName+".AcknowledgeableEventCountPerType",writeValue:r},l=e.Server.subscribeEx([o],a.SubscriptionCollector.Interval,{parallel:!0},(e=>{if(t.Logger.checkServerResult(t.Logger.Severity.warn,e)){if(null!=e.response?.commands){let t=new Map;for(let a in e.response.commands[0].readValue)t.set(Number(a),e.response.commands[0].readValue[a]);s(null,t)}}else s(new A("Loading acknowledgeable event count per event type failed!"))}));return()=>{null!=l&&e.Server.unsubscribeEx(l,{parallel:!0})}},function(e){e.onExtensionAvailable="BaSite.onExtensionAvailable",e.onExtensionLoaded="BaSite.onExtensionLoaded",e.onExtensionUnloaded="BaSite.onExtensionUnloaded",e.onBaDevicesLoaded="BaSite.onBaDevicesLoaded",e.onDiagnosticsChanged="BaSite.onDiagnosticsChanged",e.onRuntimeDiagnosticsChanged="BaSite.onRuntimeDiagnosticsChanged",e.onUnitsLoadedEvent="BaSite.onUnitsLoaded",e.onBaStandardParameterInformationLoaded="BaSite.onBaStandardParameterInformationLoaded",e.onBaAdditionalParameterInformationLoaded="BaSite.onBaAdditionalParameterInformationLoaded"}(T=n.Events||(n.Events={})),n.isIBaEventInformationServerResult=function(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("t","number"),n.set("s","number"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},n.isIBaEventServerResult=E,n.isIDeviceDiagnostics=B;class A extends t.BaseError{}function x(){o().then((a=>{n.BaStandardParameterInformation.clear(),null!=a&&(a.forEach(((e,t)=>n.BaStandardParameterInformation.set(t,e))),t.Logger.info(t.Logger.checkMark+`BaStandardParameterInformation were loaded from ${n.DomainName}`,n.BaStandardParameterInformation),e.EventProvider.raise(T.onBaStandardParameterInformationLoaded))})).catch((e=>{A.error(e)}))}function O(){l().then((a=>{n.BaAdditionalParameterInformation.clear(),null!=a&&(a.forEach(((e,t)=>n.BaAdditionalParameterInformation.set(t,e))),t.Logger.info(t.Logger.checkMark+`BaAdditionalParameterInformation were loaded from ${n.DomainName}`,a),e.EventProvider.raise(T.onBaAdditionalParameterInformationLoaded))})).catch((e=>{A.error(e)}))}function k(){r().then((a=>{n.Units.clear(),null!=a&&(a.forEach(((e,t)=>n.Units.set(t,e))),t.Logger.info(t.Logger.checkMark+`Units were loaded from ${n.DomainName}.`,n.Units),e.EventProvider.raise(T.onUnitsLoadedEvent))})).catch((e=>{A.error(e)}))}function I(e){if(!E(e))throw new a.Error("Is not IBaEvent!");return{TimeStamp:null!=e.ts?new Date(e.ts):null,Type:e.e.t,State:e.e.s,IsActive:e.a,IsHistorical:e.h,LockPriority:e.l,Identifier:e.id,DeviceName:e.d,EventClassId:e.ecID,EventClassInstanceDescription:e.ecDesc,EventClassDescription:e.ecDesc}}function P(e){let t=[];for(let a=0;a<e.length;a++)t.push(I(e[a]));return t}function M(e){return null!=e.IsEvt&&"boolean"==typeof e.IsEvt}function V(e){return!!M(e)&&(null!=e.Evts||null!=e.EvPI||null!=e.C)}function L(e,t,i){if(null==n.BaStandardParameterInformation)throw new a.Error("BaStandardParameterInformation must be loaded before!");let s=new Map;if(null!=e)for(let r in e){let o=n.BaStandardParameterInformation.get(r);if(null==o){if(n.BaAdditionalParameterInformation.size>0){if(null==t||null==i)throw new a.Error("No device name or type name passed!");o=n.BaAdditionalParameterInformation.get(t)?.get(i)?.get(r)}if(null==o)throw new a.Error(`No parameter information found for BaParameter '${r}'!`)}let l={DataType:e[r].DT,Access:{Read:e[r].A[0],Write:e[r].A[1]},Info:o};void 0!==e[r].V&&(l.Value=e[r].V),void 0!==e[r].AT&&(l.ArrayType=e[r].AT),void 0!==e[r].C&&(l.Children=new Map,l.Children=e[r].C),s.set(r,l)}return s}function R(e,t){let a={SubjectInfo:e.SI,Identifier:e.Id,Purpose:e.Pu,OperationType:e.OT,NodeType:e.NT,InstancePath:e.IP,DataType:e.DT};return null!=e.P&&(a.Params=L(e.P)),null!=e.AP&&(a.AddParams=L(e.AP,t,e.T),a.TypeName=e.T),e.texts&&(a.texts=e.texts),a}function j(e,t){return{...R(e,t)}}function W(e,t){if(1!=e.IsEvt)throw new A("IsEvt must be true!");return{...R(e,t),IsEventEnabled:e.IsEvt}}function F(e,t){return{...W(e,t),Event:e.Ev}}function N(e,t){let a={...W(e,t)};if(null!=e.Evts&&(a.Events=e.Evts),null!=e.EvPI&&(a.EventsPerIcon=e.EvPI),null!=e.C){a.Children=new Map;for(let n in e.C){const i=e.C[n];V(i)?a.Children.set(n,N(i,t)):M(i)?a.Children.set(n,F(i,t)):a.Children.set(n,j(i,t))}}return a}n.BaSiteError=A,n.hasConnectedDevice=function(){if(null==t.BA.BaDevices)return!1;for(let e of t.BA.BaDevices.values())if(e.diagnostics.connectionState===t.BA.BaDevice.ConnectionState.connected)return!0;return!1},n.DefaultDiagnosticsDialogSize={height:500,width:500},n.openDiagnosticsWindow=function(){if(null!=S)return void S.open();const a=n.DomainName+"DiagnosticsList",i=new t.Logger({name:"OpenDiagnosticsWindow"}),s=[];function r(e){if(!e)return;let n={DataType:t.DataType.object,Children:new Map([[a+"-site-api-version",{DataType:t.DataType.string,Value:e.siteApiVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.BaSiteApiVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[a+"-compatible-site-server-version",{DataType:t.DataType.string,Value:e.compatibleSiteServerVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.CompatibleBaSiteServerVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[a+"-ads-dll-version",{DataType:t.DataType.string,Value:e.adsDllVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.AdsDllVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[a+"-tcHmi-srv-ext-version",{DataType:t.DataType.string,Value:e.tcHmiSrvExtVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.TcHmiSrvExtVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}]])},r={DataType:t.DataType.object,Children:new Map,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Devices,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]};for(let n in e.devices){let o=e.devices[n],l={Title:o.deviceName,DataType:t.DataType.object,Children:new Map};l.Children.set(`${a}-${n}-device-name`,{DataType:t.DataType.string,Value:o.deviceName,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.DeviceName,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}),l.Children.set(`${a}-${n}-address`,{DataType:t.DataType.string,Value:o.address,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Address,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}),l.Children.set(`${a}-${n}-connection-state`,{DataType:t.DataType.string,Value:o.connectionStateDescription,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.ConnectionState,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}),null!=o.nameSpace&&l.Children.set(`${a}-${n}-namespace`,{DataType:t.DataType.string,Value:o.nameSpace,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Namespace,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}),null!=o.components&&l.Children.set(`${a}-${n}-components`,{DataType:t.DataType.object,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Components,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}],Children:new Map([[`${a}-${n}components-bacnetRevision`,{DataType:t.DataType.string,Value:o.components.bacnetRevision,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.BACnetRevision,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}components-bacnetStackVersion`,{DataType:t.DataType.string,Value:o.components.bacnetStackVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.BACnetStackVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}components-tc3XBaVersion`,{DataType:t.DataType.string,Value:o.components.tc3XBaVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Tc3XBaVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}components-tc3Ba2CommonVersion`,{DataType:t.DataType.string,Value:o.components.tc3Ba2CommonVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Tc3Ba2CommonVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}components-tc3BACnetRev14Version`,{DataType:t.DataType.string,Value:o.components.tc3BACnetRev14Version,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Tc3BACnetRev14Version,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}components-siteServerVersion`,{DataType:t.DataType.string,Value:o.components.siteServerVersion,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.BaSiteServerVersion,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}]])}),null!=o.statistics&&l.Children.set(`${a}-${n}-statistics`,{DataType:t.DataType.object,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Statistics,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}],Children:new Map([[`${a}-${n}statistics-object-cnt`,{DataType:t.DataType.integer,Value:o.statistics.objectCount,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmountBaObjects,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}statistics-plant-cnt`,{DataType:t.DataType.integer,Value:o.statistics.plantCount,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmountPlants,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}-unused-trends`,{DataType:t.DataType.integer,Value:o.statistics.unusedTrendObjects,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmountUnusedTrendObjects,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}],[`${a}-${n}statistics-watched-ba-variables`,{DataType:t.DataType.integer,Value:o.statistics.watchedVariables,cbOnCreated:[e=>{s.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmountWatchedVariables,(a=>{i.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)})))}]}]])}),r.Children.set(n,l)}return n.Children.set(a+"-devices",r),n}let o=new t.Navigation.ParameterList(a,null).setAttributes({data:r(n.Diagnostics),layout:{height:100,heightUnit:"%",width:100,widthUnit:"%"}}),l=e.EventProvider.register(T.onDiagnosticsChanged,(()=>{o.setData(r(n.Diagnostics))})),d={appearance:{content:o.getElement(),buttons:t.Components.DialogWindow.Buttons.CancelSize,layout:{maxHeight:n.DefaultDiagnosticsDialogSize.height,maxWidth:n.DefaultDiagnosticsDialogSize.width}},callbacks:{cbClosed:()=>{l(),o.destroy(),S?.destroy(),S=void 0,s.forEach((e=>e()))}}};S=t.Components.DialogWindow.createDialogWindow(d)?.open(),s.push(t.Locale.Localization.watchText(t.Locale.LangKey.Diagnostics,(e=>{i.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&S?.setHeadlineText(tchmi_format_string(e.text,n.DomainName))})))},n.updateBaStandardParameterInformation=x,n.updateBaAdditionalParameterInformation=O,n.updateUnits=k,n.convertIBaEventServerResult=I,n.convertIBaEventServerResults=P,0==TCHMI_DESIGNER&&function i(){e.EventProvider.register(t.TcHmiBaEvents.onInitialized,(r=>{r.destroy();let o=!0;const l=e.Server.subscribeEx([{symbol:`${n.DomainName}.ListSymbolNames`,commandOptions:["SendErrorMessage"]}],a.SubscriptionCollector.Interval,{parallel:!1},(async i=>{if(null==i.results||1!=i.results.length)throw new t.BaseError("Server request failed!");const r=i.results[0];if(0!=r.error)return 1==n.extensionAvailable&&(n.extensionAvailable=!1,e.EventProvider.raise(T.onExtensionUnloaded)),void(0==n.SuppressNotAvailableLog&&t.Logger.info(n.DomainName+" is not available.\nWorking with BaObjects of TF8040 will not be possible."));{0==n.extensionAvailable&&(await n.UserManagement.LoadUserLevelGroupsAsync(),t.Logger.info(t.Logger.checkMark+`Current user level is '${t.BA.Role[n.UserManagement.getBaRole()]}'.`),n.extensionAvailable=!0,e.EventProvider.raise(T.onExtensionLoaded)),n.AvailableSymbolNames=r.value,t.Logger.info(t.Logger.checkMark+`Available symbol names on ${n.DomainName}: `,n.AvailableSymbolNames);const i=e.Server.subscribeEx([{symbol:n.DomainName+".Diagnostics"}],a.SubscriptionCollector.Interval,{parallel:!0},(async i=>{try{if(null==i.results||1!=i.results.length)throw new a.Error("Server request failed!");const s=i.results[0];if(0!=s.error)return void t.Logger.error("Reading Diagnostics failed!");const r=s.value;if(!r.devices||Object.keys(r.devices).length<=0)return;if("string"!=typeof r.siteApiVersion)throw new t.InvalidTypeError("SiteApiVersion",{actualType:typeof r.siteApiVersion,requiredType:"string"});if("string"!=typeof r.adsDllVersion)throw new t.InvalidTypeError("AdsDllVersion",{actualType:typeof r.adsDllVersion,requiredType:"string"});let l=!1,d=r.devices;if(n.Diagnostics.siteApiVersion!=r.siteApiVersion&&(n.Diagnostics.siteApiVersion=r.siteApiVersion,l=!0),n.Diagnostics.compatibleSiteServerVersion!=r.compatibleSiteServerVersion&&(n.Diagnostics.compatibleSiteServerVersion=r.compatibleSiteServerVersion,l=!0),n.Diagnostics.adsDllVersion!=r.adsDllVersion&&(n.Diagnostics.adsDllVersion=r.adsDllVersion,l=!0),n.Diagnostics.tcHmiSrvExtVersion!=r.tcHmiSrvExtVersion&&(n.Diagnostics.tcHmiSrvExtVersion=r.tcHmiSrvExtVersion,l=!0),null!=t.BA.BaDevices)for(let e in n.Diagnostics.devices)if(null==d[e]){const a=t.BA.BaDevices.get(e);null!=a&&(a.destroy(),delete n.Diagnostics.devices[e],t.BA.BaDevices.delete(e))}const h=[];for(let e in d)if(B(d[e])){n.Diagnostics.devices||(n.Diagnostics.devices={});let a=n.Diagnostics.devices[e];a?tchmi_equal(a,d[e])||(l=!0,a.connectionState!==t.BA.BaDevice.ConnectionState.connected&&d[e].connectionState===t.BA.BaDevice.ConnectionState.connected&&O(),n.Diagnostics.devices[e]=d[e],h.push(e)):(n.Diagnostics.devices[e]=d[e],t.BA.BaDevices||(t.BA.BaDevices=new Map),t.BA.BaDevices.has(e)||t.BA.BaDevices.set(e,new t.BA.BaDevice(e)),h.push(e),o||O(),l=!0)}else t.Logger.error("Runtimes diagnostics do not fit to IDeviceDiagnostics interface!");if(h.forEach((t=>e.EventProvider.raise(T.onRuntimeDiagnosticsChanged,d[t]))),null!=t.BA.BaDevices&&t.BA.BaDevices?.size>0&&(n.devicesLoaded=!0,e.EventProvider.raise(T.onBaDevicesLoaded)),o)return e.EventProvider.raise(T.onExtensionAvailable),t.Logger.debug(t.Logger.checkMark+`${n.DomainName} available.`,n.Diagnostics),e.EventProvider.raise(T.onDiagnosticsChanged,n.Diagnostics),void(o=!1);l&&(t.Logger.debug(`${n.DomainName} diagnostics have changed.`,n.Diagnostics),e.EventProvider.raise(T.onDiagnosticsChanged,n.Diagnostics))}catch(e){t.BaseError.warn(e)}}));let l,h=e.EventProvider.register(T.onExtensionAvailable,(()=>{h(),d().then((e=>{n.PeriodicallyUpdatedVariableIds.splice(0,n.PeriodicallyUpdatedVariableIds.length),null!=e&&e.forEach((e=>n.PeriodicallyUpdatedVariableIds.push(e)))})).catch((e=>{A.error(e)})),k(),x(),O(),l=e.EventProvider.register(t.TcHmiEvents.onLocaleChanged,(async()=>{try{let a=e.Locale.get();if(null==a)throw new t.NullOrUndefinedVariableError("newLocale");let n=t.BA.LanguageManager.EChoice.Invalid;a.indexOf("de")>-1&&a.indexOf("DE")>1?n=t.BA.LanguageManager.EChoice.de_DE:a.indexOf("en")>-1&&a.indexOf("US")>1&&(n=t.BA.LanguageManager.EChoice.en_US),await s(n),k(),x(),O()}catch(e){t.BaseError.warn(e)}}))}));e.EventProvider.register(t.TcHmiEvents.onWebSocketClosed,(t=>{t.destroy(),l&&l(),null!=i&&e.Server.unsubscribeEx(i,{parallel:!0})}))}}));e.EventProvider.register(t.TcHmiEvents.onWebSocketClosed,(t=>{t.destroy(),null!=l&&e.Server.unsubscribeEx(l,{parallel:!0}),i()}))}))}()}(a.BaSite||(a.BaSite={}))}(t.Server||(t.Server={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){!function(n){!function(i){async function s(t){const i={...t,userName:e.Server.getCurrentUserConfig().name};try{return await a.callServerFunctionAsync(n.DomainName+".SaveUserData",i)}catch(e){throw new a.Error(`Saving user data for user "${i.userName}" with subject "${i.subject}" failed!`,{cause:e})}}async function r(t){const i={...t,userName:e.Server.getCurrentUserConfig().name};try{const e=await a.callServerFunctionAsync(n.DomainName+".LoadUserData",i);if("string"==typeof e&&0==e.length)return;return e}catch(e){throw new a.Error(`Loading user data for user "${i.userName}" with subject "${i.subject}" failed!`,{cause:e})}}i.saveLastContentAsync=async function(e){return s({subject:"LastContent",data:{lastContentPath:e}})},i.loadLastContentAsync=async function(){return r({subject:"LastContent"})},i.saveLastThemeAsync=async function(e){return s({subject:"LastTheme",data:{lastTheme:e}})},i.loadLastThemeAsync=async function(){return r({subject:"LastTheme"})},i.saveTrendSettingsAsync=async function(e,t){return s({subject:"TrendSettings",data:{trendName:e,settings:t}})},i.loadTrendSettingsAsync=async function(e){return r({subject:"TrendSettings",data:{trendName:e}})},i.saveAxisOptionsAsync=async function(e,t){return s({subject:"AxisOptions",data:{axisName:e,options:t}})},i.loadAxisOptionsAsync=async function(e){return r({subject:"AxisOptions",data:{axisName:e}})},i.saveTrendCollectionAsync=async function(i,s){try{await a.callServerFunctionAsync(n.DomainName+".SaveTrendCollection",{trendCollectionName:i,userName:e.Server.getCurrentUserConfig().name,root:s.root,baObjects:s.baObjects})}catch(e){throw new t.BaseError(`Saving trend collection "${i}" failed!`,{cause:e})}},i.loadTrendCollectionsAsync=async function(){try{const i=await a.callServerFunctionAsync(n.DomainName+".LoadTrendCollections",{userName:e.Server.getCurrentUserConfig().name});if(null==i)throw new t.BaseError(`No trend collections have been returned from ${n.DomainName}!`);return i}catch(e){throw new t.BaseError("Loading trend collections failed!",{cause:e})}},i.deleteTrendCollectionAsync=async function(t){try{return await a.callServerFunctionAsync(n.DomainName+".DeleteTrendCollection",{trendCollectionName:t,userName:e.Server.getCurrentUserConfig().name})}catch(e){throw new a.Error(`Deleting trend collection "${t}" failed!`,{cause:e})}},i.saveTrendCollectionSelectionAsync=async function(e){return s({subject:"TrendCollectionSelection",data:{selectedTrendCollection:e}})},i.loadTrendCollectionSelectionAsync=async function(){return r({subject:"TrendCollectionSelection"})},i.deleteTrendCollectionSelectionAsync=async function(t){return async function(t){const i={...t,userName:e.Server.getCurrentUserConfig().name};try{return await a.callServerFunctionAsync(n.DomainName+".DeleteUserData",i)}catch(e){throw new a.Error(`Deleting user data for user "${i.userName}" with subject "${i.subject}" failed!`,{cause:e})}}({subject:"TrendCollectionSelection",data:{selectedTrendCollection:t}})},i.clearUserData=async function(){const t={userName:e.Server.getCurrentUserConfig().name};try{return await a.callServerFunctionAsync(n.DomainName+".ClearUserData",t)}catch(e){throw new a.Error(`Clearing user data of "${t.userName}" in "${n.DomainName}" failed!`,{cause:e})}}}(n.UserData||(n.UserData={}))}(a.BaSite||(a.BaSite={}))}(t.Server||(t.Server={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){!function(n){!function(i){let s=!0;const r=new Map;function o(){let a=e.Server.getCurrentUserConfig().userIsInGroups,n=t.BA.Role.Undefined;return a.some((e=>r.get(t.BA.Role.eInternal).includes(e)))?n=t.BA.Role.eInternal:a.some((e=>r.get(t.BA.Role.eExpert).includes(e)))?n=t.BA.Role.eExpert:a.some((e=>r.get(t.BA.Role.eAdvanced).includes(e)))?n=t.BA.Role.eAdvanced:a.some((e=>r.get(t.BA.Role.eBasic).includes(e)))?n=t.BA.Role.eBasic:a.some((e=>r.get(t.BA.Role.eGuest).includes(e)))?n=t.BA.Role.eGuest:TCHMI_DESIGNER||TCHMI_LIVEVIEW?n=t.BA.Role.eInternal:(n=t.BA.Role.eGuest,s&&(console.warn(`Current user has undefined group / access level! Please login a user! \nUser is now in group ${t.BA.Role[n]}!`),s=!1)),n}i.LoadUserLevelGroupsAsync=async function(){try{const e=await a.BaSite.getUserLevelGroupsAsync();if(null!=e){for(let[t,a]of e)r.set(t,a);t.Logger.info(t.Logger.checkMark+`User level groups were loaded from ${n.DomainName}.`,r)}}catch(e){n.BaSiteError.error(e)}},i.checkAccess=function(e){return o()>=e},i.getBaRole=o}(n.UserManagement||(n.UserManagement={}))}(a.BaSite||(a.BaSite={}))}(t.Server||(t.Server={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n{constructor(e,n,i,s){this.IsTop=!1,this.__watchedBaVariables=[],this.__propertyWatches=new Map,this.__isLoadingAttributes={includeChildren:!1,excludeChildren:!1,includeTexts:!1,excludeTexts:!1},this.__loadingAttributesReady={},this.__pendingRequestConstellations=[],this.logger=new t.Logger({name:n,className:this.constructor.name}),this.Mapping=n,this.Device=i,this.IsTop=1==s&&s,this.IsTop||null!=e.InstancePath||this.logger.error("Instance path of BaBasicObject was not set",this),this.InstancePath=e.InstancePath,this.IsTop?this.InstanceName=e.InstancePath:this.InstanceName=e.InstancePath.slice(e.InstancePath.lastIndexOf(".")+1,e.InstancePath.length),null==e.Identifier&&this.logger.error("Identifier of BaBasicObject was not set",this),this.Identifier=e.Identifier,this.IsTop&&(this.Identifier.ObjectType=a.ObjectType.eStructuredView),this.IdentifierEx={deviceName:this.Device.Description,instancePath:this.InstancePath}}get AllParams(){let e=[];if(null!=this.Params)for(let t of this.Params.values())e.push(t);if(null!=this.AddParams)for(let t of this.AddParams.values())e.push(t);return e}setAttributes(e){if(null!=e.SubjectInfo&&(this.SubjectInfo=e.SubjectInfo),null!=e.Purpose&&(this.Purpose=e.Purpose),null!=e.OperationType&&(this.OperationType=e.OperationType),null!=e.NodeType&&(this.NodeType=e.NodeType),this.IsTop&&(this.NodeType=a.NodeType.eBuilding),null!=e.DataType&&(this.DataType=e.DataType),null!=e.TypeName&&(this.TypeName=e.TypeName),null!=e.texts&&this.setTexts(e.texts),null!=e.Params){null==this.Params&&(this.Params=new Map);for(let t of e.Params.values())a.isBaTextAddressingParameter(t.Info.ID)&&null==t.Value&&null!=this.texts&&(t.Value=this.getAddressingText(t.Info.ID)),this.Params.has(t.Info.ID)||this.Params.set(t.Info.ID,new a.BaVariable(t,this))}if(null!=e.AddParams){null==this.AddParams&&(this.AddParams=new Map);for(let[t,n]of e.AddParams)this.AddParams.has(t)||this.AddParams.set(t,new a.BaVariable(n,this))}}setTexts(e){if(this.texts={description:e.description,instDescription:e.instDescription,objectName:e.objectName,instObjectName:e.instObjectName},null!=this.Params){const e=[a.BaParameterId.eDescription,a.BaParameterId.eInstDescription,a.BaParameterId.eObjectName,a.BaParameterId.eInstObjectName];for(const t of e){const e=this.Params.get(t);null!=e&&(e.Value=this.getAddressingText(t))}}if(this instanceof a.BaView&&null!=e.children)for(let[a,n]of this.Children){let i=e.children.get(a);if(null==i)throw new t.BaseError("Invalid texts have been set!");n.setTexts(i)}}getAddressingText(e){if(null==this.texts)throw new t.BaseError("Texts have not been loaded yet!");switch(e){case a.BaParameterId.eDescription:return this.texts.description;case a.BaParameterId.eInstDescription:return this.texts.instDescription;case a.BaParameterId.eObjectName:return this.texts.objectName;case a.BaParameterId.eInstObjectName:return this.texts.instObjectName;case a.BaParameterId.eSymbolPath:return this.InstancePath;case a.BaParameterId.eSymbolName:return this.InstanceName;default:throw new t.NotImplementedError("Not implemented BaParameterId!")}}async getContent(){return new Promise(((t,n)=>{if(null==this.__content){let n=e.Config.get().content,i=this.tryGetBaVariable(a.BaParameterId.eSymbolPath);if(null!=i){const e=()=>{this.__content=n.find((e=>e.url.indexOf(i.Value+".content")>-1))?.url,null==this.__content&&(this.__content=n.find((e=>e.url.indexOf(i.Value.replaceAll(".","_")+".content")>-1))?.url,null!=this.__content&&this.logger.warn("Underscores in names of contents regarding to BaObjects in the project structure must be replaced with dots.\nOld approach: MyProject_MAIN_MyObject.content\nNew approch: MyProject.MAIN.MyObject.content"),t(void 0)),t(this.__content)};null==i.Value?i.read().then((()=>{e()})):e()}}else t(this.__content)}))}getIconAttributes(){let e=null!=a.ObjectType[this.Identifier.ObjectType]?a.ObjectType[this.Identifier.ObjectType]:"";return t.Icons.convertIIconDataToIIconAttributes(t.Icons.ObjectType[e.slice(1,e.length)])}getSymbolExpression(){return new e.SymbolExpression(`%s%${this.Mapping}%/s%`)}getIsValid(e=!1,t=!1){if(!n.isIBaBasicObjectAttributes(this))return!1;if(e&&this instanceof a.BaView&&this.Children.size>0)for(let a of this.Children.values())if(!a.getIsValid(e,t))return!1;return!t||null!=this.texts}isTrendable(){if(!this.getIsValid())throw new t.BaseError("BaBasicObject has not been loaded yet. Make sure to call loadAttributes() first.");return t.Server.BaSite.PrimitveBaObjects.indexOf(this.Identifier.ObjectType)>-1&&this instanceof a.BaObject}get isNotValidText(){return`BaBasicObject '${this.InstancePath}' is not valid!`}checkParams(e,t,a,n=!1){if(!this.getIsValid(!1,!1))return a?.logger.warn("Checking for additional parameters is only possible if attributes have been loaded before. Please call loadAttributes() before."),!1;let i=!1;for(let a in e){let n=t[a],s=e[a];if(null==n){i=!1;break}if(s.optional)i=!0;else{if(i=!1,null!=this.AddParams)if(n.symbolName instanceof Array){for(let e of n.symbolName)if(this.AddParams.has(e)){i=!0;break}}else this.AddParams.has(n.symbolName)&&(i=!0);for(let e of this.Params.values())e.Info.InstanceName==n.symbolName&&(i=!0);if(0==i)break}}return!0===i?(this.__baInterfaceSymName=t,!0):(null!=a&&n&&this.alertInvalidTemplate(a.getId()),!1)}checkTemplate(e,t,n,i=!0){return this instanceof a.BaView?!!a.BaView.verifyTemplate(this,e,t)||(null!=n&&(this.logIncorrectTemplate(n.logger),i&&this.alertInvalidTemplate(n.getId())),!1):(null!=n&&(this.logIsNotBaView(n.logger),i&&this.alertInvalidTemplate(n.getId())),!1)}logIsNotBaView(e){e.warn("Invalid template! BaObject was not a BaView!",this)}alertInvalidTemplate(e,a=!0){let n=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.InvalidTemplateBound),e);t.Components.DialogWindow.alert(n,{skipLog:a})}logInvalidBaObject(e,a=!0){let n=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.InvalidBaObjectBound),e);a&&t.Components.DialogWindow.alert(n,{skipLog:!0}),this.logger.warn(n)}async loadAttributes(e=!1,i=!1){let s=0,r=()=>{e?(this.__isLoadingAttributes.includeChildren=!1,this.__loadingAttributesReady.includeChildren&&(this.__loadingAttributesReady.includeChildren.resolver.forEach((e=>e(this))),delete this.__loadingAttributesReady.includeChildren)):(this.__isLoadingAttributes.excludeChildren=!1,this.__loadingAttributesReady.excludeChildren&&(this.__loadingAttributesReady.excludeChildren.resolver.forEach((e=>e(this))),delete this.__loadingAttributesReady.excludeChildren)),i?(this.__isLoadingAttributes.includeTexts=!1,this.__loadingAttributesReady.includeTexts&&(this.__loadingAttributesReady.includeTexts.resolver.forEach((e=>e(this))),delete this.__loadingAttributesReady.includeTexts)):(this.__isLoadingAttributes.excludeTexts=!1,this.__loadingAttributesReady.excludeTexts&&(this.__loadingAttributesReady.excludeTexts.resolver.forEach((e=>e(this))),delete this.__loadingAttributesReady.excludeTexts));let t=this.__pendingRequestConstellations.indexOf(s);t>=0&&delete this.__pendingRequestConstellations[t]},o=t=>{e?(this.__isLoadingAttributes.includeChildren=!1,this.__loadingAttributesReady.includeChildren&&(this.__loadingAttributesReady.includeChildren.rejecter.forEach((e=>e(t))),delete this.__loadingAttributesReady.includeChildren)):(this.__isLoadingAttributes.excludeChildren=!1,this.__loadingAttributesReady.excludeChildren&&(this.__loadingAttributesReady.excludeChildren.rejecter.forEach((e=>e(t))),delete this.__loadingAttributesReady.excludeChildren)),i?(this.__isLoadingAttributes.includeTexts=!1,this.__loadingAttributesReady.includeTexts&&(this.__loadingAttributesReady.includeTexts.rejecter.forEach((e=>e(t))),delete this.__loadingAttributesReady.includeTexts)):(this.__isLoadingAttributes.excludeTexts=!1,this.__loadingAttributesReady.excludeTexts&&(this.__loadingAttributesReady.excludeTexts.rejecter.forEach((e=>e(t))),delete this.__loadingAttributesReady.excludeTexts));let a=this.__pendingRequestConstellations.indexOf(s);a>=0&&delete this.__pendingRequestConstellations[a]};return new Promise(((l,d)=>{e?(this.__isLoadingAttributes.includeChildren&&(this.__loadingAttributesReady.includeChildren||(this.__loadingAttributesReady.includeChildren={resolver:[],rejecter:[]}),this.__loadingAttributesReady.includeChildren.resolver.push(l),this.__loadingAttributesReady.includeChildren.rejecter.push(d)),this.__isLoadingAttributes.includeChildren=!0,s+=1):(this.__isLoadingAttributes.excludeChildren&&(this.__loadingAttributesReady.excludeChildren||(this.__loadingAttributesReady.excludeChildren={resolver:[],rejecter:[]}),this.__loadingAttributesReady.excludeChildren.resolver.push(l),this.__loadingAttributesReady.excludeChildren.rejecter.push(d)),this.__isLoadingAttributes.excludeChildren=!0,s+=2),i?(this.__isLoadingAttributes.includeTexts&&(this.__loadingAttributesReady.includeTexts||(this.__loadingAttributesReady.includeTexts={resolver:[],rejecter:[]}),this.__loadingAttributesReady.includeTexts.resolver.push(l),this.__loadingAttributesReady.includeTexts.rejecter.push(d)),this.__isLoadingAttributes.includeTexts=!0,s+=3):(this.__isLoadingAttributes.excludeTexts&&(this.__loadingAttributesReady.excludeTexts||(this.__loadingAttributesReady.excludeTexts={resolver:[],rejecter:[]}),this.__loadingAttributesReady.excludeTexts.resolver.push(l),this.__loadingAttributesReady.excludeTexts.rejecter.push(d)),this.__isLoadingAttributes.excludeTexts=!0,s+=4),this.__pendingRequestConstellations.includes(s)||(this.__pendingRequestConstellations.push(s),n.isIBaBasicObjectAttributes(this)&&this.getIsValid(e,i)?this.getIsValid(e,i)?(l(this),r()):this.loadTextsAsync(e).then((()=>{l(this),r()})).catch((e=>{d(e),o(e)})):t.Server.BaSite.getBaObjectAsync(this,e,i).then((t=>{if(this.getIsValid(e,i)&&n.isIBaBasicObjectAttributes(this))l(this),r();else{let e=new a.BaBasicObject.Error(`Loading attributes of BaBasicObject with mapping '${this.Mapping}' was not successfull.`);d(e),o(e)}})).catch((e=>{d(e),o(e)})))}))}async loadTextsAsync(e=!1){if(null==this.texts)try{const a=await t.Server.BaSite.getBaObjectTextsAsync(this,e);this.setTexts(a)}catch(e){throw e}}updateObjectInfo(){return new Promise(((e,n)=>{if(this.IsTop||!this.getIsValid())return e();let i=0;t.Server.BaSite.PeriodicallyUpdatedVariableIds.forEach((t=>{let a=this.tryGetBaVariable(t);a&&null!=a.Value&&(i++,a.read().then((()=>{a?.invokeNoWatchCallbacks(),i--,0==i&&0==s&&e()})).catch((e=>n(e))))}));let s=0;for(let n=0;n<this.AllParams.length;n++)if(a.BaVariable.isIBaEnumeratingParameterInfo(this.AllParams[n].Info)){let a=this.AllParams[n];s++,a.updateValueRangeAsync().then((()=>{s--,0==i&&0==s&&e()})).catch((e=>{t.BaseError.warn(e,this.logger)}))}0==i&&0==s&&e()}))}watchProperty(e,a){let n=this.__propertyWatches.get(e);null==n&&(n={callbacks:new Map},n.subscriptionId=t.Server.subscriptionCollector.add(this.Mapping+"::"+e,(a=>{if(this[e]="Event"==e?t.Server.BaSite.convertIBaEventServerResult(a):"Events"==e||"EventHistory"==e?t.Server.BaSite.convertIBaEventServerResults(a):a,n)for(let t of n.callbacks.values())t(this[e])})),this.__propertyWatches.set(e,n)),n=this.__propertyWatches.get(e);let i=0;for(;n.callbacks.has(i);)i++;n.callbacks.set(i,a);let s=this[e];return null!=s&&a(s),i}stopWatchProperty(e,t){let a=this.__propertyWatches.get(e);null!=a&&(a.callbacks.delete(t),0===a.callbacks.size&&this.stopAllWatchesProperty(e))}stopAllWatchesProperty(e){let a=this.__propertyWatches.get(e);null!=a&&(null!=a.subscriptionId&&t.Server.subscriptionCollector.remove(a.subscriptionId),this.__propertyWatches.delete(e))}tryGetBaVariable(e){if(this.getIsValid()){let t;if("number"==typeof e)t=this.Params.get(e);else{for(let a of this.Params.values())if(a.InstanceName===e){t=a;break}if(null==t){const a=null!=this.__baInterfaceSymName?this.__baInterfaceSymName[e].symbolName:void 0;if(null==this.__baInterfaceSymName||null==a)return void this.logger.warn("Getting an additional parameter is only possible after calling checkAddParams()!");if(null==this.AddParams)return;if(a instanceof Array){for(let e of a)if(t=this.AddParams.get(e),t)break}else t=this.AddParams?.get(a);if(null==t)for(let n of this.Params.values()){if(n.InstanceName===e){t=n;break}if(null!=a&&n.InstanceName===a){t=n;break}}}}return t}this.logger.warn("BaBasicObject is not valid. Please load attributes first!")}tryReadBaVariable(e){return new Promise(((t,a)=>{let n=this.tryGetBaVariable(e);void 0!==n?n.read().then((e=>t(e))).catch((e=>a(e))):a(this.logger.warn(`BaVariable '${String(e)}' was not found.`))}))}async tryWriteBaVariableValueAsync(e,t,a){let n=this.tryGetBaVariable(e);return null!=n&&(n.write(t,a),!0)}tryWriteBaVariableValue(e,t,a){let n=this.tryGetBaVariable(e);return null!=n&&(n.write(t,a),!0)}tryWatchBaVariable(e,t){let n=this.tryGetBaVariable(e);if(void 0!==n)return this.__watchedBaVariables.includes(n.InstanceName)||this.__watchedBaVariables.push(n.InstanceName),{InstanceName:n.InstanceName,WatchId:n.watch(t)};{let n;return n="number"==typeof e?a.BaParameterId[e]:e,this.logger.warn(`Variable with id '${n}' is not available!`,this),void t(void 0)}}stopWatchBaVariable(e){if(this.__watchedBaVariables.includes(e.InstanceName)){let t=this.tryGetBaVariable(e.InstanceName);t.stopWatch(e.WatchId),t.watchesCount()||(this.__watchedBaVariables=this.__watchedBaVariables.filter((t=>t!==e.InstanceName)))}}stopAllWatchesBaVariable(e){let t=this.tryGetBaVariable(e);if(null!=t&&this.__watchedBaVariables.includes(t.InstanceName)){let t=this.tryGetBaVariable(e);t.stopAllWatches(),this.__watchedBaVariables=this.__watchedBaVariables.filter((e=>e!==t.InstanceName))}}stopAllWatches(){for(let e=0;e<this.__watchedBaVariables.length;e++){this.tryGetBaVariable(this.__watchedBaVariables[e]).stopAllWatches()}this.__watchedBaVariables=[];for(let e of this.__propertyWatches.keys())this.stopAllWatchesProperty(e),this.__propertyWatches.delete(e)}openParameterDialog(i="Parameter"){if(this.__parameterDialog){switch(i){case"Parameter":this.__parameterDialog.setContent(this.__baVarList?.getElement());break;case"Events":this.__eventList&&this.__parameterDialog.setContent(this.__eventList?.getElement())}let e=this.__parameterDialog.controlContainer.getControl("special-visu-toggle");e&&e.setToggleState(!1),this.__parameterDialog.open()}else{if(!this.getIsValid())return this.logger.warn("Opening of BaBasicObjects parameter dialog failed, because it is not valid. Make sure to call loadAttributes() before.",this),null;this.IsTop&&this.logger.warn(`Project structure of device '${this.Device.Description}' does not have any parameter. Parameter window will not have any entries!`),this.__baVarList||(this.__baVarList=new t.Navigation.ParameterList(this.InstancePath+"-ba-var-list",null).setAttributes({valueHandler:{autoWrite:!1},autoCollapse:n.AutoCollapseParameterCategories})),this.__baVarList.getElement().css({position:"relative",height:"100%",width:"100%"});const s=new Map,r=this.AllParams.filter((e=>e.HasPrimitiveValue&&e.DataType!=t.DataType.array&&e.DataType!=t.DataType.object&&-1===a.HiddenBaParameterIds.indexOf(e.ID)&&t.Server.BaSite.UserManagement.checkAccess(e.Access.Read)));for(const[e,n]of a.BaParameterCategories){const i=r.filter((t=>t.Category===e));if(0===i.length)continue;let o=s.get(a.BaParameterCategory[e]),l=o?.Children;null==l&&(l=new Map),null==o&&(o={DataType:t.DataType.object,Title:t.Helper.String.toLanguageKey(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey["ParameterCategory"+t.Helper.String.capitalizeFirstLetter(a.BaParameterCategory[e])])),Children:l},s.set(a.BaParameterCategory[e],o));for(const e of n)if(e!=a.BaParameterId.Additional){const t=i.find((t=>t.ID===e));null!=t&&l.set(t.InstanceName,t)}else for(const t of i.filter((t=>t.ID===e)))l.set(t.InstanceName,t)}this.__baVarList.setData({DataType:t.DataType.object,Title:this.InstancePath,Children:s});let o=[];if(a.Helper&&a.Helper.hasSpecialVisu(this)){let e;o.push({name:"special-visu-toggle",type:t.Components.ComponentType.ToggleButton,callback:t=>{this.__parameterDialog?.controlContainer.getControl("event-list-toggle")?.setToggleState(!1),t?(e||(e=a.Helper.getSpecialVisu(this,null,this.__parameterDialog,!0)),this.__baVarList.getElement().detach(),this.__parameterDialog?.setContent(e)):(e?.detach(),this.__parameterDialog?.setContent(this.__baVarList.getElement()))},settings:{iconPath:t.Icons.Standard.Right_Arrow.path}})}if((this instanceof a.BaEventObject||this instanceof a.BaView)&&(t.Controls.Management.EventList?(this.__eventList=e.ControlFactory.createEx("TcHmi.BuildingAutomation.Controls.Management.EventList",this.InstancePath+"-event-list",null,e.View.get()),this.__eventList&&(this.__eventList?.getElement().detach(),this.__eventList.getElement().css({position:"relative",height:"100%",width:"100%"}),this.__eventList.setBaObject(this),o.push({name:"event-list-toggle",type:t.Components.ComponentType.ToggleButton,callback:e=>{this.__parameterDialog?.controlContainer.getControl("special-visu-toggle")?.setToggleState(!1),e?(this.__baVarList.getElement().detach(),this.__parameterDialog?.setContent(this.__eventList.getElement())):(this.__eventList.getElement().detach(),this.__parameterDialog?.setContent(this.__baVarList.getElement()))},settings:{iconPath:t.Icons.Events.Event.Alarm.path,toggleState:"Events"===i}}))):this.logger.debug("Control BuildingAutomation.Controls.EventList is not available. If you want to use EventLists include TcHmiBaControls.")),this.isTrendable()||this instanceof a.BaTrendObject||this instanceof a.BaView&&(this.getTrendableObjects().length>0||this.getBaTrendObjects().length>0)){let e=t.Components.ContextMenu.createContextMenuAndButton({id:this.InstancePath+"-context-menu",rowEntryOptions:[]});if(e.button.iconHandler.setAttributes({iconPath:"/"+t.Icons.Standard.Graph.path,iconHeight:80,iconHeightUnit:"%",iconWidth:80,iconWidthUnit:"%"}),o.push(e.button),this.__trendSettingsContextMenu=e,this instanceof a.BaView&&this.getTrendableObjects().length>0||this.isTrendable()){let i=null;e.menu.addRowEntry({cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.NewLiveTrend,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))},onPressed:async()=>{try{e?.menu.close();let s,r=await t.Charting.Trend.createBaOnlineTrendAsync(this);if(r){r.getElement().addClass("tchmi-ba-trend-in-dialog").css({position:"relative",height:"100%",width:"100%"});let e={appearance:{content:r.getElement(),buttons:t.Components.DialogWindow.Buttons.CancelSize,layout:{maxHeight:n.DefaultOnlineTrendDialogSize.height,maxWidth:n.DefaultOnlineTrendDialogSize.width,right:0,bottom:0}},callbacks:{cbClosed:()=>{r.destroy(),null!=s&&this.stopWatchBaVariable(s)}},behaviour:{destroyOnClose:!0}};i||(i=t.Components.DialogWindow.createDialogWindow(e),s=this.tryWatchBaVariable(a.BaParameterId.eDescription,(e=>{i?.getHeadline().textHandler.setText("Online Trend | "+e)})),i?.controlContainer.addControl(r.getMenuButton())),i?.open()}}catch(e){t.BaseError.warn(e,this.logger)}}})}}let l,d=()=>{for(let e of this.AllParams)void 0!==e.editedValue&&(e.write(e.editedValue),delete e.editedValue)},h=()=>{this.__baVarList.closeAllEntries(),this.__baVarList.destroy(),delete this.__baVarList,this.__eventList?.destroy(),delete this.__eventList,this.__trendSettingsContextMenu?.menu.destroy(),this.__trendSettingsContextMenu?.button.destroy(),delete this.__trendSettingsContextMenu,this.__parameterDialog?.destroy(),delete this.__parameterDialog,null!=l&&this.stopWatchBaVariable(l)},_={appearance:{content:"Events"===i?this.__eventList?.getElement():this.__baVarList?.getElement(),buttons:t.Components.DialogWindow.Buttons.OkCancelSize,headerIcon:n.DisableParameterDialogHeaderIcon?null:this.getIconAttributes(),layout:{width:n.DefaultParameterDialogWidth},modal:!1,controls:o},callbacks:{cbClosed:h,cbConfirmed:d}};if(this.__parameterDialog=t.Components.DialogWindow.createDialogWindow(_)?.open(),this.IsTop){let e=t.Locale.Localization.getText(t.Locale.LangKey.ProjectStructure);this.__parameterDialog?.getHeadline().textHandler.setText(e+" "+this.Device.Description)}else l=this.tryWatchBaVariable(a.BaParameterId.eInstDescription,(e=>{this.__parameterDialog?.getHeadline().textHandler.setText(e)}))}return this.__parameterDialog}matchesTextFilter(e,t){if(this.texts){0===t.length&&(t=n.DefaultTextFilterIds);for(let n=0;n<t.length;n++)switch(t[n]){case a.BaParameterId.eInstDescription:if(this.texts.instDescription.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eDescription:if(this.texts.description.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eInstObjectName:if(this.texts.instObjectName.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eObjectName:if(this.texts.objectName.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eSymbolPath:if(this.InstancePath.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;default:console.warn("Filter option not implemented yet!")}return!1}return this.logger.warn("BaBasicObject texts have not been loaded. Please looad text first by calling loadTexts()!"),!1}hasSpecialVisu(){return!this.IsTop&&(this instanceof a.BaTrendObject||this.Identifier.ObjectType===a.ObjectType.eSchedule||this.Identifier.ObjectType===a.ObjectType.eCalendar)}checkParameterAccess(e,t){let a=this.tryGetBaVariable(e);return null==a?(this.logger.warn(`´BaObject does not has a variable with id or name '${String(e)}'`,this),!1):a.checkUserAccess(t)}checkManualValueWriteAccess(){if(this.getIsValid()){if(this.OperationType===a.OperationType.eDisplayValue)return!1;if(this.Params.has(a.BaParameterId.eEnManualRm)&&this.checkParameterAccess(a.BaParameterId.eEnManualRm,a.Scope.write)){if(this.checkParameterAccess(a.BaParameterId.eValManualRm,a.Scope.write))return!0}else{if(this.Params.has(a.BaParameterId.eOutOfService)&&this.checkParameterAccess(a.BaParameterId.eOutOfService,a.Scope.write))return!1;if(this.Params.has(a.BaParameterId.ePresentValue)&&this.checkParameterAccess(a.BaParameterId.ePresentValue,a.Scope.write))return!0}}return!1}destroy(){this.stopAllWatches();for(let e of this.AllParams.values())e.destroy()}static getNodeTypeIcon(e){let n=a.NodeType[e];return t.Icons.convertIIconDataToIIconAttributes(t.Icons.NodeType[n.slice(1,n.length)])}static convertToMap(e){if(!(e instanceof Map)){let t=new Map;if(e instanceof Array)for(let a=0;a<e.length;a++)t.set(a.toString(),e[a]);else for(let a in e)t.set(a,e[a]);return t}return e}}a.BaBasicObject=n,function(e){function n(e){let t=!0;if(null!=e&&"object"==typeof e){if(e instanceof Map){for(let n of e.values())if(!a.BaVariable.isIBaVariableAttributes(n)){t=!1;break}}else for(let n in e)if(!a.BaVariable.isIBaVariableAttributes(e[n])){t=!1;break}}else t=!1;return t}e.isIBaBasicObjectAttributes=function(e){let i=!0;if(null!=e&&"object"==typeof e){let s=new Map;s.set("Identifier",a.isBaIdentifier),s.set("Purpose",["number",()=>e.Purpose>0]),s.set("OperationType",["number",()=>e.OperationType>-1]),s.set("NodeType",["number",()=>e.NodeType>-1]),s.set("DataType",["number",()=>e.DataType>-1]),null!=e.Params&&s.set("Params",n),t.TypeGuards.validateProperties(e,s)||(i=!1)}else i=!1;return i},e.isBaObjectVariables=n,e.DisableParameterDialogHeaderIcon=!1,e.DefaultParameterDialogWidth=800,e.DefaultOnlineTrendDialogSize={height:250,width:450},e.AutoCollapseParameterCategories=!1,e.DefaultTextFilterIds=[a.BaParameterId.eInstDescription,a.BaParameterId.eInstObjectName,a.BaParameterId.eSymbolPath];class i extends t.BaseError{constructor(e,t){super(e,t)}}e.Error=i}(n=a.BaBasicObject||(a.BaBasicObject={}));a.BaEventEnabledObjectHandling=class{constructor(e){this.__watchEventsPerIconCallbacks=[],this.__owner=e}watchEventsPerIcon(e){throw new t.NotImplementedError("watchEventsPerIcon")}stopWatchEventsPerIcon(e){let t=this.__watchEventsPerIconCallbacks;null!=t&&(t.splice(e,1),0===t.length&&this.stopAllEventsPerIconWatches())}stopAllEventsPerIconWatches(){this.__watchEventsPerIconCallbacks=[]}async acknowledgeAsync(){return t.Server.BaSite.acknowledgeBaObjectAsync(this.__owner)}},a.isIBaEventEnabledAttributes=function(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("IsEventEnabled","boolean"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a}}(t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){const a="AssignedToTrendEntry",n="AssignedToTrendCb",i="ReferredTrend",s="ReferredObject";class r extends t.BaBasicObject{constructor(e,t,a,n){super(e,t,a,n)}__addMenuEntryReferredTrend(){this.getReferringObjectsAsync().then((s=>{if(null==s)this.logger.warn("No referencing objects found!");else{let r=this.__trendSettingsContextMenu?.menu.getRowEntry(a)?.controlContainer.getControl(n);r&&(r.setState(s.length>0),s.length>0&&this.__trendSettingsContextMenu?.menu.addRowEntry({name:i,cbOnCreated:t=>{e.Locale.Localization.watchText(e.Locale.LangKey.ReferringTrend,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text+" "+e.Globals.HTMLSymbols.Link)}))},onPressed:async()=>{if(this.__trendSettingsContextMenu?.menu.close(),s.length>0){s.length>1&&await e.Components.DialogWindow.alert(`Object has ${s.length} referring objects. Only the first will be shown.`);let a=s[0].OwnerObject;if(a instanceof t.BaTrendObject){let n=a.InstancePath+"-trend",i=1;for(;e.Globals.CreatedBaseNodes.has(n);)n=a.InstancePath+"-trend-"+i,i++;let s=new e.Charting.Trend(n,null);s.baObjectHandler.setBaObject(a);let r=e.Components.DialogWindow.createDialogWindow({appearance:{content:s.getElement(),controls:s.getMenuButton(),modal:!1,buttons:e.Components.DialogWindow.Buttons.CancelSize},callbacks:{cbClosed:()=>{s.destroy()}},behaviour:{destroyOnClose:!0}})?.open();a.tryReadBaVariable(t.BaParameterId.eDescription).then((e=>{r?.setHeadlineText(e)})).catch((t=>{e.BaseError.warn(t,this.logger)})),s.getElement().addClass("tchmi-ba-trend-in-dialog")}}}}))}})).catch((t=>{e.BaseError.warn(t,this.logger)}))}setAttributes(e){super.setAttributes(e)}async getReferringObjectsAsync(){return e.Server.BaSite.getReferringObjectsAsync(this)}openParameterDialog(t="Parameter"){if(super.openParameterDialog(t),this.isTrendable()){if(null!=this.__trendSettingsContextMenu?.menu.getRowEntry(i))return this.__parameterDialog;this.isTrendable()&&this.getIsValid()&&(this.__trendSettingsContextMenu?.menu.layoutHandler.setAttributes({width:150,widthUnit:"px"}),this.__trendSettingsContextMenu?.menu.addRowEntry([{name:a,controls:{type:e.Components.ComponentType.Checkbox,name:n,settings:{readOnly:!1,textAttributes:{horizontalAlignment:"Center"}},cbOnCreated:t=>{e.Locale.Localization.watchText(e.Locale.LangKey.AssignedToTrend,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&(t.setActiveText(a.text),t.setInactiveText(a.text))}))},callback:async t=>{this.__trendSettingsContextMenu?.menu.close();let s=this.__trendSettingsContextMenu?.menu.getRowEntry(a)?.controlContainer.getControl(n);if(t)if(await e.Components.DialogWindow.confirm(e.Locale.Localization.getText(e.Locale.LangKey.ConfirmAssignToTrend))){let t=this.__trendSettingsContextMenu.menu.busyHandler.setBusy("Assigning to trend.");e.Server.BaSite.assignBaObjectToUnusedTrendAsync(this).catch((t=>{e.BaseError.warn(t,this.logger)})).finally((()=>{t(),this.__addMenuEntryReferredTrend()}))}else s?.setState(!t);else await e.Components.DialogWindow.confirm(e.Locale.Localization.getText(e.Locale.LangKey.ConfirmRemoveFromTrend))?(e.Server.BaSite.removeBaObjectFromAssignedTrendsAsync(this).catch((t=>{e.BaseError.warn(t,this.logger)})),this.__trendSettingsContextMenu?.menu.removeRowEntry(i)):s?.setState(!t)}}}]),this.__addMenuEntryReferredTrend())}return this.__parameterDialog}}t.BaObject=r;class o extends r{constructor(e,t,a,n){super(e,t,a,n)}setAttributes(t){super.setAttributes(t),this.eventHandler=new o.EventHandling(this),null!=t.Event&&(e.Server.BaSite.isIBaEventServerResult(t.Event)&&(t.Event=e.Server.BaSite.convertIBaEventServerResult(t.Event)),t.Event instanceof l?this.Event=t.Event:this.Event=new l(t.Event,this))}destroy(){super.destroy(),this.eventHandler.stopAllEventsPerIconWatches(),null!=this.Event&&this.Event.destroy()}}t.BaEventObject=o,function(e){e.isIBaEventObjectAttributes=function(e){return t.isIBaEventEnabledAttributes(e)};class a extends t.BaEventEnabledObjectHandling{constructor(e){super(e)}watchEventsPerIcon(e){if(!this.__eventWatchIds){let e;this.__eventWatchIds={};let a=this.__owner.tryGetBaVariable(t.BaParameterId.eStatusFlags);a&&(this.__eventWatchIds.statusFlags=a.watch((a=>{null==this.__activeEvents&&(this.__activeEvents=new Map),null!=a&&(e=this.__activeEvents.get(t.EventCondition.eFlagOutOfService),a.OutOfService?e||this.__activeEvents.set(t.EventCondition.eFlagOutOfService,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1}):this.__activeEvents.delete(t.EventCondition.eFlagOutOfService),e=this.__activeEvents.get(t.EventCondition.eFlagOverridden),a.Overridden?e||this.__activeEvents.set(t.EventCondition.eFlagOverridden,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1}):this.__activeEvents.delete(t.EventCondition.eFlagOverridden),null!=this.__watchEventsPerIconCallbacks&&d.invokeEventCallbacks(this.__activeEvents,this.__watchEventsPerIconCallbacks))}))),this.__owner.Event&&(this.__eventWatchIds.event=this.__owner.Event.watch((a=>{if(null==this.__activeEvents&&(this.__activeEvents=new Map),null!=a){if(a.IsActive&&a.Type>t.EventType.Invalid){e=this.__activeEvents.get(a.Type),e?e.eMostPriorisedState=a.State:this.__activeEvents.set(a.Type,{eMostPriorisedState:a.State,nCount:1});for(let e=t.EventCondition.eLockPrioLocalMedium;e<=t.EventCondition.eLockPrioHigh;e++)this.__activeEvents.delete(e);switch(a.LockPriority){case t.LockPriority.eLocalMedium:this.__activeEvents.set(t.EventCondition.eLockPrioLocalMedium,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.LockPriority.eLocalHigh:this.__activeEvents.set(t.EventCondition.eLockPrioLocalHigh,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.LockPriority.eMedium:this.__activeEvents.set(t.EventCondition.eLockPrioMedium,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.LockPriority.eLocalHigh:this.__activeEvents.set(t.EventCondition.eLockPrioHigh,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1})}}else{for(let e=t.EventCondition.eTypeAlarm;e<=t.EventCondition.eTypeOther;e++)this.__activeEvents.delete(e);for(let e=t.EventCondition.eLockPrioLocalMedium;e<=t.EventCondition.eLockPrioHigh;e++)this.__activeEvents.delete(e)}null!=this.__watchEventsPerIconCallbacks&&d.invokeEventCallbacks(this.__activeEvents,this.__watchEventsPerIconCallbacks)}})));let n=this.__owner.tryGetBaVariable(t.BaParameterId.eActivePriority);n&&(this.__eventWatchIds.activePrio=n.watch((e=>{if(null==this.__activeEvents&&(this.__activeEvents=new Map),null!==e){for(let e=t.EventCondition.ePrioLifeSafety;e<=t.EventCondition.ePrioManualRemote;e++)this.__activeEvents.delete(e);switch(e){case t.Priority.eCritical:this.__activeEvents.set(t.EventCondition.ePrioCritical,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.Priority.eLifeSafety:this.__activeEvents.set(t.EventCondition.ePrioLifeSafety,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.Priority.eManualLocal:this.__activeEvents.set(t.EventCondition.ePrioManualLocal,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.Priority.eManualRemote:this.__activeEvents.set(t.EventCondition.ePrioManualRemote,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1})}null!=this.__watchEventsPerIconCallbacks&&d.invokeEventCallbacks(this.__activeEvents,this.__watchEventsPerIconCallbacks)}})))}return null!=this.__activeEvents&&e(this.__activeEvents),this.__watchEventsPerIconCallbacks.push(e),this.__watchEventsPerIconCallbacks.length-1}stopAllEventsPerIconWatches(){if(!this.__eventWatchIds)return;let e=this.__owner.tryGetBaVariable(t.BaParameterId.eStatusFlags);e&&null!=this.__eventWatchIds.statusFlags&&e.stopWatch(this.__eventWatchIds.statusFlags),this.__owner.Event&&null!=this.__eventWatchIds.event&&this.__owner.Event.stopWatchEvent(this.__eventWatchIds.event);let a=this.__owner.tryGetBaVariable(t.BaParameterId.eActivePriority);a&&null!=this.__eventWatchIds.activePrio&&a.stopWatch(this.__eventWatchIds.activePrio),delete this.__eventWatchIds,super.stopAllEventsPerIconWatches()}}e.EventHandling=a}(o=t.BaEventObject||(t.BaEventObject={}));t.BaTrendObject=class extends o{constructor(e,t,a,n){super(e,t,a,n)}openParameterDialog(a="Parameter"){super.openParameterDialog(a);let n=this.tryGetBaVariable(t.BaParameterId.eReferencedParam);return n&&n.read().then((t=>{let a=this.__trendSettingsContextMenu?.menu.getRowEntry(s);null==a&&(a=this.__trendSettingsContextMenu?.menu.addRowEntry({name:s,cbOnCreated:t=>{e.Locale.Localization.watchText(e.Locale.LangKey.ReferredObject,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text+" "+e.Globals.HTMLSymbols.Link)}))},onPressed:()=>{if(null!=t)t?.ReferenceObject.openParameterDialog("Parameter");else{let t=tchmi_format_string(e.Locale.Localization.getText(e.Locale.LangKey.TrendWithNoReferencedObject),this.InstancePath);e.Components.DialogWindow.alert(t)}this.__trendSettingsContextMenu?.menu.close()}})),null==t&&null!=a&&a.setIsEnabled(!1)})),this.__parameterDialog}};class l{constructor(t,a){this.__watchEventCallbacks=[],this.TimeStamp=t.TimeStamp,this.Type=t.Type,this.State=t.State,this.IsHistorical=t.IsHistorical,this.LockPriority=t.LockPriority,this.Identifier=t.Identifier,this.DeviceName=t.DeviceName,this.IsActive=t.IsActive,this.EventClassId=t.EventClassId,this.EventClassInstanceDescription=t.EventClassInstanceDescription,this.EventClassDescription=t.EventClassDescription,this.RefObject=a,this.__logger=new e.Logger({name:this.RefObject.Mapping+e.Logger.arrowRight+"Event"})}watch(t){return null==this.__eventSubscriptionId&&(this.__eventSubscriptionId=e.Server.subscriptionCollector.add(this.RefObject.Mapping+"::Events",(t=>{if(0!=t.length){if(1!=t.length)throw new Error("Length of Events of an BaObject must be 1!");for(let a=0;a<this.__watchEventCallbacks.length;a++)this.__watchEventCallbacks[a](e.Server.BaSite.convertIBaEventServerResult(t[0]))}}))),this.__watchEventCallbacks.push(t),this.__watchEventCallbacks.length-1}stopWatchEvent(e){this.__watchEventCallbacks.splice(e,1),0===this.__watchEventCallbacks.length&&this.stopAllEventsPerIconWatches()}stopAllEventsPerIconWatches(){null!=this.__eventSubscriptionId&&(e.Server.subscriptionCollector.remove(this.__eventSubscriptionId),delete this.__eventSubscriptionId),this.__watchEventCallbacks=[]}acknowledge(){this.RefObject.getIsValid()&&this.State>=t.EventCondition.eTypeAlarm&&this.State<=t.EventCondition.eTypeOther&&e.Server.BaSite.acknowledgeBaObjectAsync(this.RefObject)}destroy(){this.stopAllEventsPerIconWatches()}}let d;t.BaEvent=l,function(a){a.isBaEvent=function(a){let n=!0;if(null!=a&&"object"==typeof a){let i=new Map;i.set("TimeStamp","date"),i.set("Type","number"),i.set("State","number"),i.set("IsActive","boolean"),i.set("IsHitorical","boolean"),i.set("LockPriority","number"),i.set("Identifier",t.isBaIdentifier),i.set("DeviceName","string"),e.TypeGuards.validateProperties(a,i)||(n=!1)}else n=!1;return n}}(l=t.BaEvent||(t.BaEvent={})),function(a){a.MaximumEventCondition=new Map([[t.Role.eGuest,t.EventCondition.eEventIconDisplayed],[t.Role.eBasic,t.EventCondition.eEventIconDisplayed],[t.Role.eAdvanced,t.EventCondition.eEventIconDisplayed],[t.Role.eExpert,t.EventCondition.eEventIconDisplayed],[t.Role.eInternal,t.EventCondition.eEventIconDisplayed]]),a.invokeEventCallbacks=function(n,i){if(null!=n){const s=new Map;for(let i=t.EventCondition.eTypeAlarm;i<=a.MaximumEventCondition.get(e.Server.BaSite.UserManagement.getBaRole());i++){const e=n.get(i);null!=e&&s.set(i,e)}for(let e=0;e<i.length;e++)i[e](s)}}}(d=t.EventHelper||(t.EventHelper={}))}(e.BA||(e.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n{constructor(i,s,r){if(this.__watchCallbacks=new Map,this.__noWatchCallbacks=new Map,this.Value=i.Value,this.Info=i.Info,this.DataType=i.DataType,null!=i.ArrayType&&(this.ArrayType=i.ArrayType),this.Access=i.Access,this.RefObject=s,null==r){let n="Params";this.ID==a.BaParameterId.Additional&&(n="AddParams"),this.__originalMapping=`${this.RefObject.Mapping}::${n}::${this.InstanceName}`,this.ID!=a.BaParameterId.Additional?this.__destroyOnBaParameterInformationLoaded=e.EventProvider.register(t.Server.BaSite.Events.onBaStandardParameterInformationLoaded,(()=>{const e=t.Server.BaSite.BaStandardParameterInformation.get(this.InstanceName);this.Info=e})):this.__destroyOnBaParameterInformationLoaded=e.EventProvider.register(t.Server.BaSite.Events.onBaAdditionalParameterInformationLoaded,(()=>{const e=t.Server.BaSite.BaAdditionalParameterInformation.get(this.RefObject.Device.Description).get(this.RefObject.TypeName).get(this.InstanceName);this.Info=e})),this.Mapping=this.__originalMapping+"::Value"}else this.Mapping=r.Mapping+"::"+this.InstanceName;this.__symbol=new e.Symbol(t.Helper.String.toSymbolExpression(this.Mapping+"|Timeout=120000|ReadWriteGroup=8040","s")),this.logger=new t.Logger({name:this.Mapping});for(const[e,t]of a.BaParameterCategories)if(t.indexOf(this.ID)>-1){this.__category=e;break}if(null!=i.Children){let e=a.BaObject.convertToMap(i.Children);this.Children=new Map;for(let[t,a]of e)this.Children.set(t,new n(a,s,this))}}get ID(){return this.Info.ID}get InstanceName(){return this.Info.InstanceName}get HasPrimitiveValue(){return this.Info.HasPrimitiveValue}get Title(){return this.Info.Title}get Category(){return this.__category}checkUserAccess(e){switch(e){case a.Scope.read:return t.Server.BaSite.UserManagement.checkAccess(this.Access.Read);case a.Scope.write:return t.Server.BaSite.UserManagement.checkAccess(this.Access.Write);default:throw new t.BaseError("Invalid scope!")}}async getValueRangeAsync(){return new Promise(((e,a)=>{null!=n.__requestedValueRanges&&null!=n.__valueRangeResolvers&&null!=n.__valueRangeRejecters||(n.__requestedValueRanges=[],n.__valueRangeResolvers=new Map,n.__valueRangeRejecters=new Map,setTimeout((async()=>{if(null==n.__requestedValueRanges)throw new t.BaseError("BaVariables must be avaibale here.");if(null==n.__valueRangeResolvers)throw new t.BaseError("Resolvers must be avaibale here.");if(null==n.__valueRangeRejecters)throw new t.BaseError("Rejecters must be avaibale here.");try{const e=[];n.__requestedValueRanges.forEach((t=>e.push(t)));const a=new Map;n.__valueRangeResolvers.forEach(((e,t)=>a.set(t,e))),n.__requestedValueRanges=void 0,n.__valueRangeResolvers=void 0;const i=await t.Server.BaSite.getValueRangesAsync(e);for(let[e,n]of i){let i=a.get(e);if(null==i)throw new t.BaseError("No resolver found for BaVariable!");if(i(n),null!=e.__valueRangeCallbacks)for(let t of e.__valueRangeCallbacks.values())t(null,n)}}catch(e){for(let[t,a]of n.__valueRangeRejecters){let i=new n.Error("Getting value range failed!",t,{cause:e});if(a(i),null!=t.__valueRangeCallbacks)for(let e of t.__valueRangeCallbacks.values())e(i)}}}),n.GetValueRangeWaitTime)),n.__requestedValueRanges.includes(this)||(n.__requestedValueRanges.push(this),n.__valueRangeResolvers.set(this,e),n.__valueRangeRejecters.set(this,a))}))}async updateValueRangeAsync(){try{null!=this.__valueRangeCallbacks&&await this.getValueRangeAsync()}catch(e){throw new n.Error("Updating value range failed!",this,{cause:e})}}watchValueRange(e){null==this.__valueRangeCallbacks&&(this.__valueRangeCallbacks=new Map);let t=0;for(;this.__valueRangeCallbacks.has(t);)t++;return this.__valueRangeCallbacks.set(t,e),this.updateValueRangeAsync().then((()=>{})).catch((t=>{e(t)})),()=>{this.__valueRangeCallbacks&&this.__valueRangeCallbacks.delete(t),0===this.__valueRangeCallbacks?.size&&delete this.__valueRangeCallbacks}}getDecoratingInfoAsync(){return t.Server.BaSite.getDecoratingInfoAsync(this)}getPropertyMapping(e){if(null==this.__originalMapping)throw new n.Error("Property mappings can not be created for children of structured BaVariables.",this);return this.__originalMapping+"::"+e}toExpression(){return t.Helper.String.toSymbolExpression(this.Mapping,"s")}watch(e){null==this.__subscriptionIdentifier&&this.RefObject.Device.diagnostics.connectionState===a.BaDevice.ConnectionState.connected&&(n.__isPeriodicallyUpdatedVariable(this.ID)?null==this.Value&&this.read().then((e=>{this.Value=e,this.invokeNoWatchCallbacks()})):this.__subscriptionIdentifier=this.__createSubscription()),null!=this.Value&&e(this.Value);let t=0;if(n.__isPeriodicallyUpdatedVariable(this.ID)){for(;this.__noWatchCallbacks.has(t);)t++;this.__noWatchCallbacks.set(t,e)}else{for(;this.__watchCallbacks.has(t);)t++;this.__watchCallbacks.set(t,e)}return t}invokeNoWatchCallbacks(){if(this.__noWatchCallbacks.size>0)for(let e of this.__noWatchCallbacks.values())e(this.Value)}stopWatch(e){n.__isPeriodicallyUpdatedVariable(this.ID)?(this.__noWatchCallbacks.delete(e),0===this.__noWatchCallbacks.size&&this.stopAllWatches()):(this.__watchCallbacks.delete(e),0===this.__watchCallbacks.size&&this.stopAllWatches())}stopAllWatches(){this.__stopSubscription(),n.__isPeriodicallyUpdatedVariable(this.ID)?this.__noWatchCallbacks=new Map:this.__watchCallbacks=new Map,delete this.__valueRangeCallbacks}watchesCount(){return this.__watchCallbacks.size}read(){return new Promise(((n,i)=>{this.RefObject instanceof a.BaBasicObject&&this.__symbol.readEx2({forceParallel:!0},(a=>{t.TcHmiError.hasError(a.details)||null==a.value?(console.error(e.Log.buildMessage(a.details)),i({msg:`Reading variable '${this.Mapping} failed!'`,data:a})):this.__processValue(a.value).then((e=>{this.Value=e,n(this.Value)})).catch((e=>i(e)))}))}))}write(i,s){e.Server.writeSymbol(this.Mapping,i,(e=>{this.logger.checkServerResult(t.Logger.Severity.error,e,!1)&&(s&&s(e),n.__isPeriodicallyUpdatedVariable(this.ID)&&this.RefObject instanceof a.BaBasicObject&&this.RefObject.updateObjectInfo())}))}destroy(){this.stopAllWatches(),this.__destroyOnBaParameterInformationLoaded&&this.__destroyOnBaParameterInformationLoaded(),this.__symbol.destroy()}__processValue(e){return new Promise(((i,s)=>{if(null!=e)switch(this.ID){case a.BaParameterId.eLogBuffer:let r=[];for(let a=0;a<e.length;a++){let n=e[a];"string"==typeof n.TimeStamp&&(n.TimeStamp=new Date(n.TimeStamp)),r.push(n),null==n.Value||this.DataType===t.DataType.boolean&&!1!==n.Value&&!0!==n.Value&&console.error("Log buffer with data class binary has invalid value entry!")}return void i(r);case a.BaParameterId.eReferencedParam:return void n.processBaObjectParameter(e).then((e=>{i(e)})).catch((e=>s(e)));default:return void i(e)}else i(void 0)}))}__createSubscription(){return t.Server.subscriptionCollector.add(this.Mapping,(e=>{this.__processValue(e).then((e=>{if(this.Value=e,this.__watchCallbacks.size>0)for(let e of this.__watchCallbacks.values())e(this.Value)}))}))}__stopSubscription(){this.__subscriptionIdentifier&&(t.Server.subscriptionCollector.remove(this.__subscriptionIdentifier),delete this.__subscriptionIdentifier)}static processBaObjectParameter(e){return new Promise(((n,i)=>{let s=a.BaDevices?.get(e.ReferenceObject.D)?.findBaObject(e.ReferenceObject.Id),r=a.BaDevices?.get(e.OwnerObject.D)?.findBaObject(e.OwnerObject.Id);if(!s)return t.Logger.warn(`BaObject was found in device ${e.ReferenceObject.D}!`,{identifier:e.ReferenceObject.Id}),void n(void 0);if(!r)return t.Logger.warn(`BaObject was found in device ${e.OwnerObject.D}!`,{identifier:e.OwnerObject.Id}),void n(void 0);let o=!1,l=!1,d=()=>{if(o&&l){if(s?.getIsValid()&&r?.getIsValid()){let t={ReferenceObject:s,ReferenceObjectIdentifier:e.ReferenceObjectIdentifier,ReferencedParameter:e.ReferencedParameter,OwnerObject:r};return void n(t)}n(void 0)}else;};s.loadAttributes().then((()=>{o=!0,d()})),r.loadAttributes().then((()=>{l=!0,d()}))}))}static __isPeriodicallyUpdatedVariable(e){return t.Server.BaSite.PeriodicallyUpdatedVariableIds.indexOf(e)>-1}}a.BaVariable=n,function(e){function n(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("Title","string"),n.set("ID","number"),n.set("HasPrimitiveValue","boolean"),n.set("InstanceName","string"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a}e.isIBaParameterInfo=n,e.isIBaDecoratedParameterInfo=function(e){let a=!0;if(n(e)){let n=new Map;n.set("Decorated",["string","number"]),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},e.isIBaDecoratingParameterInfo=function(e){let a=!0;if(n(e)){let n=new Map;n.set("Decorating","boolean"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},e.isIBaEnumeratedParameterInfo=function(e){let a=!0;if(n(e)){let n=new Map;n.set("Enumerated","object"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},e.isIBaEnumeratingParameterInfo=function(e){let a=!0;if(n(e)){let n=new Map;n.set("Enumerating","boolean"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},e.isIBaVariableAttributes=function(e){let i=!0;if(null!=e&&"object"==typeof e){let s=new Map;s.set("Access",a.isBaScope),s.set("DataType","number"),s.set("Info",n),t.TypeGuards.validateProperties(e,s)||(i=!1)}else i=!1;return i},e.GetValueRangeWaitTime=200;class i extends t.BaseError{constructor(e,t,a){super(e=e+"\n"+`BaVariable: ${t.Mapping}`,a)}}e.Error=i}(n=a.BaVariable||(a.BaVariable={}))}(t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.BaBasicObject{constructor(e,t,a,n){super(e,t,a,n),this.__template={isVerified:!1,verificationResult:!1}}setAttributes(n){if(super.setAttributes(n),this.eventHandler=new a.EventHandling(this),null!=n.Children){null==this.Children&&(this.Children=new Map);for(let[i,s]of n.Children){let n=this.Children.get(i);if(null==n){if(a.isIBaViewAttributes(s))n=new a(s,this.Mapping+"::Children::"+i,this.Device);else if(s.Identifier.ObjectType===t.ObjectType.eTrend){if(!t.BaEventObject.isIBaEventObjectAttributes(s))throw new e.BaseError("Trend objects must always have IBaEventObjectAttributes!");n=new t.BaTrendObject(s,this.Mapping+"::Children::"+i,this.Device)}else n=t.BaEventObject.isIBaEventObjectAttributes(s)?new t.BaEventObject(s,this.Mapping+"::Children::"+i,this.Device):new t.BaObject(s,this.Mapping+"::Children::"+i,this.Device);this.Children.set(i,n)}n.setAttributes(s)}}if(null!=n.Events&&n.Events.length>0){if(e.Server.BaSite.isIBaEventServerResult(n.Events[0])){let a=[];for(let i=0;i<n.Events.length;i++){let s=e.Server.BaSite.convertIBaEventServerResult(n.Events[i]),r=t.BaDevices?.get(s.DeviceName);if(!r)throw new e.BaseError("Device should be available at this point!");let o=r.findBaObject(s.Identifier);if(!(o instanceof t.BaEventObject))throw new t.BaBasicObject.Error("Not a BaEventObject!");a.push(new t.BaEvent(s,o))}n.Events=a}this.Events=n.Events}this.eventHandler.setAttributes(n)}getIsValid(e=!1,t=!1){return super.getIsValid(e,t)}getIconAttributes(){let e=super.getIconAttributes();if(0==a.DisableNodeTypeIcons){let a=this.NodeType;if(null!=a){let n=t.BaBasicObject.getNodeTypeIcon(a);null!=n&&(e=n)}}return e}updateObjectInfo(){return new Promise(((e,t)=>{let a=0;for(let n of this.Children.values())a++,n.updateObjectInfo().then((()=>{a--,0===a&&e()})).catch((e=>t(e)));a++,super.updateObjectInfo().then((()=>{a--,0===a&&e()})).catch((e=>t(e)))}))}openParameterDialog(t="Parameter"){return super.openParameterDialog(t),this.__trendSettingsContextMenu?.menu.addRowEntry([{onPressed:async()=>{try{this.__trendSettingsContextMenu?.menu.close(),await e.Charting.Trend.CollectionConfigurator.openAsync({baView:this,modal:!1})}catch(t){e.BaseError.warn(t,this.logger)}},cbOnCreated:t=>{e.Locale.Localization.watchText(e.Locale.LangKey.NewTrendCollection,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)}))}},{onPressed:async()=>{try{if(this.__trendSettingsContextMenu?.menu.close(),null!=e.Charting.Trend.CollectionView.showsTrendCollections())await e.Charting.Trend.CollectionView.openAsync();else{const t=await e.Charting.Trend.CollectionConfigurator.selectCollectionAsync();null!=t&&await e.Charting.Trend.CollectionView.openAsync(t)}}catch(t){e.BaseError.warn(t,this.logger)}},cbOnCreated:t=>{e.Locale.Localization.watchText(e.Locale.LangKey.TrendCollections,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)}))}}]),this.getBaTrendObjects().length>0&&this.__trendSettingsContextMenu?.menu.addRowEntry({cbOnCreated:t=>{e.Locale.Localization.watchText(e.Locale.LangKey.Trends,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)}))},onPressed:()=>{this.__trendSettingsContextMenu?.menu.close();let t=new e.Charting.Trend(this.InstancePath+"-trends",null);t.getElement().css({position:"relative",height:"100%",width:"100%"}),t.baObjectHandler.setBaObject(this),e.Components.DialogWindow.openDialogWindow({appearance:{content:t.getElement(),controls:t.getMenuButton(),modal:!0,buttons:e.Components.DialogWindow.Buttons.Cancel,headline:{textAttributes:{text:this.texts?.description}}},callbacks:{cbClosed:()=>{t.destroy()}},behaviour:{destroyOnClose:!0}}),t.getElement().addClass("tchmi-ba-trend-in-dialog")}}),this.__parameterDialog}filterChildren(e){let t=[];for(const n of this.Children.values())e(n)&&t.push(n),n instanceof a&&(t=t.concat(n.filterChildren(e)));return t}findChildBySubjectInfoIdentifier(t){if(!this.getIsValid())return this.logger.warn(e.Logger.crossMark+"BaObject is not valid yet.\nLoad attributes including children before looking for children."),null;for(let a of this.Children.values()){if(!a.getIsValid())return this.logger.warn(e.Logger.crossMark+"BaObject is not valid yet.\nLoad attributes including children before looking for children."),null;if(a.SubjectInfo.Identifier===t)return a}return null}getTrendableObjects(){let a=[];if(this instanceof t.BaView)for(let n of this.Children.values())n instanceof t.BaView&&(a=a.concat(n.getTrendableObjects())),e.Server.BaSite.PrimitveBaObjects.indexOf(n.Identifier.ObjectType)>-1&&a.push(n);return a}getBaTrendObjects(){let e=[];if(this instanceof t.BaView)for(let a of this.Children.values())a instanceof t.BaView&&(e=e.concat(a.getBaTrendObjects())),a instanceof t.BaTrendObject&&e.push(a);return e}getTemplateChild(e){if(null==this.__template.description)return null;let t=this.__template.description[e],n=t?.identifier;if(null==n)return null;let i=n.split("::"),s=0,r=this;do{if(!(r instanceof a))return this.logger.warn(`BaObject can not have children.\nDo not use parameter name in BaTemplateDescription (${t.identifier}).\n`,{rootBaView:this,baObject:r}),null;if(r=r.Children.get(i[s]),null==r)return null;s++}while(s<i.length);return r}static verifyTemplate(t,i,s){if(tchmi_equal(i,t.__template.definition)||(t.__template.definition=i,t.__template.isVerified=!1),!tchmi_equal(s,t.__template.description)){t.__template.isVerified=!1,t.__template.description={};for(let e in t.__template.definition){if(!t.__template.definition[e].optional&&null==s[e])return t.logger.warn(`Template description does not fit to template definition! Element '${e}' is missing in template description!`,{templateDefinition:t.__template.definition,passedDescription:s}),t.__template.description=void 0,!1;{let a=s[e];null!=a&&(t.__template.description[e]=a)}}}if(t.__template.isVerified)return t.__template.verificationResult;if(null==t.__template.definition)return t.logger.warn("Template definition must be set before verifying a template."),!1;if(null==t.__template.description)return t.logger.warn("Template description must be set before verifying a template."),!1;t.__template.isVerified=!0,t.__template.verificationResult=!0;for(let i in t.__template.definition){let s=t.__template.definition[i];if(s.optional)continue;let r=t.__template.description[i];if(!r){t.__template.verificationResult=!1,t.logger.warn(`Template definition defines element '${i}' which is not known in template description.`,{templateDescription:t.__template.description,templateDefintion:t.__template.definition});break}let o=t.getTemplateChild(i);if(!o){t.__template.verificationResult=!1,t.__template.verificationErrorMessage=e.Locale.LangKey.TemplateChildNotFound,t.__template.incorrectObjectKey=i;break}if(n(s)&&a.isBaTemplateDescriptionWithSubTemplate(r)){if(!(o instanceof a)){t.__template.verificationResult=!1,t.__template.verificationErrorMessage=e.Locale.LangKey.TemplateChildNotABaView,t.__template.incorrectObjectKey=i;break}if(!a.verifyTemplate(o,s.subTemplate,r.subTemplate)){t.__template.verificationResult=!1;break}}else o instanceof a&&(t.__template.verificationResult=!1,t.__template.verificationErrorMessage=e.Locale.LangKey.TemplateChildNotABaObject,t.__template.incorrectObjectKey=i)}return t.__template.verificationResult}static getTemplates(t,n,i){if(e.BaInterfaceHandler.isBaInterfaceDefinition(n)&&e.BaInterfaceHandler.isBaInterfaceSymbolNames(i)){let e=[];for(let[a,s]of t.Children)s.checkParams(n,i)&&e.push(s);return e}if(e.BaInterfaceHandler.isBaInterfaceDefinition(n)||e.BaInterfaceHandler.isBaInterfaceSymbolNames(i))throw new e.BaseError("Invalid combination of function parameters was passed into BaView.getTemplates()!");{let e=[];for(let[s,r]of t.Children)r instanceof a&&(a.verifyTemplate(r,n,i)&&e.push(r),e=e.concat(a.getTemplates(r,n,i)));return e}}async logIncorrectTemplate(t){let a={templateDescription:this.__template.description,boundTemplate:this,templateDefinition:this.__template.definition};null!=this.__template.verificationErrorMessage&&null!=this.__template.incorrectObjectKey&&(a.verificationResult=tchmi_format_string(e.Locale.Localization.getText(this.__template.verificationErrorMessage),this.__template.incorrectObjectKey)),t.warn("Bound BaView does not fit to the given BaTemplateDefinition.",a)}destroy(){super.destroy(),this.eventHandler.stopAllEventsPerIconWatches();for(let e of this.Children.values())e.destroy()}}function n(e){return"object"==typeof e.subTemplate}t.BaView=a,function(a){a.isIBaViewAttributes=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("Children",[()=>t.Children instanceof Map]),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},a.isBaViewChildren=function(e){let a=!0;if(null!=e&&"object"==typeof e){if(e instanceof Map){for(let n of e.values())if(!t.BaBasicObject.isIBaBasicObjectAttributes(n)){a=!1;break}}else for(let n in e)if(!t.BaBasicObject.isIBaBasicObjectAttributes(e[n])){a=!1;break}}else a=!1;return a},a.DisableNodeTypeIcons=!1;class i extends t.BaEventEnabledObjectHandling{constructor(e){super(e)}setAttributes(e){if(null!=e.EventsPerIcon)for(let t in e.EventsPerIcon){let a=Number(t);isNaN(a)||(this.__activeEvents=new Map,this.__activeEvents.set(a,e.EventsPerIcon[t]))}}watchEventsPerIcon(a){return this.__watchEventsPerIconCallbacks.push(a),this.__eventSubscriptionId||(this.__eventSubscriptionId=e.Server.subscriptionCollector.add(this.__owner.Mapping+"::EventsPerIcon",(e=>{this.__activeEvents=new Map;for(let t in e){let a=Number(t);isNaN(a)||this.__activeEvents.set(a,e[t])}this.__watchEventsPerIconCallbacks.length>0&&t.EventHelper.invokeEventCallbacks(this.__activeEvents,this.__watchEventsPerIconCallbacks)}))),null!=this.__activeEvents&&a(this.__activeEvents),this.__watchEventsPerIconCallbacks.length-1}stopAllEventsPerIconWatches(){null!=this.__eventSubscriptionId&&(e.Server.subscriptionCollector.remove(this.__eventSubscriptionId),delete this.__eventSubscriptionId),super.stopAllEventsPerIconWatches()}}a.EventHandling=i,a.isBaTemplateDescriptionWithSubTemplate=function(e){return n(e)},a.isBaTemplateDescription=function(e){if("object"!=typeof e)return!1;for(let t in e)if("string"!=typeof e[t].identifier)return!1;return!0}}(a=t.BaView||(t.BaView={}))}(e.BA||(e.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){let n;!function(e){e.onDeviceLoaded="onBaDeviceLoaded",e.onAllDevicesLoaded="onAllBaDevicesLoaded"}(n=a.Events||(a.Events={}));class i{constructor(n){this.__eventDestroyFunctions={},this.projectStructureLoaded=i.ProjectStructureLoadingStatus.invalid,this.__disconnectedReported=!1,this.__connectedReported=!1,this.logger=new t.Logger({name:n}),a.BaDevices?.has(n)?this.logger.error("Device was already created"):(this.Description=n,this.eventNames={onConnectionStateChanged:this.Description+"ConnectionStateChangedEvent",onDiagnosticsChanged:this.Description+"DiagnosticsChangedEvent",onProjectStructureLoaded:this.Description+"ProjectStructureLoadedEvent"},this.__eventDestroyFunctions.destroyOnRuntimeDiagnosticsChanged=e.EventProvider.register(t.Server.BaSite.Events.onRuntimeDiagnosticsChanged,((e,t)=>this.__onDiagnosticsChanged(t))))}findBaObject(e,t){if(this.diagnostics.connectionState!==i.ConnectionState.connected)return this.logger.warn(`Can not find BaObject because connection state is '${i.ConnectionState[this.diagnostics.connectionState]}'!`),null;if(!this.projectStructureLoaded)return this.logger.warn("Unable to find BaObject because the ProjectStructure has not been loaded yet. Wait for eventNames.onProjectStructureLoaded!"),null;let n=null;if(t||(t=this.ProjectStructure),"string"==typeof e){if(e.indexOf("::")>-1){if(t.Mapping===e)return t}else if(t.InstancePath===e)return t}else{if(!a.isBaIdentifier(e))throw new Error("Invalid instance was passed to findBaObject!");if(t.Identifier.InstanceID===e.InstanceID&&t.Identifier.ObjectType===e.ObjectType)return t}if(t instanceof a.BaView)for(let[a,i]of t.Children)if(n=this.findBaObject(e,i),n)return n;return n}validate(){return this.diagnostics.connectionState===i.ConnectionState.connected&&i.validateProjectStructure(this.ProjectStructure)}static validateProjectStructure(e){if(e instanceof a.BaView){if(e.Children.size>0)return!0}else if(null!=e.Children&&e.Children.size>0)return!0;return t.Logger.error(t.Logger.crossMark+"Project strucutre is empty!"),!1}updateObjectInfo(){return new Promise(((e,t)=>{this.projectStructureLoaded!=i.ProjectStructureLoadingStatus.loaded&&t("Project structure not loaded!"),this.ProjectStructure.updateObjectInfo().then((()=>{e()})).catch((e=>t({msg:`Updating object info of device '${this.Description}' failed!`,reason:e})))}))}async __onDiagnosticsChanged(s){if(null==s)return void this.logger.error(t.Logger.crossMark+"No device diagnostics send from server. Check server log!");if(s.deviceName!=this.Description)return;const r=this.diagnostics?.connectionState;if(this.diagnostics=s,e.EventProvider.raise(this.eventNames.onDiagnosticsChanged,s),r!=this.diagnostics?.connectionState){switch(s.connectionState){case i.ConnectionState.error:case i.ConnectionState.unknown:case i.ConnectionState.disconnected:TCHMI_DESIGNER||this.__disconnectedReported||(this.__disconnectedReported=!0,this.__connectedReported=!1,t.Components.DialogWindow.alert(t.Logger.crossMark+`Device '${this.Description}' is not available. Connection state: ${i.ConnectionState[s.connectionState]}`,{callbacks:{cbOnCreated:e=>{i.DialogConnectionAutoCloseStateChanged&&(this.__deviceNotAvailableAlert=e)},cbClosed:()=>{delete this.__deviceNotAvailableAlert}}}));break;case i.ConnectionState.disabled:case i.ConnectionState.disconnecting:case i.ConnectionState.connecting:this.logger.warn(t.Logger.crossMark+`Device '${this.Description}' is not available. Connection state: ${i.ConnectionState[s.connectionState]}`);break;case i.ConnectionState.connected:if(null!=r){if(!TCHMI_DESIGNER&&!this.__connectedReported)if(i.DialogConnectionAutoCloseStateChanged&&this.__deviceNotAvailableAlert?.close(),this.__connectedReported=!0,this.__disconnectedReported=!1,i.DialogConnectionAutoReloadOnReconnect){let e,a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ReloadPageAfterDeviceReconnect),this.Description,i.ConnectionState[s.connectionState],i.DialogConnectionAutoReloadOnReconnectTime),n=i.DialogConnectionAutoReloadOnReconnectTime;const r=setInterval((()=>{n-=1,a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ReloadPageAfterDeviceReconnect),this.Description,i.ConnectionState[s.connectionState],n),e?.textHandler.setText(a),0==n&&location.reload()}),1e3);t.Components.DialogWindow.confirm(this.logger.info(a),{callbacks:{cbOnTextBlockCreated:t=>{e=t}}}).then((e=>{e?location.reload():clearInterval(r)}))}else{let e=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmDeviceAvailableReloadPage),this.Description,i.ConnectionState[s.connectionState]);await t.Components.DialogWindow.confirm(this.logger.info(e))&&location.reload()}}else this.logger.info(t.Logger.checkMark+`Device '${this.Description}' is available. Connection state: ${i.ConnectionState[s.connectionState]}.`),this.__disconnectedReported=!1;break;default:throw new t.BaseError("Invalid ConnectionState!")}e.EventProvider.raise(this.eventNames.onConnectionStateChanged,s)}null==this.ProjectStructure&&s.connectionState===i.ConnectionState.connected&&(this.projectStructureLoaded=i.ProjectStructureLoadingStatus.loading,t.Server.BaSite.AvailableSymbolNames.indexOf(this.Description)>-1?t.Server.BaSite.getBaDeviceAsync({DeviceName:this.Description,LoadChildren:!1}).then((s=>{if(null!=s&&null!=s.ProjectStructure&&void 0!==s.ProjectStructure.Children){if(null==this.ProjectStructure){i.validateProjectStructure(s.ProjectStructure)?(this.ProjectStructure=new a.BaView(s.ProjectStructure,this.Description+"::"+t.Server.BaSite.ProjectStructureName,this,!0),this.ProjectStructure.setAttributes(s.ProjectStructure),this.validate()?(this.projectStructureLoaded=i.ProjectStructureLoadingStatus.loaded,this.logger.info(t.Logger.checkMark+`ProjectStructure of device '${this.Description}' loaded.`,this.ProjectStructure)):this.projectStructureLoaded=i.ProjectStructureLoadingStatus.failed):(this.logger.error("Device is not valid!"),this.projectStructureLoaded=i.ProjectStructureLoadingStatus.failed),e.EventProvider.raise(this.eventNames.onProjectStructureLoaded,this),e.EventProvider.raise(n.onDeviceLoaded,this);let r=!0;a.BaDevices.forEach((e=>{e.projectStructureLoaded<=i.ProjectStructureLoadingStatus.invalid&&(r=!1)})),r&&e.EventProvider.raise(n.onAllDevicesLoaded)}}else this.logger.error(`Passed ProjectStructure for device ${this.Description} is not a BaView!`)})).catch((e=>{t.BaseError.error(e,this.logger)})):console.error(`No mapping was created for device ${this.Description}! Make sure to map the complete device ${this.Description}!`))}destroy(){for(let e in this.__eventDestroyFunctions)this.__eventDestroyFunctions[e]()}}a.BaDevice=i,function(e){let a,n;!function(e){e[e.disabled=-2]="disabled",e[e.unknown=-1]="unknown",e[e.connecting=0]="connecting",e[e.connected=1]="connected",e[e.disconnecting=2]="disconnecting",e[e.disconnected=3]="disconnected",e[e.error=4]="error"}(a=e.ConnectionState||(e.ConnectionState={})),function(e){e[e.invalid=-1]="invalid",e[e.loading=0]="loading",e[e.loaded=1]="loaded",e[e.failed=2]="failed"}(n=e.ProjectStructureLoadingStatus||(e.ProjectStructureLoadingStatus={})),e.DialogConnectionAutoCloseStateChanged=!0,e.DialogConnectionAutoReloadOnReconnect=!0,e.DialogConnectionAutoReloadOnReconnectTime=30;class i extends t.BaseError{constructor(e,a,n){if(e.includes(i.__deviceNamePlaceHolder)){if(null==a)throw new t.BaseError("Device name must be set when using place holders in message!");e=e.replaceAll(i.__deviceNamePlaceHolder,a)}else e=`BaDevice: ${a}\n`+e;super(e,n)}}i.__deviceNamePlaceHolder="{deviceName}",e.Error=i;e.InvalidConnectionStateError=class extends i{constructor(e,t,n){let i=`BaDevice '{deviceName}' is not connected! Connection state: ${a[e.diagnostics.connectionState]}.\n`;null!=t&&(i+=t),super(i,e.Description,n)}}}(i=a.BaDevice||(a.BaDevice={}))}(t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(e){this.__baObject=null,this.__loadBaChildren=!1,this.__loadTexts=!1,this.__baObjectSymbolExpression=null,this.__owner=e}isLoadingBaObject(){return new Promise(((e,t)=>{this.__isLoadingBaObject?(null==this.__loadingReadyResolver&&(this.__loadingReadyResolver=[]),this.__loadingReadyResolver.push(e)):e(!1)}))}destroy(){this.__stopAllWatches(),null!=this.__destroyOnDeviceConnectionStateChanged&&(this.__destroyOnDeviceConnectionStateChanged(),delete this.__destroyOnDeviceConnectionStateChanged)}set loadChildren(e){this.__loadBaChildren=e}set loadTexts(e){this.__loadTexts=e}get baObject(){return this.__baObject}set baVariable(e){this.__baVariable=e}get baVariable(){return this.__baVariable}get baObjectSymbolExpression(){return this.__baObjectSymbolExpression}setBaObject(e,n){if(TCHMI_DESIGNER)return this;if(void 0===e||tchmi_equal(e,this.__baObject))return this;if(null==e)return this.__setBaObjectInternal(null,n),this;if(e instanceof t.BA.BaBasicObject&&e.getIsValid(this.__loadBaChildren,this.__loadTexts))return this.__setBaObjectInternal(e,n),this;this.__isLoadingBaObject=!0;let i=this.__owner.busyHandler.setBusy("Reading BaObject",{cbOnTimeout:()=>{i&&i(),this.__owner.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.connection)},optionalOutput:{symbolName:e}});return a.resolveBaObject(e,this.__loadBaChildren,this.__loadTexts,this.__owner).then((e=>{i&&i(),this.baVariable=e.baVariable,this.__setBaObjectInternal(e.baObject,n)})).catch((e=>{t.BaseError.warn(e),this.__owner.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.connection),i&&i()})),this}static resolveBaObject(n,i=!1,s=!1,r){return new Promise(((o,l)=>{if(null==n)return o({baObject:n,baVariable:null});if("string"==typeof n&&(n.length<=0?l(new t.BaseError("Symbol expression was empty!")):e.Symbol.isSymbolExpression(n)&&(n=new e.Symbol(n))),n instanceof e.Symbol){let d=n.getExpression().getName()||"";if(n.getExpression().getType()===e.SymbolType.PartialParam){if(null==r)return l(new t.BaseError('Symbol expression is PartialParam (40) but "ctrl" is not set!'));let e=t.Helper.Mapping.resolvePartialParam(r,n.getExpression()).getName();if(null==e)return l(new t.BaseError("Name of SymbolExpression was null!"));d=e}a.readBaObject(d,i,s).then((async e=>{if(t.BA.BaBasicObject.isIBaBasicObjectAttributes(e)){r?.errorIndicator.reset();let t=d.indexOf("Params::"),a="",n=[],i="",s="",l=null;return t>-1&&(a=d.substring(t,d.length),n=a.split("::"),i=n[0],s=n[1]),"Params"===i&&null!=e.Params&&e.Params.forEach(((e,t)=>{null==l&&e.Mapping.includes(s)&&(l=e)})),o({baObject:e,baVariable:l})}if(TCHMI_DESIGNER)return o({baObject:null,baVariable:null});{let e="Passed BaObject is not a BaObject or BA.BaView!";null!=r&&t.Components.DialogWindow.alert(`${r?.getId()}: ${e}`),l(new t.BaseError(e))}})).catch((e=>(t.BaseError.warn(e),r?.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.connection),l(e))))}else if(n instanceof t.BA.BaBasicObject)n.loadAttributes(i,s).then((()=>n instanceof t.BA.BaBasicObject&&n.getIsValid()?o({baObject:n,baVariable:null}):l(new t.BA.BaBasicObject.Error("BaObject is not valid!")))).catch((async e=>(r?.logger.error(e),await t.Components.DialogWindow.alert(e),l(e))));else if(t.BA.BaBasicObject.isIBaBasicObjectAttributes(n)){let a,d=()=>{if(t.BA.BaBasicObject.isIBaBasicObjectAttributes(n)&&t.BA.BaDevices){let h=t.BA.BaDevices.get(null!=n.DeviceName?n.DeviceName:"");if(!h)return void r?.logger.error(t.Logger.crossMark+`Device with name ${n.DeviceName} could not found in BaDevices! Check mapping and make sure to only use subsymbols of the mapping of the device!`);switch(h.diagnostics.connectionState!==t.BA.BaDevice.ConnectionState.connected?r?.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.connection):r?.errorIndicator.reset(),h.projectStructureLoaded){case t.BA.BaDevice.ProjectStructureLoadingStatus.loading:a&&a(),a=e.EventProvider.register(h.eventNames.onProjectStructureLoaded,(()=>{d(),a&&a()}));break;case t.BA.BaDevice.ProjectStructureLoadingStatus.loaded:let _=h.findBaObject(n.Identifier);if(!_){const e=t.Logger.crossMark+`BaObject '${n.InstancePath}' could not be found in BaDevice ${n.DeviceName}!`;return r?.logger.error(e),l(new t.BA.BaBasicObject.Error(e))}_.loadAttributes(i,s).then((()=>_?.getIsValid()?o({baObject:_,baVariable:null}):l(new t.BA.BaBasicObject.Error("BaObject was not valid!")))).catch((e=>(r?.logger.warn("Loading attributes of BaObject failed!",e),l(e)))),a&&a();break;default:const c=`Loading of project structure of device ${h.Description} failed!`;return r?.logger.error(`Loading of project structure of device ${h.Description} failed!`),l(new t.BA.BaDevice.Error(c))}}};t.BA.BaDevices?d():a=e.EventProvider.register(t.BA.Events.onAllDevicesLoaded,d)}else TCHMI_DESIGNER||t.Components.DialogWindow.alert(`Passed BaObject of control with id ${r?.getId()} is not a BaObject or BA.BaView!`)}))}static readBaObject(a,n=!1,i=!1){return new Promise(((s,r)=>{let o,l=()=>{let d;if(a.indexOf(":")>-1)d=a.substring(0,a.indexOf(":"));else{if(!(a.indexOf(".")>-1))return r(new t.BaseError(`Device name could not be found in symbol expression '${a}'. Make sure to only use sub symbols of the mapping of the device!`));d=a.substring(0,a.indexOf("."))}if(t.BA.BaDevices){let h=t.BA.BaDevices.get(d);if(!h)return r(new t.BA.BaDevice.Error("Device with name {deviceName} could be not found in BaDevices! Check mapping and make sure to only use sub symbols of the mapping of the device!",d));if(h.diagnostics.connectionState!==t.BA.BaDevice.ConnectionState.connected)return r(new t.BA.BaDevice.InvalidConnectionStateError(h));switch(h.projectStructureLoaded){case t.BA.BaDevice.ProjectStructureLoadingStatus.loading:o&&o(),o=e.EventProvider.register(h.eventNames.onProjectStructureLoaded,(()=>{l(),o&&o()}));break;case t.BA.BaDevice.ProjectStructureLoadingStatus.loaded:let _=h.findBaObject(a),c=a.indexOf("Params::");if(c>-1&&(a=a.substring(0,c-2),_=h.findBaObject(a)),!_)return r(new t.BA.BaBasicObject.Error(`BaObject with mapping '${a}' could not be found in BaDevice '${d}'!`));_.loadAttributes(n,i).then((()=>{_.getIsValid(n,i)?s(_):r(new t.BA.BaBasicObject.Error(`BaObject '${_?.InstancePath}' was not loaded correctly!`))})).catch((e=>r(e))),o&&o();break;default:return r(new t.BA.BaBasicObject.Error(`Cannot read BaObject with mapping '${a}' because project structure of device '${h.Description}' was not loaded!`))}}};t.BA.BaDevices?l():o=e.EventProvider.register(t.BA.Events.onAllDevicesLoaded,l)}))}watchBaVariable(e,t,a=!0){let n;a&&(n=this.__owner.busyHandler.setBusy(`Watching BaVariable '${e.Mapping}'`));let i={InstanceName:e.InstanceName,WatchId:e.watch((e=>{null!=n&&(n(),n=void 0),t(e)}))};return this.__baVarWatchIdentifier||(this.__baVarWatchIdentifier=[]),this.__baVarWatchIdentifier.push(i),i}tryWatchBaVariable(e,a,n=!0){let i;n&&(i=this.__owner.busyHandler.setBusy(`Watching BaVariable '${t.BA.BaParameterId[e]}'`));let s=this.__baObject?.tryWatchBaVariable(e,(e=>{null!=i&&(i(),i=void 0),a(e)}));return null!=s&&(this.__baVarWatchIdentifier||(this.__baVarWatchIdentifier=[]),this.__baVarWatchIdentifier.push(s)),s}tryWatchChildrenBaVariable(e,a,n,i=!0){if(!e)return!1;if(this.__baChildrenWatchIdentifier||(this.__baChildrenWatchIdentifier=new Map),e.tryGetBaVariable(a)){let s,r=this.__baChildrenWatchIdentifier.get(e);r||(this.__baChildrenWatchIdentifier.set(e,[]),r=this.__baChildrenWatchIdentifier.get(e)),i&&(s=this.__owner.busyHandler.setBusy(`Watching BaVariable '${t.BA.BaParameterId[a]}' of BaObject '${e?.Mapping}'`));let o=e.tryWatchBaVariable(a,(e=>{null!=s&&(s(),s=void 0),n(e)}));if(null!=o)return r.push(o),!0}return!1}watchValueRange(e,a,n=!0){let i,s;if("number"==typeof e){if(s=this.__baObject?.tryGetBaVariable(e),null==s)return this.__owner.logger.warn(`BaObject does not contain a BaParameter ${t.BA.BaParameterId[e]}`),!1}else s=e;n&&(i=this.__owner.busyHandler.setBusy(`Watching value range of '${t.BA.BaParameterId[s.ID]}'`));let r=s.watchValueRange(((e,n)=>{null!=i&&(i(),i=void 0),null!=e?(t.BaseError.warn(e,this.__owner.logger),this.__owner.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.error)):this.__owner.errorIndicator.reset(),a(n)}));this.__baWatchValueRangeDestroyers||(this.__baWatchValueRangeDestroyers=new Map);let o=this.__baWatchValueRangeDestroyers.get(s);return o||(this.__baWatchValueRangeDestroyers.set(s,[]),o=this.__baWatchValueRangeDestroyers.get(s)),null!=r&&(o.push(r),!0)}onBaObjectChanged(t){return e.EventProvider.register(this.__owner.getId()+"."+a.Events.onBaObjectChanged,((e,...a)=>{t(this.__baObject)}))}__setBaObjectInternal(n,i){if(null==i&&(i={}),this.__baObject=n,null!=this.__baObject?this.__baObjectSymbolExpression=this.__baObject.getSymbolExpression():this.__baObjectSymbolExpression=null,this.__isLoadingBaObject=!1,this.__loadingReadyResolver&&(this.__loadingReadyResolver.forEach((e=>e(!0))),delete this.__loadingReadyResolver),null!=this.__destroyOnDeviceConnectionStateChanged&&(this.__destroyOnDeviceConnectionStateChanged(),delete this.__destroyOnDeviceConnectionStateChanged),null!=this.__baObject&&(this.__destroyOnDeviceConnectionStateChanged=e.EventProvider.register(this.__baObject.Device.eventNames.onConnectionStateChanged,(()=>{this.__baObject?.Device.diagnostics.connectionState!==t.BA.BaDevice.ConnectionState.connected?this.__owner.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.connection):this.__owner.errorIndicator.reset()}))),null!=this.__baObject&&this.__baObject.Device.diagnostics.connectionState===t.BA.BaDevice.ConnectionState.connected&&this.__owner.errorIndicator.reset(),this.__owner.processBaObject(),null==i.notifyOwnerParent||!0===i.notifyOwnerParent){let t=this.__owner.getBaParent();null!=t&&t!==this.__owner&&a.isIUsesBaObject(t)&&t instanceof e.Controls.System.TcHmiControl&&(t.processBaObject(),e.EventProvider.raise(t.getId()+".onPropertyChanged",{propertyName:"BaObject"}))}e.EventProvider.raise(this.__owner.getId()+"."+a.Events.onBaObjectChanged,this.__baObject),this.__owner instanceof e.Controls.System.TcHmiControl&&e.EventProvider.raise(this.__owner.getId()+".onPropertyChanged",{propertyName:"BaObject"})}__stopAllWatches(){if(this.__baVarWatchIdentifier?.forEach((e=>{e&&this.__baObject&&this.__baObject.stopWatchBaVariable(e)})),delete this.__baVarWatchIdentifier,null!=this.__baChildrenWatchIdentifier){for(let[e,t]of this.__baChildrenWatchIdentifier)t.forEach((t=>e.stopWatchBaVariable(t)));delete this.__baChildrenWatchIdentifier}if(null!=this.__baWatchValueRangeDestroyers){for(let e of this.__baWatchValueRangeDestroyers.values())e.forEach((e=>e()));delete this.__baWatchValueRangeDestroyers}}}t.BaObjectHandler=a,function(e){let a;!function(e){e.onBaObjectChanged="onBaObjectChanged"}(a=e.Events||(e.Events={})),e.isIUsesBaObject=function(a){let n=!1;if(null!=a&&"object"==typeof a){let i=new Map;a.baObjectHandler instanceof e&&"function"==typeof a.processBaObject&&(n=!0),t.TypeGuards.validateProperties(a,i)||(n=!1)}return n}}(a=t.BaObjectHandler||(t.BaObjectHandler={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n{constructor(e,a){this.__owner=e,this.logger=new t.Logger({name:this.__owner.getId()}),this.__attrHandler=new t.AttrHandler(this),this.__owner.getElement().addClass("tchmi-ba-background-styler"),a&&this.setAttributes(a)}__processBackground(){let e="",t="",a="",n=this.__attrHandler.color?.toString();null!=n&&n.length>0?-1===n.indexOf("gradient")?(e=n,t=n,a=""):(e=t,t=n.slice(n.lastIndexOf(",")+1,n.lastIndexOf(")")),a=n):(e="",t="",a=""),e.length>0&&t.length>0?(this.__owner.getElement().css("--tchmi-ba-background-styler-background",e),this.__owner.getElement().css("--tchmi-ba-background-styler-background-color",t)):(this.__owner.getElement().css("--tchmi-ba-background-styler-background",""),this.__owner.getElement().css("--tchmi-ba-background-styler-background-color","")),a.length>0?this.__owner.getElement().css("--tchmi-ba-background-styler-background-gradient",a):this.__owner.getElement().css("--tchmi-ba-background-styler-background-gradient","")}__processImageSize(){null==this.__attrHandler.imageHeight&&null==this.__attrHandler.imageWidth?(this.__owner.getElement().css("--tchmi-ba-background-styler-image-size",""),!0===this.__attrHandler.useSVG&&(this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-width",""),this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-height",""))):(null==this.__attrHandler.imageHeight?null!=this.__attrHandler.imageWidth&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-size",this.__attrHandler.imageWidth+this.__attrHandler.imageWidthUnit+", cover"):null==this.__attrHandler.imageWidth?null!=this.__attrHandler.imageHeight&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-size",this.__attrHandler.imageHeight+this.__attrHandler.imageHeightUnit+", cover"):this.__owner.getElement().css("--tchmi-ba-background-styler-image-size",this.__attrHandler.imageWidth+this.__attrHandler.imageWidthUnit+" "+this.__attrHandler.imageHeight+this.__attrHandler.imageHeightUnit+", cover"),!0===this.__attrHandler.useSVG&&(this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-width",this.__attrHandler.imageWidth+this.__attrHandler.imageWidthUnit),this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-height",this.__attrHandler.imageHeight+this.__attrHandler.imageHeightUnit)))}__processImagePosition(){if(null==this.__attrHandler.imageHorizontalAlignment&&null==this.__attrHandler.imageVerticalAlignment)this.__owner.getElement().css("--tchmi-ba-background-styler-image-position",""),this.__attrHandler.useSVG&&(this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-left",""),this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-top",""));else{let e,t;switch(this.__attrHandler.imageHorizontalAlignment){case"Left":e="0%",this.__attrHandler.useSVG&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-left","0px");break;case"Right":e="100%",this.__attrHandler.useSVG&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-left","calc((100% - var(--tchmi-ba-background-styler-image-svg-width)))");break;default:e="50%",this.__attrHandler.useSVG&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-left","")}switch(this.__attrHandler.imageVerticalAlignment){case"Top":t="0%",this.__attrHandler.useSVG&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-top","0px");break;case"Bottom":t="100%",this.__attrHandler.useSVG&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-top","calc((100% - var(--tchmi-ba-background-styler-image-svg-height)))");break;default:t="50%",this.__attrHandler.useSVG&&this.__owner.getElement().css("--tchmi-ba-background-styler-image-svg-position-top","")}this.__owner.getElement().css("--tchmi-ba-background-styler-image-position",e+" "+t)}}getControl(){return this.__owner}getSvg(){return this.__svg?this.__svg:null}setAttributes(e){return null==e&&this.logger.warn(t.Logger.crossMark+"Passed attributes object was null!"),void 0!==e.color&&this.setColor(e.color,e.colorChangeDuration),void 0!==e.image&&(void 0===e.useSVG&&null!=e.image&&e.image.indexOf(".svg")>0&&(e.useSVG=!0),this.setImage(e.image,e.useSVG)),void 0!==e.imageColor&&this.setImageColor(e.imageColor,e.imageColorChangeDuration),void 0!==e.imageHeight&&(void 0===e.imageHeightUnit&&this.__attrHandler.imageHeightUnit&&(e.imageHeightUnit=this.__attrHandler.imageHeightUnit),this.setImageHeight(e.imageHeight,e.imageHeightUnit)),void 0!==e.imageHorizontalAlignment&&this.setImageHorizontalAlignment(e.imageHorizontalAlignment),void 0!==e.imageRotation&&this.setImageRotation(e.imageRotation),void 0!==e.imageRotationDirection&&this.setImageRotationDirection(e.imageRotationDirection),void 0!==e.imageRotationSpeed&&this.setImageRotationSpeed(e.imageRotationSpeed),void 0!==e.imageVerticalAlignment&&this.setImageVerticalAlignment(e.imageVerticalAlignment),e.imageWidth&&(void 0===e.imageWidthUnit&&this.__attrHandler.imageWidthUnit&&(e.imageWidthUnit=this.__attrHandler.imageWidthUnit),this.setImageWidth(e.imageWidth,e.imageWidthUnit)),void 0!==e.imageStrokeWidth&&(void 0===e.imageStrokeWidthUnit&&this.__attrHandler.imageStrokeWidthUnit&&(e.imageStrokeWidthUnit=this.__attrHandler.imageStrokeWidthUnit),this.setImageStrokeWidth(e.imageStrokeWidth,e.imageStrokeWidthUnit)),this}getAttributes(){return this.__attrHandler.getRef()}setColor(e,a=200){if(!this.__attrHandler.checkColorAttribute(e,"color"))return this;const n=t.AttrHandler.convertToColor(e);return a!==this.__attrHandler.colorChangeDuration&&(this.__attrHandler.colorChangeDuration=a,null!=this.__attrHandler.colorChangeDuration?this.__owner.getElement().css("--tchmi-ba-background-styler-background-color-transition-duration",this.__attrHandler.colorChangeDuration+"ms"):this.__owner.getElement().css("--tchmi-ba-background-styler-background-color-transition-duration","")),this.__attrHandler.color=n,this.__processColor(),this}__processColor(){this.__processBackground()}getColor(){return this.__attrHandler.color}setImage(e,a=!1){return 0===e?.length&&(e=null),this.__attrHandler.checkAttribute(e,"image",{validator:()=>t.Helper.String.validateFilePath(e,n.ImageFileEndings)})?(this.__attrHandler.image=e,this.__attrHandler.useSVG=(null!=a||"boolean"==typeof a)&&a,this.__processImage(),this):this}__processImage(){let e=this.__owner.getElement().children(".background-image-svg");if(null!=this.__attrHandler.image&&this.__attrHandler.image.length>0)if(!0===this.__attrHandler.useSVG&&this.__attrHandler.image.indexOf(".svg")>-1){null!=e[0]&&e.detach();let a=this.__attrHandler.image;t.System.SVGLoader.get(this.__attrHandler.image).then((t=>{a===this.__attrHandler.image&&(e=this.__owner.getElement().children(".background-image-svg"),null!=e[0]&&e.detach(),this.__svg=$(t).addClass("background-image-svg"),this.__owner.getElement().append(this.__svg),this.__processImageSize(),this.__processImageColor(),this.__owner.eventHandler.raise(n.Events.onSvgLoaded))})).catch((e=>this.logger.warn(`Loading SVG failed! Path: ${this.__attrHandler.image}`,e))),this.__owner.getElement().removeClass("use-image")}else{this.__owner.getElement().addClass("use-image"),e.detach(),this.__attrHandler.useSVG=!1;let t="/"!==this.__attrHandler.image[0]?"/":"";this.__owner.getElement().css("--tchmi-ba-background-styler-image","url('"+t+this.__attrHandler.image+"')")}else e.detach(),this.__owner.getElement().removeClass("use-image"),this.__owner.getElement().css("--tchmi-ba-background-styler-image","")}getImage(){return this.__attrHandler.image}setImageHeight(e,t){return a.LayoutHandler.dimensionSetter(this.__attrHandler,"imageHeight",e,t)?(this.__processImageSize(),this):this}getImageHeight(){return this.__attrHandler.imageHeight}getImageHeightUnit(){return this.__attrHandler.imageHeightUnit}setImageWidth(e,t){return a.LayoutHandler.dimensionSetter(this.__attrHandler,"imageWidth",e,t)?(this.__processImageSize(),this):this}getImageWidth(){return this.__attrHandler.imageWidth}getImageWidthUnit(){return this.__attrHandler.imageWidthUnit}setImageHorizontalAlignment(t){return this.__attrHandler.checkAttribute(t,"imageHorizontalAlignment",{validator:e.isHorizontalAlignment})?(this.__attrHandler.imageHorizontalAlignment=t,this.__processImagePosition(),this):this}getImageHorizontalAlignment(){return this.__attrHandler.imageHorizontalAlignment}setImageVerticalAlignment(t){return this.__attrHandler.checkAttribute(t,"imageVerticalAlignment",{validator:e.isVerticalAlignment})?(this.__attrHandler.imageVerticalAlignment=t,this.__processImagePosition(),this):this}getImageVerticalAlignment(){return this.__attrHandler.imageVerticalAlignment}setImageColor(e,a=200){if(!this.__attrHandler.checkColorAttribute(e,"imageColor"))return this;const n=t.AttrHandler.convertToRGBAColor(e);return this.__attrHandler.imageColor=n,a!==this.__attrHandler.imageColorChangeDuration&&(this.__attrHandler.imageColorChangeDuration=a,null!=this.__attrHandler.imageColorChangeDuration?this.__owner.getElement().css("--tchmi-ba-background-styler-image-color-transition-duration",this.__attrHandler.imageColorChangeDuration+"ms"):this.__owner.getElement().css("--tchmi-ba-background-styler-image-color-transition-duration","")),this.__processImageColor(),this}__processImageColor(){this.__attrHandler.useSVG&&this.__svg&&(null!=this.__attrHandler.imageColor?this.__owner.getElement().css("--tchmi-ba-global-icon-color",this.__attrHandler.imageColor.toString()):this.__owner.getElement().css("--tchmi-ba-global-icon-color",""))}getImageColor(){return this.__attrHandler.imageColor}setImageRotation(e){return this.__attrHandler.checkAttribute(e,"imageRotation",{validator:"number"})?(this.__attrHandler.imageRotation=e,this.__processImageRotation(),this):this}__processImageRotation(){null==this.__attrHandler.imageRotation?this.__owner.getElement().css("--tchmi-ba-background-styler-image-rotation",""):this.__owner.getElement().css("--tchmi-ba-background-styler-image-rotation",this.__attrHandler.imageRotation+"deg")}getImageRotation(){return this.__attrHandler.imageRotation}setImageRotationSpeed(e){return this.__attrHandler.checkAttribute(e,"imageRotationSpeed",{validator:"number"})?(this.__attrHandler.imageRotationSpeed=e,this.__processImageRotationSpeed(),this):this}__processImageRotationSpeed(){null!=this.__attrHandler.imageRotationDirection||null!=this.__attrHandler.imageRotationSpeed?(this.__owner.getElement().css("--tchmi-ba-background-styler-image-rotation-speed",this.__attrHandler.imageRotationSpeed+"s"),this.__owner.getElement().css("--tchmi-ba-background-styler-image-rotation",""),this.__attrHandler.imageRotationDirection===n.RotationDirection.left?(this.__owner.getElement().addClass("rotate-left"),this.__owner.getElement().removeClass("rotate-right")):(this.__owner.getElement().addClass("rotate-right"),this.__owner.getElement().removeClass("rotate-left"))):(this.__processImageRotation(),this.__owner.getElement().removeClass("rotate-right"),this.__owner.getElement().removeClass("rotate-left"),this.__owner.getElement().css("--tchmi-ba-background-styler-image-rotation-speed",""))}getImageRotationSpeed(){return this.__attrHandler.imageRotationSpeed}setImageRotationDirection(e){return this.__attrHandler.checkAttribute(e,"imageRotationDirection",{validator:"number"})?(this.__attrHandler.imageRotationDirection=e,this.__processImageRotationDirection(),this):this}__processImageRotationDirection(){this.__processImageRotationSpeed()}getImageRotationDirection(){return this.__attrHandler.imageRotationDirection}setImageStrokeWidth(e,t){return a.LayoutHandler.dimensionSetter(this.__attrHandler,"imageStrokeWidth",e,t)?(this.__attrHandler.imageStrokeWidth=e,this.__processImageStrokeWidth(),this):this}__processImageStrokeWidth(){null==this.__attrHandler.imageStrokeWidth?this.__owner.getElement().css("--tchmi-ba-icon-stroke-width",""):this.__owner.getElement().css("--tchmi-ba-icon-stroke-width",this.__attrHandler.imageStrokeWidth+(null!=this.__attrHandler.imageStrokeWidthUnit?this.__attrHandler.imageStrokeWidthUnit:"px"))}getImageStrokeWidth(){return this.__attrHandler.imageStrokeWidth}getImageStrokeWidthUnit(){return this.__attrHandler.imageStrokeWidthUnit}}a.BackgroundStyler=n,function(e){let t,a;!function(e){e[e.left=0]="left",e[e.right=1]="right"}(t=e.RotationDirection||(e.RotationDirection={})),e.isRotationDirection=function(e){return"number"==typeof e&&(0===e||1===e)},function(e){e.onSvgLoaded="onSvgLoaded"}(a=e.Events||(e.Events={})),e.ImageFileEndings=["svg","png","jpg","jpeg"]}(n=a.BackgroundStyler||(a.BackgroundStyler={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){a.BorderStyler=class{constructor(e,a){this.__owner=e,this.logger=new t.Logger({name:this.__owner.getId()}),this.__attrHandler=new t.AttrHandler(this),this.__owner.getElement(),a&&this.setAttributes(a)}getControl(){return this.__owner}setAttributes(e){return null==e||(void 0!==e.border&&this.setBorder(e.border),void 0!==e.color&&this.setColor(e.color),void 0!==e.radius&&this.setRadius(e.radius,e.radiusUnit),void 0!==e.style&&this.setStyle(e.style),void 0!==e.width&&this.setWidth(e.width,e.widthUnit)),this}getAttributes(){return this.__attrHandler.getRef()}setBorder(e){return this.__attrHandler.checkAttribute(e,"border",{validator:"string"})?(this.__attrHandler.border=e,this.__processBorder(),this):this}__processBorder(){null==this.__attrHandler.border?(this.__owner.getElement().css("border",""),this.__processColor(),this.__processRadius(),this.__processStyle(),this.__processWidth()):this.__owner.getElement().css("border",this.__attrHandler.border)}getBorder(){return this.__attrHandler.border}setColor(e){return this.__attrHandler.checkAttribute(e,"color",{validator:["string",t.isFourSidedString]})?(this.__attrHandler.color=e,this.__processColor(),this):this}__processColor(){null==this.__attrHandler.color?this.__owner.getElement().css("border-color",""):t.isFourSidedString(this.__attrHandler.color)?this.__owner.getElement().css("border-color",this.__attrHandler.color.top+" "+this.__attrHandler.color.left+" "+this.__attrHandler.color.bottom+" "+this.__attrHandler.color.left):this.__owner.getElement().css("border-color",this.__attrHandler.color)}getColor(){return this.__attrHandler.color}setWidth(t,n){if(!this.__attrHandler.checkAttribute(t,"width",{validator:["number",e.isBorderWidth]}))return this;if("number"==typeof t){if(!a.LayoutHandler.dimensionSetter(this.__attrHandler,"width",t,n))return this}else this.__attrHandler.width=t;return this.__processWidth(),this}__processWidth(){if(null==this.__attrHandler.width)this.__owner.getElement().css("border-width","");else{let t=this.__attrHandler.width;e.isBorderWidth(t)?this.__owner.getElement().css("border-width",t.top+(void 0===t.topUnit?"px":t.topUnit)+" "+t.right+(void 0===t.rightUnit?"px":t.rightUnit)+" "+t.bottom+(void 0===t.bottomUnit?"px":t.bottomUnit)+" "+t.left+(void 0===t.leftUnit?"px":t.leftUnit)):this.__owner.getElement().css("border-width",t+(this.__attrHandler.widthUnit?this.__attrHandler.widthUnit:"px"))}}getWidth(){return this.__attrHandler.width}getWidthUnit(){return this.__attrHandler.widthUnit}setStyle(t){return this.__attrHandler.checkAttribute(t,"style",{validator:["object",e.isBorderStyle,e.isBorderStyleValue]})?(this.__attrHandler.style=t,this.__processStyle(),this):this}__processStyle(){if(null==this.__attrHandler.style)this.__owner.getElement().css("border-style","");else{let t=this.__attrHandler.style;e.isBorderStyle(t)?this.__owner.getElement().css("border-style",t.top+" "+t.right+" "+t.bottom+" "+t.left):this.__owner.getElement().css("border-style",t)}}getStyle(){return this.__attrHandler.style}setRadius(t,n){if(!this.__attrHandler.checkAttribute(t,"radius",{validator:["number",e.isBorderRadius]}))return this;if("number"==typeof t){if(!a.LayoutHandler.dimensionSetter(this.__attrHandler,"radius",t,n))return this}else this.__attrHandler.radius=t;return this.__processRadius(),this}__processRadius(){if(null==this.__attrHandler.radius)this.__owner.getElement().css("border-radius","");else{let t=this.__attrHandler.radius;e.isBorderRadius(t)?this.__owner.getElement().css("border-radius",t.topLeft+(void 0===t.topLeftUnit?"px":t.topLeftUnit)+" "+t.topRight+(void 0===t.topRightUnit?"px":t.topRightUnit)+" "+t.bottomRight+(void 0===t.bottomRightUnit?"px":t.bottomRightUnit)+" "+t.bottomLeft+(void 0===t.bottomLeftUnit?"px":t.bottomLeftUnit)):this.__owner.getElement().css("border-radius",t+(this.__attrHandler.radiusUnit?this.__attrHandler.radiusUnit:"px"))}}getRadius(){return this.__attrHandler.radius}getRadiusUnit(){return this.__attrHandler.radiusUnit}}}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(e){this.__isBusy=!1,this.__timeoutIds=new Map,this.__busyChildren=new Map,this.__busyChildrenReadyCallbacks=[],this.__timerResults=[],this.__owner=e,this.__logger=new t.Logger({name:this.__owner.getId(),className:this.__owner.constructor.name})}get timerResults(){return this.__timerResults}__getBusyChildren(){const e=[];for(let a of this.__owner.childrenHandler.getChildren().values())t.Components.Base.isIBase(a)&&a.busyHandler.getIsBusy()&&e.push(a);return e}__hasBusyParent(){let e=this.__owner.getBaParent();for(;e;){if(t.Components.Base.isIBase(e)&&e.busyHandler.getIsBusy())return!0;e=e.getBaParent()}return!1}__createTimeout(e,n){return setTimeout((()=>{if(!0===this.__isBusy){const i={timeoutMessage:e,type:this.__owner.constructor.name,busyHandler:this,instance:this.__owner};t.Components.Base.isIBase(this.__owner)&&t.BaObjectHandler.isIUsesBaObject(this.__owner)&&(i.baObject=this.__owner.baObjectHandler.baObject),n?.optionalOutput&&(i.optionalOutput=n.optionalOutput),this.__logger.warn(t.Logger.hourGlass+"Still not ready!",i),n?.cbOnTimeout&&n.cbOnTimeout(n.cbTimeoutParams),this.__owner.eventHandler.raise(a.Events.onIsBusyTimeOut,this)}}),null!=n?.timeout?n.timeout:a.DefaultTimeout)}__createReadyFunction(e,t,n){let i,s=!0;return a.RecordTimerResults&&(i=performance.now(),s=!1),()=>{a.RecordTimerResults&&0==s&&null!=i&&(s=!0,this.__timerResults.push({requiredTime:((performance.now()-i)/1e3).toFixed(2)+" s",action:t})),this.__timeoutIds.has(e)&&this.__setReady(e),n?.cbOnReady&&n.cbOnReady(n.cbReadyParams)}}__setReady(e){if(this.__isBusy){if(null==this.__timeoutIds.get(e))throw new t.BaseError("Timeout identifier was not found!");if(clearTimeout(e),this.__timeoutIds.delete(e),this.checkForBusyChildren()||this.__timeoutIds.size<=0&&(a.detachBusyIndicator(this.__owner.getElement()),this.__isBusy=!1),!this.__isBusy){const e=this.__owner.getBaParent();t.Components.Base.isIBase(e)&&e.busyHandler.__childReady(this.__owner)}}if(!this.__isBusy&&this.__timeoutIds.size>0)throw new t.BaseError(`${this.__owner.getId()} is ready but still has timeoutIds!`)}__childBusy(e){this.__busyChildren.set(e.getId(),{ctrl:e,rf:this.setBusy("Waiting for busy children",{optionalOutput:e})})}__childReady(e){const t=this.__busyChildren.get(e.getId())?.rf;if(t&&(this.__busyChildren.delete(e.getId()),t()),0===this.__busyChildren.size&&this.__busyChildrenReadyCallbacks.length>0)for(let e=0;e<this.__busyChildrenReadyCallbacks.length;e++)this.__busyChildrenReadyCallbacks[e]()}getControl(){return this.__owner}setBusy(e,n){if(!this.__isBusy){if(!this.__hasBusyParent()){let e=!1;if(this.__owner instanceof t.Components.Base?(0!=this.__owner.getShowBusyIndicator()&&(e=!0),0==n?.showIndicator&&(e=!1)):0!=n?.showIndicator&&(e=!0),e){a.appendBusyIndicator(this.__owner.getElement());const e=this.__getBusyChildren();if(e.length>0)for(let t=0;t<e.length;t++)a.detachBusyIndicator(e[t].getElement())}}this.__isBusy=!0}const i=this.__createTimeout(e,n);if(this.__timeoutIds.has(i))throw new t.BaseError("Timeout id was already set!");this.__timeoutIds.set(i,e);const s=this.__createReadyFunction(i,e,n),r=this.__owner.getBaParent();return n?.notifyParent&&t.Components.Base.isIBase(r)&&r.busyHandler.__childBusy(this.__owner),s}getIsBusy(){return this.__isBusy}checkForBusyChildren(e){const t=this.__getBusyChildren();if(t.length>0){for(let e=0;e<t.length;e++){const a=t[e];this.__busyChildren.has(a.getId())||this.__busyChildren.set(a.getId(),{ctrl:a,rf:this.setBusy("Waiting for busy children",{optionalOutput:{busyChild:a}})})}return e&&this.__busyChildrenReadyCallbacks.push(e),!0}return!1}logTimerResults(){if(1==a.RecordTimerResults)if(t.Components.Base.isIBase(this.__owner)){function e(a){let n={timerResults:a.busyHandler.timerResults};if(a.childrenHandler.getChildCount()>0){n.children={};for(let i of a.childrenHandler.getChildren().values())t.Components.Base.isIBase(i)&&i.busyHandler.timerResults.length>0&&(n.children[i.getId()]=e(i))}return n}const n=e(this.__owner);console.log(`Timer results of '${this.__owner.getId()}'`,n)}else console.log("Timer results:",this.timerResults);else console.warn("Recording of timer results is disabled. Activate it in onInitialize of TcHmi with TcHmi.BuildingAutomation.BusyHandler.RecordTimerResults = true")}destroy(){for(let e of this.__timeoutIds.keys())clearTimeout(e)}static appendBusyIndicator(e){let t=e.children(".tchmi-ba-busy-indicator");null==t[0]&&(t=$("<div>").addClass("tchmi-ba-busy-indicator"),t.append($('\n\t\t\t\t\t<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<circle cx="50" cy="50" r="45"/>\n\t\t\t\t\t</svg>')),e.append(t))}static detachBusyIndicator(e){const t=e.children(".tchmi-ba-busy-indicator");void 0!==t[0]&&t.detach()}}t.BusyHandler=a,function(a){function n(e){return null!=e&&(null!=e.busyHandler&&e.busyHandler instanceof a)}let i;a.DefaultTimeout=1e4,a.RecordTimerResults=!1,a.ShowEventLoading=!0,a.isIBusyHandler=n,function(e){e.onIsBusyTimeOut="onIsBusyTimeOut"}(i=a.Events||(a.Events={})),a.logTimerResultsOfControl=function(a){const i=e.Controls.get(a);n(i)?i.busyHandler.logTimerResults():t.Logger.warn(`Control with id '${a}' is not a BA control!`)}}(a=t.BusyHandler||(t.BusyHandler={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n{constructor(e,a){this.__owner=e,this.logger=new t.Logger({name:this.__owner.getId()}),this.__attrHandler=new t.AttrHandler(this),a&&this.setAttributes(a)}static dimensionSetter(t,a,n,i){return!(!t.checkAttribute(n,a,{validator:"number",skipEqualityCheck:!0})&&!t.checkAttribute(i,String(a)+"Unit",{validator:e.isDimensionUnit,skipEqualityCheck:!0}))&&(null==i&&(i=null!=t[String(a)+"Unit"]?t[String(a)+"Unit"]:"px"),n===t[a]&&i===t[String(a)+"Unit"]?(t.equalAttribute(String(a)),!1):(t[String(a)]=n,t[String(a)+"Unit"]=i,!0))}__dimensionProcessor(e){null==this.__attrHandler[e]?this.__owner.getElement().css(e,""):this.__owner.getElement().css(e,this.__attrHandler[e]+this.__attrHandler[e+"Unit"])}getControl(){return this.__owner}reset(){let e=this.__attrHandler.getCopy();return this.setAttributes({bottom:null,left:null,top:null,right:null,height:null,maxHeight:null,maxWidth:null,minHeight:null,minWidth:null,width:null}),e}setPosition(t){return void 0!==t&&e.isPartialFourSidedCss(t)?(null==t?this.setLeft(null).setTop(null).setRight(null).setBottom(null):this.setLeft(t.left,t.leftUnit).setTop(t.top,t.topUnit).setRight(t.right,t.rightUnit).setBottom(t.bottom,t.bottomUnit),this):this}destroy(){null!=this.__attachId&&t.System.AttachObserver.remove(this.__owner,this.__attachId)}setAttributes(e){return null==e?(this.__attrHandler.invalidAttribute("Attributes",e),this):(void 0!==e.bottom&&this.setBottom(e.bottom,e.bottomUnit),void 0!==e.left&&this.setLeft(e.left,e.leftUnit),void 0!==e.top&&this.setTop(e.top,e.topUnit),void 0!==e.right&&this.setRight(e.right,e.rightUnit),void 0!==e.height&&this.setHeight(e.height,e.heightUnit),void 0!==e.width&&this.setWidth(e.width,e.widthUnit),void 0!==e.minHeight&&this.setMinHeight(e.minHeight,e.minHeightUnit),void 0!==e.minWidth&&this.setMinWidth(e.minWidth,e.minWidthUnit),void 0!==e.maxHeight&&this.setMaxHeight(e.maxHeight,e.maxHeightUnit),void 0!==e.maxWidth&&this.setMaxWidth(e.maxWidth,e.maxWidthUnit),void 0!==e.zIndex&&this.setZindex(e.zIndex),void 0!==e.autoUpdateAttributes&&this.setAutoUpdateAttributes(e.autoUpdateAttributes),this)}getAttributes(){return this.__attrHandler.getRef()}setHeight(e,t){return n.dimensionSetter(this.__attrHandler,"height",e,t)?(this.__dimensionProcessor("height"),this):this}getHeight(){return this.__attrHandler.height}getHeightUnit(){return this.__attrHandler.heightUnit}setWidth(e,t){return n.dimensionSetter(this.__attrHandler,"width",e,t)?(this.__dimensionProcessor("width"),this):this}getWidth(){return this.__attrHandler.width}getWidthUnit(){return this.__attrHandler.widthUnit}setRight(e,t){return n.dimensionSetter(this.__attrHandler,"right",e,t)?(this.__dimensionProcessor("right"),this):this}getRight(){return this.__attrHandler.right}getRightUnit(){return this.__attrHandler.rightUnit}setLeft(e,t){return n.dimensionSetter(this.__attrHandler,"left",e,t)?(this.__dimensionProcessor("left"),this):this}getLeft(){return this.__attrHandler.left}getLeftUnit(){return this.__attrHandler.leftUnit}setTop(e,t){return n.dimensionSetter(this.__attrHandler,"top",e,t)?(this.__dimensionProcessor("top"),this):this}getTop(){return this.__attrHandler.top}getTopUnit(){return this.__attrHandler.topUnit}setBottom(e,t){return n.dimensionSetter(this.__attrHandler,"bottom",e,t)?(this.__dimensionProcessor("bottom"),this):this}getBottom(){return this.__attrHandler.bottom}getBottomUnit(){return this.__attrHandler.bottomUnit}setMaxWidth(e,t){return n.dimensionSetter(this.__attrHandler,"maxWidth",e,t)?(this.__dimensionProcessor("maxWidth"),this):this}getMaxWidth(){return this.__attrHandler.maxWidth}getMaxWidthUnit(){return this.__attrHandler.maxWidthUnit}setMaxHeight(e,t){return n.dimensionSetter(this.__attrHandler,"maxHeight",e,t)?(this.__dimensionProcessor("maxHeight"),this):this}getMaxHeight(){return this.__attrHandler.maxHeight}getMaxHeightUnit(){return this.__attrHandler.maxHeightUnit}setMinWidth(e,t){return n.dimensionSetter(this.__attrHandler,"minWidth",e,t)?(this.__dimensionProcessor("minWidth"),this):this}getMinWidth(){return this.__attrHandler.minWidth}getMinWidthUnit(){return this.__attrHandler.minWidthUnit}setMinHeight(e,t){return n.dimensionSetter(this.__attrHandler,"minHeight",e,t)?(this.__dimensionProcessor("minHeight"),this):this}getMinHeight(){return this.__attrHandler.minHeight}getMinHeightUnit(){return this.__attrHandler.minHeightUnit}setZindex(e){return this.__attrHandler.checkAttribute(e,"zIndex",{validator:"number"})?(this.__attrHandler.zIndex=e,this.__processZindex(),this):this}__processZindex(){null==this.__attrHandler.zIndex?this.__owner.getElement().css("z-index",""):this.__owner.getElement().css("z-index",this.__attrHandler.zIndex)}getZindex(){return this.__attrHandler.zIndex}setAutoUpdateAttributes(e){return this.__attrHandler.checkAttribute(e,"autoUpdateAttributes",{validator:"array"})?(this.__attrHandler.autoUpdateAttributes=e,this.__processAutoUpdateAttributes(),this):this}__processAutoUpdateAttributes(){if(null==this.__attrHandler.autoUpdateAttributes)this.__mutationObserver?.disconnect(),delete this.__mutationObserver;else if(!this.__mutationObserver){let e=()=>{let e=!1;if(this.__attrHandler.autoUpdateAttributes){if(this.__attrHandler.autoUpdateAttributes.indexOf("width")>-1){let t=this.__owner.getElement().width();null!=t&&t!==this.__attrHandler.width&&(this.__attrHandler.width=t,e=!0)}if(this.__attrHandler.autoUpdateAttributes.indexOf("height")>-1){let t=this.__owner.getElement().height();null!=t&&t!==this.__attrHandler.height&&(this.__attrHandler.height=t,e=!0)}if(this.__attrHandler.autoUpdateAttributes.indexOf("left")>-1){let t=this.__owner.getElement().offset()?.left;null!=t&&t!==this.__attrHandler.left&&(this.__attrHandler.left=t,e=!0)}if(this.__attrHandler.autoUpdateAttributes.indexOf("top")>-1){let t=this.__owner.getElement().offset()?.top;null!=t&&t!==this.__attrHandler.top&&(this.__attrHandler.top=t,e=!0)}e&&t.isIEventHandler(this.__owner)&&this.__owner.eventHandler.raise(n.LayoutHandlerEvents.onAttributesAutoUpdated)}};this.__mutationObserver=new MutationObserver(e),null!=this.__attachId&&t.System.AttachObserver.remove(this.__owner,this.__attachId),this.__attachId=t.System.AttachObserver.add(this.__owner,{attachedCb:()=>{this.__mutationObserver?.observe(this.__owner.getElement()[0],{attributes:!0,attributeFilter:["style"]}),e()},detachedCb:()=>{this.__mutationObserver?.disconnect()}})}}getAutoUpdateAttributes(){return this.__attrHandler.autoUpdateAttributes}}a.LayoutHandler=n,function(e){let t;!function(e){e.onAttributesAutoUpdated="onLayoutHandlerAttributesAutoUpdated"}(t=e.LayoutHandlerEvents||(e.LayoutHandlerEvents={}))}(n=a.LayoutHandler||(a.LayoutHandler={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){let t;!function(t){class a{constructor(t,n){this.childrenHandler=new a.ChildrenHandler(this),this.__destroyersToCallOnDetach=[],this.__destroyersToCallOnDestroy=[],this.__isAttached=!1,this.__isDestroyed=!1,this.__element=$("<div>").addClass("tchmi-ba-base-node"),"string"==typeof t?t.length<=0?console.error("ID cannot be an empty string!","Passed ID:",t):(e.Globals.CreatedBaseNodes.has(t)&&console.error(`A class instance with id ${t} has already been created! Did you forgot to destroy the class?`),this.__id=t,this.__attrHandler=new e.AttrHandler(this),this.logger=new e.Logger({name:t,className:this.constructor.name}),this.eventHandler=new e.EventHandler(this),this.__element.attr("id",t),e.Globals.CreatedBaseNodes.set(t,this),null!=n&&(this.__baParent=n,this.__baParent.childrenHandler.addChild(this)),this.__attachId=e.System.AttachObserver.add(this,{attachedCb:()=>this.__attach(),detachedCb:()=>this.__detach()})):console.error("ID must be a string!","Passed ID:",t)}__attach(){this.__isAttached||(this.__isAttached=!0,this.eventHandler.raise(a.BaseNodeEvents.onAttached))}__detach(){if(this.__isAttached){this.__isAttached=!1,this.eventHandler.raise(a.BaseNodeEvents.onDetached);for(let e=0;e<this.__destroyersToCallOnDetach.length;e++)this.__destroyersToCallOnDetach[e]();this.__destroyersToCallOnDetach=[]}}destroy(){if(!this.__isDestroyed){this.__element.detach(),e.Globals.CreatedBaseNodes.delete(this.__id),e.System.AttachObserver.remove(this,this.__attachId),this.eventHandler.raise(a.BaseNodeEvents.onDestroyed);for(let e=0;e<this.__destroyersToCallOnDestroy.length;e++)this.__destroyersToCallOnDestroy[e]();this.__destroyersToCallOnDestroy=[],this.__baParent?.childrenHandler.removeChild(this),this.__isDestroyed=!0}}getId(){return this.__id}getBaParent(){return this.__baParent}getElement(){return this.__element}hide(){return this.__element.css("display","none"),this}show(){return this.__element.css("display",""),this}getIsAttached(){return this.__isAttached}setAttributes(t){return null==t&&this.logger.warn(e.Logger.crossMark+"Passed attributes object was null!"),void 0!==t.visibility&&this.setVisibility(t.visibility),void 0!==t.hide&&this.setHide(t.hide),void 0!==t.cssClass&&this.setCssClass(t.cssClass),this}getAttributes(){return this.__attrHandler.getRef()}setVisibility(e){return this.__attrHandler.checkAttribute(e,"visibility",{validator:"number"})?(this.__attrHandler.visibility=e,this.__processVisibility(),this):this}__processVisibility(){switch(this.__attrHandler.visibility){case null:this.__element.css("visibility","");break;case e.Visibility.Collapsed:this.__element.css("visibility","collapse");break;case e.Visibility.Hidden:this.__element.css("visibility","hidden");break;case e.Visibility.Visible:this.__element.css("visibility","visible");break;default:this.logger.warn(`Visibility of ${this.__id} has invalid value!`)}}getVisibility(){return this.__attrHandler.visibility}setHide(e){return this.__attrHandler.checkAttribute(e,"hide",{validator:"boolean"})?(this.__attrHandler.hide=e,this.__processHide(),this):this}__processHide(){1==this.__attrHandler.hide?this.hide():this.show()}getHide(){return this.__attrHandler.hide}setCssClass(e){return this.__attrHandler.checkAttribute(e,"cssClass",{validator:"string"})?(this.__attrHandler.cssClass&&this.__element.removeClass(this.__attrHandler.cssClass),this.__attrHandler.cssClass=e,this.__processCssClass(),this):this}__processCssClass(){this.__attrHandler.cssClass&&this.__element.addClass(this.__attrHandler.cssClass)}getCssClass(){return this.__attrHandler.cssClass}}t.BaseNode=a,function(t){let a;!function(e){e.onAttached="onAttached",e.onDetached="onDetached",e.onDestroyed="onDestroyed"}(a=t.BaseNodeEvents||(t.BaseNodeEvents={}));t.ChildrenHandler=class{constructor(e){this.__children=new Map,this.__ctrl=e}addChild(t){if(null==t)return!1;if(this.__children.get(t.getId())){const a=`A child with id ${t.getId()} does already exists on ${this.__ctrl.getId()}!`;return e.Logger.isILogger(this.__ctrl)?this.__ctrl.logger.error(a):console.error(a),!1}return this.__children.set(t.getId(),t),!0}removeChild(e){if(null==e)return!1;return null!=this.__children.get(e.getId())&&(this.__children.delete(e.getId()),!0)}getChildCount(){return this.__children.size}getChildren(){return this.__children}getChild(e){return this.__children.get(e)}}}(a=t.BaseNode||(t.BaseNode={}))}(t=e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.BaseNode{constructor(e,n){super(e,n),this.busyHandler=new t.BusyHandler(this),this.layoutHandler=new a.LayoutHandler(this),this.backgroundStyler=new a.BackgroundStyler(this),this.borderStyler=new a.BorderStyler(this),this.errorIndicator=new i(this),this.__element.addClass("tchmi-ba-base"),this.__attrHandler.layout=this.layoutHandler.getAttributes(),this.__attrHandler.background=this.backgroundStyler.getAttributes(),this.__attrHandler.border=this.borderStyler.getAttributes(),this.__attrHandler.isEnabled=!0}__attach(){this.__isAttached||(super.__attach(),this.busyHandler.checkForBusyChildren())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy(),this.busyHandler.destroy(),this.layoutHandler.destroy(),this.__deviceDiagEventDf&&this.__deviceDiagEventDf()}__getNextAttachedParent(){let e=this.__baParent;for(;e;){if(e.getIsAttached())return e;e=e.getBaParent()}return null}checkAccess(t){let a=this.__baParent;for(;null!=a?.getBaParent();)a=a.getBaParent();return a instanceof e.Controls.System.TcHmiControl?e.Access.checkAccess(a,t):null}setAttributes(e){return super.setAttributes(e),null!=e.layout&&this.layoutHandler.setAttributes(e.layout),null!=e.background&&this.backgroundStyler.setAttributes(e.background),null!=e.border&&this.borderStyler.setAttributes(e.border),void 0!==e.contentPadding&&this.setContentPadding(e.contentPadding),void 0!==e.boxShadow&&this.setBoxShadow(e.boxShadow),void 0!==e.isEnabled&&this.setIsEnabled(e.isEnabled),void 0!==e.readOnly&&this.setReadOnly(e.readOnly),void 0!==e.showBusyIndicator&&this.setShowBusyIndicator(e.showBusyIndicator),this}getAttributes(){return this.__attrHandler.getRef()}setReadOnly(e){return this.__attrHandler.checkAttribute(e,"readOnly",{validator:"boolean"})?(this.__attrHandler.readOnly=e,this.__processReadOnly(),this):this}__processReadOnly(){null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?this.__element.removeClass("read-only"):this.__element.addClass("read-only")}getReadOnly(){return this.__attrHandler.readOnly}setShowBusyIndicator(e){return this.__attrHandler.checkAttribute(e,"showBusyIndicator",{validator:"boolean"})?(this.__attrHandler.showBusyIndicator=e,this.__processShowBusyIndicator(),this):this}__processShowBusyIndicator(){}getShowBusyIndicator(){return this.__attrHandler.showBusyIndicator}setIsEnabled(e){return this.__attrHandler.checkAttribute(e,"isEnabled",{validator:"boolean"})?(this.__attrHandler.isEnabled=e,this.__processIsEnabled(),this):this}__processIsEnabled(){this.__attrHandler.isEnabled?this.__element.removeClass("tchmi-control-disabled"):this.__element.addClass("tchmi-control-disabled")}getIsEnabled(){return this.__attrHandler.isEnabled}setBoxShadow(e){return this.__attrHandler.checkAttribute(e,"boxShadow",{validator:"string"})?(this.__attrHandler.boxShadow=e,this.__processBoxShadow(),this):this}__processBoxShadow(){null==this.__attrHandler.boxShadow?this.__element.css("box-shadow",""):this.__element.css("box-shadow",this.__attrHandler.boxShadow)}getBoxShadow(){return this.__attrHandler.boxShadow}setContentPadding(t){return this.__attrHandler.checkAttribute(t,"contentPadding",{validator:[e.isFourSidedCss,()=>"number"==typeof t]})?(this.__attrHandler.contentPadding=t,this.__processContentPadding(),this):this}__processContentPadding(){if(null==this.__attrHandler.contentPadding)this.__element.css("--tchmi-ba-base-content-padding","");else{let t;t=e.isFourSidedCss(this.__attrHandler.contentPadding)?this.__attrHandler.contentPadding:{top:this.__attrHandler.contentPadding,right:this.__attrHandler.contentPadding,bottom:this.__attrHandler.contentPadding,left:this.__attrHandler.contentPadding},this.__element.css("--tchmi-ba-base-content-padding",""+t.top+(t.topUnit?t.topUnit:"px")+" "+t.right+(t.rightUnit?t.rightUnit:"px")+" "+t.bottom+(t.bottomUnit?t.bottomUnit:"px")+" "+t.left+(t.leftUnit?t.leftUnit:"px"))}}getContentPadding(){return this.__attrHandler.contentPadding}}a.Base=n,function(e){e.isIBase=function(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;e.busyHandler instanceof t.BusyHandler||(a=!1),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a}}(n=a.Base||(a.Base={}));class i{constructor(e){this.__legendIconHandler=new a.LegendIconHandler,this.__ctrl=e}getControl(){return this.__ctrl}set(e){i.appendErrorIndicator(this.__ctrl.getElement(),e,this.__legendIconHandler),this.__legendIconHandler.show()}reset(){i.detachErrorIndicator(this.__ctrl.getElement()),this.__legendIconHandler.hide()}static __onPressedHandler(e){e.stopPropagation()}static appendErrorIndicator(e,a,n){let s,r=e.children(".tchmi-ba-error-indicator");if(null!=r[0])return!1;switch(r=$("<div>").addClass("tchmi-ba-error-indicator"),a){case i.ErrorLevel.error:r.addClass("level-error"),s=t.Icons.Errors.Error,t.System.SVGLoader.get(s.path).then((e=>{r.append(e)})),null!=n&&(n.icon=t.Icons.convertIIconDataToIIconAttributes(s));break;case i.ErrorLevel.connection:r.addClass("level-connection"),s=t.Icons.Errors.Communication,t.System.SVGLoader.get(s.path).then((e=>{r.append(e)})),null!=n&&(n.icon=t.Icons.convertIIconDataToIIconAttributes(s));break;default:throw new t.BaseError("Invalid ErrorLevel!")}return e.append(r),r.on("mousedown pointerdown touchstart",this.__onPressedHandler),!0}static detachErrorIndicator(e){let t=e.children(".tchmi-ba-error-indicator");void 0!==t[0]&&(t.off("mousedown pointerdown touchstart",this.__onPressedHandler),t.detach())}}a.ErrorIndicator=i,function(e){let t;!function(e){e[e.error=0]="error",e[e.connection=1]="connection"}(t=e.ErrorLevel||(e.ErrorLevel={}))}(i=a.ErrorIndicator||(a.ErrorIndicator={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n{constructor(e){this.__textElement=$("<span>").addClass("text-element"),this.__owner=e,this.logger=new t.Logger({name:this.__owner.getId()}),this.__attrHandler=new t.AttrHandler(this),this.__owner.getElement().addClass("tchmi-ba-text-handler"),this.setOverflow(n.Overflow.ellipsis)}destroy(){this.__destroyTextSymbols()}__onResized(){if(this.__attrHandler.overflow===n.Overflow.marquee)this.__textElement.width((()=>{let e=this.__textElement[0].scrollWidth,t=this.__textElement[0].parentElement?.clientWidth;return e&&t&&e-t>0?(this.__owner.getElement().addClass("overflow-marquee"),e-t):(this.__owner.getElement().removeClass("overflow-marquee"),"")}));else this.__textElement.width("")}getControl(){return this.__owner}getTextElement(){return this.__textElement}__destroyTextSymbols(){if(null!=this.__textSymbols&&this.__textSymbols.length>0){for(const e of this.__textSymbols)e.destroy();delete this.__textSymbols}}setAttributes(e){return null==e?(this.__attrHandler.invalidAttribute("Attributes",e),this):(void 0!==e.text&&this.setText(e.text),void 0!==e.color&&this.setColor(e.color),void 0!==e.horizontalAlignment&&this.setHorizontalAlignment(e.horizontalAlignment),void 0!==e.verticalAlignment&&this.setVerticalAlignment(e.verticalAlignment),void 0!==e.fontSize&&this.setFontSize(e.fontSize,e.fontSizeUnit),void 0!==e.fontStyle&&this.setFontStyle(e.fontStyle),void 0!==e.fontWeight&&this.setFontWeight(e.fontWeight),void 0!==e.fontFamily&&this.setFontFamily(e.fontFamily),void 0!==e.overflow&&this.setOverflow(e.overflow),void 0!==e.userSelect&&this.setUserSelect(e.userSelect),void 0!==e.decorationColor&&this.setDecorationColor(e.decorationColor),void 0!==e.decorationLine&&this.setDecorationLine(e.decorationLine),void 0!==e.decorationStyle&&this.setDecorationStyle(e.decorationStyle),void 0!==e.wordWrap&&this.setWordWrap(e.wordWrap),this)}getAttributes(){return this.__attrHandler.getRef()}setText(a){if(!this.__attrHandler.checkAttribute(a,"text",{validator:"string"}))return this;if(this.__attrHandler.text=a,null==this.__attrHandler.text)return this.__processText(),this.__owner.onTextChanged(this.__attrHandler.text),this;let n=this.__attrHandler.text.split(/(%[ls]%.*?%\/[ls]%)/).filter((e=>e.length>0));if(n.length>1){this.__destroyTextSymbols(),this.__textSymbols=[];const a=[];let i=0;const s=()=>{if(n.length===a.length&&0===i){this.__attrHandler.text="";for(const e of a)this.__attrHandler.text+=e;this.__processText(),this.__owner.onTextChanged(this.__attrHandler.text)}};for(let r=0;r<n.length;r++){const o=n[r];if(e.Symbol.isSymbolExpression(o)){i++;const n=new e.Symbol(o);this.__textSymbols.push(n),n.watch((e=>{i>0&&i--,this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.value&&(a[r]=e.value,s())}))}else a[r]=o,s()}}else e.Symbol.isSymbolExpression(this.__attrHandler.text)?(this.__destroyTextSymbols(),this.__textSymbols=[new e.Symbol(this.__attrHandler.text)],this.__textSymbols[0].watch((e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.value&&(this.__attrHandler.text=e.value,this.__processText(),this.__owner.onTextChanged(this.__attrHandler.text))}))):(this.__processText(),this.__owner.onTextChanged(this.__attrHandler.text));return this}__processText(){null==this.__attrHandler.text?this.__textElement.html(""):this.__textElement.html(this.__attrHandler.text),this.__onResized()}getText(){return this.__attrHandler.text}setColor(e){return this.__attrHandler.checkColorAttribute(e,"color")?(this.__attrHandler.color=e,this.__processColor(),this):this}__processColor(){null==this.__attrHandler.color?this.__owner.getElement().css("--tchmi-ba-text-color",""):this.__owner.getElement().css("--tchmi-ba-text-color",this.__attrHandler.color.toString())}getColor(){return this.__attrHandler.color}setHorizontalAlignment(t){return this.__attrHandler.checkAttribute(t,"horizontalAlignment",{validator:e.isHorizontalAlignment})?(this.__attrHandler.horizontalAlignment=t,this.__processHorizontalAlignment(),this):this}__processHorizontalAlignment(){null==this.__attrHandler.horizontalAlignment?this.__owner.getElement().css("--tchmi-ba-text-horizontal-alignment",""):this.__owner.getElement().css("--tchmi-ba-text-horizontal-alignment",this.__attrHandler.horizontalAlignment.toLowerCase())}getHorizontalAlignment(){return this.__attrHandler.horizontalAlignment}setVerticalAlignment(t){return this.__attrHandler.checkAttribute(t,"verticalAlignment",{validator:e.isVerticalAlignment})?(this.__attrHandler.verticalAlignment=t,this.__processVerticalAlignment(),this):this}__processVerticalAlignment(){let e;switch(this.__attrHandler.verticalAlignment){case null:e="";break;case"Top":e="flex-start";break;case"Center":e="center";break;case"Bottom":e="flex-end";break;default:return}this.__owner.getElement().css("--tchmi-ba-text-vertical-alignment",e)}getVerticalAlignment(){return this.__attrHandler.verticalAlignment}setFontSize(e,t){return a.LayoutHandler.dimensionSetter(this.__attrHandler,"fontSize",e,t)?(this.__processFontSize(),this):this}__processFontSize(){null==this.__attrHandler.fontSize?this.__owner.getElement().css("--tchmi-ba-font-size",""):this.__owner.getElement().css("--tchmi-ba-font-size",this.__attrHandler.fontSize+(this.__attrHandler.fontSizeUnit?this.__attrHandler.fontSizeUnit:"px"))}getFontSize(){return this.__attrHandler.fontSize}getFontSizeUnit(){return this.__attrHandler.fontSizeUnit}setFontWeight(t){return this.__attrHandler.checkAttribute(t,"fontWeight",{validator:e.isFontWeight})?(this.__attrHandler.fontWeight=t,this.__processFontWeight(),this):this}__processFontWeight(){null==this.__attrHandler.fontWeight?this.__owner.getElement().css("--tchmi-ba-font-weight",""):this.__owner.getElement().css("--tchmi-ba-font-weight",this.__attrHandler.fontWeight.toLowerCase())}getFontWeight(){return this.__attrHandler.fontWeight}setFontStyle(t){return this.__attrHandler.checkAttribute(t,"fontStyle",{validator:e.isFontStyle})?(this.__attrHandler.fontStyle=t,this.__processFontStyle(),this):this}__processFontStyle(){null==this.__attrHandler.fontStyle?this.__owner.getElement().css("--tchmi-ba-font-style",""):this.__owner.getElement().css("--tchmi-ba-font-style",this.__attrHandler.fontStyle.toLowerCase())}getFontStyle(){return this.__attrHandler.fontStyle}setFontFamily(e){return this.__attrHandler.checkAttribute(e,"fontFamily",{validator:"string"})?(this.__attrHandler.fontFamily=e,this.__processFontFamily(),this):this}__processFontFamily(){null==this.__attrHandler.fontFamily?this.__owner.getElement().css("--tchmi-ba-font-family",""):this.__owner.getElement().css("--tchmi-ba-font-family",this.__attrHandler.fontFamily)}getFontFamily(){return this.__attrHandler.fontFamily}setDecorationColor(e){return this.__attrHandler.checkColorAttribute(e,"decorationColor")?(this.__attrHandler.decorationColor=e,this.__processDecorationColor(),this):this}__processDecorationColor(){null==this.__attrHandler.decorationColor?this.__owner.getElement().css("--tchmi-ba-text-decoration-color",""):this.__owner.getElement().css("--tchmi-ba-text-decoration-color",this.__attrHandler.decorationColor.toString())}getDecorationColor(){return this.__attrHandler.decorationColor}setDecorationLine(e){return this.__attrHandler.checkAttribute(e,"decorationLine",{validator:n.isTextDecorationLine})?(this.__attrHandler.decorationLine=e,this.__processDecorationLine(),this):this}__processDecorationLine(){null==this.__attrHandler.decorationLine?this.__owner.getElement().css("--tchmi-ba-text-decoration-line",""):this.__owner.getElement().css("--tchmi-ba-text-decoration-line",this.__attrHandler.decorationLine)}getDecorationLine(){return this.__attrHandler.decorationLine}setDecorationStyle(e){return this.__attrHandler.checkAttribute(e,"decorationStyle",{validator:n.isTextDecorationStyle})?(this.__attrHandler.decorationStyle=e,this.__processDecorationStyle(),this):this}__processDecorationStyle(){null==this.__attrHandler.decorationStyle?this.__owner.getElement().css("--tchmi-ba-text-decoration-style",""):this.__owner.getElement().css("--tchmi-ba-text-decoration-style",this.__attrHandler.decorationStyle)}getDecorationStyle(){return this.__attrHandler.decorationStyle}setUserSelect(e){return this.__attrHandler.checkAttribute(e,"userSelect",{validator:n.isUserSelect})?(this.__attrHandler.userSelect=e,this.__processUserSelect(),this):this}__processUserSelect(){null==this.__attrHandler.userSelect?this.__owner.getElement().css("--tchmi-ba-user-select",""):this.__owner.getElement().css("--tchmi-ba-user-select",this.__attrHandler.userSelect)}getUserSelect(){return this.__attrHandler.userSelect}setOverflow(e){return this.__attrHandler.checkAttribute(e,"overflow",{validator:"number"})?(this.__attrHandler.overflow=e,this.__processOverflow(),this):this}__processOverflow(){switch(this.__resizeObserver?.unobserve(this.__owner.getElement()[0]),this.__attrHandler.overflow){case n.Overflow.ellipsis:this.__owner.getElement().addClass("overflow-ellipsis"),this.__owner.getElement().removeClass("overflow-marquee");break;case n.Overflow.marquee:this.__owner.getElement().removeClass("overflow-ellipsis"),this.__resizeObserver||(this.__resizeObserver=new ResizeObserver((()=>this.__onResized()))),this.__resizeObserver.observe(this.__owner.getElement()[0]);break;default:this.__owner.getElement().removeClass("overflow-ellipsis"),this.__owner.getElement().removeClass("overflow-marquee")}this.__onResized()}getOverflow(){return this.__attrHandler.overflow}setWordWrap(e){return this.__attrHandler.checkAttribute(e,"wordWrap",{validator:"boolean"})?(this.__attrHandler.wordWrap=e,this.__processWordWrap(),this):this}__processWordWrap(){this.__attrHandler.wordWrap?(this.__owner.getElement().css("--tchmi-ba-text-white-space","normal"),this.__owner.getElement().css("word-break","break-word")):(this.__owner.getElement().css("--tchmi-ba-text-white-space",""),this.__owner.getElement().css("word-break",""))}getWordWrap(){return this.__attrHandler.wordWrap}}a.TextHandler=n,function(e){let t;e.isTextDecorationLine=function(e){return"none"===e||"underline"===e||"overline"===e||"line-through"===e||"initial"===e||"inherit"===e},e.isTextDecorationStyle=function(e){return"solid"===e||"double"===e||"dotted"===e||"dashed"===e||"wavy"===e||"initial"===e||"inherit"===e},e.isUserSelect=function(e){return"auto"===e||"none"===e||"text"===e||"all"===e},function(e){e[e.none=0]="none",e[e.ellipsis=1]="ellipsis",e[e.marquee=2]="marquee"}(t=e.Overflow||(e.Overflow={})),e.calculateTextSize=function(e,t){let a=$("<span>").css({position:"absolute",height:"auto",width:t?t+"px":"auto","font-weight":e.fontWeight?e.fontWeight.toLowerCase():"normal","font-size":e.fontSize+"px","white-space":e.wordWrap?"normal":"nowrap","word-break":"break-word","text-align":e.horizontalAlignment?e.horizontalAlignment:"left","z-index":5e3});a.html(e.text),$("body").append(a);let n=Number(a.innerHeight()),i=Number(a.innerWidth());return a.detach(),{width:i,height:n}}}(n=a.TextHandler||(a.TextHandler={}));class i extends a.Base{constructor(e,t){super(e,t),this.textHandler=new n(this),this.__element.addClass("text-control"),this.__attrHandler.textAttributes=this.textHandler.getAttributes()}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}onTextChanged(e){this.eventHandler.raise(i.TextControlEvents.onTextChanged,e)}setAttributes(e){return super.setAttributes(e),this.textHandler||(this.textHandler=new n(this)),null!=e.textAttributes&&this.textHandler.setAttributes(e.textAttributes),this}getAttributes(){return this.__attrHandler.getRef()}}a.TextControl=i,function(e){let t;!function(e){e.onTextChanged="onTextChanged"}(t=e.TextControlEvents||(e.TextControlEvents={})),e.isITextControl=function(e){return null!=e&&"object"==typeof e&&(!(e.textHandler instanceof n)&&"function"==typeof e.onTextChanged)}}(i=a.TextControl||(a.TextControl={}));a.Textblock=class extends i{constructor(e,a){super(e,a),this.baObjectHandler=new t.BaObjectHandler(this),this.valueHandler=new t.System.ValueHandler(this),this.textHandler=new n(this),this.__attrHandler.textAttributes=this.textHandler.getAttributes(),this.__element.append(this.textHandler.getTextElement()).addClass("textblock")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__updateBaObjectDisplay(){if(null!=this.baObjectHandler.baObject)switch(this.baObjectHandler.baObject.DataType){case t.DataType.boolean:1==this.__bValue?this.textHandler.setText(this.__activeText):this.textHandler.setText(this.__inactiveText);break;case t.DataType.number:if(null!=this.__rValue){let e=this.__rValue;null!=this.__attrHandler.digits&&(e=e.toFixed(this.__attrHandler.digits)),this.textHandler.setText(e+" "+this.__unit)}else this.textHandler.setText("??? "+this.__unit);break;case t.DataType.enum:null!=this.__stateTexts&&null!=this.__iValue?this.textHandler.setText(this.__stateTexts.get(this.__iValue)):this.textHandler.setText("???")}}onValueChanged(e){this.textHandler.setText(null!=e?e+"":null)}setAttributes(e){return super.setAttributes(e),void 0!==e.digits&&this.setDigits(e.digits),this}getAttributes(){return this.__attrHandler.getRef()}setDigits(e){return this.__attrHandler.checkAttribute(e,"digits",{validator:"number"})?(this.__attrHandler.digits=e,this.__updateBaObjectDisplay(),this):this}getDigits(){return this.__attrHandler.digits}processBaObject(){if(null!=this.baObjectHandler.baObject)if(null==this.baObjectHandler.baVariable)switch(this.baObjectHandler.baObject.DataType){case t.DataType.boolean:this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(e=>{this.__bValue=e,this.__updateBaObjectDisplay()})),this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,(e=>{this.__inactiveText=e?.get(0),this.__activeText=e?.get(1),this.__updateBaObjectDisplay()}),!0);break;case t.DataType.number:this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(e=>{this.__rValue=e,this.__updateBaObjectDisplay()})),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eUnit)?this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,(e=>{this.__unit=t.Helper.convertUnitToString(e),this.__updateBaObjectDisplay()})):this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eOutputUnit)&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eOutputUnit,(e=>{this.__unit=t.Helper.convertUnitToString(e),this.__updateBaObjectDisplay()}));break;case t.DataType.enum:this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(e=>{this.__iValue=e,this.__updateBaObjectDisplay()})),this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,(e=>{this.__stateTexts=e,this.__updateBaObjectDisplay()}));break;default:throw new Error("Invalid BaObject bound to Textblock! Only Binary, Analog and Multistate objects are allowed!")}else this.valueHandler.setBaVariable(this.baObjectHandler.baVariable);else this.valueHandler.setBaVariable(null)}}}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){let a;!function(e){e[e.Invalid=-1]="Invalid",e[e.Button=0]="Button",e[e.ToggleButton=1]="ToggleButton",e[e.Combobox=2]="Combobox",e[e.Checkbox=3]="Checkbox",e[e.InputBox=4]="InputBox",e[e.DateTimeField=5]="DateTimeField",e[e.Slider=6]="Slider",e[e.Textblock=7]="Textblock",e[e.Icon=8]="Icon"}(a=t.ComponentType||(t.ComponentType={}));class n extends t.BaseNode{constructor(e,t){super(e,t),this.__controlInteractionHandler=(e,t)=>{if(null==this.__controls)return;let a;for(let e=0;e<this.__controls.length;e++)if(this.__controls[e].control.getId()===t.getId()){a=this.__controls[e].options;break}a&&a.internalCallback&&a.internalCallback()},this.__element.addClass("tchmi-ba-control-container")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__controls?.forEach((e=>{null!=e.options?.destroyOnUserInteractionFinished&&e.options.destroyOnUserInteractionFinished(),e.options?.omitDestroy||e.control.destroy()})),super.destroy()}__addControl(i){let s,r;if(this.__controls||(this.__controls=[]),i instanceof t.Base)s=i,r={control:s,options:{type:a.Invalid,omitDestroy:!0}};else{let t=0,a=this.__id+"-control-"+t;for(;e.Globals.CreatedBaseNodes.has(a);)t++,a=this.__id+"-control-"+t;s=n.createControl(a,i,this),r={control:s,options:i}}let o=this.__getEvent(s);return null!=o&&null!=r.options&&(r.options.destroyOnUserInteractionFinished=s.eventHandler.register(o,this.__controlInteractionHandler)),this.__controls.push(r),s}__getEvent(e){switch(e.constructor){case t.Button:return t.Button.ButtonEvents.onPressed;case t.ToggleButton:return t.ToggleButton.ToggleButtonEvents.onToggleStateChanged;case t.Checkbox:return t.Checkbox.CheckboxEvents.onUserInteractionFinished;case t.Combobox:return t.Combobox.ComboboxEvents.onUserInteractionFinished;case t.InputBox:return t.InputBox.InputBoxEvents.onUserInteractionFinished;case t.Slider:return t.Slider.SliderEvents.onUserInteractionFinished;case t.DateTimeField:return t.DateTimeField.DateTimeFieldEvents.onUserInteractionFinished;default:return null}}__appendControlsInOrder(){if(this.__controls){this.__controls=e.Helper.Array.mergeSort(this.__controls,!0,((e,t)=>null==e.options?.settings?.order||null!=t.options?.settings?.order&&e.options.settings.order<t.options.settings.order));for(let e=0;e<this.__controls.length;e++)this.__element.append(this.__controls[e].control.getElement())}}static createControl(e,n,i){let s;switch(n.type){case a.Button:s=new t.Button(e,i),n.internalCallback=()=>{n.callback&&n.callback(void 0,n.settings?.callbackParams,s)};break;case a.ToggleButton:s=new t.ToggleButton(e,i),n.internalCallback=()=>{n.callback&&n.callback(s.getToggleState(),n.settings?.callbackParams,s)};break;case a.Checkbox:s=new t.Checkbox(e,i),n.internalCallback=()=>{n.callback&&n.callback(s.getState(),n.settings?.callbackParams,s)},void 0===n.settings&&(n.settings={}),void 0===n.settings.activeText&&(n.settings.activeText=null),void 0===n.settings.inactiveText&&(n.settings.inactiveText=null);break;case a.Combobox:s=new t.Combobox(e,i),n.internalCallback=()=>{n.callback&&n.callback(s.getSelectedValue(),n.settings?.callbackParams,s)};break;case a.DateTimeField:s=new t.DateTimeField(e,i),n.internalCallback=()=>{n.callback&&n.callback(s.getDate(),n.settings?.callbackParams,s)};break;case a.InputBox:s=new t.InputBox(e,i),n.internalCallback=()=>{n.callback&&n.callback(s.getValue(),n.settings?.callbackParams,s)};break;case a.Slider:s=new t.Slider(e,i),n.internalCallback=()=>{n.callback&&n.callback(s.getValue(),n.settings?.callbackParams,s)},s instanceof t.Slider&&(s.setShowScale(!1),s.setShowValue(!1));break;case a.Textblock:s=new t.Textblock(e,i);break;case a.Icon:s=new t.Icon(e,i);break;default:throw new Error("Not implemented ComponentType!")}return n.settings&&s instanceof t.Base&&s.setAttributes(n.settings),n.cbOnCreated&&n.cbOnCreated(s),s}addControl(e){let t=this.__addControl(e);return this.__appendControlsInOrder(),this.__controlCollectionChangedCBs?.forEach((e=>e(t,"added"))),t}addControls(e){let t=[];if(e instanceof Array)for(let a=0;a<e.length;a++)t.push(this.__addControl(e[a]));return this.__appendControlsInOrder(),t.forEach((e=>this.__controlCollectionChangedCBs?.forEach((t=>t(e,"added"))))),t}removeControl(e){if(null==e)return!1;if(this.__controls){if("string"==typeof e&&(e=this.getControl(e)),null==e)return!1;let t;for(let a=0;a<this.__controls.length;a++)if(t=this.__controls[a],t.control.getId()===e.getId())return null!=t.options?.destroyOnUserInteractionFinished&&t.options.destroyOnUserInteractionFinished(),t.control.destroy(),this.__controls.splice(a,1),this.__controlCollectionChangedCBs?.forEach((e=>e(t.control,"removed"))),!0}return!1}removeAllControls(){if(this.__controls){for(;this.__controls.length>0;)this.removeControl(this.__controls[this.__controls.length-1].control);delete this.__controls}}getElement(){return this.__element}getControls(){let e=[];return this.__controls?.forEach((t=>e.push(t.control))),e}getControl(e){let a;if(this.__controls)for(let n=0;n<this.__controls.length;n++)if("string"==typeof e){if(this.__controls[n].options?.name===e){a=this.__controls[n].control;break}}else if(e instanceof t.Base&&this.__controls[n].control.getId()===e.getId()){a=this.__controls[n].control;break}return a}hasControl(e){return t.Base,null!=this.getControl(e)}onControlsCollectionChanged(e){this.__controlCollectionChangedCBs||(this.__controlCollectionChangedCBs=[]),this.__controlCollectionChangedCBs.push(e)}setControlsHorizonzalAlignment(e){switch(e){case"Left":this.__element.css("justify-content","flex-start");break;case"Right":this.__element.css("justify-content","flex-end");break;default:this.__element.css("justify-content","")}return this}setControlsVerticalAlignment(e){switch(e){case"Top":this.__element.css("align-items","flex-start");break;case"Bottom":this.__element.css("align-items","flex-end");break;default:this.__element.css("align-items","center")}return this}}t.ControlContainer=n,function(t){t.isIControlOptions=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("type","number"),void 0!==t.callback&&n.set("callback","function"),void 0!==t.name&&n.set("name","string"),void 0!==t.settings&&n.set("settings","object"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.createIControlOptions=function(){return{type:a.Textblock,callback:()=>null,settings:{}}}}(n=t.ControlContainer||(t.ControlContainer={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.Base{constructor(n,i){super(n,i),this.iconHandler=new t.Icons.IconHandler(this),this.__legendIconHandler=new a.LegendIconHandler,this.__destroyOnIconChanged=e.EventProvider.register(t.Icons.IconHandler.IconHandlerEvents.onIconChanged,(()=>{this.__updateLegendIcon()})),this.__iconShowInLegend=!1,this.__iconDescription="",this.__iconCategory="",this.__element.addClass("icon")}__attach(){this.__isAttached||(this.__processLegendVisibility(),super.__attach())}__detach(){this.__isAttached&&(this.__legendIconHandler.hide(),super.__detach())}destroy(){null!=this.iconHandler&&this.iconHandler.destroy(),null!=this.__destroyOnIconChanged&&this.__destroyOnIconChanged(),super.destroy()}__processLegendVisibility(){this.__iconShowInLegend?this.__legendIconHandler.show():this.__legendIconHandler.hide()}__updateLegendIcon(){let e,a=this.iconHandler.getIcon(),n=this.__iconCategory||"",i=this.__iconDescription||"";null!=a?(e=t.Icons.convertIIconDataToIIconAttributes(t.Icons.createIIconData(a,n,i)),e.iconOverlays=this.iconHandler.getIconOverlays(),this.__legendIconHandler.icon=e,this.__processShowInLegend()):this.__legendIconHandler.icon=null}setAttributes(e){return super.setAttributes(e),this.iconHandler.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}setShowInLegend(e){return this.__iconShowInLegend=e,this.__processShowInLegend(),this}__processShowInLegend(){this.__iconShowInLegend?this.__legendIconHandler.show():this.__legendIconHandler.hide()}getShowInLegend(){return this.__iconShowInLegend}setIconCategoryLegend(e){return this.__iconCategory=e,this.__processIconCategoryLegend(),this}__processIconCategoryLegend(){this.__updateLegendIcon()}getIconCategoryLegend(){return this.__iconCategory}setIconDescriptionLegend(e){return this.__iconDescription=e,this.__updateLegendIcon(),this}__processIconDescriptionLegend(){this.__updateLegendIcon()}getIconDescriptionLegend(){return this.__iconDescription}}a.Icon=n}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.TextControl{constructor(n,i){super(n,i),this.__isPressed=!1,this.iconHandler=new t.Icons.IconHandler(this),this.__legendIconHandler=new a.LegendIconHandler,this.__destroyOnIconChanged=e.EventProvider.register(t.Icons.IconHandler.IconHandlerEvents.onIconChanged,(()=>{this.__updateLegendIcon()})),this.__iconShowInLegend=!1,this.__iconDescription="",this.__iconCategory="",this.__pressCnt=0,this.__element.addClass("button"),this.switchColorOnDown=!0,this.textHandler.setUserSelect("none"),this.setIsEnabled(!0),this.__downHandler=e=>this.__onDown(e),this.__pointerleaveHandler=e=>this.__onPointerLeave(e),this.__pointerenterHandler=e=>this.__onPointerEnter(e),this.__releasedHandler=e=>this.__onReleased(e)}onTextChanged(e){super.onTextChanged(e);let t=this.__element.children(".text-element");null==e||0==e.length?(t[0]&&this.textHandler.getTextElement().detach(),this.textHandler.getTextElement().html("")):(t[0]||this.__element.append(this.textHandler.getTextElement()),this.textHandler.getTextElement().html(e))}__onDown(e){0!=this.checkAccess(t.Server.AccessRight.operate)&&0!=this.__attrHandler.isEnabled&&e.button===t.MouseButtons.left&&($(document).on("pointerup",this.__releasedHandler),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__element.addClass("down"),this.__isPressed=!0)}__onPointerLeave(e){this.__element.removeClass("down"),this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.on("pointerenter",this.__pointerenterHandler),this.__isPressed=!1}__onPointerEnter(e){this.__element.addClass("down"),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),this.__isPressed=!0}__onReleased(e){this.__element.removeClass("down"),this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),$(document).off("pointerup",this.__releasedHandler),!0===this.__isPressed&&this.eventHandler.raise(n.ButtonEvents.onPressed),this.__isPressed=!1}__onPressed(e,t){switch(this.__pressCnt){case 0:setTimeout((()=>this.__pressCnt=0),n.DoublePressDuration),this.__pressCnt++;break;case 1:this.eventHandler.raise(n.ButtonEvents.onDoublePressed),this.__pressCnt=0;break;default:this.__pressCnt=0}}__attach(){this.__isAttached||(this.__attrHandler.readOnly||(this.__element.on("pointerdown",this.__downHandler),this.__destroyersToCallOnDetach.push(this.eventHandler.register(n.ButtonEvents.onPressed,((e,t)=>this.__onPressed(e,t))))),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__downHandler),this.__legendIconHandler.hide(),super.__detach())}destroy(){null!=this.iconHandler&&this.iconHandler.destroy(),null!=this.__destroyOnIconChanged&&this.__destroyOnIconChanged(),super.destroy()}__updateLegendIcon(){let e,a=this.iconHandler.getIcon(),n=this.__iconCategory||"",i=this.__iconDescription||"";null!=a?(e=t.Icons.convertIIconDataToIIconAttributes(t.Icons.createIIconData(a,n,i)),e.iconOverlays=this.iconHandler.getIconOverlays(),this.__legendIconHandler.icon=e,this.__processShowInLegend()):this.__legendIconHandler.icon=null}static addBadge(e,t){let a=e.children(".tchmi-ba-badge");null!=t&&t>0?(a[0]||(a=$("<div>").addClass("tchmi-ba-badge"),e.append(a)),t<100?a.html(String(t)):a.html(String("99+"))):a[0]&&a.detach()}disableInteraction(){this.__element.off("pointerdown",this.__downHandler)}enableInteraction(){this.__element.on("pointerdown",this.__downHandler)}set switchColorOnDown(e){1==e?this.__element.addClass("switch-color-on-down"):this.__element.removeClass("switch-color-on-down")}setAttributes(e){return super.setAttributes(e),void 0!==e.textAttributes?.colorPressed&&this.setTextColorPressed(e.textAttributes.colorPressed),this.iconHandler.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}setTextColorPressed(e){return void 0===e?this:null==e||t.Color.isRGBAColor(e)?(!t.Color.isRGBAColor(e)||e instanceof t.Color.RGBAColor||(e=new t.Color.RGBAColor(e)),tchmi_equal(e,this.__attrHandler.textAttributes?.colorPressed)?(this.__attrHandler.equalAttribute("TextColorPressed"),this):(this.__attrHandler.textAttributes||(this.__attrHandler.textAttributes={}),this.__attrHandler.textAttributes.colorPressed=e,this.__processTextColorPressed(),this)):(this.__attrHandler.invalidAttribute("TextColorPressed",e),this)}__processTextColorPressed(){null!=this.__attrHandler.textAttributes&&(null==this.__attrHandler.textAttributes.colorPressed?this.__element.css("--tchmi-ba-global-button-text-color-pressed",""):this.__element.css("--tchmi-ba-global-button-text-color-pressed",this.__attrHandler.textAttributes.colorPressed.toString()))}getTextColorPressed(){return this.__attrHandler.textAttributes?.colorPressed}setShowInLegend(e){return this.__iconShowInLegend=e,this.__processShowInLegend(),this}__processShowInLegend(){this.__iconShowInLegend?this.__legendIconHandler.show():this.__legendIconHandler.hide()}getShowInLegend(){return this.__iconShowInLegend}setIconCategoryLegend(e){return this.__iconCategory=e,this.__processIconCategoryLegend(),this}__processIconCategoryLegend(){this.__updateLegendIcon()}getIconCategoryLegend(){return this.__iconCategory}setIconDescriptionLegend(e){return this.__iconDescription=e,this.__updateLegendIcon(),this}__processIconDescriptionLegend(){this.__updateLegendIcon()}getIconDescriptionLegend(){return this.__iconDescription}__processReadOnly(){super.__processReadOnly(),this.__attrHandler.readOnly?this.__element.off("pointerdown",this.__downHandler):this.__isAttached&&this.__element.on("pointerdown",this.__downHandler)}}a.Button=n,function(e){let t;!function(e){e.onPressed="onButtonPressed",e.onDoublePressed="onButtonDoublePressed"}(t=e.ButtonEvents||(e.ButtonEvents={})),e.DoublePressDuration=200}(n=a.Button||(a.Button={}));class i extends n{constructor(e,a){super(e,a),this.__element.addClass("toggle-button"),this.baObjectHandler=new t.BaObjectHandler(this),this.setToggleState(!1)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.baObjectHandler.destroy(),super.destroy()}__onDown(e){0!=this.checkAccess(t.Server.AccessRight.operate)&&0!=this.__attrHandler.isEnabled&&e.button===t.MouseButtons.left&&($(document).on("pointerup",this.__releasedHandler),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__attrHandler.toggleState?this.__element.removeClass("down"):this.__element.addClass("down"),this.__isPressed=!0)}__onPointerLeave(e){this.__attrHandler.toggleState?this.__element.addClass("down"):this.__element.removeClass("down"),this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.on("pointerenter",this.__pointerenterHandler),this.__isPressed=!1}__onPointerEnter(e){this.__attrHandler.toggleState?this.__element.removeClass("down"):this.__element.addClass("down"),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),this.__isPressed=!0}__onReleased(e){this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),$(document).off("pointerup",this.__releasedHandler),this.__isPressed&&(this.__attrHandler.toggleState?this.__element.removeClass("down"):this.__element.addClass("down"),this.__attrHandler.toggleState=!this.__attrHandler.toggleState,this.eventHandler.raise(i.ToggleButtonEvents.onToggleStateChanged)),this.__isPressed=!1}setAttributes(e){return super.setAttributes(e),void 0!==e.toggleState&&this.setToggleState(e.toggleState),this}getAttributes(){return this.__attrHandler.getRef()}setToggleState(e){return this.__attrHandler.checkAttribute(e,"toggleState",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.toggleState=e,this.__processToggleState(),this):this}__processToggleState(){this.__attrHandler.toggleState?this.__element.addClass("down"):this.__element.removeClass("down")}getToggleState(){return this.__attrHandler.toggleState}processBaObject(){this.baObjectHandler.baObject&&this.baObjectHandler.baObject.DataType===t.DataType.boolean&&(this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(e=>{this.setToggleState(e)})),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess()))}}a.ToggleButton=i,function(e){let t;!function(e){e.onToggleStateChanged="onToggleStateChanged"}(t=e.ToggleButtonEvents||(e.ToggleButtonEvents={}))}(i=a.ToggleButton||(a.ToggleButton={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){let a,n;!function(a){class i extends a.Base{constructor(e,a){super(e,a),this.baObjectHandler=new t.BaObjectHandler(this),this.__element.addClass("calendar-list"),this.__list=new t.Navigation.ControlList(this.__id+"-list",this).setAttributes({layout:{width:100,widthUnit:"%",height:100,heightUnit:"%"}}),this.__element.append(this.__list.getElement())}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__list.destroy(),this.baObjectHandler.destroy(),super.destroy()}processBaObject(){if(null!=this.baObjectHandler.baObject)if(this.baObjectHandler.baObject instanceof n.BaView){let e=this.baObjectHandler.baObject.getBaCalendarObjects();e.length>0?e.forEach((e=>{e.loadAttributes().then((()=>{e.getIsValid()&&this.addBaCalendar(e)}))})):a.DialogWindow.alert(`No calendar objects found in bound BaView '${this.baObjectHandler.baObject.InstancePath}'!`,{headline:"No calendar objects found",logger:this.logger})}else this.baObjectHandler.baObject instanceof n.BaBasicObject&&(this.baObjectHandler.baObject.Identifier.ObjectType===n.ObjectType.eCalendar?this.baObjectHandler.baObject.loadAttributes().then((()=>{this.baObjectHandler.baObject?.getIsValid()&&this.addBaCalendar(this.baObjectHandler.baObject)})):a.DialogWindow.alert(`Bound BaObject '${this.baObjectHandler.baObject.InstancePath}' is not a calendar object!`,{headline:"No calendar object",logger:this.logger}))}static calendarEntryToString(e){switch(e.eType){case n.DateValChoice.eDate:return new n.BaDate(e.uDate.stDate).toString(n.BaDate.Format.din1355_1);case n.DateValChoice.eDateRange:return new n.BaDate(e.uDate.stDateRange.stDateFrom).toString(n.BaDate.Format.din1355_1)+" - "+new n.BaDate(e.uDate.stDateRange.stDateTo).toString(n.BaDate.Format.din1355_1);case n.DateValChoice.eWeekNDay:let t,a,s;if(e.uDate.stWeekNDay.eWeekday===n.Weekday.Unspecified)t="Any day";else t=e.uDate.stWeekNDay.eWeekday>n.Weekday.eSunday||e.uDate.stWeekNDay.eWeekday<n.Weekday.eMonday?"?":i.WeekDays[e.uDate.stWeekNDay.eWeekday-1];switch(e.uDate.stWeekNDay.eWeekOfMonth){case n.Week.Unspecified:a="any week";break;case n.Week.eWeek1:a="days numbered 1-7";break;case n.Week.eWeek2:a="days numbered 8-14";break;case n.Week.eWeek3:a="days numbered 15-21";break;case n.Week.eWeek4:a="days numbered 22-28";break;case n.Week.eWeek5:a="days numbered 29-31";break;default:a="invalid"}switch(e.uDate.stWeekNDay.eMonth){case n.Month.Unspecified:s="any month";break;case n.Month.odd:s="odd month";break;case n.Month.even:s="even month";break;default:s=e.uDate.stWeekNDay.eMonth>n.Month.eDecember||e.uDate.stWeekNDay.eMonth<n.Month.Invalid?"?":i.MonthNames[e.uDate.stWeekNDay.eMonth-1]}return`${t} in ${a} in ${s}`;default:return"Invalid calendar entry"}}static createMonthCbData(){let e=[];for(let t=n.Month.eJanuary;t<=n.Month.eDecember;t++)e.push({text:i.MonthNames[t-1],value:t});return e=e.concat([{text:"Odd",value:n.Month.odd},{text:"Even",value:n.Month.even},{text:"Every",value:n.Month.Unspecified}]),e}static createWeekOfMonthCbData(){return[{text:"First",value:n.Week.eWeek1},{text:"Second",value:n.Week.eWeek2},{text:"Third",value:n.Week.eWeek3},{text:"Fouth",value:n.Week.eWeek4},{text:"Fifth",value:n.Week.eWeek5},{text:"Every",value:n.Week.Unspecified}]}static createDayOfWeekCbData(){let e=[];for(let t=n.Weekday.eMonday;t<=n.Weekday.eSunday;t++)e.push({text:i.WeekDays[t-1],value:t});return e.push({text:"Every",value:n.Weekday.Unspecified}),e}async addBaCalendar(e){e.tryReadBaVariable(n.BaParameterId.eDescription).then((s=>{if(e.Identifier.ObjectType!==n.ObjectType.eCalendar)return;let r=e.tryGetBaVariable(n.BaParameterId.eDateList);if(null==r)return;if(null==this.__attrHandler.calendars&&(this.__attrHandler.calendars=new Map),this.__attrHandler.calendars.has(e.InstancePath))return void this.logger.warn(`Calendar with instance path ${e.InstancePath} has already been added!`);let o=new Map,l=new Map,d=this.__list.addEntry(e.InstancePath,{Title:s,controls:[{type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Confirm.path,layout:{maxWidth:25}},callback:()=>{let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmSaveChangesOfCalendar),e.InstancePath);confirm(a)&&r?.write(r.editedValue)}},{type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Plus.path,layout:{maxWidth:25}},callback:()=>{let e,t={eType:n.DateValChoice.Invalid,uDate:{stDate:n.BaDate.fromDate(new Date),stDateRange:{stDateFrom:n.BaDate.fromDate(new Date),stDateTo:n.BaDate.fromDate(new Date)},stWeekNDay:{eMonth:n.Month.Unspecified,eWeekOfMonth:n.Week.Unspecified,eWeekday:n.Weekday.Unspecified}}};if(confirm("New Date entry?"))t.eType=n.DateValChoice.eDate;else if(confirm("New DateRange entry?"))t.eType=n.DateValChoice.eDateRange;else{if(!confirm("New Week 'n' Day entry?"))return;t.eType=n.DateValChoice.eWeekNDay}if(null==r||null==r?.editedValue)return;for(e=0;e<r.editedValue.length;e++)if(r.editedValue[e].eType===n.DateValChoice.Invalid){r.editedValue[e]=t;break}let a=d.getId()+"-"+e,i=h(e,t),s=d.getSublist();s?s.addEntry(a,i):(d.hasEntry(a)&&d.removeEntry(a),d.addEntry(a,i))}},{type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.MenuBurger.path,iconHeight:60,iconHeightUnit:"%",iconWidth:60,iconWidthUnit:"%",layout:{maxWidth:25}},callback:()=>{e.openParameterDialog()}}]});this.__attrHandler.calendars.set(e.InstancePath,e);const h=(e,s)=>{let h,_=d.getId()+"-"+e,c={cbOnCreated:[e=>{h=e}]};switch(c.controls=[{type:a.ComponentType.Textblock,settings:{textAttributes:{horizontalAlignment:"Right",text:i.calendarEntryToString(s)}},cbOnCreated:e=>{o.set(_,e)}},{type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Delete.path,layout:{width:25,maxWidth:25}},callback:()=>{if(!h)throw new Error("No date entry found!");confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmRemoveEntry))&&(h.getBaParent().removeEntry(_),null!=r?.editedValue&&r.editedValue?.splice(e,1),l.delete(_),o.delete(_))}}],s.eType){case n.DateValChoice.eDate:c.name=_,c.cbOnCreated.push((e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Date,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))})),c.Children=new Map([["date",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Date,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}],controls:{type:a.ComponentType.DateTimeField,settings:{mode:a.DateTimeField.Mode.date,date:new n.BaDate(s.uDate.stDate).toDate(),readOnly:!1,layout:{maxWidth:120}},callback:t=>{if(null!=r?.editedValue){let a=o.get(_);r.editedValue[e].uDate.stDate=n.BaDate.fromDate(t),a?.textHandler.setText(i.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(_);t&&(t.ctrls.dateFrom=e)}}}]]);break;case n.DateValChoice.eDateRange:let d,h;c.name=_,c.cbOnCreated.push((e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DateRange,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))})),c.Children=new Map([["date-from",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DateFrom,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}],controls:{type:a.ComponentType.DateTimeField,settings:{mode:a.DateTimeField.Mode.date,date:new n.BaDate(s.uDate.stDateRange.stDateFrom).toDate(),readOnly:!1,layout:{maxWidth:120}},callback:t=>{if(null!=d&&null!=h){if(t>h.getDate())return alert("Date from is after date to, which is not allowed!"),void d.openPicker();if(null!=r?.editedValue){let a=o.get(_);r.editedValue[e].uDate.stDateRange.stDateFrom=n.BaDate.fromDate(t),a?.textHandler.setText(i.calendarEntryToString(r.editedValue[e]))}}},cbOnCreated:e=>{let t=l.get(_);t&&(t.ctrls.dateFrom=e),d=e}}}],["date-to",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DateTo,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}],controls:{type:a.ComponentType.DateTimeField,settings:{mode:a.DateTimeField.Mode.date,date:new n.BaDate(s.uDate.stDateRange.stDateTo).toDate(),readOnly:!1,layout:{maxWidth:120}},callback:t=>{if(null!=d&&null!=h){if(t<d.getDate())return alert("Date from is after date to, which is not allowed!"),void h.openPicker();if(null!=r?.editedValue){let a=o.get(_);r.editedValue[e].uDate.stDateRange.stDateTo=n.BaDate.fromDate(t),a?.textHandler.setText(i.calendarEntryToString(r.editedValue[e]))}}},cbOnCreated:e=>{let t=l.get(_);t&&(t.ctrls.dateTo=e),h=e}}}]]);break;case n.DateValChoice.eWeekNDay:c.cbOnCreated.push((e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.WeekNDay,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))})),c.Children=new Map([["day-of-week",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DayOfWeek,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}],controls:{type:a.ComponentType.Combobox,settings:{readOnly:!1,layout:{maxWidth:120},data:i.createDayOfWeekCbData(),selectedValue:s.uDate.stWeekNDay.eWeekday},callback:t=>{if(null!=r?.editedValue){let a=o.get(_);r.editedValue[e].uDate.stWeekNDay.eWeekday=t,a?.textHandler.setText(i.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(_);t&&(t.ctrls.dayOfWeekCb=e)}}}],["week-of-month",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.WeekOfMonth,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}],controls:{type:a.ComponentType.Combobox,settings:{readOnly:!1,layout:{maxWidth:120},data:i.createWeekOfMonthCbData(),selectedValue:s.uDate.stWeekNDay.eWeekOfMonth},callback:t=>{if(null!=r?.editedValue){let a=o.get(_);r.editedValue[e].uDate.stWeekNDay.eWeekOfMonth=t,a?.textHandler.setText(i.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(_);t&&(t.ctrls.weekOfMonthCb=e)}}}],["month",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Month,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}],controls:{type:a.ComponentType.Combobox,settings:{readOnly:!1,layout:{maxWidth:120},data:i.createMonthCbData(),selectedValue:s.uDate.stWeekNDay.eMonth},callback:t=>{if(null!=r?.editedValue){let a=o.get(_);r.editedValue[e].uDate.stWeekNDay.eMonth=t,a?.textHandler.setText(i.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(_);t&&(t.ctrls.monthCb=e)}}}]])}return c};this.baObjectHandler.watchBaVariable(r,(e=>{if(r&&null!=e){r.editedValue=e;for(let t=0;t<e.length;t++){let a=d.getId()+"-"+t,s=e[t],r=d.getSublist(),_=o.get(a),c=l.get(a);if(null!=c&&null!=_&&c.type!=s.eType&&r?.hasEntry(a)&&(r.removeEntry(a),l.delete(a),o.delete(a),_=void 0,c=void 0),_)switch(_.textHandler.setText(i.calendarEntryToString(s)),s.eType){case n.DateValChoice.eDate:null!=c?.ctrls.dateFrom&&c.ctrls.dateFrom.setDate(new n.BaDate(s.uDate.stDate).toDate());break;case n.DateValChoice.eDateRange:null!=c?.ctrls.dateFrom&&c.ctrls.dateFrom.setDate(new n.BaDate(s.uDate.stDateRange.stDateFrom).toDate()),null!=c?.ctrls.dateTo&&c.ctrls.dateTo.setDate(new n.BaDate(s.uDate.stDateRange.stDateTo).toDate());break;case n.DateValChoice.eWeekNDay:null!=c?.ctrls.monthCb&&c.ctrls.monthCb.setSelectedValue(s.uDate.stWeekNDay.eMonth),null!=c?.ctrls.weekOfMonthCb&&c.ctrls.weekOfMonthCb.setSelectedValue(s.uDate.stWeekNDay.eWeekOfMonth),null!=c?.ctrls.dayOfWeekCb&&c.ctrls.dayOfWeekCb.setSelectedValue(s.uDate.stWeekNDay.eWeekday);break;default:r?.hasEntry(a)&&(r.removeEntry(a),l.delete(a),o.delete(a))}else{if(s.eType<=n.DateValChoice.Invalid)return;l.set(a,{type:s.eType,ctrls:{}});let e=h(t,s);r?r.addEntry(a,e):(d.hasEntry(a)&&d.removeEntry(a),d.addEntry(a,e))}}}}))})).catch((e=>{t.BaseError.warn(e)}))}setAttributes(e){return super.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}}a.CalendarList=i,function(i){i.openCalendarListDialog=function e(s){if(null==s){if(null==n.BaDevices)return;for(let t of n.BaDevices.values())e(t.ProjectStructure)}else{let e="CalendarList-"+s.InstancePath,n=1;for(;t.Globals.CreatedBaseNodes.has(e);)e="CalendarList-"+s.InstancePath+n,n++;let r=new i(e,null);r.baObjectHandler.setBaObject(s),r.getElement().css({width:"100%",height:"100%",position:"relative"});let o=a.DialogWindow.createDialogWindow({appearance:{headline:{textAttributes:{text:`Calendar list | ${s.InstancePath}`}},content:r.getElement(),layout:{maxWidth:i.DefaultCalendarListDialogSize.width,maxHeight:i.DefaultCalendarListDialogSize.height},buttons:a.DialogWindow.Buttons.Cancel},callbacks:{cbClosed:()=>{l(),r.destroy()}},behaviour:{destroyOnClose:!0}})?.open();const l=t.Locale.Localization.watchText(t.Locale.LangKey.CalendarList,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&o?.setHeadlineText(e.text+` | ${s.InstancePath}`)}))}},i.WeekDays=[],i.WeekDaysShort=[],i.MonthNames=[],i.MonthNamesShort=[],i.DefaultCalendarListDialogSize={width:750,height:400};let s=()=>{e.EventProvider.register(t.TcHmiEvents.onWebSocketOpened,(a=>{a.destroy();let n=[];for(let e=0;e<t.Locale.WeekDaysLongLangKey.length;e++)n.push(t.Locale.Localization.watchText(t.Locale.WeekDaysLongLangKey[e],(a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(i.WeekDays[e]=a.text)})));for(let e=0;e<t.Locale.WeekDaysShortLangKey.length;e++)n.push(t.Locale.Localization.watchText(t.Locale.WeekDaysShortLangKey[e],(a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(i.WeekDaysShort[e]=a.text)})));for(let e=0;e<t.Locale.MonthsLongLangKey.length;e++)n.push(t.Locale.Localization.watchText(t.Locale.MonthsLongLangKey[e],(a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(i.MonthNames[e]=a.text)})));for(let e=0;e<t.Locale.MonthsShortLangKey.length;e++)n.push(t.Locale.Localization.watchText(t.Locale.MonthsShortLangKey[e],(a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(i.MonthNamesShort[e]=a.text)})));e.EventProvider.register(t.TcHmiEvents.onWebSocketClosed,(e=>{e.destroy(),n.forEach((e=>e())),s()}))}))};s()}(i=a.CalendarList||(a.CalendarList={}))}(a=t.Components||(t.Components={})),function(e){e.BaView.prototype.getBaCalendarObjects=function(){let t=[];if(this instanceof e.BaView)for(let a of this.Children.values())a instanceof e.BaView&&(t=t.concat(a.getBaCalendarObjects())),a instanceof e.BaBasicObject&&a.Identifier.ObjectType===e.ObjectType.eCalendar&&t.push(a);return t}}(n=t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){let n;!function(e){e[e.None=0]="None",e[e.BaObject=1]="BaObject",e[e.BaInterface=2]="BaInterface",e[e.BaIExc=100]="BaIExc",e[e.BaICal=101]="BaICal"}(n||(n={}));class i extends a.Base{onResized(){this.__updateVisibleEvents()}constructor(e,o){super(e,o),this.__initDone=!1,this.__dataOrigin=n.None,this.__hasChanges=!1,this.__maxExceptions=0,this.__maxDaily=0,this.__maxDailyRef=0,this.__indexBaId=r.IndexStartBa,this.__indexBaRefId=r.IndexStartBa,this.__contextMenu=null,this.__isDialogWindowBtnDelete=!1,this.__handlerSwitchMonth=e=>{"<"===$(e.target).text()?this.__dateSelected.setMonth(this.__dateSelected.getMonth()-1):this.__dateSelected.setMonth(this.__dateSelected.getMonth()+1),this.__updateCalendarWrappers(),this.__updateInvisibleEventCounts()},this.__handlerSwitchYear=e=>{"<"===$(e.target).text()?this.__dateSelected.setFullYear(this.__dateSelected.getFullYear()-1):this.__dateSelected.setFullYear(this.__dateSelected.getFullYear()+1),this.__updateCalendarWrappers(),this.__updateInvisibleEventCounts()},this.__handlerSelectDay=e=>{let t,a,n,s,o,l,d;if(null!=e.target&&(o=e.target,a=$(o).prop("className"),null!=o.parentNode&&(t=o.parentNode,n=$(t).prop("className"),!a.includes("spacer")&&!a.includes("days")))){if(a.includes("day"))s=parseInt($(o).text()),l=0;else{if(!n.includes("day"))return;s=parseInt($(t).text()),l=1}this.__htmlDays.find("div.selected").removeClass("selected"),0===l?$(o).addClass("selected"):$(t).addClass("selected"),this.__dateSelectedLast.setDate(s),this.__dateSelectedLast.setMonth(this.__dateSelected.getMonth()),this.__dateSelectedLast.setFullYear(this.__dateSelected.getFullYear()),this.__dateSelected=new Date(this.__dateSelected.getFullYear(),this.__dateSelected.getMonth(),s,0,0,0,0),d=r.createEventSelection(i.CalendarSelectionType.Date),null!=d?(d.Data=new Date(this.__dateSelected.getTime()),this.__onSelectionChanged(d)):this.logger.error("__handlerSelectDay(): Selection type unknown.")}},this.__handlerSelectMonth=e=>{let t,a,n,s=e.target;t=$(s).prop("className"),t.includes("days")||t.includes("text")?a=s.parentElement?.attributes.baid:t.includes("day")?a=s.parentElement?.parentElement?.attributes.baid:t.includes("month")&&(a=s.attributes.baid),null!=a&&(n=Number.parseInt(a.value),isNaN(n)||(this.__dateSelected=new Date(this.__dateSelected.getFullYear(),n,1,0,0,0,0),this.__displayView=i.CalendarDisplayView.Month,this.__updateCalendar(),this.__updateInvisibleEventCounts()))},this.__handlerSelectEvent=e=>{if(0==this.checkAccess(t.Server.AccessRight.operate))return;let a,n,s,o,l,d=e.target,h=!1;s=$(d).prop("className"),s.includes("spacer")||s.includes("row")||(s.includes("event")||(h=!0,s.includes("col")))&&(a=h?d.parentElement?.attributes.baid:d.attributes.baid,null!=a&&(n=Number.parseInt(a.value),isNaN(n)||(o=this.__getCalendarEvent(n),null!=o&&(l=r.createEventSelection(i.CalendarSelectionType.Event),null!=l?(l.Data={id:o.id,title:o.title,desc:o.desc,start:o.start,end:o.end},this.__onSelectionChanged(l),this.__openEventDialog(o)):this.logger.error("__handlerSelectEvent(): Selection type unknown.")))))},this.__handlerAddHighlight=e=>{let t,a,n,i=e.target,s=!1;if(null!=i&&(a=$(i).prop("className"),!a.includes("spacer")&&(a.includes("event")||(s=!0,a.includes("col")))&&(t=s?i.parentElement?.attributes.baid:i.attributes.baid,null!=t&&(n=this.__htmlEventHighlights.get(Number.parseInt(t.value)),null!=n)))){this.__htmlEventHighlightsLast=n;for(let e=0;e<n.length;e++)n[e].classList.add("highlight")}},this.__handlerRemoveHighlight=()=>{for(let e=0;e<this.__htmlEventHighlightsLast.length;e++)this.__htmlEventHighlightsLast[e].classList.remove("highlight");this.__htmlEventHighlightsLast=[]},this.__handlerEventDialogConfirmed=()=>{let e=this.__eventContent.getEvent();null!=e?(this.__changeEvent(e),this.__updateCalendarWrappers()):this.logger.error("__handlerEventDialogConfirmed(): Confirmed event was NULL.")},this.__handlerEventDialogDeleted=()=>{let e;a.DialogWindow.confirm(this.__strDialogWindowEntryDelete).then((t=>{t&&(e=this.__eventContent.getEvent(),null!=e?null!=this.__dialogWindow&&(this.__dialogWindow.close(),this.__changeEvent(e,!0),this.__updateCalendarWrappers(),this.__menuEntryReset&&this.__menuEntryReset.setIsEnabled(!0)):this.logger.error("__handlerEventDialogDeleted(): Selected entry could not be deleted."))}))},this.__handlerMenuEntryEventVisibility=()=>{this.__contextMenu&&this.__contextMenu.menu.close(),null!=this.__menuEntryVisibilityEvents&&this.__menuEntryVisibilityEvents.getIsEnabled()&&this.__menuVisibilityEvents()},this.__handlerMenuEntryAdd=()=>{this.__contextMenu&&this.__contextMenu.menu.close(),null!=this.__menuEntryAdd&&this.__menuEntryAdd.getIsEnabled()&&(this.__eventsBa.length+this.__eventsBaNew.length>this.__maxExceptions?a.DialogWindow.alert(`More than '${this.__maxExceptions}' entries are not allowed!`,{logger:this.logger}):this.__menuAdd())},this.__handlerMenuEntrySave=()=>{this.__contextMenu&&this.__contextMenu.menu.close(),null!=this.__menuEntrySave&&this.__menuEntrySave.getIsEnabled()&&this.__menuSave()},this.__handlerMenuEntryReset=()=>{this.__contextMenu&&this.__contextMenu.menu.close(),null!=this.__menuEntryReset&&this.__menuEntryReset.getIsEnabled()&&this.__menuReset()},this.__handlerButtonToday=()=>{this.__buttonToday.getIsEnabled()&&this.__today()},this.__handlerButtonToggleViewYearMonth=()=>{this.__toggleViewYearMonth()},this.__sortEvents=(e,t)=>{let a=e.start.getTime(),n=t.start.getTime();if(a<n)return-1;if(a>n)return 1;let i=e.end.getTime(),s=t.end.getTime();return a===n?i-a>s-n?-1:1:0},this.__displayMode=i.CalendarDisplayMode.DatePicker,this.__displayView=i.CalendarDisplayView.Month,this.__visibilityEvents=!0,this.__visibilityMenu=!1,this.__visibilityMenuEntrySave=!0,this.__dowStart=t.BA.Weekday.eMonday,this.__dfStatic=[],this.__dfEvents=[],this.__monthLong=[],this.__daysLong=[],this.__daysShort=[],this.__maxWeeksDow=0,this.__dateYearPrev=0,this.__htmlHeaderMonth=[],this.__htmlHeaderYear=[],this.__htmlNavMonth=[],this.__htmlNavYear=[],this.__htmlTextMonths=[],this.__htmlEventCounts=[],this.__htmlEventHighlightsLast=[],this.__htmlEventHighlights=new Map,this.__htmlDays=$("<div>"),this.__htmlMonths=$("<div>"),this.__htmlEventRows=$("<div>"),this.__events=[],this.__eventsBaNew=[],this.__eventsBaChanged=[],this.__eventsBaRefChanged=[],this.__eventsBa=[],this.__eventsBaRef=[],this.__eventsCountDay=[],this.__eventsAmountPossible=0,this.__eventsAmountDayMax=0,this.__flagOnAttach=!1,this.__lihToday=new a.LegendIconHandler(t.Icons.convertIIconDataToIIconAttributes(t.Icons.Standard.CalendarToday)),this.__lihMonth=new a.LegendIconHandler(t.Icons.convertIIconDataToIIconAttributes(t.Icons.Standard.CalendarMonth)),this.__lihYear=new a.LegendIconHandler(t.Icons.convertIIconDataToIIconAttributes(t.Icons.Standard.CalendarYear)),this.baObjectHandler=new t.BaObjectHandler(this),this.__element.addClass("calendar"),this.__dialogWindowBtnDelete=a.ControlContainer.createIControlOptions(),this.__dialogWindowBtnDelete.type=a.ComponentType.Button,this.__dialogWindowBtnDelete.settings={background:{image:t.Icons.Standard.Delete.path}},this.__dialogWindowBtnDelete.callback=this.__handlerEventDialogDeleted,this.__eventContent=new s(this.__id+"-event-dialog"),this.__dialogWindow=new a.DialogWindow(this.__id+"dialog-window"),this.__dialogWindow.eventHandler.register(a.DialogWindow.DialogWindowEvents.onConfirmed,this.__handlerEventDialogConfirmed),this.__dialogWindow.setAttributes({content:this.__eventContent.getElement(),layout:{maxWidth:i.DefaultEventDialogSize.width,maxHeight:i.DefaultEventDialogSize.height},modal:!0,buttons:a.DialogWindow.Buttons.OkCancel}),this.__constructCalendar(),this.resizeHandler=new a.ResizeHandler(this),this.__initDone=!0}__attach(){this.__isAttached||(super.__attach(),this.__updateLegendIcons(),this.__flagOnAttach=!0)}__detach(){this.__isAttached&&(super.__detach(),this.__updateLegendIcons())}destroy(){this.__dfStatic&&(this.__dfStatic.forEach((e=>e())),this.__dfStatic.length=0),this.__dfEvents&&(this.__dfEvents.forEach((e=>e())),this.__dfEvents.length=0),this.__lihToday&&this.__lihToday.destroy(),this.__lihMonth&&this.__lihMonth.destroy(),this.__lihYear&&this.__lihYear.destroy(),this.__contextMenu&&(this.__contextMenu.menu&&this.__contextMenu.menu.destroy(),this.__contextMenu.button&&this.__contextMenu.button.destroy()),this.__buttonToday&&(this.__buttonToday.getElement().off("click"),this.__buttonToday.destroy()),this.__buttonToggleYearMonth&&(this.__buttonToggleYearMonth.getElement().off("click"),this.__buttonToggleYearMonth.destroy()),this.__dialogWindow&&this.__dialogWindow.destroy(),this.__eventContent&&this.__eventContent.destroy(),this.__htmlNavMonth&&($(this.__htmlNavMonth).off("click"),this.__htmlNavMonth.length=0),this.__htmlNavYear&&($(this.__htmlNavYear).off("click"),this.__htmlNavYear.length=0),this.__htmlDays&&(this.__htmlDays.off("click"),this.__htmlDays.empty()),this.__htmlMonths&&(this.__htmlMonths.off("click"),this.__htmlMonths.empty()),this.__htmlEventRows&&(this.__htmlEventRows.off("click"),this.__htmlEventRows.off("mouseover"),this.__htmlEventRows.off("mouseout"),this.__htmlEventRows.empty()),this.__htmlWrapperDay&&this.__htmlWrapperDay.empty(),this.__htmlWrapperMonth&&this.__htmlWrapperMonth.empty(),this.__htmlWrapperEvent&&this.__htmlWrapperEvent.empty(),this.__htmlNavConMonth&&this.__htmlNavConMonth.empty(),this.__monthLong&&(this.__monthLong.length=0),this.__daysLong&&(this.__daysLong.length=0),this.__daysShort&&(this.__daysShort.length=0),this.__htmlHeaderMonth&&(this.__htmlHeaderMonth.length=0),this.__htmlHeaderYear&&(this.__htmlHeaderYear.length=0),this.__htmlTextMonths&&(this.__htmlTextMonths.length=0),this.__htmlEventCounts&&(this.__htmlEventCounts.length=0),this.__htmlEventHighlightsLast&&(this.__htmlEventHighlightsLast.length=0),this.__htmlEventHighlights&&this.__htmlEventHighlights.clear(),this.__events&&(this.__events.length=0),this.__eventsBaNew&&(this.__eventsBaNew.length=0),this.__eventsBaChanged&&(this.__eventsBaChanged.length=0),this.__eventsBaRefChanged&&(this.__eventsBaRefChanged.length=0),this.__eventsBa&&(this.__eventsBa.length=0),this.__eventsCountDay&&(this.__eventsCountDay.length=0),this.__eventsBaRef&&(this.__eventsBaRef.length=0),this.__schedExceptionList&&(this.__schedExceptionList.length=0),this.__schedCalendarList&&(this.__schedCalendarList.length=0),this.__schedCalendarExceptions&&(this.__schedCalendarExceptions.length=0),this.resizeHandler&&this.resizeHandler.destroy(),this.baObjectHandler&&this.baObjectHandler.destroy(),super.destroy()}__isDataOriginBao(){return this.__dataOrigin===n.BaObject}__isDataOriginValid(){return this.__dataOrigin!==n.None}__processScheduleExceptions(){if(null==this.__schedExceptionList)return;let e,a,n=0;this.__indexBaId=r.IndexStartBa,this.__maxDaily=0,this.__resetEventsBa(),this.__resetChangesBa();for(let i=0;i<this.__schedExceptionList.length;i++)if(e=this.__schedExceptionList[i],e.eType!==t.BA.DateValChoice.Invalid&&(a=this.__createEventFromBASchedException(e,0),null!=a&&(this.__eventsBa.push(a),a.data))){n=0;for(let e=0;e<a.data.length&&(a.data[e].eState!==t.BA.SchedEntryState.Invalid&&a.data[e].eState!==t.BA.SchedEntryState.eUndefined);e++)n++;n>this.__maxDaily&&(this.__maxDaily=n)}this.__maxExceptions=this.__schedExceptionList.length,this.__combineEvents(),this.__updateCalendarWrappers(),this.__onEventsChanged()}__processScheduleCalendarReferences(){if(null==this.__schedCalendarList)return;if(null==this.baObjectHandler.baObject)return;let e=t.BA.BaDevices?.get(this.baObjectHandler.baObject.Device.Description);if(null==e)return;let a,n,s,o,l=0;this.__indexBaRefId=r.IndexStartBaRef,this.__maxDailyRef=0,this.__resetEventsBaRef(),this.__resetChangesBaRef(),this.__schedCalendarExceptions=[];for(let d=0;d<this.__schedCalendarList.length;d++){let h,_;_=this.__schedCalendarList[d],0===_.stRefCalendarID.nInstanceID&&0===_.stRefCalendarID.eObjectType||(h=e.findBaObject({InstanceID:_.stRefCalendarID.nInstanceID,ObjectType:_.stRefCalendarID.eObjectType}),null!=h&&h.loadAttributes().then((()=>{null!=this.__schedCalendarExceptions&&(this.__schedCalendarExceptions.push({instanceId:_.stRefCalendarID.nInstanceID,exceptions:[]}),this.baObjectHandler.tryWatchChildrenBaVariable(h,t.BA.BaParameterId.eDateList,(e=>{if(null!=e&&null!=this.__schedCalendarExceptions&&null!=h){o=null;for(let e=0;e<this.__schedCalendarExceptions.length;e++)if(h.Identifier.InstanceID===this.__schedCalendarExceptions[e].instanceId){o=this.__schedCalendarExceptions[e];break}if(null!=o){o.exceptions=[];for(let i=0;i<e.length&&(n=e[i],n.eType!==t.BA.DateValChoice.Invalid);i++){l=0,a=r.createScheduleException(),a.eType=n.eType,a.uDate=n.uDate,a.aEntry=_.aEntry,o.exceptions.push(a);for(let e=0;e<a.aEntry.length&&(a.aEntry[e].eState!==t.BA.SchedEntryState.Invalid&&a.aEntry[e].eState!==t.BA.SchedEntryState.eUndefined);e++)l++;l>this.__maxDailyRef&&(this.__maxDailyRef=l)}if(null!=this.__schedCalendarExceptions){s=null,this.__indexBaRefId=r.IndexStartBaRef,this.__resetEventsBaRef(),this.__resetChangesBaRef();for(let e=0;e<this.__schedCalendarExceptions.length;e++){o=this.__schedCalendarExceptions[e];for(let e=0;e<o.exceptions.length;e++)s=this.__createEventFromBASchedException(o.exceptions[e],o.instanceId,i.CalendarEventSource.BARef),null!=s&&this.__eventsBaRef.push(s)}this.__combineEvents(),this.__updateCalendarWrappers(),this.__onEventsChanged()}}}})))})))}}__processDisplayMode(){this.__constructCalendar()}__processDisplayView(){this.__displayMode!==i.CalendarDisplayMode.DatePicker&&this.__updateCalendar()}__constructCalendar(){let e,n,s,r,o,l,d,h,_,c,u,g=[],p=[],b=[];if($(this.__htmlNavMonth).off("click"),$(this.__htmlNavYear).off("click"),this.__htmlDays.off("click"),this.__htmlMonths.off("click"),this.__htmlEventRows.off("mouseover"),this.__htmlEventRows.off("mouseout"),this.__htmlHeaderMonth.length=0,this.__htmlHeaderYear.length=0,this.__htmlNavMonth.length=0,this.__htmlNavYear.length=0,this.__htmlDays.empty(),this.__htmlMonths.empty(),this.__htmlEventRows.empty(),this.__dfStatic.forEach((e=>e())),this.__dfStatic.length=0,this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.ConfirmSaveChangesToPlc,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strSaveChanges=e.text)}))),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.ConfirmRemoveEntry,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strDialogWindowEntryDelete=e.text)}))),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.ConfirmResetChanges,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strResetChanges=e.text)}))),this.__dateCurrent=new Date,this.__dateInit?(this.__dateSelected=new Date(this.__dateInit.getTime()),this.__dateSelectedLast=new Date(this.__dateInit.getTime())):(this.__dateSelected=new Date,this.__dateSelectedLast=new Date(t.BA.BaDate.YearOffset,1)),n=$("<div>").addClass("nav-wrapper"),s=$("<div>").addClass("day-wrapper"),r=$("<div>").addClass("month-wrapper"),o=$("<div>").addClass("event-wrapper"),this.__htmlWrapperDay=s,this.__htmlWrapperMonth=r,this.__htmlWrapperEvent=o,e=this.__element[0].children.length,0!==e)for(let t=0;t<e;t++)this.__element[0].children[0].remove();this.__element.append(n);for(let e=0;e<2;e++)this.__displayMode===i.CalendarDisplayMode.EventCalendar?(l=$("<div>").addClass("navc-c"),l.append($("<div>").addClass("navs")),d=$("<div>").addClass("nav-c"),d.append($("<div>").addClass("navb-c").text("<")),h=$("<div>").addClass("navt-c")):(l=$("<div>").addClass("navc-dp"),d=$("<div>").addClass("nav-dp"),d.append($("<div>").addClass("navb-dp").text("<")),h=$("<div>").addClass("navt-dp")),d.append(h),this.__displayMode===i.CalendarDisplayMode.EventCalendar?d.append($("<div>").addClass("navb-c").text(">")):d.append($("<div>").addClass("navb-dp").text(">")),l.append(d),0==e?(this.__htmlHeaderYear.push(h[0]),this.__displayMode===i.CalendarDisplayMode.EventCalendar&&l.append($("<div>").addClass("navs")),this.__htmlNavYear=d.find("div:nth-child(1), div:nth-child(3)").toArray()):(this.__htmlHeaderMonth.push(h[0]),this.__displayMode===i.CalendarDisplayMode.EventCalendar&&l.append($("<div>").addClass("navs")),this.__htmlNavMonth=d.find("div:nth-child(1), div:nth-child(3)").toArray(),this.__htmlNavConMonth=d),n.append(l);$(this.__htmlNavMonth).on("click",this.__handlerSwitchMonth),$(this.__htmlNavYear).on("click",this.__handlerSwitchYear),s.append($("<div>").addClass("header")),this.__htmlDays=$("<div>").addClass("days"),s.append(this.__htmlDays),_=$("<div>").addClass("headers"),r.append(_),this.__htmlMonths=$("<div>").addClass("months"),r.append(this.__htmlMonths),this.__element.css("--ba-height-nav-row","var(--ba-height-nav-row-dp)"),this.__displayMode===i.CalendarDisplayMode.EventCalendar&&(this.__htmlEventRows=$("<div>").addClass("event-rows"),o.append(this.__htmlEventRows),this.__htmlEventRows.on("mouseover",this.__handlerAddHighlight),this.__htmlEventRows.on("mouseout",this.__handlerRemoveHighlight),this.__element.css("--ba-height-nav-row","var(--ba-height-nav-row-c)")),$(this.__htmlHeaderYear).text(this.__dateCurrent.getFullYear());for(let e=0;e<t.Locale.MonthsLongLangKey.length;e++)this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.MonthsLongLangKey[e],(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__monthLong[e]=a.text,e===this.__dateSelected.getMonth()&&$(this.__htmlHeaderMonth).text(a.text),this.__htmlTextMonths[e]&&$(this.__htmlTextMonths[e]).text(a.text))})));g=this.__displayMode===i.CalendarDisplayMode.DatePicker?t.Locale.WeekDaysShortLangKey:t.Locale.WeekDaysLongLangKey,p=t.Locale.WeekDaysShortLangKey,g=g.slice(this.__dowStart-1).concat(g.slice(0,this.__dowStart-1)),p=p.slice(this.__dowStart-1).concat(p.slice(0,this.__dowStart-1));for(let e=0;e<=g.length-1;e++){let a=$("<div>");b.push(a),this.__dfStatic.push(t.Locale.Localization.watchText(g[e],(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&a.text(e.text)})))}for(let e=0;e<3;e++){c=$("<div>").addClass("header"),c.append($("<div>").addClass("spacer")),u=$("<div>").addClass("head"),c.append(u);for(let e=0;e<=p.length-1;e++){let a=$("<div>");u.append(a),this.__dfStatic?.push(t.Locale.Localization.watchText(p[e],(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&a.text(e.text)})))}_.append(c)}this.__displayMode!==i.CalendarDisplayMode.DatePicker&&(null==this.__contextMenu&&(this.__contextMenu=a.ContextMenu.createContextMenuAndButton({id:this.__id,root:this.__element,parent:this}),this.__contextMenu.button.getElement().addClass("context-menu-button"),this.__menuEntryVisibilityEvents=this.__contextMenu.menu.addRowEntry({onPressed:this.__handlerMenuEntryEventVisibility,cbOnCreated:e=>{this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.Show,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strEventsShow=a.text,this.getVisibilityEvents()||e.textHandler.setText(this.__strEventsShow))}))),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.Hide,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strEventsHide=a.text,this.getVisibilityEvents()&&e.textHandler.setText(this.__strEventsHide))})))}}),this.__menuEntryAdd=this.__contextMenu.menu.addRowEntry({onPressed:this.__handlerMenuEntryAdd,cbOnCreated:e=>{this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.Add,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}}),this.__visibilityMenuEntrySave&&(this.__menuEntrySave=this.__contextMenu.menu.addRowEntry({onPressed:this.__handlerMenuEntrySave,cbOnCreated:e=>{this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.Save,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}})),this.__menuEntryReset=this.__contextMenu.menu.addRowEntry({onPressed:this.__handlerMenuEntryReset,cbOnCreated:e=>{this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.Reset,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}})),this.__element.append(this.__contextMenu.button.getElement()),null==this.__buttonToggleYearMonth&&(this.__buttonToggleYearMonth=new a.Button(this.__id+".button-header-year-month",this),this.__buttonToggleYearMonth.setCssClass("button-header year-month"),this.__buttonToggleYearMonth.getElement().on("click",this.__handlerButtonToggleViewYearMonth)),this.__element.append(this.__buttonToggleYearMonth.getElement()),null==this.__buttonToday&&(this.__buttonToday=new a.Button(this.__id+".button-header.today",this),this.__buttonToday.setCssClass("button-header today"),this.__buttonToday.iconHandler.setIcon(t.Icons.Standard.CalendarToday.path,!0),this.__buttonToday.getElement().on("click",this.__handlerButtonToday)),this.__element.append(this.__buttonToday.getElement())),this.__htmlWrapperDay.find(".header").append(b),this.__updateCalendar(),this.__updateMenuStates()}__createEventFromBASchedException(e,a,n){let s="",o={},l=r.createEvent();switch(l.source=null==n?i.CalendarEventSource.BA:n,l.calInstId=a,l.data=e.aEntry,e.eType){case t.BA.DateValChoice.eDate:if(s="eDate",o={day:e.uDate.stDate.nDay,month:e.uDate.stDate.eMonth,year:e.uDate.stDate.nYear},e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=r.createDatePast(),l.end=r.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Daily,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=r.createDatePast(0,e.uDate.stDate.nDay),l.end=r.createDateFuture(0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=r.DowEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=r.createDatePast(e.uDate.stDate.eMonth-1),l.end=r.createDateFuture(e.uDate.stDate.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=r.createDateFromBa(e.uDate.stDate.nYear,0,r.DayPast),l.end=r.createDateFromBa(e.uDate.stDate.nYear,0,r.DayFuture),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=r.createDatePast(),l.end=r.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){if(!r.isValidDate(e.uDate.stDate.nDay,e.uDate.stDate.eMonth))break;l.start=r.createDatePast(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=r.createDateFuture(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.DowEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=r.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.end=r.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=r.DowEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=r.createDatePast(0,e.uDate.stDate.nDay),l.end=r.createDateFuture(0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek);break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=r.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,r.DayPast),l.end=r.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,r.DayFuture),l.repitition.Type=i.CalendarEventRepetition.YearlyOnce,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=r.createDatePast(e.uDate.stDate.eMonth-1),l.end=r.createDateFuture(e.uDate.stDate.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=r.createDateFromBa(e.uDate.stDate.nYear,0,r.DayPast),l.end=r.createDateFromBa(e.uDate.stDate.nYear,0,r.DayFuture),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=r.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=r.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Regular;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=r.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,r.DayPast),l.end=r.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,r.DayFuture),l.repitition.Type=i.CalendarEventRepetition.YearlyOnce,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=r.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.end=r.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek);break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=r.createDatePast(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=r.createDateFuture(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek);break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.even&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){if(!r.isValidDate(e.uDate.stDate.nDay,e.uDate.stDate.eMonth,r.createYearFromBa(e.uDate.stDate.nYear)))break;l.start=r.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=new Date(l.start.getTime()),l.repitition.Type=i.CalendarEventRepetition.Regular;break}break;case t.BA.DateValChoice.eDateRange:e.uDate.stDateRange.stDateFrom.nDay===t.BA.Day.Unspecified||e.uDate.stDateRange.stDateFrom.eMonth===t.BA.Month.Unspecified||e.uDate.stDateRange.stDateFrom.nYear===t.BA.BaDate.YearUnspecified?l.start=r.createDatePast():l.start=r.createDateFromBa(e.uDate.stDateRange.stDateFrom.nYear,e.uDate.stDateRange.stDateFrom.eMonth-1,e.uDate.stDateRange.stDateFrom.nDay),e.uDate.stDateRange.stDateTo.nDay===t.BA.Day.Unspecified||e.uDate.stDateRange.stDateTo.eMonth===t.BA.Month.Unspecified||e.uDate.stDateRange.stDateTo.nYear===t.BA.BaDate.YearUnspecified?l.end=r.createDateFuture():l.end=r.createDateFromBa(e.uDate.stDateRange.stDateTo.nYear,e.uDate.stDateRange.stDateTo.eMonth-1,e.uDate.stDateRange.stDateTo.nDay),l.repitition.Type=i.CalendarEventRepetition.Regular;break;case t.BA.DateValChoice.eWeekNDay:if(s="eWeekNDay",o={weekday:e.uDate.stWeekNDay.eWeekday,weekOfMonth:e.uDate.stWeekNDay.eWeekOfMonth,month:e.uDate.stWeekNDay.eMonth},e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=r.createDatePast(),l.end=r.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Daily,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=r.createDatePast(),l.end=r.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=r.createDatePast(),l.end=r.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}if(e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=r.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=r.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=r.createDatePast(),l.end=r.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}if(e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=r.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=r.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.DowEvery,l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=r.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=r.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=r.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=r.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=r.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=r.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}break;default:this.logger.warn("__createEventFromBASchedException(): Exception type ",e.eType," unknown!")}return l.repitition.Type!=i.CalendarEventRepetition.None?l.id=this.__getNextEventId(l.source):this.logger.warn("__createEventFromBASchedException(): Could not create schedule exception of eType("+s+")! See data:",o),l.id>0?l:null}__createSchedExceptionFromCalendarEvent(e){if(null==e)return null;let a,n=r.createScheduleException();if(null==e.data)return this.logger.warn("__createSchedExceptionFromCalendarEvent(): Exception entry list is NULL!"),null;switch(n.aEntry=e.data,e.repitition.Type){case i.CalendarEventRepetition.Regular:n.uDate.stDateRange.stDateFrom.nDay=e.start.getDate(),n.uDate.stDateRange.stDateFrom.eMonth=e.start.getMonth()+1,n.uDate.stDateRange.stDateFrom.nYear=r.createYearForBa(e.start.getFullYear()),e.start.getFullYear()===e.end.getFullYear()&&e.start.getMonth()===e.end.getMonth()&&e.start.getDate()===e.end.getDate()?(n.uDate.stDate.nDay=n.uDate.stDateRange.stDateFrom.nDay,n.uDate.stDate.eMonth=n.uDate.stDateRange.stDateFrom.eMonth,n.uDate.stDate.nYear=n.uDate.stDateRange.stDateFrom.nYear,n.eType=t.BA.DateValChoice.eDate):(n.uDate.stDateRange.stDateTo.nDay=e.end.getDate(),n.uDate.stDateRange.stDateTo.eMonth=e.end.getMonth()+1,n.uDate.stDateRange.stDateTo.nYear=r.createYearForBa(e.end.getFullYear()),n.eType=t.BA.DateValChoice.eDateRange);break;case i.CalendarEventRepetition.Daily:n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.eType=t.BA.DateValChoice.eDate;break;case i.CalendarEventRepetition.Weekly:break;case i.CalendarEventRepetition.Monthly:if(e.start.getDate()===e.end.getDate()){a=r.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===r.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate;break}if(e.repitition.Data.dow===r.DowEvery&&e.repitition.Data.dowWeek===r.WeekEvery){n.uDate.stWeekNDay.eWeekday=t.BA.Weekday.Unspecified,n.uDate.stWeekNDay.eWeekOfMonth=t.BA.Week.Unspecified,n.uDate.stWeekNDay.eMonth=t.BA.Month.Unspecified,n.eType=t.BA.DateValChoice.eWeekNDay;break}if(e.repitition.Data.dow!==r.DowEvery&&e.repitition.Data.dowWeek===r.WeekEvery){a=r.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],n.eType=t.BA.DateValChoice.eDate;break}if(e.repitition.Data.dow===r.DowEvery&&e.repitition.Data.dowWeek!==r.WeekEvery){n.uDate.stWeekNDay.eWeekday=t.BA.Weekday.Unspecified,n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=t.BA.Month.Unspecified,n.eType=t.BA.DateValChoice.eWeekNDay;break}if(e.repitition.Data.dow!==r.DowEvery&&e.repitition.Data.dowWeek!==r.WeekEvery){a=r.createDows(e.repitition.Data.dow),n.uDate.stWeekNDay.eWeekday=a[0],n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=t.BA.Month.Unspecified,n.eType=t.BA.DateValChoice.eWeekNDay;break}break;case i.CalendarEventRepetition.MonthlyOnce:n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=r.createYearForBa(e.start.getFullYear()),e.start.getDate()===r.DayPast&&e.end.getDate()===r.DayFuture&&e.repitition.Data.dow===r.DowEvery&&e.repitition.Data.dowWeek===r.WeekEvery?(n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.eType=t.BA.DateValChoice.eDate):(a=r.createDows(e.repitition.Data.dow),0!==e.repitition.Data.dow&&0!==e.repitition.Data.dowWeek?n.uDate.stDate.nDay=t.BA.Day.Unspecified:n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===r.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate);break;case i.CalendarEventRepetition.Yearly:if(e.repitition.Data.dow===r.DowEvery&&e.repitition.Data.dowWeek===r.WeekEvery){n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.eType=t.BA.DateValChoice.eDate;break}if(e.start.getDate()===e.end.getDate()&&0===e.repitition.Data.dow&&0===e.repitition.Data.dowWeek){n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.eType=t.BA.DateValChoice.eDate;break}if(e.start.getDate()===e.end.getDate()&&0!==e.repitition.Data.dow&&0===e.repitition.Data.dowWeek){a=r.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===r.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate;break}if(e.repitition.Data.dow===r.DowEvery&&e.repitition.Data.dowWeek!==r.WeekEvery){n.uDate.stWeekNDay.eWeekday=t.BA.Weekday.Unspecified,n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=e.start.getMonth()+1,n.eType=t.BA.DateValChoice.eWeekNDay;break}if(e.repitition.Data.dow!==r.DowEvery&&e.repitition.Data.dowWeek===r.WeekEvery){a=r.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],n.eType=t.BA.DateValChoice.eDate;break}if(e.end.getDate()===r.DayFuture&&e.repitition.Data.dow!==r.DowEvery&&e.repitition.Data.dowWeek!==r.WeekEvery){a=r.createDows(e.repitition.Data.dow),n.uDate.stWeekNDay.eWeekday=a[0],n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=e.start.getMonth()+1,n.eType=t.BA.DateValChoice.eWeekNDay;break}break;case i.CalendarEventRepetition.YearlyOnce:a=r.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=r.createYearForBa(e.start.getFullYear()),n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===r.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate}return n.eType!==t.BA.DateValChoice.Invalid?n:null}__changeEvent(e,t){if(null==e)return void this.logger.error("__changeEvent(): Event was NULLL.");let a,n=!1,s=!1,o=!1,l=!1;if(null==t&&(t=!1),e.id<0)e.id=this.__getNextEventId(i.CalendarEventSource.BA),this.__eventsBaNew.push(e),s=!0;else switch(e.source){case i.CalendarEventSource.None:case i.CalendarEventSource.BA:for(let a=0;a<this.__eventsBaNew.length;a++)if(this.__eventsBaNew[a].id===e.id){o=!0,t?(this.__eventsBaNew.splice(a,1),s=!0):this.__compareEventContent(this.__eventsBaNew[a],e)||(this.__eventsBaNew[a]=e,s=!0);break}if(!o)for(let a=0;a<this.__eventsBaChanged.length;a++)if(this.__eventsBaChanged[a].id===e.id){l=!0,t?(e.calInstId=-1,this.__eventsBaChanged[a]=e,s=!0):this.__compareEventContent(this.__eventsBaChanged[a],e)||(this.__eventsBaChanged[a]=e,s=!0);break}if(!o&&!l)if(t)e.calInstId=-1,this.__eventsBaChanged.push(e),s=!0;else for(let t=0;t<this.__eventsBa.length;t++)if(this.__eventsBa[t].id===e.id){this.__compareEventContent(this.__eventsBa[t],e)||(this.__eventsBaChanged.push(e),s=!0);break}break;case i.CalendarEventSource.BARef:for(let t=0;t<this.__eventsBaRefChanged.length;t++)this.__eventsBaRefChanged[t].calInstId===e.calInstId&&(this.__eventsBaRefChanged[t].data=e.data,n=!0,s=!0);if(!n){for(let t=0;t<this.__eventsBaRef.length;t++)this.__eventsBaRef[t].calInstId===e.calInstId&&(a=r.copyCalendarEvent(this.__eventsBaRef[t]),a.data=e.data,this.__eventsBaRefChanged.push(a));s=!0}}s&&(this.__hasChanges=!0,this.__combineEvents(),this.__updateCalendarWrappers(),this.__updateMenuStateSave(),this.__updateMenuStateReset(),this.__onEventsChanged())}__updateCalendar(){this.__updateCalendarWrappers(),this.__updateCalendarView()}__updateCalendarWrappers(){this.__dateCurrent=new Date,this.__updateWrapperDays(),this.__displayMode!==i.CalendarDisplayMode.DatePicker&&(this.__displayView===i.CalendarDisplayView.Month?(this.__updateWrapperEvents(),this.__updateVisibleEvents(),this.__updateInvisibleEventCounts(),this.__dateYearPrev!==this.__dateSelected.getFullYear()&&this.__updateWrapperMonths(),this.__dateYearPrev=this.__dateSelected.getFullYear()):this.__updateWrapperMonths(),this.__updateButtonStateToday())}__updateWrapperDays(){let e,a,n,s,r,o,l=[],d=0,h=this.__dateCurrent.getDate(),_=this.__dateCurrent.getMonth(),c=this.__dateCurrent.getFullYear(),u=this.__dateSelectedLast.getDate(),g=this.__dateSelectedLast.getMonth(),p=this.__dateSelectedLast.getFullYear(),b=this.__dateSelected.getMonth(),m=this.__dateSelected.getFullYear(),y=new Date(m,b,1,0,0,0,0);this.__maxWeeksDow=t.Helper.Date.getWeeksOfMonth(this.__dateSelected,this.__dowStart),this.__element.css("--ba-js-weeks",this.__maxWeeksDow.toString()),this.__htmlEventCounts.length=0,$(this.__htmlHeaderYear).text(m),$(this.__htmlHeaderMonth).text(this.__monthLong[b]),this.__htmlDays.off("click"),this.__htmlDays.empty(),d=t.Helper.Date.getMaxDaysOfMonth(this.__dateSelected),r=t.Helper.Date.adjustDayOfWeek(y.getDay()),r>=this.__dowStart?r-=this.__dowStart:r=t.Helper.Date.WeekdaysMax-(this.__dowStart-r),y.setDate(d),o=t.Helper.Date.adjustDayOfWeek(y.getDay()),o=o>=this.__dowStart?t.Helper.Date.WeekdaysMax-o+(this.__dowStart-1):this.__dowStart-o-1;for(let e=0;e<r;e++)l.push($("<div>").addClass("day-spacer"));s=this.__displayMode===i.CalendarDisplayMode.EventCalendar?"day-c":"day-dp";for(let t=1;t<=d;t++)e=$("<div>").addClass(s),this.__displayMode===i.CalendarDisplayMode.DatePicker?e.text(t):(n=$("<div>").addClass("title"),n.append($("<div>").text(t)),a=$("<div>").text(""),n.append(a),this.__htmlEventCounts.push(a),e.append(n)),l.push(e);for(let e=0;e<o;e++)l.push($("<div>").addClass("day-spacer"));c===m&&_===b&&(e=l[r+h-1],e.addClass("curbor"),this.__displayMode===i.CalendarDisplayMode.DatePicker&&e.addClass("curtxt")),p>t.BA.BaDate.YearOffset&&p===m&&g===b&&l[r+u-1].addClass("selected"),this.__htmlDays.append(l),this.__htmlDays.on("click",this.__handlerSelectDay)}__updateInvisibleEventCounts(){if(!this.__isAttached)return;if(0===this.__htmlEventCounts.length)return;if(this.__displayMode!==i.CalendarDisplayMode.EventCalendar)return;if(this.__displayView!==i.CalendarDisplayView.Month)return;let e,t="";if(this.__visibilityEvents)for(let a=0;a<this.__htmlEventCounts.length;a++)e=-1*(this.__eventsAmountPossible-this.__eventsCountDay[a]),t="",e>0&&(t="(+"+e+")"),this.__htmlEventCounts[a].text(t);else for(let e=0;e<this.__htmlEventCounts.length;e++)this.__htmlEventCounts[e].text(t)}__updateWrapperMonths(){let e,a,n,s,o,l,d,h,_,c,u,g=[],p=[],b=this.__dateCurrent.getMonth(),m=this.__dateCurrent.getFullYear(),y=this.__dateSelected.getFullYear(),v=[],f=!1,D=0,C=0,H=0,w=0,S=0,T=!1,E=!1,B=0,A=t.Helper.DateTime.convertDaysToMilliseconds(1);$(this.__htmlHeaderYear).text(y),this.__htmlMonths.off("click"),this.__htmlMonths.empty(),this.__htmlTextMonths.length=0;for(let e=0;e<t.Helper.Date.MonthsMax;e++){v[e]=[],_=new Date(y,e,1,0,0,0,0),o=t.Helper.Date.getMaxDaysOfMonth(_);for(let t=0;t<o;t++)v[e][t]=!1}for(let e=0;e<this.__events.length;e++){switch(h=r.copyCalendarEvent(this.__events[e]),h.start.getTime()>h.end.getTime()&&this.__swapDate(h),h.repitition.Type){case i.CalendarEventRepetition.Regular:if(h.start.getTime()===h.end.getTime()){if(h.start.getFullYear()!==y)continue;B=1}else{if(h.start.getFullYear()>y||h.end.getFullYear()<y)continue;if(h.start.getFullYear()<y&&(h.start=new Date(y,0,1,0,0,0,0)),h.end.getFullYear()>y&&(h.end=new Date(y,11,t.Helper.Date.DaysMax,0,0,0,0)),B=t.Helper.DateTime.convertMillisecondsToDays(h.end.getTime()-h.start.getTime()+A),u=this.__getDecimal(B),null==u)continue;B=u}for(H=h.start.getMonth(),D=h.start.getDate();B>0;B--)v[H][D-1]=!0,D++,D>v[H].length&&(D=1,H++);break;case i.CalendarEventRepetition.Daily:for(let e=0;e<v.length;e++)for(let t=0;t<v[e].length;t++)v[e][t]=!0;f=!0;break;case i.CalendarEventRepetition.Monthly:case i.CalendarEventRepetition.Yearly:case i.CalendarEventRepetition.MonthlyOnce:case i.CalendarEventRepetition.YearlyOnce:if((h.repitition.Type===i.CalendarEventRepetition.MonthlyOnce||h.repitition.Type===i.CalendarEventRepetition.YearlyOnce)&&h.start.getFullYear()!==y)continue;if(D=0,H=0,C=v.length,h.repitition.Type!==i.CalendarEventRepetition.Yearly&&h.repitition.Type!==i.CalendarEventRepetition.YearlyOnce||(H=h.start.getMonth(),C=H+1),0===h.repitition.Data.dow&&0===h.repitition.Data.dowWeek)for(D=h.start.getDate();H<C;H++)D<=v[H].length&&(v[H][D-1]=!0);else for(c=r.createDows(h.repitition.Data.dow),_=new Date(y,0,1,0,0,0,0),E=0!==h.repitition.Data.dow&&0===h.repitition.Data.dowWeek,T=h.repitition.Data.dowWeek===r.WeekEvery||E,w=T?1:h.repitition.Data.dowWeek,S=w;H<C;H++){T&&(_.setMonth(H),S=t.Helper.Date.getWeeksOfMonth(_,this.__dowStart));for(let e=w;e<=S;e++)for(let t=0;t<c.length;t++)_.setMonth(H),D=this.__getDayOfDow(c[t],e,_,this.__dowStart),0!==D&&(E&&D!==h.start.getDate()||D<=v[H].length&&(v[H][D-1]=!0))}}if(f)break}for(let i=0;i<v.length;i++){g.length=0,_=new Date(y,i,1,0,0,0,0),a=$("<div>").addClass("month"),a.attr("baid",i),o=v[i].length,l=t.Helper.Date.adjustDayOfWeek(_.getDay()),l>=this.__dowStart?l-=this.__dowStart:l=t.Helper.Date.WeekdaysMax-(this.__dowStart-l),_.setDate(o),d=t.Helper.Date.adjustDayOfWeek(_.getDay()),d=d>=this.__dowStart?t.Helper.Date.WeekdaysMax-d+(this.__dowStart-1):this.__dowStart-d-1;for(let e=0;e<l;e++)g.push($("<div>").addClass("day-spacer"));for(let t=1;t<=o;t++)e=$("<div>").addClass("day-c").text(t),this.__visibilityEvents&&v[i][t-1]&&e.addClass("evt"),g.push(e);for(let e=0;e<d;e++)g.push($("<div>").addClass("day-spacer"));if(s=t.Helper.Date.getWeeksOfMonth(_,this.__dowStart),s)switch(s){case 4:for(let e=0;e<t.Helper.Date.WeekdaysMax+1;e++)g.push($("<div>").addClass("day-spacer"));break;case 5:g.push($("<div>").addClass("day-spacer"))}n=$("<div>").addClass("month-text").text(this.__monthLong[i]),m===y&&b===i&&n.addClass("curbor"),a.append(n),a.append($("<div>").append(g).addClass("days")),p.push(a),this.__htmlTextMonths.push(n[0])}this.__htmlMonths.append(p),this.__htmlMonths.on("click",this.__handlerSelectMonth)}__updateWrapperEvents(){let e,a,n,s,o,l,d,h,_,c,u,g,p=[],b=[],m=[],y=-1,v=-1,f=[],D=0,C=0,H=0,w=0,S=0,T=0,E=0,B=0,A=0,x=0,O=0,k=0,I=0,P=t.Helper.Date.getMaxDaysOfMonth(this.__dateSelected),M=0,V=0,L=0,R=0,j=t.Helper.DateTime.convertDaysToMilliseconds(1)-1,W=0,F=0;this.__dfEvents.forEach((e=>e())),this.__dfEvents.length=0;for(let e=0;e<this.__maxWeeksDow;e++)f.push([]);this.__htmlEventRows.off("click"),this.__htmlEventRows.empty(),this.__htmlEventHighlights.clear();for(let e=0;e<this.__maxWeeksDow;e++)d=$("<div>").addClass("event-row"),d.append($("<div>").addClass("event-spacer")),m.push(d);this.__eventsCountDay.length=0,this.__eventsAmountDayMax=0;for(let e=0;e<P;e++)this.__eventsCountDay.push(0);l=new Date(this.__dateSelected.getFullYear(),this.__dateSelected.getMonth(),1,0,0,0,0),h=l.getTime(),_=h+t.Helper.DateTime.convertDaysToMilliseconds(P-1);for(let e=0;e<this.__events.length;e++)if(a=r.copyCalendarEvent(this.__events[e]),a.start.getTime()>a.end.getTime()&&this.__swapDate(a),D=a.start.getMonth(),a.start.getFullYear()===r.YearPast&&(a.start.setFullYear(l.getFullYear()),a.end.setFullYear(l.getFullYear())),D==a.start.getMonth()){switch(D=a.start.getDate(),a.repitition.Type){case i.CalendarEventRepetition.Regular:if(a.start.getFullYear()>l.getFullYear())continue;if(a.start.getFullYear()===l.getFullYear()&&a.start.getMonth()>l.getMonth())continue;break;case i.CalendarEventRepetition.Weekly:this.logger.warn("__updateWrapperEvents(): Repitition type "+a.repitition.Type+" ("+i.CalendarEventRepetition[a.repitition.Type]+") not implemented yet!");break;case i.CalendarEventRepetition.Daily:case i.CalendarEventRepetition.Monthly:case i.CalendarEventRepetition.Yearly:if(a.repitition.Type!==i.CalendarEventRepetition.Yearly)a.start.setMonth(l.getMonth()),a.end.setMonth(l.getMonth());else if(a.start.getMonth()!==l.getMonth())continue;if(0!==a.repitition.Data.dow&&0!==a.repitition.Data.dowWeek)g=r.createDows(a.repitition.Data.dow),V=g[0],L=a.repitition.Data.dowWeek,L===r.WeekEvery&&(L=1),M=this.__getDayOfDow(V,L,l),0!==M&&(D=M,a.start.setDate(M));else if(0!==a.repitition.Data.dow&&0===a.repitition.Data.dowWeek&&a.repitition.Data.dow!==r.DowEvery&&(g=r.createDows(a.repitition.Data.dow),V=g[0],V!==t.Helper.Date.adjustDayOfWeek(a.start.getDay())))continue;break;case i.CalendarEventRepetition.MonthlyOnce:if(a.start.getFullYear()!=l.getFullYear())continue;if(a.start.setMonth(l.getMonth()),a.end.setMonth(l.getMonth()),0!==a.repitition.Data.dow&&0===a.repitition.Data.dowWeek&&a.repitition.Data.dow!==r.DowEvery&&(g=r.createDows(a.repitition.Data.dow),V=g[0],V!==t.Helper.Date.adjustDayOfWeek(a.start.getDay())))continue;break;case i.CalendarEventRepetition.YearlyOnce:if(a.start.getFullYear()!=l.getFullYear())continue;if(a.start.getMonth()!=l.getMonth())continue;if(0!==a.repitition.Data.dow&&0===a.repitition.Data.dowWeek&&(g=r.createDows(a.repitition.Data.dow),V=g[0],V!==t.Helper.Date.adjustDayOfWeek(a.start.getDay())))continue;break;default:this.logger.warn("__updateWrapperEvents(): Repitition type ",a.repitition.Type," is unknown!")}D===a.start.getDate()&&b.push(a)}for(let t=0;t<b.length;t++){switch(I=0,a=b[t],a.repitition.Type){case i.CalendarEventRepetition.Regular:I=1;break;case i.CalendarEventRepetition.Daily:case i.CalendarEventRepetition.Monthly:case i.CalendarEventRepetition.Yearly:case i.CalendarEventRepetition.MonthlyOnce:case i.CalendarEventRepetition.YearlyOnce:0===a.repitition.Data.dow&&0===a.repitition.Data.dowWeek||0!==a.repitition.Data.dow&&0===a.repitition.Data.dowWeek?I=1:0!==a.repitition.Data.dow&&0!==a.repitition.Data.dowWeek&&(I=2)}switch(I){case 1:p.push(a);break;case 2:M=1,g=r.createDows(a.repitition.Data.dow),L=0,R=0,L=a.repitition.Data.dowWeek,R=L,L===r.WeekEvery&&(L=1,R=this.__maxWeeksDow);for(let t=L;t<=R;t++)for(let n=0;n<g.length;n++)M=this.__getDayOfDow(g[n],t,l,this.__dowStart),0!==M&&(e=r.createEvent(),e.id=a.id,e.calInstId=a.calInstId,e.source=a.source,e.start=new Date(l.getTime()),e.start.setDate(M),e.end.setTime(e.start.getTime()+j),p.push(e))}}p.sort(this.__sortEvents);for(let e=0;e<p.length;e++)if(a=p[e],w=a.start.getTime(),S=a.end.getTime(),c=new Date(w),u=new Date(S),!(w>_||S<h||S<w)){C=c.getDate(),H=u.getDate(),w<h&&(C=1,w=h),S>_&&(H=P,S=_),E=H-C+1;for(let e=0;e<E;e++)O=C-1+e,this.__eventsCountDay[O]++,this.__eventsCountDay[O]>this.__eventsAmountDayMax&&(this.__eventsAmountDayMax=this.__eventsCountDay[O]);l.setDate(C),B=t.Helper.Date.adjustDayOfWeek(l.getDay()),A=B>=this.__dowStart?B-this.__dowStart:t.Helper.Date.WeekdaysMax-(this.__dowStart-B),k=t.Helper.Date.WeekdaysMax-A,E>k?(T=k,E-=k):(T=E,E=0),x=k-T;for(let e=this.__getWeekOfDay(this.__dateSelected,C,this.__dowStart);e<=this.__maxWeeksDow;e++){y=e-1,0===f[y].length&&f[y].push(0);for(let e=0;e<=f[y].length-1;e++){if(w>f[y][e]){v=e+1;break}v=e+2}S=w+t.Helper.DateTime.convertDaysToMilliseconds(T)-1,void 0!==f[y][v-1]?(F=f[y][v-1],F>0&&(l.setTime(F),W=t.Helper.Date.adjustDayOfWeek(l.getDay()),W>=this.__dowStart?A-=W-this.__dowStart+1:A-=t.Helper.Date.WeekdaysMax-this.__dowStart+1+W),f[y][v-1]=S):f[y].push(S),v<=m[y][0].childElementCount-1?(s=m[y][0].children[v],s.lastChild&&s.removeChild(s.lastChild)):(s=$("<div>").addClass("event-row-entry")[0],m[y].append(s)),A>0&&s.append($("<div>").addClass("event-spacer-"+A)[0]);let r=0,d=$("<div>");if(a.source===i.CalendarEventSource.BARef?(o=$("<div>").addClass("event-"+T)[0],o.classList.add("calref"),o.append($("<div>").text("R").addClass("col1")[0]),o.append(d.addClass("col2")[0]),""===a.title?(r=a.calInstId,this.__dfEvents.push(t.Locale.Localization.watchText(t.Locale.LangKey.Exception,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&d.text(e.text+" "+r)})))):d.text(a.title)):(d.addClass("event-"+T),""===a.title?(r=a.id,this.__dfEvents.push(t.Locale.Localization.watchText(t.Locale.LangKey.Exception,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&d.text(e.text+" "+r)})))):d.text(a.title),o=d[0]),$(o).attr("baid",a.id),n=this.__htmlEventHighlights.get(a.id),null==n?this.__htmlEventHighlights.set(a.id,[o]):n.push(o),s.append(o),x>0&&s.append($("<div>").addClass("event-spacer-"+x)[0]),!(E>0))break;A=0,x=0,w=S+1,k=t.Helper.Date.WeekdaysMax,E>k?(T=k,E-=k):(T=E,E=0,x=k-T)}}this.__htmlEventRows.append(m),this.__htmlEventRows.on("click",this.__handlerSelectEvent),f.length=0,b.length=0,p.length=0}__updateVisibleEvents(){if(null==this.__htmlEventRows)return;let e,t=this.__htmlEventRows.children(),a=0,n=0,i=0,s=0,r=0;for(let i=0;i<t.length;i++)if(e=t[i],!(e.childElementCount-1<1)){a=e.children[0].clientHeight,n=e.children[1].clientHeight;break}if(!(a<=0||n<=0||null==this.__htmlDays||this.__htmlDays[0].children.length<=0)){i=this.__htmlDays[0].children[0].clientHeight,r=i-a,this.__eventsAmountPossible=Math.floor(r/n),this.__eventsAmountPossible!=this.__eventsAmountPossibleLast&&(this.__eventsAmountPossible<=this.__eventsAmountDayMax&&this.__eventsAmountPossible>=0||this.__flagOnAttach)&&(this.__flagOnAttach=!1,this.__eventsAmountPossibleLast=this.__eventsAmountPossible,this.__updateInvisibleEventCounts());for(let e=0;e<this.__maxWeeksDow;e++){let a=t[e];for(let e=1;e<a.childElementCount;e++)e>this.__eventsAmountPossible?$(a.children[e]).addClass("invis"):$(a.children[e]).removeClass("invis")}s=this.__htmlDays.height(),null!=s&&this.__htmlEventRows.height(s)}}__updateCalendarView(){if(this.__htmlWrapperDay.detach(),this.__htmlWrapperMonth.detach(),this.__htmlWrapperEvent.detach(),this.__htmlNavConMonth.removeClass("invis"),this.__updateMenuVisibility(),this.__updateLegendIcons(),this.__displayMode!==i.CalendarDisplayMode.DatePicker){switch(this.__displayView){case i.CalendarDisplayView.Month:this.__element.append(this.__htmlWrapperDay),this.__visibilityEvents&&(this.__element.append(this.__htmlWrapperEvent),this.__updateVisibleEvents());break;case i.CalendarDisplayView.Year:this.__element.append(this.__htmlWrapperMonth),this.__htmlNavConMonth.addClass("invis")}this.__updateButtonStateToday(),this.__updateButtonImageToggleYear()}else this.__element.append(this.__htmlWrapperDay)}__updateMenuVisibility(){let e=this.__visibilityMenu?t.Visibility.Visible:t.Visibility.Hidden;this.__contextMenu&&this.__contextMenu.button.setVisibility(e),this.__buttonToggleYearMonth&&this.__buttonToggleYearMonth.setVisibility(e),this.__buttonToday&&this.__buttonToday.setVisibility(e)}__updateMenuTextEventVisibility(){null!=this.__menuEntryVisibilityEvents&&this.__menuEntryVisibilityEvents.textHandler.setText(this.getVisibilityEvents()?this.__strEventsHide:this.__strEventsShow)}__updateMenuStateEventVisibility(){null!=this.__menuEntryVisibilityEvents&&(this.__menuEntryVisibilityEvents.setIsEnabled(this.__isDataOriginValid()),this.setVisibilityEvents(this.__isDataOriginValid()),this.__updateMenuTextEventVisibility())}__updateMenuStates(){this.__updateMenuStateAdd(),this.__updateMenuStateSave(),this.__updateMenuStateReset(),this.__updateMenuStateEventVisibility()}__updateMenuStateAdd(){if(null==this.__menuEntryAdd)return;let e=null==this.__attrHandler.readOnly||this.__attrHandler.readOnly;this.__menuEntryAdd.setIsEnabled(this.__isDataOriginValid()&&!e)}__updateMenuStateSave(){if(null==this.__menuEntrySave)return;let e=null==this.__attrHandler.readOnly||this.__attrHandler.readOnly;this.__menuEntrySave.setIsEnabled(this.__isDataOriginBao()&&this.__hasChanges&&!e)}__updateMenuStateReset(){if(null==this.__menuEntryReset)return;let e=null==this.__attrHandler.readOnly||this.__attrHandler.readOnly;this.__menuEntryReset.setIsEnabled(this.__hasChanges&&!e)}__updateButtonStateToday(){if(null==this.__buttonToday)return;let e=this.__dateCurrent.getFullYear()!==this.__dateSelected.getFullYear();this.__displayView===i.CalendarDisplayView.Month&&(e=this.__dateCurrent.getMonth()!==this.__dateSelected.getMonth()||e),this.__buttonToday.setIsEnabled(e)}__updateButtonImageToggleYear(){if(null==this.__buttonToggleYearMonth)return;let e=this.__displayView===i.CalendarDisplayView.Month?t.Icons.Standard.CalendarYear.path:t.Icons.Standard.CalendarMonth.path;this.__buttonToggleYearMonth.iconHandler.setIcon(e,!0)}__updateLegendIcons(){if(!this.__isAttached||this.__displayMode===i.CalendarDisplayMode.DatePicker)return this.__lihToday.hide(),this.__lihMonth.hide(),void this.__lihYear.hide();this.__visibilityMenu?(this.__lihToday.show(),this.__displayView===i.CalendarDisplayView.Month?(this.__lihMonth.hide(),this.__lihYear.show()):(this.__lihMonth.show(),this.__lihYear.hide())):(this.__lihToday.hide(),this.__lihMonth.hide(),this.__lihYear.hide())}__updateDialogWindow(){let e=null==this.__attrHandler.readOnly||this.__attrHandler.readOnly,n=this.__dialogWindow.getIsAttached();this.__dialogWindow.close(),this.__dialogWindow.setAttributes({controls:[]}),this.__dialogWindow.setAttributes({headline:{textAttributes:{text:e?t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Exception):this.__strDialogWindowTitle}},buttons:e?a.DialogWindow.Buttons.Cancel:a.DialogWindow.Buttons.OkCancel,controls:!e&&this.__isDialogWindowBtnDelete?[this.__dialogWindowBtnDelete]:[]}),n&&this.__dialogWindow.open()}__resetEventsBa(){this.__eventsBa=[]}__resetChangesBa(){this.__eventsBaNew=[],this.__eventsBaChanged=[]}__resetEventsBaRef(){this.__eventsBaRef=[]}__resetChangesBaRef(){this.__eventsBaRefChanged=[]}__resetEvents(){this.__resetEventsBa(),this.__resetEventsBaRef(),this.__events=[]}__resetChanges(){this.__resetChangesBa(),this.__resetChangesBaRef(),this.__hasChanges=!1}__reset(){this.__resetChanges(),this.__resetEvents()}__swapDate(e){let t=0,a=0,n=0;t=e.start.getDate(),a=e.start.getMonth(),n=e.start.getFullYear(),e.start=new Date(e.end.getFullYear(),e.end.getMonth(),e.end.getDate()),e.end=new Date(n,a,t)}__combineEvents(){let e;if(this.__events=[],this.__eventsBaNew.length>0&&(this.__events=this.__events.concat(Array.from(this.__eventsBaNew))),this.__eventsBaChanged.length>0)for(let t=0;t<this.__eventsBa.length;t++){e=this.__eventsBa[t];for(let t=0;t<this.__eventsBaChanged.length;t++)if(e.id===this.__eventsBaChanged[t].id){e=this.__eventsBaChanged[t].calInstId<0?null:this.__eventsBaChanged[t];break}null!=e&&this.__events.push(e)}else this.__eventsBa.length>0&&(this.__events=this.__events.concat(Array.from(this.__eventsBa)));if(this.__eventsBaRefChanged.length>0)for(let t=0;t<this.__eventsBaRef.length;t++){e=this.__eventsBaRef[t];for(let t=0;t<this.__eventsBaRefChanged.length;t++)if(e.id===this.__eventsBaRefChanged[t].id){e=this.__eventsBaRefChanged[t].calInstId<0?null:this.__eventsBaRefChanged[t];break}null!=e&&this.__events.push(e)}else this.__eventsBaRef.length>0&&(this.__events=this.__events.concat(Array.from(this.__eventsBaRef)))}__compareEventContent(e,a){if(e.id!==a.id)return!1;if(e.calInstId!==a.calInstId)return!1;if(e.title!==a.title)return!1;if(e.desc!==a.desc)return!1;if(e.source!==a.source)return!1;if(e.start.getTime()!==a.start.getTime())return!1;if(e.end.getTime()!==a.end.getTime())return!1;if(null==e.data&&null!=a.data)return!1;if(null!=e.data&&null==a.data)return!1;if(e.repitition.Type!==a.repitition.Type)return!1;if(e.repitition.Data.dow!==a.repitition.Data.dow||e.repitition.Data.dowNth!==a.repitition.Data.dowNth||e.repitition.Data.dowWeek!==a.repitition.Data.dowWeek||e.repitition.Data.workday!==a.repitition.Data.workday)return!1;let n,i,s=!0,r=0;if(null!=e.data&&null!=a.data){n=e.data,i=a.data,e.data.length<a.data.length&&(n=a.data,i=e.data);for(let e=0;e<i.length&&(n[e].eState!==i[e].eState&&(s=!1),n[e].uValue.bVal===i[e].uValue.bVal&&n[e].uValue.rVal===i[e].uValue.rVal&&n[e].uValue.udiVal===i[e].uValue.udiVal||(s=!1),n[e].stTime.nHour===i[e].stTime.nHour&&n[e].stTime.nMinute===i[e].stTime.nMinute&&n[e].stTime.nSecond===i[e].stTime.nSecond||(s=!1),s);e++);if(s){for(let e=0;e<n.length;e++)n[e].eState===t.BA.SchedEntryState.eUndefined&&r++;s=n.length-r===i.length}}else s=!1;return s}__openEventDialog(e){null==e?(this.__strDialogWindowTitle=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.AddException),this.__isDialogWindowBtnDelete=!1):(this.__strDialogWindowTitle=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.EditException),this.__isDialogWindowBtnDelete=!(e.source===i.CalendarEventSource.BARef)),this.__eventContent.setCurrentDate(this.__dateSelected),this.__eventContent.setEvent(e),this.__updateDialogWindow(),this.__dialogWindow.open()}__today(){this.__dateSelected.setMonth(this.__dateCurrent.getMonth()),this.__dateSelected.setFullYear(this.__dateCurrent.getFullYear()),this.__updateCalendarWrappers(),this.__updateInvisibleEventCounts()}__toggleViewYearMonth(){this.__displayView=this.__displayView===i.CalendarDisplayView.Month?i.CalendarDisplayView.Year:i.CalendarDisplayView.Month,this.__updateCalendar(),this.__updateInvisibleEventCounts()}__menuVisibilityEvents(){this.toggleVisibilityEvents(),this.__updateInvisibleEventCounts(),this.__updateMenuTextEventVisibility()}__menuAdd(){this.__openEventDialog()}__menuSave(){null!=this.__menuEntrySave&&this.__menuEntrySave.getIsEnabled()&&a.DialogWindow.confirm(this.__strSaveChanges).then((e=>{e&&this.writeToPlc()}))}__menuReset(){null!=this.__menuEntryReset&&this.__menuEntryReset.getIsEnabled()&&a.DialogWindow.confirm(this.__strResetChanges).then((e=>{e&&this.resetChanges()}))}__getCalendarEvent(e){if(e>=r.IndexStartBa&&e<r.IndexStartBaRef&&e<=this.__indexBaId){for(let t=0;t<this.__eventsBaNew.length;t++)if(e===this.__eventsBaNew[t].id)return this.__eventsBaNew[t];for(let t=0;t<this.__eventsBaChanged.length;t++)if(e===this.__eventsBaChanged[t].id)return this.__eventsBaChanged[t]}if(e>=r.IndexStartBaRef&&e<=this.__indexBaRefId)for(let t=0;t<this.__eventsBaRefChanged.length;t++)if(e===this.__eventsBaRefChanged[t].id)return this.__eventsBaRefChanged[t];for(let t=0;t<this.__events.length;t++)if(e===this.__events[t].id)return this.__events[t];return null}__getWeekOfDay(e,a,n){if(!t.Helper.Date.isDate(e))return 0;if(a<1||a>t.Helper.Date.DaysMax)return 0;let i=new Date(e.getFullYear(),e.getMonth(),1),s=t.Helper.Date.adjustDayOfWeek(i.getDay());i.setDate(a);let r=t.Helper.Date.adjustDayOfWeek(i.getDay());return(a+(s>=(n=t.Helper.Date.validateDow(n))?s-n:t.Helper.Date.WeekdaysMax-(n-s))+(r>=n?t.Helper.Date.WeekdaysMax-(r-(n-1)):n-r-1))/t.Helper.Date.WeekdaysMax}__getDayOfDow(e,a,n,i){if(e<1||e>t.Helper.Date.WeekdaysMax)return 0;if(!t.Helper.Date.isDate(n))return 0;let s,r,o=t.Helper.Date.getWeeksOfMonth(n,i);if(a<1||a>o)return 0;let l=new Date(n.getTime());l.setDate(1);let d=t.Helper.Date.adjustDayOfWeek(l.getDay()),h=t.Helper.Date.getMaxDaysOfMonth(l);if(r=(i=t.Helper.Date.validateDow(i))-1,i!==t.BA.Weekday.eMonday&&(d=d>=i?d-r:d-r+t.Helper.Date.WeekdaysMax,e=e>=i?e-r:e-r+t.Helper.Date.WeekdaysMax),1===a){if(e<d)return 0;if(e===d)return 1;if(e>d)return e-d+1}if(a===o){if(l.setDate(h),d=t.Helper.Date.adjustDayOfWeek(l.getDay()),i!==t.BA.Weekday.eMonday&&(d=d>=i?d-r:d-r+t.Helper.Date.WeekdaysMax),e>d)return 0;if(e===d)return h;if(e<d)return h-(d-e)}return s=0,s+=t.Helper.Date.WeekdaysMax-d+1,s+=e,a-2>0&&(s+=t.Helper.Date.WeekdaysMax*(a-2)),s}__getNextEventId(e){switch(e){case i.CalendarEventSource.BA:return this.__indexBaId++;case i.CalendarEventSource.BARef:return this.__indexBaRefId++;default:return this.__indexBaId++}}__getDecimal(t){let a=e.ValueConverter.toNumber(t);return null==a?null:parseInt((a+"").split(".")[0])}__setScheduleExceptions(e){null==e?(this.__resetEventsBa(),this.__resetChangesBa(),this.__schedExceptionList=null,null==this.__schedCalendarList&&this.__eventContent.setMaximumEntryCount(null)):(this.__schedExceptionList=t.Helper.Array.clone(e),this.__eventContent.setMaximumEntryCount(e[0].aEntry.length)),this.__processScheduleExceptions()}__setScheduleCalendarReferences(e){null==e?(this.__resetEventsBaRef(),this.__resetChangesBaRef(),this.__schedCalendarList=null,null==this.__schedExceptionList&&this.__eventContent.setMaximumEntryCount(null)):(this.__schedCalendarList=t.Helper.Array.clone(e),this.__eventContent.setMaximumEntryCount(e[0].aEntry.length)),this.__processScheduleCalendarReferences()}__onSelectionChanged(e){this.eventHandler.raise(i.CalendarEvent.onSelectionChanged,e)}__onEventsChanged(){this.eventHandler.raise(i.CalendarEvent.onEventsChanged)}processBaObject(){if(null==this.baObjectHandler.baObject||!this.baObjectHandler.baObject.getIsValid())return null!=this.baObjectHandler.baObject&&this.logger.warn("processBaObject(): "+this.baObjectHandler.baObject?.isNotValidText),this.__dataOrigin=n.None,this.__reset(),this.__updateWrapperEvents(),void this.__updateMenuStates();let e;switch(this.__dataOrigin=n.BaObject,this.__updateMenuStateAdd(),this.__updateMenuStateEventVisibility(),this.setDataType(this.baObjectHandler.baObject.DataType),this.baObjectHandler.baObject.DataType){case t.DataType.boolean:this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,(e=>{this.setActiveText(e?.get(0)),this.setInactiveText(e?.get(1))}),!0);break;case t.DataType.number:this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,(e=>{this.setUnit(e)}));break;case t.DataType.enum:this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,(t=>{e=a.Combobox.toComboboxItemArray(t),this.setStateTexts(e)}),!0)}this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eException,(e=>{this.__resetChanges(),this.__updateMenuStateSave(),this.__updateMenuStateReset(),null!=e?this.__setScheduleExceptions(e):this.logger.warn("processBaObject(): Invalid value was received for BaParameterId 'eException'!")})),this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eCalendar,(e=>{this.__resetChanges(),this.__updateMenuStateSave(),this.__updateMenuStateReset(),null!=e?this.__setScheduleCalendarReferences(e):this.logger.warn("processBaObject(): Invalid value was received for BaParameterId 'aCalendar'!")})),!0!==this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkParameterAccess(t.BA.BaParameterId.eException,t.BA.Scope.write))}setAttributes(e){if(super.setAttributes(e),!this.__initDone)return this;let a=0,n=this.__visibilityEvents,i=this.__displayView;switch(this.__eventContent.setAttributes(e),null!=e.visibilityMenu&&this.setVisibilityMenu(e.visibilityMenu),null!=e.visibilityEvents&&(n=e.visibilityEvents,a=1),null!=e.displayView&&(i=e.displayView,a=2),null!=e.displayMode&&(this.__displayMode=e.displayMode,a=3),null!=e.dowStart&&(this.__dowStart=t.Helper.Date.validateDow(e.dowStart),a=3),a){case 1:this.setVisibilityEvents(n);break;case 2:this.__visibilityEvents=n,this.setDisplayView(i);break;case 3:this.__visibilityEvents=n,this.__displayView=i,this.__constructCalendar()}return this}getAttributes(){let e={...this.__attrHandler.getRef(),displayMode:this.__displayMode,displayView:this.__displayView,visibilityMenu:this.__visibilityMenu,visibilityMenuEntrySave:this.__visibilityMenuEntrySave,visibilityEvents:this.__visibilityEvents};this.__dateInit&&(e.dateInit=this.__dateInit);let t=this.__eventContent.getAttributes();return t.unit&&(e.unit=t.unit),t.dataType&&(e.dataType=t.dataType),t.stateTexts&&(e.stateTexts=t.stateTexts),t.stateColors&&(e.stateColors=t.stateColors),t.snapPeriode&&(e.snapPeriode=t.snapPeriode),t.activeText&&(e.activeText=t.activeText),t.inactiveText&&(e.inactiveText=t.inactiveText),e}setVisibilityEvents(e){e!==this.__visibilityEvents&&(this.__visibilityEvents=e,this.__attrHandler.visibilityEvents=e,this.__displayMode!==i.CalendarDisplayMode.DatePicker&&(this.__displayView===i.CalendarDisplayView.Month?this.__updateCalendarView():this.__updateCalendarWrappers()))}getVisibilityEvents(){return this.__visibilityEvents}toggleVisibilityEvents(){this.setVisibilityEvents(!this.__visibilityEvents)}setDate(e){this.__dateSelected=new Date,e&&t.Helper.Date.isDate(e)&&(this.__dateSelected=new Date(e.getTime()),this.__dateSelectedLast=new Date(e.getTime())),this.__updateCalendarWrappers()}getSelectedDate(){return new Date(Date.UTC(this.__dateSelected.getFullYear(),this.__dateSelected.getMonth(),this.__dateSelected.getDate()))}hasChanges(){return this.__hasChanges}writeToPlc(){return new Promise((async(e,a)=>{if(null==this.baObjectHandler.baObject)return;if(this.__attrHandler.readOnly)return;if(!this.__hasChanges)return;let n=this.getScheduleExceptions(i.CalendarEventSource.BA);if(null==n||0===n.length)return;const s=this.busyHandler.setBusy("Writing exceptions to PLC.");this.baObjectHandler.baObject.tryWriteBaVariableValue(t.BA.BaParameterId.eException,n,(n=>{if(this.logger.checkServerResult(t.Logger.Severity.warn,n)||(s(),a()),null==this.__schedCalendarList)return;if(null==this.baObjectHandler.baObject)return;let i,r,o=[],l=t.BA.createEmptySchedEntry();for(let e=0;e<this.__schedCalendarList.length;e++){if(i=this.__schedCalendarList[e],o.push({stRefCalendarID:{eObjectType:i.stRefCalendarID.eObjectType,nInstanceID:i.stRefCalendarID.nInstanceID},aEntry:[]}),0!==o[e].stRefCalendarID.nInstanceID)for(let t=0;t<this.__events.length;t++)if(r=this.__events[t],r.calInstId===o[e].stRefCalendarID.nInstanceID){o[e].aEntry=r.data;break}for(let t=0;t<this.__maxDailyRef-o[e].aEntry.length;t++)o[e].aEntry.push(l)}this.baObjectHandler.baObject.tryWriteBaVariableValue(t.BA.BaParameterId.eCalendar,o,(n=>{s(),this.__resetChanges(),this.__updateMenuStateSave(),this.__updateMenuStateReset(),this.logger.checkServerResult(t.Logger.Severity.warn,n)?e():a()}))}))}))}resetChanges(){this.__resetChanges(),this.__combineEvents(),this.__updateCalendarWrappers(),this.__updateMenuStateSave(),this.__updateMenuStateReset(),this.__onEventsChanged()}setScheduleExceptions(e){null!=e?this.__dataOrigin=this.__dataOrigin===n.BaICal?n.BaInterface:n.BaIExc:(this.__dataOrigin===n.BaInterface&&(this.__dataOrigin=n.BaICal),this.__dataOrigin!==n.BaICal&&(this.__dataOrigin=n.None)),this.__resetChanges(),this.__updateMenuStateAdd(),this.__updateMenuStateEventVisibility(),this.__updateMenuStateSave(),this.__updateMenuStateReset(),this.__setScheduleExceptions(e),this.__setScheduleCalendarReferences(null)}getScheduleExceptions(e,a,n){let s,o=0,l=[],d=this.__events,h=t.BA.createEmptySchedEntry(),_=r.createScheduleException();(null==e||e<i.CalendarEventSource.None||e>Object.keys(i.CalendarEventSource).length/2)&&(e=i.CalendarEventSource.None);for(let e=0;e<this.__maxDaily;e++)_.aEntry.push(h);if(null==d||d.length<=0){for(let e=0;e<this.__maxExceptions;e++)l.push(_);return l}for(let t=0;t<d.length;t++)if(s=this.__createSchedExceptionFromCalendarEvent(d[t]),null!=s&&(e===i.CalendarEventSource.None||d[t].source===i.CalendarEventSource.None||d[t].source===e)){for(let e=0;e<this.__maxDaily-s.aEntry.length;e++)s.aEntry.push(h);l.push(s)}if(e===i.CalendarEventSource.BA){if(null!=this.__schedCalendarExceptions)for(let e=0;e<this.__schedCalendarExceptions.length;e++)o+=this.__schedCalendarExceptions[e].exceptions.length;for(let e=0;e<this.__maxExceptions-(this.__events.length-o);e++)l.push(_)}if(l.length<=0)return null;if(null==a&&null==n)return l;if(null==a)return null;let c,u,g,p,b,m,y,v,f,D,C,H,w,S,T,E=[],B=new Date(a.getTime()),A=new Date((n||a).getTime()),x=new Date,O=new Date;if(isNaN(B.getTime())||isNaN(A.getTime()))return this.logger.error("getSchedExceptionEntries(): Invalid date range."),null;x.setHours(0),x.setMinutes(0),x.setSeconds(0),x.setMilliseconds(0),O.setHours(23),O.setMinutes(59),O.setSeconds(59),O.setMilliseconds(0),B.setHours(0),B.setMinutes(0),B.setSeconds(0),B.setMilliseconds(0),A.setHours(23),A.setMinutes(59),A.setSeconds(59),A.setMilliseconds(0);for(let e=0;e<l.length&&(s=l[e],s.eType!==t.BA.DateValChoice.Invalid);e++)switch(s.eType){case t.BA.DateValChoice.eDate:if(s.uDate.stDate.nDay!==t.BA.Day.Unspecified&&s.uDate.stDate.eMonth!==t.BA.Month.Unspecified&&s.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified)x.setDate(s.uDate.stDate.nDay),x.setMonth(s.uDate.stDate.eMonth-1),x.setFullYear(r.createYearFromBa(s.uDate.stDate.nYear)),O.setDate(s.uDate.stDate.nDay),O.setMonth(s.uDate.stDate.eMonth-1),O.setFullYear(r.createYearFromBa(s.uDate.stDate.nYear)),x.getTime()<=A.getTime()&&O.getTime()>=B.getTime()&&E.push(s);else if(s.uDate.stDate.nDay===t.BA.Day.Unspecified&&s.uDate.stDate.eMonth===t.BA.Month.Unspecified&&s.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&s.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified)E.push(s);else{if(C=new Date,C.setHours(0),C.setMinutes(0),C.setSeconds(0),C.setMilliseconds(0),S=!1,s.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified)w=B.getFullYear(),D=A.getFullYear();else{if(w=r.createYearFromBa(s.uDate.stDate.nYear),D=w,w<B.getFullYear()||w>A.getFullYear())break;C.setFullYear(w)}if(s.uDate.stDate.eMonth===t.BA.Month.Invalid)break;H=B.getMonth()+1,s.uDate.stDate.eMonth!==t.BA.Month.Unspecified&&(s.uDate.stDate.eMonth>B.getMonth()+1&&(H=s.uDate.stDate.eMonth),s.uDate.stDate.eMonth>A.getMonth()+1&&(H=A.getMonth()+1),C.setMonth(s.uDate.stDate.eMonth-1));for(let e=w;e<=D;e++){s.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&C.setFullYear(e),y=e===D?A.getMonth()+1:12;for(let a=H;a<=y;a++){if(s.uDate.stDate.eMonth===t.BA.Month.Unspecified&&C.setMonth(a-1),s.uDate.stDate.nDay!==t.BA.Day.Unspecified){if(C.setDate(s.uDate.stDate.nDay),C.getTime()>=B.getTime()&&C.getTime()<=A.getTime())E.push(s),S=!0;else if(s.uDate.stDate.eMonth!==t.BA.Month.Unspecified)break}else if(s.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){v=t.Helper.Date.getWeeksOfMonth(C);for(let e=1;e<=v;e++)if(c=this.__getDayOfDow(s.uDate.stDate.eDayOfWeek,e,C),0!==c){if(C.setDate(c),C.getTime()>=B.getTime()&&C.getTime()<=A.getTime()){E.push(s),S=!0;break}if(C.getTime()>A.getTime()){S=!0;break}}}else{m=t.Helper.Date.getMaxDaysOfMonth(C);for(let e=1;e<=m;e++){if(C.setDate(e),C.getTime()>=B.getTime()&&C.getTime()<=A.getTime()){E.push(s),S=!0;break}if(C.getTime()>A.getTime()){S=!0;break}}}S&&(e=D+1,a=y+1)}H=1}}break;case t.BA.DateValChoice.eDateRange:c=0,u=0,g=0,c=s.uDate.stDateRange.stDateFrom.nDay!==t.BA.Day.Unspecified?s.uDate.stDateRange.stDateFrom.nDay:B.getDate(),u=s.uDate.stDateRange.stDateFrom.eMonth!==t.BA.Month.Unspecified?s.uDate.stDateRange.stDateFrom.eMonth-1:B.getMonth(),g=s.uDate.stDateRange.stDateFrom.nYear!==t.BA.BaDate.YearUnspecified?r.createYearFromBa(s.uDate.stDateRange.stDateFrom.nYear):B.getFullYear(),x=new Date(g,u,c,0,0,0),c=s.uDate.stDateRange.stDateTo.nDay!==t.BA.Day.Unspecified?s.uDate.stDateRange.stDateTo.nDay:A.getDate(),u=s.uDate.stDateRange.stDateTo.eMonth!==t.BA.Month.Unspecified?s.uDate.stDateRange.stDateTo.eMonth-1:A.getMonth(),g=s.uDate.stDateRange.stDateTo.nYear!==t.BA.BaDate.YearUnspecified?r.createYearFromBa(s.uDate.stDateRange.stDateTo.nYear):A.getFullYear(),O=new Date(g,u,c,23,59,59),x.getTime()<=A.getTime()&&O.getTime()>=B.getTime()&&E.push(s);break;case t.BA.DateValChoice.eWeekNDay:p=0,b=0,v=0,f=0,x.setFullYear(B.getFullYear()),O.setFullYear(B.getFullYear()),s.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified?(x.setMonth(B.getMonth()),O.setMonth(B.getMonth())):(x.setMonth(s.uDate.stWeekNDay.eMonth-1),O.setMonth(s.uDate.stWeekNDay.eMonth-1)),H=B.getMonth(),T=B.getMonth(),y=A.getMonth(),H>y&&(H=y,y=T-y);for(let e=H;e<=y;e++){x.setDate(1),O.setDate(1),p=0,v=t.Helper.Date.getWeeksOfMonth(x),f=t.Helper.Date.adjustDayOfWeek(x.getDay());for(let a=1;a<=v;a++){if(1===a)if(s.uDate.stWeekNDay.eWeekday!==t.BA.Weekday.Unspecified){if(s.uDate.stWeekNDay.eWeekday<f){p=t.Helper.Date.WeekdaysMax-t.Helper.Date.adjustDayOfWeek(x.getDay())+s.uDate.stWeekNDay.eWeekday+1,b=t.Helper.Date.WeekdaysMax-t.Helper.Date.adjustDayOfWeek(x.getDay())+s.uDate.stWeekNDay.eWeekday+1;continue}p=s.uDate.stWeekNDay.eWeekday-f+1,b=s.uDate.stWeekNDay.eWeekday-f+1}else p=1,b=p+(t.Helper.Date.WeekdaysMax-f);if(x.setDate(p),O.setDate(b),x.getTime()>=B.getTime()&&x.getTime()<=A.getTime()&&O.getTime()>=B.getTime()&&O.getTime()<=A.getTime()||x.getTime()<B.getTime()&&O.getTime()>=B.getTime()&&O.getTime()<=A.getTime()||x.getTime()>=B.getTime()&&x.getTime()<=A.getTime()&&O.getTime()>A.getTime()){if(s.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified){E.push(s),e=y+1;break}if(a===s.uDate.stWeekNDay.eWeekOfMonth){E.push(s),e=y+1;break}}s.uDate.stWeekNDay.eWeekday!==t.BA.Weekday.Unspecified?(p+=t.Helper.Date.WeekdaysMax,b+=t.Helper.Date.WeekdaysMax,p>t.Helper.Date.getMaxDaysOfMonth(x)&&(a=v+1)):1===a?(p=b+1,b=p+(t.Helper.Date.WeekdaysMax-1)):(p+=t.Helper.Date.WeekdaysMax,p>t.Helper.Date.getMaxDaysOfMonth(x)&&(p=t.Helper.Date.getMaxDaysOfMonth(x)),b+=t.Helper.Date.WeekdaysMax,b>t.Helper.Date.getMaxDaysOfMonth(x)&&(b=t.Helper.Date.getMaxDaysOfMonth(x)))}if(s.uDate.stWeekNDay.eMonth!==t.BA.Month.Unspecified)break;x.setMonth(e+1),O.setMonth(e+1)}}return E}getScheduleCalendarReferences(){return this.__schedCalendarList}setDataType(e){this.__eventContent.setDataType(e)}getDataType(){return this.__eventContent.getDataType()}setActiveText(e){this.__eventContent.setActiveText(e)}getActiveText(){return this.__eventContent.getActiveText()}setInactiveText(e){this.__eventContent.setInactiveText(e)}getInactiveText(){return this.__eventContent.getInactiveText()}setUnit(e){this.__eventContent.setUnit(e)}getUnit(){return this.__eventContent.getUnit()}setStateTexts(e){this.__eventContent.setStateTexts(e)}getStateTexts(){return this.__attrHandler.stateTexts}setStateColors(e){this.__eventContent.setStateColors(e)}getStateColors(){return this.__eventContent.getStateColors()}setSnapPeriode(e){this.__eventContent.setSnapPeriode(e)}getSnapPeriode(){return this.__eventContent.getSnapPeriode()}getMaximumExcCount(){return this.__maxExceptions}getMaximumEntryCount(){return this.__eventContent.getMaximumEntryCount()||0}getMaximumCalCount(){return this.__schedCalendarList?this.__schedCalendarList.length:0}setDisplayMode(e){let t=null;return this.__attrHandler.checkAttribute(e,"displayMode",{validator:"number"})&&e in i.CalendarDisplayMode&&(t=e),null!==t&&(this.__attrHandler.displayMode=t,this.__displayMode=t,this.__processDisplayMode()),this}getDisplayMode(){return this.__displayMode}setDisplayView(e){let t=null;return this.__attrHandler.checkAttribute(e,"displayView",{validator:"number"})&&e in i.CalendarDisplayView&&(t=e),null!==t&&(this.__attrHandler.displayView=t,this.__displayView=t,this.__processDisplayView()),this}getDisplayView(){return this.__displayView}setVisibilityMenu(e){return this.__attrHandler.checkAttribute(e,"visibilityMenu",{validator:"boolean"})?(this.__attrHandler.visibilityMenu=e,this.__visibilityMenu=e,this.__updateLegendIcons(),this.__displayMode===i.CalendarDisplayMode.DatePicker||this.__updateMenuVisibility(),this):this}getVisibilityMenu(){return this.__visibilityMenu}__processReadOnly(){super.__processReadOnly(),this.__updateMenuStateAdd(),this.__updateMenuStateSave(),this.__eventContent.setReadOnly(this.__attrHandler.readOnly),this.__updateDialogWindow()}}a.Calendar=i;class s{constructor(e,n){this.__maxTabs=5,this.__indexDowEvery=7,this.__indexWeekEvery=5,this.__indexMonthEvery=12,this.__element=$("<div>").addClass("event-dialog"),this.logger=new t.Logger({name:"CalendarEventContent"}),this.__dfStatic=[],this.__strMonthLong=[],this.__strDaysLong=[],this.__strOrdinalText=[],this.__strEveryWeekday="",this.__strEveryMonth="",this.__strEvery="",this.__arrReadOnly=[],this.__evt=null,this.__dateCurrent=null,this.__tabWindow=new a.TabWindow(e+"-tab-window",null),null!=n&&this.__tabWindow.setAttributes(n),this.__tabWindow.setTabPosition(t.Position.top),this.__htmlTabWindow=this.__tabWindow.getElement()[0],this.__schedDaily=new a.DailySchedule(e+"-daily-schedule",null),null!=n&&this.__schedDaily.setAttributes(n),this.__schedDaily.setOrientation(t.Orientation.horizontal),this.__schedDaily.setSnapPeriode(10),this.__htmlSchedDaily=this.__schedDaily.getElement()[0],this.__constructTabContent(),this.__createLocalizationWatches(),this.__updateTabContent()}destroy(){this.__dfStatic&&(this.__dfStatic.forEach((e=>e())),this.__dfStatic.length=0),this.__tabWindow&&this.__tabWindow.destroy(),this.__schedDaily&&this.__schedDaily.destroy(),this.__dtf1_1&&this.__dtf1_1.destroy(),this.__dtf1_2&&this.__dtf1_2.destroy(),this.__radio2_1&&this.__radio2_1.destroy(),this.__cb2_1&&this.__cb2_1.destroy(),this.__ipb2_1&&this.__ipb2_1.destroy(),this.__ckb2_1&&this.__ckb2_1.destroy(),this.__radio4_1&&this.__radio4_1.destroy(),this.__radio4_2&&this.__radio4_2.destroy(),this.__cb4_1&&this.__cb4_1.destroy(),this.__cb4_2&&this.__cb4_2.destroy(),this.__cb4_3&&this.__cb4_3.destroy(),this.__cb4_4&&this.__cb4_4.destroy(),this.__ipb4_1&&this.__ipb4_1.destroy(),this.__ipb4_2&&this.__ipb4_2.destroy(),this.__ckb4_1&&this.__ckb4_1.destroy(),this.__ckb4_2&&this.__ckb4_2.destroy(),this.__radio5_1&&this.__radio5_1.destroy(),this.__radio5_2&&this.__radio5_2.destroy(),this.__cb5_1&&this.__cb5_1.destroy(),this.__cb5_2&&this.__cb5_2.destroy(),this.__cb5_3&&this.__cb5_3.destroy(),this.__cb5_4&&this.__cb5_4.destroy(),this.__cb5_5&&this.__cb5_5.destroy(),this.__cb5_6&&this.__cb5_6.destroy(),this.__ipb5_1&&this.__ipb5_1.destroy(),this.__ckb5_1&&this.__ckb5_1.destroy(),this.__arrReadOnly&&(this.__arrReadOnly.length=0)}__constructTabContent(){let e,n,i=25,s=120,r=20;this.__dfStatic.forEach((e=>e())),this.__dfStatic.length=0,this.__tabWindow.removeAllTabs(),this.__tabs=[],e=[],this.__arrReadOnly.length=0,this.__arrReadOnly=[];for(let a=0;a<t.Helper.Date.DaysMax;a++)e.push({text:a+1+".",value:a});for(let o=1;o<=this.__maxTabs;o++)if(3!=o)if(n=this.__tabWindow.getId()+"-tab-"+o,null!=this.__tabWindow.addTab(n))switch(this.__tabs.push(n),o){case 1:this.__tabWindow?.getTab(this.__tabs[o-1])?.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Regular)),this.__dtf1_1=new a.DateTimeField(n+"-dtf"+o+"-1",null),this.__dtf1_1.setReadOnly(!1),this.__dtf1_1.layoutHandler.setWidth(170,"px"),this.__dtf1_1.layoutHandler.setHeight(i,"px"),this.__dtf1_1.setMode(a.DateTimeField.Mode.date),this.__dtf1_2=new a.DateTimeField(n+"-dtf"+o+"-2",null),this.__dtf1_2.setReadOnly(!1),this.__dtf1_2.layoutHandler.setWidth(170,"px"),this.__dtf1_2.layoutHandler.setHeight(i,"px"),this.__dtf1_2.setMode(a.DateTimeField.Mode.date),this.__arrReadOnly.push(this.__dtf1_1),this.__arrReadOnly.push(this.__dtf1_2);break;case 2:this.__tabWindow?.getTab(this.__tabs[o-1])?.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Daily)),this.__radio2_1=new a.RadioButton(n+"-r"+o+"-1",null),this.__radio2_1.getElement().addClass("eds"),this.__radio2_1.setRadioGroup("g2"),this.__radio2_1.setRadioState(!0),this.__cb2_1=new a.Combobox(n+"-cb"+o+"-1",null),this.__cb2_1.getElement().addClass("eds"),this.__cb2_1.setReadOnly(!1),this.__cb2_1.layoutHandler.setWidth(105,"px"),this.__cb2_1.layoutHandler.setHeight(i,"px"),this.__ckb2_1=new a.Checkbox(n+"-ckb"+o+"-1",null),this.__ckb2_1.setReadOnly(!1),this.__ckb2_1.layoutHandler.setWidth(r,"px"),this.__ckb2_1.layoutHandler.setHeight(r,"px"),this.__ckb2_1.setActiveText(""),this.__ckb2_1.setInactiveText(""),this.__div2_1=$("<div>").addClass("evd-text eds t3"),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div2_1.text(e.text)}))),this.__ipb2_1=new a.InputBox(n+"-ipb"+o+"-1",null),this.__ipb2_1.setReadOnly(!1),this.__ipb2_1.layoutHandler.setWidth(55,"px"),this.__ipb2_1.layoutHandler.setHeight(i,"px"),this.__ipb2_1.setMinValue(0),this.__ipb2_1.setDigits(0),this.__arrReadOnly.push(this.__radio2_1),this.__arrReadOnly.push(this.__cb2_1),this.__arrReadOnly.push(this.__ckb2_1),this.__arrReadOnly.push(this.__ipb2_1);break;case 4:this.__tabWindow?.getTab(this.__tabs[o-1])?.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Monthly)),this.__radio4_1=new a.RadioButton(n+"-r"+o+"-1",null),this.__radio4_1.getElement().addClass("eds"),this.__radio4_1.setRadioGroup("g4"),this.__radio4_1.setRadioState(!0),this.__cb4_1=new a.Combobox(n+"-cb"+o+"-1",null),this.__cb4_1.getElement().addClass("eds"),this.__cb4_1.setReadOnly(!1),this.__cb4_1.layoutHandler.setWidth(s,"px"),this.__cb4_1.layoutHandler.setHeight(i,"px"),this.__cb4_1.setData(e),this.__cb4_2=new a.Combobox(n+"-cb"+o+"-2",null),this.__cb4_2.getElement().addClass("eds3"),this.__cb4_2.setReadOnly(!1),this.__cb4_2.layoutHandler.setWidth(s,"px"),this.__cb4_2.layoutHandler.setHeight(i,"px"),this.__ckb4_1=new a.Checkbox(n+"-ckb"+o+"-1",null),this.__ckb4_1.setReadOnly(!1),this.__ckb4_1.layoutHandler.setWidth(r,"px"),this.__ckb4_1.layoutHandler.setHeight(r,"px"),this.__ckb4_1.setActiveText(""),this.__ckb4_1.setInactiveText(""),this.__div4_1=$("<div>").addClass("evd-text eds t3"),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div4_1.text(e.text)}))),this.__ipb4_1=new a.InputBox(n+"-ipb"+o+"-1",null),this.__ipb4_1.setReadOnly(!1),this.__ipb4_1.layoutHandler.setWidth(55,"px"),this.__ipb4_1.layoutHandler.setHeight(i,"px"),this.__ipb4_1.setMinValue(0),this.__ipb4_1.setDigits(0),this.__radio4_2=new a.RadioButton(n+"-r"+o+"-2",null),this.__radio4_2.getElement().addClass("eds"),this.__radio4_2.setRadioGroup("g4"),this.__cb4_3=new a.Combobox(n+"-cb"+o+"-3",null),this.__cb4_3.getElement().addClass("eds"),this.__cb4_3.setReadOnly(!1),this.__cb4_3.layoutHandler.setWidth(s,"px"),this.__cb4_3.layoutHandler.setHeight(i,"px"),this.__cb4_4=new a.Combobox(n+"-cb"+o+"-4",null),this.__cb4_4.getElement().addClass("eds"),this.__cb4_4.setReadOnly(!1),this.__cb4_4.layoutHandler.setWidth(s,"px"),this.__cb4_4.layoutHandler.setHeight(i,"px"),this.__div4_2=$("<div>").addClass("evd-text eds t2"),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.Week,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div4_2.text(e.text)}))),this.__ckb4_2=new a.Checkbox(n+"-ckb"+o+"-2",null),this.__ckb4_2.setReadOnly(!1),this.__ckb4_2.layoutHandler.setWidth(r,"px"),this.__ckb4_2.layoutHandler.setHeight(r,"px"),this.__ckb4_2.setActiveText(""),this.__ckb4_2.setInactiveText(""),this.__div4_3=$("<div>").addClass("evd-text eds t3"),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div4_3.text(e.text)}))),this.__ipb4_2=new a.InputBox(n+"-ipb"+o+"-2",null),this.__ipb4_2.setReadOnly(!1),this.__ipb4_2.layoutHandler.setWidth(55,"px"),this.__ipb4_2.layoutHandler.setHeight(i,"px"),this.__ipb4_2.setMinValue(0),this.__ipb4_2.setDigits(0),this.__arrReadOnly.push(this.__radio4_1),this.__arrReadOnly.push(this.__cb4_1),this.__arrReadOnly.push(this.__cb4_2),this.__arrReadOnly.push(this.__ckb4_1),this.__arrReadOnly.push(this.__ipb4_1),this.__arrReadOnly.push(this.__radio4_2),this.__arrReadOnly.push(this.__cb4_3),this.__arrReadOnly.push(this.__cb4_4),this.__arrReadOnly.push(this.__ckb4_2),this.__arrReadOnly.push(this.__ipb4_2);break;case 5:this.__tabWindow?.getTab(this.__tabs[o-1])?.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Annual)),this.__radio5_1=new a.RadioButton(n+"-r"+o+"-1",null),this.__radio5_1.getElement().addClass("eds"),this.__radio5_1.setRadioGroup("g5"),this.__radio5_1.setRadioState(!0),this.__cb5_1=new a.Combobox(n+"-cb"+o+"-1",null),this.__cb5_1.getElement().addClass("eds"),this.__cb5_1.setReadOnly(!1),this.__cb5_1.layoutHandler.setWidth(s,"px"),this.__cb5_1.layoutHandler.setHeight(i,"px"),this.__cb5_1.setData(e),this.__cb5_2=new a.Combobox(n+"-cb"+o+"-2",null),this.__cb5_2.getElement().addClass("eds2"),this.__cb5_2.setReadOnly(!1),this.__cb5_2.layoutHandler.setWidth(105,"px"),this.__cb5_2.layoutHandler.setHeight(i,"px"),this.__cb5_3=new a.Combobox(n+"-cb"+o+"-3",null),this.__cb5_3.getElement().addClass("eds"),this.__cb5_3.setReadOnly(!1),this.__cb5_3.layoutHandler.setWidth(s,"px"),this.__cb5_3.layoutHandler.setHeight(i,"px"),this.__radio5_2=new a.RadioButton(n+"-r"+o+"-2",null),this.__radio5_2.getElement().addClass("eds"),this.__radio5_2.setRadioGroup("g5"),this.__cb5_4=new a.Combobox(n+"-cb"+o+"-4",null),this.__cb5_4.getElement().addClass("eds"),this.__cb5_4.setReadOnly(!1),this.__cb5_4.layoutHandler.setWidth(s,"px"),this.__cb5_4.layoutHandler.setHeight(i,"px"),this.__cb5_5=new a.Combobox(n+"-cb"+o+"-5",null),this.__cb5_5.getElement().addClass("eds"),this.__cb5_5.setReadOnly(!1),this.__cb5_5.layoutHandler.setWidth(105,"px"),this.__cb5_5.layoutHandler.setHeight(i,"px"),this.__div5_1=$("<div>").addClass("evd-text eds t2"),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.WeekOf,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div5_1.text(e.text)}))),this.__cb5_6=new a.Combobox(n+"-cb"+o+"-6",null),this.__cb5_6.getElement().addClass("eds"),this.__cb5_6.setReadOnly(!1),this.__cb5_6.layoutHandler.setWidth(s,"px"),this.__cb5_6.layoutHandler.setHeight(i,"px"),this.__ckb5_1=new a.Checkbox(n+"-ckb"+o+"-1",null),this.__ckb5_1.setReadOnly(!1),this.__ckb5_1.layoutHandler.setWidth(r,"px"),this.__ckb5_1.layoutHandler.setHeight(r,"px"),this.__ckb5_1.setActiveText(""),this.__ckb5_1.setInactiveText(""),this.__div5_2=$("<div>").addClass("evd-text eds t3"),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div5_2.text(e.text)}))),this.__ipb5_1=new a.InputBox(n+"-ipb"+o+"-1",null),this.__ipb5_1.setReadOnly(!1),this.__ipb5_1.layoutHandler.setWidth(55,"px"),this.__ipb5_1.layoutHandler.setHeight(i,"px"),this.__ipb5_1.setMinValue(0),this.__ipb5_1.setDigits(0),this.__arrReadOnly.push(this.__radio5_1),this.__arrReadOnly.push(this.__cb5_1),this.__arrReadOnly.push(this.__cb5_2),this.__arrReadOnly.push(this.__cb5_3),this.__arrReadOnly.push(this.__radio5_2),this.__arrReadOnly.push(this.__cb5_4),this.__arrReadOnly.push(this.__cb5_5),this.__arrReadOnly.push(this.__cb5_6),this.__arrReadOnly.push(this.__ckb5_1),this.__arrReadOnly.push(this.__ipb5_1)}else this.logger.warn(`__constructTabContent(): Could not create tab with id ${n}.`);else this.__tabs.push("empty")}__createDialogValues(){return{selection:-1,dateStart:r.createDatePast(),dateEnd:r.createDateFuture(),yearSet:!1,yearValue:r.YearPast,combo1:-1,combo2:-1,combo3:-1}}__createLocalizationWatches(){for(let e=0;e<t.Locale.MonthsLongLangKey.length;e++)this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.MonthsLongLangKey[e],(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strMonthLong[e]=a.text),this.__updateLocalization()})));for(let e=0;e<t.Locale.WeekDaysLongLangKey.length;e++)this.__dfStatic?.push(t.Locale.Localization.watchText(t.Locale.WeekDaysLongLangKey[e],(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strDaysLong[e]=a.text),this.__updateLocalization()})));for(let e=0;e<t.Locale.OrdinalTextLangKey.length;e++)this.__dfStatic?.push(t.Locale.Localization.watchText(t.Locale.OrdinalTextLangKey[e],(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strOrdinalText[e]=a.text),this.__updateLocalization()})));this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.EveryWeekday,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strEveryWeekday=e.text),this.__updateLocalization()}))),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.EveryMonth,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strEveryMonth=e.text),this.__updateLocalization()}))),this.__dfStatic.push(t.Locale.Localization.watchText(t.Locale.LangKey.Every,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strEvery=e.text),this.__updateLocalization()})))}__convertDowToComboboxIndex(e,t){return e===r.DowEvery?this.__indexDowEvery:t-1}__convertWeekToComboboxIndex(e){return e===r.WeekEvery?this.__indexWeekEvery:e-1}__updateLocalization(){let e=[],t=[],a=[],n=[];for(let t=0;t<this.__strMonthLong.length;t++)e.push({text:this.__strMonthLong[t],value:t}),a.push({text:this.__strMonthLong[t],value:t});e.push({text:this.__strEveryMonth,value:this.__strMonthLong.length}),this.__cb2_1.setData(e),this.__cb5_2.setData(a),this.__cb5_6.setData(a),t.length=0,a.length=0;for(let e=0;e<this.__strDaysLong.length;e++)t.push({text:this.__strDaysLong[e],value:e}),a.push({text:this.__strDaysLong[e],value:e});t.push({text:this.__strEveryWeekday,value:this.__strDaysLong.length}),this.__cb4_2.setData(t),this.__cb4_3.setData(t),a.push({text:this.__strEveryWeekday,value:this.__strDaysLong.length}),this.__cb5_3.setData(a),this.__cb5_4.setData(a);for(let e=0;e<this.__strOrdinalText.length;e++)n.push({text:this.__strOrdinalText[e],value:e});n.push({text:this.__strEvery,value:this.__strOrdinalText.length}),this.__cb4_4.setData(n),this.__cb5_5.setData(n)}__updateTabContent(){let e,t,a;for(let n=0;n<this.__maxTabs;n++)if(e=this.__tabWindow.getTab(this.__tabs[n]),e)switch(t=$("<div>").addClass("wrapper"),n+1){case 1:a=$("<div>"),a.append(this.__dtf1_1.getElement()),t.append(a),a=$("<div>"),a.append(this.__dtf1_2.getElement()),t.append(a),e.setContent(t);break;case 2:a=$("<div>"),a.append(this.__radio2_1.getElement()),a.append(this.__cb2_1.getElement()),a.append(this.__ckb2_1.getElement()),a.append(this.__div2_1[0]),a.append(this.__ipb2_1.getElement()),t.append(a),e.setContent(t);break;case 4:a=$("<div>"),a.append(this.__radio4_1.getElement()),a.append(this.__cb4_1.getElement()),a.append(this.__cb4_2.getElement()),a.append(this.__ckb4_1.getElement()),a.append(this.__div4_1[0]),a.append(this.__ipb4_1.getElement()),t.append(a),a=$("<div>"),a.append(this.__radio4_2.getElement()),a.append(this.__cb4_3.getElement()),a.append(this.__cb4_4.getElement()),a.append(this.__div4_2[0]),a.append(this.__ckb4_2.getElement()),a.append(this.__div4_3[0]),a.append(this.__ipb4_2.getElement()),t.append(a),e.setContent(t);break;case 5:a=$("<div>"),a.append(this.__radio5_1.getElement()),a.append(this.__cb5_1.getElement()),a.append(this.__cb5_2.getElement()),a.append(this.__cb5_3.getElement()),t.append(a),a=$("<div>"),a.append(this.__radio5_2.getElement()),a.append(this.__cb5_4.getElement()),a.append(this.__cb5_5.getElement()),a.append(this.__div5_1[0]),a.append(this.__cb5_6.getElement()),a.append(this.__ckb5_1.getElement()),a.append(this.__div5_2[0]),a.append(this.__ipb5_1.getElement()),t.append(a),e.setContent(t)}}__resetEventContent(){this.__tabWindow.selectTab(this.__tabs[0]),this.__dateCurrent?(this.__dtf1_1.setDate(new Date(this.__dateCurrent.getTime())),this.__dtf1_2.setDate(new Date(this.__dateCurrent.getTime())),this.__dateCurrent=null):(this.__dtf1_1.setDate(new Date),this.__dtf1_2.setDate(new Date)),this.__radio2_1.setRadioState(!0),this.__cb2_1.setSelectedValue(0),this.__ckb2_1.setState(!1),this.__ipb2_1.setValue(null),this.__radio4_1.setRadioState(!0),this.__cb4_1.setSelectedValue(0),this.__cb4_2.setSelectedValue(0),this.__ckb4_1.setState(!1),this.__ipb4_1.setValue(null),this.__radio4_2.getRadioState(),this.__cb4_3.setSelectedValue(0),this.__cb4_4.setSelectedValue(0),this.__ckb4_2.setState(!1),this.__ipb4_2.setValue(null),this.__radio5_1.setRadioState(!0),this.__cb5_1.setSelectedValue(0),this.__cb5_2.setSelectedValue(0),this.__cb5_3.setSelectedValue(0),this.__cb5_4.setSelectedValue(0),this.__cb5_5.setSelectedValue(0),this.__cb5_6.setSelectedValue(0),this.__ckb5_1.setState(!1),this.__ipb5_1.setValue(null),this.__schedDaily.setData(null);for(let e=0;e<this.__element[0].children.length;e++)switch(this.__element[0].children[e].id){case this.__tabWindow.getId():this.__element[0].removeChild(this.__htmlTabWindow);break;case this.__schedDaily.getId():this.__element[0].removeChild(this.__htmlSchedDaily)}this.__element[0].appendChild(this.__htmlTabWindow),this.__element[0].appendChild(this.__htmlSchedDaily)}setAttributes(e){return this.__tabWindow.setAttributes(e),this.__schedDaily.setAttributes(e),this}getAttributes(){return{...this.__tabWindow.getAttributes(),...this.__schedDaily.getAttributes()}}setEvent(e){if(this.__resetEventContent(),null==e)return void(this.__evt=null);e.source===i.CalendarEventSource.BARef&&this.__element[0].removeChild(this.__htmlTabWindow),this.__evt=r.copyCalendarEvent(e);let t,a=0,n=this.__evt,s=this.__createDialogValues();if(null!=n){switch(this.__schedDaily.setData(this.__evt.data),n.repitition.Type){case i.CalendarEventRepetition.Regular:s.dateStart=n.start,s.dateEnd=n.end,a=1;break;case i.CalendarEventRepetition.Daily:s.selection=1,s.combo1=this.__indexMonthEvery,a=2;break;case i.CalendarEventRepetition.Weekly:break;case i.CalendarEventRepetition.Monthly:t=r.createDows(n.repitition.Data.dow),n.start.getDate()===n.end.getDate()?(s.selection=1,s.combo1=n.start.getDate()-1,s.combo2=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),a=4):n.repitition.Data.dow===r.DowEvery&&n.repitition.Data.dowWeek===r.WeekEvery?(s.selection=1,s.combo1=this.__indexMonthEvery,a=2):(s.selection=2,s.combo1=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),s.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),a=4);break;case i.CalendarEventRepetition.MonthlyOnce:t=r.createDows(n.repitition.Data.dow),n.start.getDate()===n.end.getDate()?(s.selection=1,s.combo1=n.start.getDate()-1,s.combo2=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),s.yearSet=!0,s.yearValue=n.start.getFullYear(),a=4):n.repitition.Data.dow===r.DowEvery&&n.repitition.Data.dowWeek===r.WeekEvery?(s.selection=1,s.combo1=this.__indexMonthEvery,s.combo2=this.__indexDowEvery,s.yearSet=!0,s.yearValue=n.start.getFullYear(),a=2):(s.selection=2,s.combo1=t[0]-1,s.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),s.yearSet=!0,s.yearValue=n.start.getFullYear(),a=4);break;case i.CalendarEventRepetition.Yearly:n.repitition.Data.dow===r.DowEvery&&n.repitition.Data.dowWeek===r.WeekEvery?(s.selection=1,s.combo1=n.start.getMonth(),a=2):(t=r.createDows(n.repitition.Data.dow),n.start.getDate()===n.end.getDate()?(s.selection=1,s.combo1=n.start.getDate()-1,s.combo2=n.start.getMonth(),s.combo3=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),a=5):(s.selection=2,s.combo1=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),s.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),s.combo3=n.start.getMonth(),a=5));break;case i.CalendarEventRepetition.YearlyOnce:n.repitition.Data.dow===r.DowEvery&&n.repitition.Data.dowWeek===r.WeekEvery?(s.selection=1,s.combo1=n.start.getMonth(),s.combo2=this.__indexDowEvery,s.yearSet=!0,s.yearValue=n.start.getFullYear(),a=2):(t=r.createDows(n.repitition.Data.dow),s.selection=2,s.combo1=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),s.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),s.combo3=n.start.getMonth(),s.yearSet=!0,s.yearValue=s.yearValue=n.start.getFullYear(),a=5)}switch(a>0&&a<=5&&this.__tabWindow.selectTab(this.__tabs[a-1]),a){case 1:this.__dtf1_1.setDate(s.dateStart),this.__dtf1_2.setDate(s.dateEnd);break;case 2:this.__radio2_1.setRadioState(!0),this.__cb2_1.setSelectedValue(s.combo1),s.yearSet&&(this.__ckb2_1.setState(!0),this.__ipb2_1.setValue(s.yearValue));break;case 4:switch(s.selection){case 1:this.__radio4_1.setRadioState(!0),this.__cb4_1.setSelectedValue(s.combo1),this.__cb4_2.setSelectedValue(s.combo2),s.yearSet&&(this.__ckb4_1.setState(!0),this.__ipb4_1.setValue(s.yearValue));break;case 2:this.__radio4_2.setRadioState(!0),this.__cb4_3.setSelectedValue(s.combo1),this.__cb4_4.setSelectedValue(s.combo2),s.yearSet&&(this.__ckb4_2.setState(!0),this.__ipb4_2.setValue(s.yearValue))}break;case 5:switch(s.selection){case 1:this.__radio5_1.setRadioState(!0),this.__cb5_1.setSelectedValue(s.combo1),this.__cb5_2.setSelectedValue(s.combo2),this.__cb5_3.setSelectedValue(s.combo3);break;case 2:this.__radio5_2.setRadioState(!0),this.__cb5_4.setSelectedValue(s.combo1),this.__cb5_5.setSelectedValue(s.combo2),this.__cb5_6.setSelectedValue(s.combo3),s.yearSet&&(this.__ckb5_1.setState(!0),this.__ipb5_1.setValue(s.yearValue))}}}}getEvent(){let e;null!=this.__evt?(e=this.__evt,e.repitition.Data.dow=0,e.repitition.Data.dowWeek=0):e=r.createEvent();let a=this.__tabWindow.getSelectedTab();if(null==a)return null;let n,s,o,l,d,h,_,c=a.getId(),u=parseInt(c.slice(c.length-1));if(null==u)return this.logger.error("getEvent(): Invalid tab id of NULL."),null;e.data=[],n=this.__schedDaily.getData(),null==n&&(n=[]);for(let a=0;a<n.length;a++)n[a].eState!=t.BA.SchedEntryState.eUndefined&&e.data.push(n[a]);switch(u){case 1:if(s=this.__dtf1_1.getDate(),null==s){e=null,this.logger.warn("getEvent(): Invalid date for tab 1.");break}e.start=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),s=this.__dtf1_2.getDate(),e.end=null==s?new Date(e.start.getTime()):new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,0),e.repitition.Type=i.CalendarEventRepetition.Regular;break;case 2:if(o=this.__cb2_1.getSelectedValue(),null==o){e=null;break}if(h=this.__ckb2_1.getState(),_=this.__ipb2_1.getValue(),e.start.setDate(r.DayPast),e.end.setDate(r.DayFuture),e.repitition.Data.dow=r.DowEvery,e.repitition.Data.dowWeek=r.WeekEvery,o===this.__indexMonthEvery)if(h){if(null==_){e=null;break}e.start.setFullYear(_),e.start.setMonth(0),e.end.setFullYear(_),e.end.setMonth(0),e.repitition.Type=i.CalendarEventRepetition.MonthlyOnce}else e.start.setFullYear(r.YearPast),e.start.setMonth(0),e.end.setFullYear(r.YearFuture),e.end.setMonth(0),e.repitition.Type=i.CalendarEventRepetition.Daily;else if(h){if(null==_){e=null;break}e.start.setFullYear(_),e.start.setMonth(o),e.end.setFullYear(_),e.end.setMonth(o),e.repitition.Type=i.CalendarEventRepetition.YearlyOnce}else e.start.setFullYear(r.YearPast),e.start.setMonth(o),e.end.setFullYear(r.YearFuture),e.end.setMonth(o),e.repitition.Type=i.CalendarEventRepetition.Yearly;break;case 3:this.logger.warn("getEvent(): Tab id 3 not implemented yet.");break;case 4:if(e.start.setMonth(0),e.end.setMonth(0),this.__radio4_1.getRadioState()){if(o=this.__cb4_1.getSelectedValue(),l=this.__cb4_2.getSelectedValue(),null==o||null==l){e=null;break}if(h=this.__ckb4_1.getState(),_=this.__ipb4_1.getValue(),h){if(null==_){e=null;break}e.start.setFullYear(_),e.end.setFullYear(_),e.repitition.Type=i.CalendarEventRepetition.MonthlyOnce}else e.start.setFullYear(r.YearPast),e.end.setFullYear(r.YearFuture),e.repitition.Type=i.CalendarEventRepetition.Monthly;e.start.setDate(o+1),e.end.setDate(o+1),e.repitition.Data.dow=l===this.__indexDowEvery?r.DowEvery:Math.pow(2,l)}else{if(!this.__radio4_2.getRadioState()){e=null;break}if(o=this.__cb4_3.getSelectedValue(),l=this.__cb4_4.getSelectedValue(),null==o||null==l){e=null;break}if(e.start.setDate(r.DayPast),e.end.setDate(r.DayFuture),h=this.__ckb4_2.getState(),_=this.__ipb4_2.getValue(),h){if(null==_){e=null;break}e.start.setFullYear(_),e.end.setFullYear(_),e.repitition.Type=i.CalendarEventRepetition.MonthlyOnce}else e.start.setFullYear(r.YearPast),e.end.setFullYear(r.YearFuture),e.repitition.Type=i.CalendarEventRepetition.Monthly;e.repitition.Data.dow=o===this.__indexDowEvery?r.DowEvery:Math.pow(2,o),e.repitition.Data.dowWeek=l===this.__indexWeekEvery?r.WeekEvery:l+1}break;case 5:if(e.start.setDate(r.DayPast),e.end.setDate(r.DayFuture),this.__radio5_1.getRadioState()){if(o=this.__cb5_1.getSelectedValue(),l=this.__cb5_2.getSelectedValue(),d=this.__cb5_3.getSelectedValue(),null==o||null==l||null==d){e=null;break}e.start.setFullYear(r.YearPast),e.start.setMonth(l),e.start.setDate(o+1),e.end.setFullYear(r.YearFuture),e.end.setMonth(l),e.end.setDate(o+1),e.repitition.Data.dow=d===this.__indexDowEvery?r.DowEvery:Math.pow(2,d),e.repitition.Type=i.CalendarEventRepetition.Yearly}else if(this.__radio5_2.getRadioState()){if(o=this.__cb5_4.getSelectedValue(),l=this.__cb5_5.getSelectedValue(),d=this.__cb5_6.getSelectedValue(),null==o||null==l||null==d){e=null;break}if(h=this.__ckb5_1.getState(),_=this.__ipb5_1.getValue(),h){if(null==_){e=null;break}e.start.setFullYear(_),e.end.setFullYear(_),e.repitition.Type=i.CalendarEventRepetition.YearlyOnce}else e.start.setFullYear(r.YearPast),e.end.setFullYear(r.YearFuture),e.repitition.Type=i.CalendarEventRepetition.Yearly;e.start.setMonth(d),e.end.setMonth(d),e.repitition.Data.dow=o===this.__indexDowEvery?r.DowEvery:Math.pow(2,o),e.repitition.Data.dowWeek=l===this.__indexWeekEvery?r.WeekEvery:l+1}break;default:e=null}return e}setStateColors(e){this.__schedDaily.setStateColors(e)}getStateColors(){return this.__schedDaily.getStateColors()}setMaximumEntryCount(e){this.__schedDaily.setMaximumEntryCount(e)}getMaximumEntryCount(){return this.__schedDaily.getMaximumEntryCount()}setSnapPeriode(e){this.__schedDaily.setSnapPeriode(e)}getSnapPeriode(){return this.__schedDaily.getSnapPeriode()}setCurrentDate(e){this.__dateCurrent=null,null!=e&&t.Helper.Date.isDate(e)&&(this.__dateCurrent=new Date(e.getTime()),this.__dateCurrent.setDate(1))}getElement(){return this.__element}setDataType(e){this.__schedDaily.setDataType(e)}getDataType(){return this.__schedDaily.getDataType()}setStateTexts(e){this.__schedDaily.setStateTexts(e)}getStateTexts(){return this.__schedDaily.getStateTexts()}setActiveText(e){this.__schedDaily.setActiveText(e)}getActiveText(){return this.__schedDaily.getActiveText()}setInactiveText(e){this.__schedDaily.setInactiveText(e)}getInactiveText(){return this.__schedDaily.getInactiveText()}setUnit(e){this.__schedDaily.setUnit(e)}getUnit(){return this.__schedDaily.getUnit()}setReadOnly(e){if(null!=e){this.__tabWindow.setReadOnly(e),this.__schedDaily.setReadOnly(e);for(let t=0;t<this.__arrReadOnly.length;t++)this.__arrReadOnly[t].setReadOnly(e)}}}class r{static createEvent(){return{id:-1,source:i.CalendarEventSource.None,calInstId:-1,repitition:r.createRepitition(),start:new Date,end:new Date,title:"",desc:"",data:null}}static createRepitition(){return{Type:i.CalendarEventRepetition.None,Data:{dow:0,dowNth:0,dowWeek:0,workday:0}}}static createEventSelection(e){switch(e){case i.CalendarSelectionType.Date:return{Type:i.CalendarSelectionType.Date,Data:new Date};case i.CalendarSelectionType.Event:return{Type:i.CalendarSelectionType.Event,Data:r.createEvent()}}return null}static createScheduleException(){return{aEntry:[],eType:t.BA.DateValChoice.Invalid,uDate:{stDate:r.createBaDate(),stDateRange:{stDateFrom:r.createBaDate(),stDateTo:r.createBaDate()},stWeekNDay:{eMonth:t.BA.Month.Unspecified,eWeekOfMonth:t.BA.Week.Unspecified,eWeekday:t.BA.Weekday.Unspecified}}}}static createBaDate(){return{nYear:t.BA.BaDate.YearUnspecified,eMonth:t.BA.Month.Unspecified,nDay:t.BA.Day.Unspecified,eDayOfWeek:t.BA.Weekday.Unspecified}}static createDatePast(e=0,t=r.DayPast){return new Date(r.YearPast,e,t)}static createDateFuture(e=0,t=r.DayFuture){return new Date(r.YearFuture,e,t)}static createDateFromBa(e,t,a){return new Date(r.createYearFromBa(e),t,a)}static createYearFromBa(e){return e+t.BA.BaDate.YearOffset}static createYearForBa(e){return e-t.BA.BaDate.YearOffset}static createDows(e){if(e<0||e>r.DowEvery)return console.warn(`createDows(): Invalid dow value ${e}`),[];let a=[],n=0;for(let i=t.Helper.Date.WeekdaysMax-1;i>=0;i--)n=Math.pow(2,i),n<=e&&(e-=n,a.push(i+1));return a.sort(((e,t)=>e<t?-1:e>t?1:0)),a}static convertBaDowToRepititionDow(e){let a=0;switch(e){case t.BA.Weekday.eMonday:a=1;break;case t.BA.Weekday.eTuesday:a=2;break;case t.BA.Weekday.eWednesday:a=4;break;case t.BA.Weekday.eThursday:a=8;break;case t.BA.Weekday.eFriday:a=16;break;case t.BA.Weekday.eSaturday:a=32;break;case t.BA.Weekday.eSunday:a=64}return a}static copyCalendarEvent(e){let t=JSON.parse(JSON.stringify(e));return t.start=new Date(t.start),t.end=new Date(t.end),t}static isValidDate(e,a,n){if(e<1||e>t.Helper.Date.DaysMax)return!1;if(a<1||a>t.Helper.Date.MonthsMax)return!1;if(n){if(n<0)return!1}else n=r.YearPast;let i=t.Helper.Date.getMaxDaysOfMonth({month:a,year:n});return 0!==i&&!(e>i)}}r.IndexStartBa=1,r.IndexStartBaRef=100,r.DowEvery=127,r.WeekEvery=7,r.DayPast=1,r.DayFuture=20,r.YearPast=1904,r.YearFuture=2204,function(e){let t,a,n,i,s,r;!function(e){e.onEventsChanged="oneventschanged",e.onSelectionChanged="onselectionchanged"}(t=e.CalendarEvent||(e.CalendarEvent={})),function(e){e[e.DatePicker=0]="DatePicker",e[e.EventCalendar=1]="EventCalendar"}(a=e.CalendarDisplayMode||(e.CalendarDisplayMode={})),function(e){e[e.Month=0]="Month",e[e.Year=1]="Year"}(n=e.CalendarDisplayView||(e.CalendarDisplayView={})),function(e){e[e.None=0]="None",e[e.Regular=1]="Regular",e[e.Daily=2]="Daily",e[e.Weekly=3]="Weekly",e[e.Monthly=4]="Monthly",e[e.Yearly=5]="Yearly",e[e.MonthlyOnce=6]="MonthlyOnce",e[e.YearlyOnce=7]="YearlyOnce"}(i=e.CalendarEventRepetition||(e.CalendarEventRepetition={})),function(e){e[e.None=0]="None",e[e.User=1]="User",e[e.BA=2]="BA",e[e.BARef=3]="BARef"}(s=e.CalendarEventSource||(e.CalendarEventSource={})),function(e){e[e.None=0]="None",e[e.Date=1]="Date",e[e.Event=2]="Event"}(r=e.CalendarSelectionType||(e.CalendarSelectionType={})),e.DefaultEventDialogSize={width:700,height:350}}(i=a.Calendar||(a.Calendar={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.TextControl{constructor(e,i){super(e,i),this.baObjectHandler=new t.BaObjectHandler(this),this.valueHandler=new t.System.ValueHandler(this),this.resizeHandler=new a.ResizeHandler(this),this.__checkbox=$("<input type='checkbox'></input>"),this.__paddingContainer=$("<div>").addClass("padding-container"),this.__stateChangedHandler=e=>this.__onStateChanged(e),this.__labelPressedHandler=e=>this.__onLabelPressed(e),this.__element.addClass("checkbox"),this.__element.append(this.__paddingContainer),this.setActiveText("Active"),this.setInactiveText("Inactive"),this.setAppearance(n.Appearance.checkbox),this.setReadOnly(!0),this.textHandler.setHorizontalAlignment("Left"),this.__updateElements(this.__attrHandler.state)}__attach(){this.__isAttached||(this.__checkbox.on("change",this.__stateChangedHandler),this.__useLabel&&this.__paddingContainer.children(".text-element").on("pointerdown",this.__labelPressedHandler),null==this.__attrHandler.appearance&&this.setAppearance(n.Appearance.checkbox),this.onResized(),super.__attach())}__detach(){this.__isAttached&&(this.__checkbox.off("change",this.__stateChangedHandler),this.__paddingContainer.children(".text-element").off("pointerdown",this.__labelPressedHandler),super.__detach())}destroy(){this.__activeTextSymbol?.destroy(),this.__inactiveTextSymbol?.destroy(),this.valueHandler.destroy(),this.resizeHandler.destroy(),this.baObjectHandler.destroy(),super.destroy()}onResized(){if(this.__isAttached&&(this.__element.css("--tchmi-ba-checkbox-height",this.__element.outerHeight()+"px"),null!=this.__attrHandler.appearance&&this.__attrHandler.appearance>n.Appearance.checkbox)){let e=this.__paddingContainer.find(".checkbox-container");e[0]&&e.css("--tchmi-ba-checkbox-container-width",e.outerWidth()+"px")}}onValueChanged(e){this.__setStateInternal(null!=e&&e)}__onStateChanged(e){if(e.stopPropagation(),1==this.__attrHandler.readOnly||0==this.__attrHandler.isEnabled||0==this.checkAccess(t.Server.AccessRight.operate))this.__checkbox.prop("checked",this.__attrHandler.state);else{if(this.__setStateInternal(this.__checkbox.prop("checked")),null!=this.__attrHandler.state&&this.valueHandler.processChangedValue(this.__attrHandler.state),null!=this.__attrHandler.stateFeedback&&this.__attrHandler.state!=this.__attrHandler.stateFeedback){let e=()=>{this.__stateFeedbackReady&&this.__stateFeedbackReady(),null!=this.__attrHandler.stateFeedback&&this.__setStateInternal(this.__attrHandler.stateFeedback)};this.__stateFeedbackReady=this.busyHandler.setBusy("Waiting for StateFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"})}this.eventHandler.raise(n.CheckboxEvents.onUserInteractionFinished)}}__onLabelPressed(e){if((null==e.button||e.button===t.MouseButtons.left)&&!this.__attrHandler.readOnly){let t=()=>{this.__checkbox.prop("checked",!this.__attrHandler.state),this.__onStateChanged(e),this.__element.off("pointerup",t)};this.__element.on("pointerup",t)}}__updateElements(e){this.__checkbox.prop("checked",e),this.__useLabel&&this.__updateLabel(e),e?this.__element.addClass("checked"):this.__element.removeClass("checked"),this.__processCheckedBackgroundColor()}__updateLabel(e){if(null==this.__paddingContainer)return;let t=this.__useLabel,a=this.__paddingContainer.children(".text-element");null==this.__attrHandler.activeText&&null==this.__attrHandler.inactiveText?(this.__useLabel=!1,this.__element.removeClass("use-label"),null!=a[0]&&(a.text(""),a.detach())):(this.__useLabel=!0,this.__element.addClass("use-label"),null==a[0]&&(a=$("<span>").addClass("text-element"),this.__paddingContainer.append(a)),e?a.text(this.__attrHandler.activeText?this.__attrHandler.activeText:""):a.text(this.__attrHandler.inactiveText?this.__attrHandler.inactiveText:"")),t!==this.__useLabel&&(this.eventHandler.raise(n.CheckboxEvents.onUseLabelChanged),this.__useLabel&&this.__isAttached&&a.on("click touchstart",this.__labelPressedHandler))}processBaObject(){this.baObjectHandler.baObject&&this.baObjectHandler.baObject.DataType===t.DataType.boolean&&(this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(e=>{this.setStateFeedback(e)})),this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,(e=>{this.setInactiveText(e?.get(0)),this.setActiveText(e?.get(1))}),!0),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess()))}getUseLabel(){return this.__useLabel}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.state&&this.setState(e.state),void 0!==e.stateFeedback&&this.setStateFeedback(e.stateFeedback),void 0!==e.activeText&&this.setActiveText(e.activeText),void 0!==e.inactiveText&&this.setInactiveText(e.inactiveText),void 0!==e.checkedBackgroundColor&&this.setCheckedBackgroundColor(e.checkedBackgroundColor),void 0!==e.checkmarkColor&&this.setCheckmarkColor(e.checkmarkColor),void 0!==e.appearance&&this.setAppearance(e.appearance),this}getAttributes(){return this.__attrHandler.getRef()}setState(e){return this.__attrHandler.checkAttribute(e,"state",{validator:"boolean"})?(null==e&&(e=!1),null==this.__attrHandler.stateFeedback&&this.__setStateInternal(e),this):this}__setStateInternal(e){e!==this.__attrHandler.state&&(this.__attrHandler.state=e,this.__processState(),this.eventHandler.raise(n.CheckboxEvents.onStateChanged))}__processState(){null!=this.__attrHandler.state&&this.__updateElements(this.__attrHandler.state)}getState(){return this.__attrHandler.state}setStateFeedback(e){return this.__attrHandler.checkAttribute(e,"stateFeedback",{validator:"boolean"})?(this.__attrHandler.stateFeedback=e,null!=this.__attrHandler.stateFeedback&&this.__processStateFeedback(),this.__stateFeedbackReady&&this.__stateFeedbackReady(),this.eventHandler.raise(n.CheckboxEvents.onStateFeedbackChanged),this):this}__processStateFeedback(){null==this.__attrHandler.stateFeedback&&(this.__attrHandler.stateFeedback=!1),this.__setStateInternal(this.__attrHandler.stateFeedback)}getStateFeedback(){return this.__attrHandler.stateFeedback}setActiveText(a){return this.__attrHandler.checkAttribute(a,"activeText",{validator:"string"})?(this.__attrHandler.activeText=a,null!=this.__attrHandler.activeText&&e.Symbol.isSymbolExpression(this.__attrHandler.activeText)?(null!=this.__activeTextSymbol&&this.__activeTextSymbol.destroy(),this.__activeTextSymbol=new e.Symbol(this.__attrHandler.activeText),this.__activeTextSymbol.watch((e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.value&&(this.__attrHandler.activeText=e.value,this.__processActiveText())}))):this.__processActiveText(),this):this}__processActiveText(){let e=this.__useLabel;null==this.__attrHandler.activeText?(this.__useLabel=!1,this.__element.removeClass("use-label")):(this.__useLabel=!0,this.__element.addClass("use-label")),e!==this.__useLabel&&this.eventHandler.raise(n.CheckboxEvents.onUseLabelChanged),this.__updateLabel(this.__attrHandler.state)}getActiveText(){return this.__attrHandler.activeText}setInactiveText(a){return this.__attrHandler.checkAttribute(a,"inactiveText",{validator:"string"})?(this.__attrHandler.inactiveText=a,null!=this.__attrHandler.inactiveText&&e.Symbol.isSymbolExpression(this.__attrHandler.inactiveText)?(null!=this.__inactiveTextSymbol&&this.__inactiveTextSymbol.destroy(),this.__inactiveTextSymbol=new e.Symbol(this.__attrHandler.inactiveText),this.__inactiveTextSymbol.watch((e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.value&&(this.__attrHandler.inactiveText=e.value,this.__processInactiveText())}))):this.__processInactiveText(),this):this}__processInactiveText(){let e=this.__useLabel;null==this.__attrHandler.inactiveText?(this.__useLabel=!1,this.__element.removeClass("use-label")):(this.__useLabel=!0,this.__element.addClass("use-label")),e!==this.__useLabel&&this.eventHandler.raise(n.CheckboxEvents.onUseLabelChanged),this.__updateLabel(this.__attrHandler.state)}getInactiveText(){return this.__attrHandler.inactiveText}setCheckedBackgroundColor(e){return this.__attrHandler.checkColorAttribute(e,"checkedBackgroundColor")?(this.__attrHandler.checkedBackgroundColor=e,this.__processCheckedBackgroundColor(),this):this}__processCheckedBackgroundColor(){null==this.__attrHandler.checkedBackgroundColor?this.__element.css("--tchmi-ba-checkbox-checked-background-color",""):this.__element.css("--tchmi-ba-checkbox-checked-background-color",this.__attrHandler.checkedBackgroundColor.toString())}getCheckedBackgroundColor(){return this.__attrHandler.checkedBackgroundColor}setCheckmarkColor(e){return this.__attrHandler.checkColorAttribute(e,"checkmarkColor")?(this.__attrHandler.checkmarkColor=e,this.__processCheckmarkColor(),this):this}__processCheckmarkColor(){null==this.__attrHandler.checkmarkColor?this.__element.css("--tchmi-ba-checkbox-checkmark-color",""):this.__element.css("--tchmi-ba-checkbox-checkmark-color",this.__attrHandler.checkmarkColor.toString())}getCheckmarkColor(){return this.__attrHandler.checkmarkColor}setAppearance(e){return this.__attrHandler.checkAttribute(e,"appearance",{validator:"number"})?(null==e&&(e=n.Appearance.checkbox),this.__attrHandler.appearance=e,this.__processAppearance(),this):this}__processAppearance(){let e=this.__paddingContainer.find(".checkbox-container");switch(e[0]&&e.detach(),e=$("<label>").addClass("checkbox-container"),this.__attrHandler.appearance){case n.Appearance.toggleSwitch:case n.Appearance.toggleSlider:this.__element.addClass("toggle-switch"),this.__element.removeClass("standard");let t=$("<span>").addClass("toggle-switch-slider");e.append(this.__checkbox,t),this.__paddingContainer.append(e),this.__attrHandler.appearance===n.Appearance.toggleSlider?this.__element.addClass("toggle-slider"):this.__element.removeClass("toggle-slider"),this.onResized();break;default:this.__element.removeClass("toggle-switch"),this.__element.removeClass("toggle-slider"),this.__element.addClass("standard");let a=$('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">\n\t\t\t\t\t\t\t\t<path d="M 9 18 L 13 22 L 22 9" fill="none" stroke-width="2" stroke-linecap="round"></path>\n\t\t\t\t\t\t\t</svg>');e.append(this.__checkbox,a),this.__paddingContainer.append(e)}}getAppearance(){return this.__attrHandler.appearance}__processReadOnly(){super.__processReadOnly(),null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?this.__checkbox.removeAttr("disabled"):this.__checkbox.attr("disabled","disabled")}}a.Checkbox=n,function(e){let t,a;!function(e){e.onStateChanged="onStateChanged",e.onStateFeedbackChanged="onStateFeedbackChanged",e.onUserInteractionFinished="onUserInteractionFinished",e.onUseLabelChanged="onUseLabelChanged"}(t=e.CheckboxEvents||(e.CheckboxEvents={})),function(e){e[e.checkbox=0]="checkbox",e[e.toggleSwitch=1]="toggleSwitch",e[e.toggleSlider=2]="toggleSlider"}(a=e.Appearance||(e.Appearance={}))}(n=a.Checkbox||(a.Checkbox={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.TextControl{constructor(t,a){super(t,a),this.baObjectHandler=new e.BaObjectHandler(this),this.valueHandler=new e.System.ValueHandler(this),this.__combobox=$("<select>").addClass("text-element"),this.__changedHandler=e=>this.__onChanged(e),this.__element.addClass("combobox"),this.__element.append(this.__combobox),this.__button=$('<div class=\'combobox-button\'>\n\t\t\t\t\t<svg version="1.1"\n\t\t\t\t\t   width="100" height="100"\n\t\t\t\t\t   xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t   viewBox="0 0 100 100"\n\t\t\t\t\t   style="\n\t\t\t\t\t\t  stroke: var(--tchmi-ba-combobox-button-arrow-color);\n\t\t\t\t\t\t  fill: transparent;\n\t\t\t\t\t\t  stroke-linecap: round;\n\t\t\t\t\t\t  stroke-linejoin: round;\n\t\t\t\t\t\t  stroke-width: 6px;\n\t\t\t\t\t   ">\n\t\t\t\t\t   <g>\n\t\t\t\t\t\t  <path\n\t\t\t\t\t\t\t d="M 3 30 L 50 70 L 97 30" />\n\t\t\t\t\t   </g>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>'),this.__element.append(this.__button),this.setReadOnly(!0)}__attach(){this.__isAttached||(this.__combobox.on("change",this.__changedHandler),super.__attach())}__detach(){this.__isAttached&&(this.__combobox.off("change",this.__changedHandler),super.__detach())}destroy(){this.valueHandler.destroy(),this.baObjectHandler.destroy(),super.destroy()}onValueChanged(e){this.__setSelectedValueInternal(e)}__onChanged(e){if(e.stopPropagation(),null!=this.__attrHandler.data&&(this.__setSelectedValueInternal(this.__attrHandler.data[this.__combobox[0].selectedIndex].value),null!=this.__attrHandler.selectedData)){if(null!=this.__attrHandler.selectedData.value&&this.valueHandler.processChangedValue(this.__attrHandler.selectedData.value),null!=this.__attrHandler.selectedValueFeedback&&this.__attrHandler.selectedData.value!=this.__attrHandler.selectedValueFeedback){let e=()=>{this.__valueFeedbackReady&&this.__valueFeedbackReady(),null!=this.__attrHandler.selectedValueFeedback&&this.__setSelectedValueInternal(this.__attrHandler.selectedValueFeedback)};this.__valueFeedbackReady=this.busyHandler.setBusy("Waiting for SelectedValueFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"})}this.eventHandler.raise(a.ComboboxEvents.onUserInteractionFinished)}}__addOption(e){let t=$("<option>");t.text(e.text||""),$(this.__combobox).append(t)}__updateElements(e){if(null!=this.__attrHandler.data)if(null==e)this.__combobox[0].selectedIndex=0,this.textHandler.setText(this.__attrHandler.data[0].text);else{let t=this.__attrHandler.data.findIndex((t=>t.value===e));if(t>-1){this.__combobox[0].selectedIndex=t;let e=this.__attrHandler.data[t].text;null!==e&&this.textHandler.setText(e)}else this.__attrHandler.selectedData||(this.__attrHandler.selectedData={text:"invalid#",value:e}),this.__combobox[0].selectedIndex=t,this.__attrHandler.selectedData.text||(this.__attrHandler.selectedData.text="invalid#"),this.textHandler.setText(this.__attrHandler.selectedData.text)}}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.data&&this.setData(e.data),void 0!==e.selectedValue&&this.setSelectedValue(e.selectedValue),void 0!==e.selectedValueFeedback&&this.setSelectedValueFeedback(e.selectedValueFeedback),void 0!==e.buttonColor&&this.setButtonColor(e.buttonColor),e.buttonArrowColor&&this.setButtonArrowColor(e.buttonArrowColor),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){if(!this.__attrHandler.checkAttribute(e,"data",{validator:()=>e instanceof Array}))return this;let t=null;if(null!=e)for(let n=0;n<e.length;n++){if(!a.isComboboxItem(e[n]))return this.__attrHandler.invalidAttribute("Data",e[n]),this;let i=e.findIndex(((t,a)=>a!==n&&t.value===e[n].value));i<0?(null==t&&(t=[]),t.push(e[n])):console.warn("Dublicate value in data of "+this.__id+".\n Entries with texts "+e[n].text+" and "+e[i].text+" have same value!\n The dublicate entry will be ignored!")}return this.__attrHandler.data=t,this.__processData(),this}__processData(){if($(this.__combobox).empty(),null!=this.__attrHandler.data)for(let e=0;e<this.__attrHandler.data.length;e++)null==this.__attrHandler.selectedData?.value&&this.setSelectedValue(this.__attrHandler.data[e].value),this.__addOption(this.__attrHandler.data[e]);this.__updateElements(this.__attrHandler.selectedData?.value)}getData(){return this.__attrHandler.data}getSelectedData(){return this.__attrHandler.selectedData}setSelectedValue(e){return this.__attrHandler.checkAttribute(e,"selectedValue")?(null==this.__attrHandler.selectedValueFeedback&&this.__setSelectedValueInternal(e),this):this}__setSelectedValueInternal(e){this.__attrHandler.selectedValue!=e&&(this.__attrHandler.selectedValue=e,this.__processSelectedValue(),this.eventHandler.raise(a.ComboboxEvents.onSelectedValueChanged))}__processSelectedValue(){if(null==this.__attrHandler.selectedValue)this.__attrHandler.selectedData={text:null,value:null};else if(null!=this.__attrHandler.data){let e=this.__attrHandler.data.find((e=>e.value===this.__attrHandler.selectedValue));this.__attrHandler.selectedData=null==e?{text:"invalid#",value:this.__attrHandler.selectedValue}:e}else this.__attrHandler.selectedData={text:"invalid#",value:this.__attrHandler.selectedValue};this.__updateElements(this.__attrHandler.selectedValue)}getSelectedValue(){return this.__attrHandler.selectedValue}setSelectedValueFeedback(e){return this.__attrHandler.checkAttribute(e,"selectedValueFeedback")?(this.__attrHandler.selectedValueFeedback=e,this.__processSelectedValueFeedback(),this.__valueFeedbackReady&&this.__valueFeedbackReady(),this.eventHandler.raise(a.ComboboxEvents.onSelectedValueFeedbackChanged),this):this}__processSelectedValueFeedback(){this.__setSelectedValueInternal(this.__attrHandler.selectedValueFeedback)}getSelectedValueFeedback(){return this.__attrHandler.selectedValueFeedback}setButtonColor(e){return this.__attrHandler.checkColorAttribute(e,"buttonColor")?(this.__attrHandler.buttonColor=e,this.__processButtonColor(),this):this}__processButtonColor(){null==this.__attrHandler.buttonColor?this.__element.css("--tchmi-ba-combobox-button-color",""):this.__element.css("--tchmi-ba-combobox-button-color",this.__attrHandler.buttonColor.toString())}getButtonColor(){return this.__attrHandler.buttonColor}setButtonArrowColor(e){return this.__attrHandler.checkColorAttribute(e,"buttonArrowColor")?(this.__attrHandler.buttonArrowColor=e,this.__processButtonArrowColor(),this):this}__processButtonArrowColor(){null==this.__attrHandler.buttonArrowColor?this.__element.css("--tchmi-ba-combobox-button-arrow-color",""):this.__element.css("--tchmi-ba-combobox-button-arrow-color",this.__attrHandler.buttonArrowColor.toString())}getButtonArrowColor(){return this.__attrHandler.buttonArrowColor}__processReadOnly(){super.__processReadOnly(),null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?(this.textHandler.getTextElement().detach(),this.__element.append(this.__combobox),this.__element.append(this.__button),this.__element.addClass("editable")):(this.__element.append(this.textHandler.getTextElement()),this.__combobox.detach(),this.__element.removeClass("editable"),this.__button.detach())}static toComboboxItemArray(e,t){if(null==e)return null;let a=[];if(e instanceof Map)for(let[t,n]of e){let e={text:n,value:t};a.push(e)}else if(e instanceof Array){if(e.length<=0)return null;null==t&&(t=0);for(let n=0;n<e.length;n++)if(e[n].length>0){let i={text:e[n],value:n+t};a.push(i)}}else if("object"==typeof e)for(let t in e)a.push({value:Number(t),text:e[t]});return a}processBaObject(){if(!this.baObjectHandler.baObject)return;if(this.baObjectHandler.baObject.DataType!==e.DataType.enum)return;let t=this.baObjectHandler.baObject.tryGetBaVariable(e.BA.BaParameterId.ePresentValue);null!=t&&(this.baObjectHandler.tryWatchBaVariable(t.ID,(e=>{this.setSelectedValueFeedback(e)})),this.baObjectHandler.watchValueRange(t.ID,(e=>{this.setData(a.toComboboxItemArray(e)),this.__processSelectedValueFeedback()}),!0)),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess())}}t.Combobox=a,function(t){let a;t.isComboboxItem=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("text","string"),n.set("value","any"),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.createDataFromEnum=function(e){let t=[];for(let a in e)if(isNaN(Number(a))){let n=Number(e[a]);if(isNaN(n))throw new Error("Value must be of type number!");t.push({text:a,value:n})}return t},function(e){e.onSelectedValueChanged="onSelectedValueChanged",e.onSelectedValueFeedbackChanged="onSelectedValueFeedbackChanged",e.onUserInteractionFinished="onUserInteractionFinished"}(a=t.ComboboxEvents||(t.ComboboxEvents={}))}(a=t.Combobox||(t.Combobox={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.TextControl{constructor(e,a){super(e,a),this.__curDataType=null,this.baObjectHandler=new t.BaObjectHandler(this),this.__element.addClass("value-field"),this.setDigits(1),this.setActiveText("Active"),this.setInactiveText("Inactive"),this.setValueHandler({autoWrite:!0}),this.textHandler.setHorizontalAlignment("Left")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__valueField?.destroy(),this.__checkbox?.destroy(),this.__inputField?.destroy(),this.__combobox?.destroy(),this.baObjectHandler.destroy(),super.destroy()}__onDataTypeChanged(){if(this.__attrHandler.dataType!==this.__curDataType){if(null!=this.__attrHandler.dataType){if(null!=this.__valueField){this.__valueField.getElement().detach();let e=this.__valueField.getId(),n=n=>{n.destroy();let i=t.Globals.CreatedBaseNodes.get(e);if(i instanceof a.Checkbox)this.__checkbox?.destroy(),delete this.__checkbox;else if(i instanceof a.InputBox)this.__inputField?.destroy(),delete this.__inputField;else if(i instanceof a.Combobox)this.__combobox?.destroy(),delete this.__combobox;else{if(!(i instanceof a.DateTimeField))throw new Error("Not handled control was detached!");this.__dateTimeField?.destroy(),delete this.__dateTimeField}};this.__valueField.eventHandler.register(a.BaseNode.BaseNodeEvents.onDetached,n),delete this.__valueField}let e=null;switch(this.__attrHandler.dataType){case t.DataType.boolean:null==this.__checkbox&&(this.__checkbox=new a.Checkbox(this.__id+"-checkbox",this),this.__destroyersToCallOnDestroy.push(this.__checkbox.eventHandler.register(a.Checkbox.CheckboxEvents.onStateChanged,(()=>{null!=this.__checkbox&&(this.__attrHandler.value=this.__checkbox.getState(),this.eventHandler.raise(n.ValueFieldEvents.onValueChanged))}))),this.__destroyersToCallOnDestroy.push(this.__checkbox.eventHandler.register(a.Checkbox.CheckboxEvents.onUseLabelChanged,(()=>this.__processCheckboxUseLabel()))),this.__destroyersToCallOnDestroy.push(this.__checkbox.eventHandler.register(a.Checkbox.CheckboxEvents.onUserInteractionFinished,((e,t)=>this.__onUserInteractionFinished(e,t))))),this.__valueField=this.__checkbox,this.__checkbox.setInactiveText(this.__attrHandler.inactiveText).setActiveText(this.__attrHandler.activeText).textHandler.setHorizontalAlignment(this.__attrHandler.textAttributes?.horizontalAlignment),this.__processCheckboxUseLabel(),null!=this.__attrHandler.valueFeedback?"boolean"==typeof this.__attrHandler.valueFeedback&&(e=this.__attrHandler.valueFeedback):"boolean"==typeof this.__attrHandler.value&&(e=this.__attrHandler.value),this.__updateValue(e);break;case t.DataType.number:case t.DataType.integer:case t.DataType.string:null==this.__inputField&&(this.__inputField=new a.InputBox(this.__id+"-input-field",this),this.__destroyersToCallOnDestroy.push(this.__inputField.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,(()=>{null!=this.__inputField&&(this.__attrHandler.value=this.__inputField.getValue(),this.eventHandler.raise(n.ValueFieldEvents.onValueChanged))}))),this.__destroyersToCallOnDestroy.push(this.__inputField.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,((e,t)=>this.__onUserInteractionFinished(e,t))))),this.__valueField=this.__inputField,this.__inputField.setDigits(this.__attrHandler.digits).setDataType(this.__attrHandler.dataType).textHandler.setHorizontalAlignment(this.__attrHandler.textAttributes?.horizontalAlignment),this.__attrHandler.dataType!==t.DataType.number&&this.__attrHandler.dataType!==t.DataType.integer||this.__inputField.setUnit(this.__attrHandler.unit),null!=this.__attrHandler.valueFeedback?"number"==typeof this.__attrHandler.valueFeedback&&(e=this.__attrHandler.valueFeedback):"number"==typeof this.__attrHandler.value&&(e=this.__attrHandler.value),this.__updateValue(e);break;case t.DataType.enum:null==this.__combobox&&(this.__combobox=new a.Combobox(this.__id+"-combobox-field",this),this.__destroyersToCallOnDestroy.push(this.__combobox.eventHandler.register(a.Combobox.ComboboxEvents.onSelectedValueChanged,(()=>{null!=this.__combobox&&(this.__attrHandler.value=this.__combobox.getSelectedValue(),this.eventHandler.raise(n.ValueFieldEvents.onValueChanged))}))),this.__destroyersToCallOnDestroy.push(this.__combobox.eventHandler.register(a.Combobox.ComboboxEvents.onUserInteractionFinished,((e,t)=>this.__onUserInteractionFinished(e,t))))),this.__valueField=this.__combobox,this.__combobox.setData(this.__attrHandler.stateTexts),null!=this.__attrHandler.valueFeedback?"number"==typeof this.__attrHandler.valueFeedback&&(e=this.__attrHandler.valueFeedback):"number"==typeof this.__attrHandler.value&&(e=this.__attrHandler.value),this.__updateValue(e);break;case t.DataType.dateTime:null==this.__dateTimeField&&(this.__dateTimeField=new a.DateTimeField(this.__id+"-date-time-field",this),this.__isAttached&&this.__destroyersToCallOnDestroy.push(this.__dateTimeField.eventHandler.register(a.DateTimeField.DateTimeFieldEvents.onDateChanged,(()=>{null!=this.__dateTimeField&&(this.__attrHandler.value=this.__dateTimeField.getDate(),this.eventHandler.raise(n.ValueFieldEvents.onValueChanged))}))),this.__destroyersToCallOnDestroy.push(this.__dateTimeField.eventHandler.register(a.DateTimeField.DateTimeFieldEvents.onUserInteractionFinished,((e,t)=>this.__onUserInteractionFinished(e,t))))),this.__valueField=this.__dateTimeField,null!=this.__attrHandler.valueFeedback?"number"===this.__attrHandler.valueFeedback&&(e=this.__attrHandler.valueFeedback):"number"==typeof this.__attrHandler.value&&(e=this.__attrHandler.value),this.__updateValue(e);break;case t.DataType.unknown:break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}this.__curDataType=this.__attrHandler.dataType,null!=this.__valueField&&(this.__valueField.setAttributes({valueHandler:this.__attrHandler.valueHandler}).setContentPadding(this.__attrHandler.contentPadding).setReadOnly(this.__attrHandler.readOnly),this.__valueField.textHandler.setHorizontalAlignment(this.__attrHandler.textAttributes?.horizontalAlignment),this.__valueField.layoutHandler.setWidth(100,"%").setHeight(100,"%"),this.__attrHandler.dataType===t.DataType.boolean&&null==this.__attrHandler.textAttributes?.horizontalAlignment?this.__valueField.textHandler.setHorizontalAlignment("Left"):this.__valueField.textHandler.setHorizontalAlignment(this.__attrHandler.textAttributes?.horizontalAlignment),this.__element.append(this.__valueField.getElement()))}else if(null!=this.__valueField){this.__valueField.getElement().detach();let e=this.__valueField.getId(),n=n=>{n.destroy();let i=t.Globals.CreatedBaseNodes.get(e);i instanceof a.Base&&i?.destroy()};this.__valueField.eventHandler.register(a.BaseNode.BaseNodeEvents.onDetached,n),delete this.__valueField}this.eventHandler.raise(n.ValueFieldEvents.onDataTypeChanged)}}__onUserInteractionFinished(e,t){this.eventHandler.raise(n.ValueFieldEvents.onUserInteractionFinished)}__updateValue(e){if(this.__attrHandler.dataType!=t.DataType.unknown)if(null==this.__attrHandler.valueFeedback)if(null==e)this.__checkbox?.setState(null),this.__inputField?.setValue(null),this.__combobox?.setSelectedValue(null),this.__dateTimeField?.setDate(null);else switch(this.__attrHandler.dataType){case t.DataType.boolean:void 0!==this.__checkbox&&"boolean"==typeof e&&this.__checkbox.setState(e);break;case t.DataType.number:case t.DataType.integer:case t.DataType.string:void 0===this.__inputField||"number"!=typeof e&&"string"!=typeof e||this.__inputField.setValue(e);break;case t.DataType.enum:void 0!==this.__combobox&&"number"==typeof e&&this.__combobox.setSelectedValue(e);break;case t.DataType.dateTime:void 0!==this.__dateTimeField&&e instanceof Date&&this.__dateTimeField.setDate(e);break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}else if(null==e||null==this.__attrHandler.dataType)this.__checkbox?.setStateFeedback(null),this.__inputField?.setValueFeedback(null),this.__combobox?.setSelectedValueFeedback(null);else switch(this.__attrHandler.dataType){case t.DataType.boolean:void 0!==this.__checkbox&&"boolean"==typeof e&&this.__checkbox.setStateFeedback(e);break;case t.DataType.string:case t.DataType.integer:case t.DataType.number:void 0===this.__inputField||"number"!=typeof e&&"string"!=typeof e||this.__inputField.setValueFeedback(e);break;case t.DataType.enum:void 0!==this.__combobox&&"number"==typeof e&&this.__combobox.setSelectedValueFeedback(e);break;case t.DataType.dateTime:void 0!==this.__dateTimeField&&e instanceof Date&&this.__dateTimeField.setDate(e);break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}else console.warn(`DataType of ValueField ${this.__id} is unkown! Please set DataType before setting value of the ValueField!`)}__processCheckboxUseLabel(){void 0===this.__checkbox||this.__checkbox.getUseLabel()?this.__element.css({display:"","justify-content":""}):this.__element.css({display:"flex","justify-content":"center"})}processBaObject(){if(null!=this.baObjectHandler.baObject)switch(this.baObjectHandler.baObject.DataType){case t.DataType.number:this.setDataType(t.DataType.number),this.__inputField?.baObjectHandler.setBaObject(this.baObjectHandler.baObject);break;case t.DataType.boolean:this.setDataType(t.DataType.boolean),this.__checkbox?.baObjectHandler.setBaObject(this.baObjectHandler.baObject);break;case t.DataType.enum:this.setDataType(t.DataType.enum),this.__combobox?.baObjectHandler.setBaObject(this.baObjectHandler.baObject);break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}}getValueField(){return this.__valueField}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&this.setValueHandler(e.valueHandler),void 0!==e.value&&this.setValue(e.value),void 0!==e.valueFeedback&&this.setValueFeedback(e.valueFeedback),void 0!==e.dataType&&this.setDataType(e.dataType),void 0!==e.activeText&&this.setActiveText(e.activeText),void 0!==e.inactiveText&&this.setInactiveText(e.inactiveText),void 0!==e.unit&&this.setUnit(e.unit),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.stateTexts&&this.setStateTexts(e.stateTexts),this}getAttributes(){return this.__attrHandler.getRef()}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:["number","boolean","string","date"]})?(null==this.__attrHandler.valueFeedback&&(this.__attrHandler.value=e,this.__processValue()),this.eventHandler.raise(n.ValueFieldEvents.onValueChanged),this):this}__processValue(){this.__updateValue(this.__attrHandler.value)}getValue(){return this.__attrHandler.value}setValueFeedback(e){return this.__attrHandler.checkAttribute(e,"valueFeedback",{validator:["number","boolean","string","date"]})?(this.__attrHandler.valueFeedback=e,this.__processValueFeedback(),this):this}__processValueFeedback(){this.__attrHandler.value=this.__attrHandler.valueFeedback,this.__updateValue(this.__attrHandler.valueFeedback)}getValueFeedback(){return this.__attrHandler.valueFeedback}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(null==e&&(e=t.DataType.unknown),this.__attrHandler.dataType=e,this.__processDataType(),this):this}__processDataType(){this.__onDataTypeChanged()}getDataType(){return this.__attrHandler.dataType}setActiveText(e){return this.__attrHandler.checkAttribute(e,"activeText",{validator:"string"})?(this.__attrHandler.activeText=e,this.__processActiveText(),this):this}__processActiveText(){this.__checkbox?.setActiveText(this.__attrHandler.activeText)}getActiveText(){return this.__attrHandler.activeText}setInactiveText(e){return this.__attrHandler.checkAttribute(e,"inactiveText",{validator:"string"})?(this.__attrHandler.inactiveText=e,this.__processInactiveText(),this):this}__processInactiveText(){this.__checkbox?.setInactiveText(this.__attrHandler.inactiveText)}getInactiveText(){return this.__attrHandler.inactiveText}setUnit(a){if(!this.__attrHandler.checkAttribute(a,"unit",{validator:["string","number"]}))return this;if("number"==typeof a)if(t.Server.BaSite.Units.size>0)a=t.Helper.convertUnitToString(a),this.__attrHandler.unit=a,this.__processUnit();else{this.__attrHandler.unit=t.BA.Unit[a],this.__processUnit();let n=e.EventProvider.register("CustomBA.onUnitsLoaded",(()=>{this.__attrHandler.unit=t.Helper.convertUnitToString(a),this.__processUnit(),n()}))}else this.__attrHandler.unit=a,this.__processUnit();return this.__processUnit(),this}__processUnit(){this.__inputField?.setUnit(this.__attrHandler.unit)}getUnit(){return this.__attrHandler.unit}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,this.__processMinValue(),this):this}__processMinValue(){this.__inputField?.setMinValue(this.__attrHandler.minValue)}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,this.__processMaxValue(),this):this}__processMaxValue(){this.__inputField?.setMaxValue(this.__attrHandler.maxValue)}getMaxValue(){return this.__attrHandler.maxValue}setStateTexts(e){return this.__attrHandler.checkAttribute(e,"stateTexts",{validator:"array"})?(this.__attrHandler.stateTexts=e,this.__processStateTexts(),this):this}__processStateTexts(){this.__combobox?.setData(this.__attrHandler.stateTexts)}getStateTexts(){return this.__attrHandler.stateTexts}setDigits(e){return this.__attrHandler.checkAttribute(e,"digits",{validator:"number"})?(this.__attrHandler.digits=e,this.__inputField?.setDigits(this.__attrHandler.digits),this):this}getDigits(){return this.__attrHandler.digits}setValueHandler(e){return this.__attrHandler.checkAttribute(e,"valueHandler")?(this.__attrHandler.valueHandler=e,this.__checkbox?.setAttributes({valueHandler:e}),this.__inputField?.setAttributes({valueHandler:e}),this.__combobox?.setAttributes({valueHandler:e}),this):this}getAutoWrite(){return this.__attrHandler.valueHandler}__processReadOnly(){super.__processReadOnly(),this.__valueField?.setReadOnly(this.__attrHandler.readOnly)}__processContentPadding(){super.__processContentPadding(),this.__valueField?.setContentPadding(this.__attrHandler.contentPadding)}__processTextHorizontalAlignment(){this.__attrHandler.dataType===t.DataType.boolean&&null==this.__attrHandler.textAttributes?.horizontalAlignment?this.__valueField?.textHandler.setHorizontalAlignment("Left"):this.__valueField?.textHandler.setHorizontalAlignment(this.__attrHandler.textAttributes?.horizontalAlignment)}__processTextVerticalAlignment(){this.__valueField?.textHandler.setVerticalAlignment(this.__attrHandler.textAttributes?.verticalAlignment)}}a.ValueField=n,function(e){let t;!function(e){e.onValueChanged="onValueFieldValueChanged",e.onUserInteractionFinished="onValueFieldUserIneractionFinished",e.onDataTypeChanged="onValueFieldDataTypeChanged"}(t=e.ValueFieldEvents||(e.ValueFieldEvents={}))}(n=a.ValueField||(a.ValueField={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,a){super(e,a),this.resizeHandler=new t.ResizeHandler(this),this.controlContainer=new t.ControlContainer(this.__id+"-control-container",this),this.__header=$("<div>").addClass("header"),this.__headline=new t.Textblock(this.__id+"-headline",this),this.__contentContainer=$("<div>").addClass("content-container"),this.__headerIconLegendHandler=new t.LegendIconHandler,this.__headerMenuButtonPressed=()=>{this.__contextMenu?.toggleOpen(this.__element,this.__attrHandler.menuAppearance?.sideways),null!=this.__destroyHeaderMenuButtonPressed&&this.__destroyHeaderMenuButtonPressed()},this.__contextMenuClosedHandler=()=>{this.__menuButton?.setToggleState(this.__contextMenu?.getIsOpen()),this.__contextMenu?.getIsOpen()||(this.__destroyHeaderMenuButtonPressed=this.__menuButton?.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__headerMenuButtonPressed))},this.__controlContainerCollectionChangedHandler=(e,t)=>{this.__onControlContainerCollectionChanged(e,t)},this.__element.addClass("content-window"),this.__header.append(this.__headline.getElement()),this.__headline.textHandler.setOverflow(t.TextHandler.Overflow.marquee),this.__headerAppended=!1,this.setShowHeader(!0),this.__element.append(this.__contentContainer),this.controlContainer.onControlsCollectionChanged(this.__controlContainerCollectionChangedHandler),this.controlContainer.getElement().addClass("controls-container")}__attach(){this.__isAttached||(this.__destroyHeaderMenuButtonPressed=this.__menuButton?.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__headerMenuButtonPressed),null!=this.__contextMenu&&this.__destroyersToCallOnDetach.push(this.__contextMenu?.eventHandler.register(t.ContextMenu.ContextMenuEvents.onMenuClose,this.__contextMenuClosedHandler)),null!=this.__attrHandler.headerIcon&&this.__headerIconLegendHandler.show(),super.__attach())}__detach(){this.__isAttached&&(null!=this.__destroyHeaderMenuButtonPressed&&this.__destroyHeaderMenuButtonPressed(),this.__headerIconLegendHandler.hide(),super.__detach())}destroy(){this.__headline.destroy(),null!=this.__headerIcon&&(this.__headerIcon.destroy(),delete this.__headerIcon),this.__contextMenu?.destroy(),this.__menuButton?.destroy(),null!=this.__destroyHeaderMenuButtonPressed&&(this.__destroyHeaderMenuButtonPressed(),delete this.__destroyHeaderMenuButtonPressed),this.controlContainer.destroy(),this.resizeHandler.destroy(),super.destroy()}__onControlContainerCollectionChanged(e,t){this.controlContainer.getControls().length>0?this.__header.append(this.controlContainer.getElement()):this.controlContainer.getElement().detach(),this.__updateHeaderElementsOrder()}onResized(){let e=this.__header.width(),t=this.controlContainer.getElement().width(),a=Number(this.controlContainer.getElement().css("margin-right").replace("px","")),n=this.__menuButton?.getElement().width(),i=Number(this.__menuButton?.getElement().css("margin-right").replace("px",""));e=null!=e?e:0,a=isNaN(a)?0:a,t=null!=t?t+a:0,i=isNaN(i)?0:i,n=null!=n?n+i:0;let s=e-t-n;this.__headline.layoutHandler.setMaxWidth(s)}__updateHeaderElementsOrder(){this.controlContainer.getElement().detach(),this.__menuButton?.getElement().detach(),this.controlContainer.getControls().length>0&&this.__header.append(this.controlContainer.getElement()),this.__contextMenu&&this.__header.append(this.__menuButton.getElement())}getHeader(){return this.__header}getContentContainer(){return this.__contentContainer}addMenu(a){return null!=this.__contextMenu?(console.warn(`There was already a menu created for ${this.__id}!`),this.__contextMenu):(this.__menuButton=new t.ToggleButton(this.__id+"-header-menu-button",this),this.__menuButton.iconHandler.setIcon(e.Icons.Standard.MenuBurger.path,!0).setIconHeight(60,"%").setIconWidth(60,"%"),this.__menuButton.getElement().addClass("controls-container menu-button"),this.__header.append(this.__menuButton.getElement()),this.__isAttached&&null==this.__destroyHeaderMenuButtonPressed&&(this.__destroyHeaderMenuButtonPressed=this.__menuButton.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__headerMenuButtonPressed)),this.__contextMenu=new t.ContextMenu(this.__id+"-context-menu",this),a&&this.__contextMenu.addRowEntry(a),this.__isAttached&&this.__destroyersToCallOnDestroy.push(this.__contextMenu.eventHandler.register(t.ContextMenu.ContextMenuEvents.onMenuClose,this.__contextMenuClosedHandler)),this.__processMenuAppearance(),this.__updateHeaderElementsOrder(),this.__contextMenu)}getHeadline(){return this.__headline}setAttributes(e){return super.setAttributes(e),void 0!==e.content&&this.setContent(e.content),void 0!==e.headerIcon&&this.setHeaderIcon(e.headerIcon),null!=e.headline&&this.__headline.setAttributes(e.headline),void 0!==e.headerColor&&this.setHeaderColor(e.headerColor),void 0!==e.headerHeight&&this.setHeaderHeight(e.headerHeight,e.headerHeightUnit),void 0!==e.showHeader&&this.setShowHeader(e.showHeader),void 0!==e.menuAppearance&&this.setMenuAppearance(e.menuAppearance),e.menu&&this.addMenu(e.menu),void 0!==e.controls&&(e.controls instanceof Array?e.controls.length>0?this.controlContainer.addControls(e.controls):this.controlContainer.removeAllControls():this.controlContainer.addControl(e.controls)),this}getAttributes(){return this.__attrHandler.getRef()}setContent(e){return this.__attrHandler.checkAttribute(e,"content")?(this.__attrHandler.content=e,this.__processContent(),this):this}__processContent(){this.__contentContainer.empty(),null!=this.__attrHandler.content&&this.__contentContainer.append(this.__attrHandler.content)}getContent(){return this.__attrHandler.content}setHeaderIcon(t){return this.__attrHandler.checkAttribute(t,"headerIcon",{validator:e.Icons.isIIconAttributes})?(this.__attrHandler.headerIcon=t,null!=this.__attrHandler.headerIcon&&null==this.__attrHandler.headerIcon.hideBorder&&(this.__attrHandler.headerIcon.hideBorder=a.HideHeaderIconBorderDefault),this.__processHeaderIcon(),this):this}__processHeaderIcon(){null==this.__attrHandler.headerIcon?null!=this.__headerIcon&&(this.__headerIcon.destroy(),delete this.__headerIcon,this.__headerIconLegendHandler.icon=e.Icons.convertIIconDataToIIconAttributes(e.Icons.Standard.NotFound),this.__headerIconLegendHandler.hide()):(null==this.__headerIcon&&(this.__headerIcon=new t.Icon(this.__id+"-header-icon",this).setAttributes({cssClass:a.__headerIconClassName,iconWidth:70,iconWidthUnit:"%",iconHeight:70,iconHeightUnit:"%"}),this.__header.append(this.__headerIcon.getElement())),1==this.__attrHandler.headerIcon.hideBorder?this.__headerIcon.getElement().removeClass("apply-border"):this.__headerIcon.getElement().addClass("apply-border"),this.__headerIcon.iconHandler.setIcon(this.__attrHandler.headerIcon.iconPath,!0).setIconColor(void 0===this.__attrHandler.headerIcon.iconColor?null:this.__attrHandler.headerIcon.iconColor),this.__headerIconLegendHandler.icon=this.__attrHandler.headerIcon,this.__isAttached&&this.__headerIconLegendHandler.show())}getHeaderIcon(){return this.__attrHandler.headerIcon}setHeadlineText(e){return void 0===e?this:null!=e&&"string"!=typeof e?(this.__attrHandler.invalidAttribute("Headline",e),this):e===this.__attrHandler.headline?.textAttributes?.text?(this.__attrHandler.equalAttribute("Headline"),this):(this.__attrHandler.headline||(this.__attrHandler.headline={}),this.__attrHandler.headline.textAttributes||(this.__attrHandler.headline.textAttributes={}),this.__attrHandler.headline.textAttributes.text=e,this.__processHeadlineText(),this)}__processHeadlineText(){this.__headline?.textHandler.setText(this.__attrHandler.headline?.textAttributes?.text)}getHeadlineText(){return this.__attrHandler.headline?.textAttributes?.text}setHeadlineAttributes(e){return this.__headline.setAttributes(e),this}getHeadlineAttributes(){return this.__headline.getAttributes()}setHeaderColor(e){return this.__attrHandler.checkColorAttribute(e,"headerColor")?(this.__attrHandler.headerColor=e,this.__processHeaderColor(),this):this}__processHeaderColor(){null==this.__attrHandler.headerColor?this.__header.css("background-color",""):this.__header.css("background-color",this.__attrHandler.headerColor.toString())}getHeaderColor(){return this.__attrHandler.headerColor}setHeaderHeight(e,a){return t.LayoutHandler.dimensionSetter(this.__attrHandler,"headerHeight",e,a)?(this.__processHeaderHeight(),this):this}__processHeaderHeight(){null==this.__attrHandler.headerHeight?this.__header.css("--tchmi-ba-content-window-header-height",""):this.__header.css("--tchmi-ba-content-window-header-height",this.__attrHandler.headerHeight+(this.__attrHandler.headerHeightUnit?this.__attrHandler.headerHeightUnit:"px"))}getHeaderHeight(){return this.__attrHandler.headerHeight}getHeaderHeightUnit(){return this.__attrHandler.headerHeightUnit}setShowHeader(e){return this.__attrHandler.checkAttribute(e,"showHeader",{validator:"boolean"})?(this.__attrHandler.showHeader=e,this.__processShowHeader(),this):this}__processShowHeader(){null!==this.__attrHandler.showHeader&&(!0===this.__attrHandler.showHeader?!1===this.__headerAppended&&(this.__element.append(this.__header),this.__contentContainer.detach(),this.__element.append(this.__contentContainer),this.__headerAppended=!0):!1===this.__attrHandler.showHeader&&!0===this.__headerAppended&&(this.__header.detach(),this.__headerAppended=!1))}getShowHeader(){return this.__attrHandler.showHeader}setMenuAppearance(e){return this.__attrHandler.checkAttribute(e,"menuAppearance",{validator:a.isMenuAppearance})?(this.__attrHandler.menuAppearance=e,this.__processMenuAppearance(),this):this}__processMenuAppearance(){null==this.__attrHandler.menuAppearance?(this.__contextMenu?.getElement().removeClass("overlay"),this.__contextMenu?.getElement().removeClass("sideways")):(null!=this.__attrHandler.menuAppearance.overlay&&this.__attrHandler.menuAppearance.overlay&&this.__contextMenu?.getElement().addClass("overlay"),null!=this.__attrHandler.menuAppearance.sideways&&this.__attrHandler.menuAppearance.sideways&&(this.__contextMenu?.getElement().addClass("sideways"),this.__contextMenu?.getElement().addClass("overlay")))}getMenuAppearance(){return this.__attrHandler.menuAppearance}}a.__headerIconClassName="header-icon",t.ContentWindow=a,function(t){t.isMenuAppearance=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a},t.HideHeaderIconBorderDefault=!1}(a=t.ContentWindow||(t.ContentWindow={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,t){super(e,t),this.__rowEntryPressedHandler=e=>this.__onRowEntryPressed(e),this.__bodyPressedHandler=e=>{null==this.__element.find(e.target)[0]&&this.__close()},this.__element=$("<ul>").addClass(this.__element[0].classList.toString()),this.__element.addClass("context-menu"),this.__element.attr("id",this.__id),this.setRowEntryHeight(30),this.setAutoClose(!0)}__attach(){this.__isAttached||(this.__element.on("pointerdown","li",this.__rowEntryPressedHandler),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown","li",this.__rowEntryPressedHandler),$("body").off("pointerdown",this.__bodyPressedHandler),super.__detach())}destroy(){this.__rowEntries?.forEach((e=>e.rowEntry.destroy())),super.destroy()}__onRowEntryPressed(t){if(null!=t.button&&t.button!==e.MouseButtons.left)return;t.stopPropagation();let a=()=>{if(!this.__rowEntries)return;let e;for(let a=0;a<this.__rowEntries.length;a++)if(this.__rowEntries[a].rowEntry.getId()===t.currentTarget.id){e=this.__rowEntries[a];break}e&&e.options&&e.options.onPressed&&e.options.onPressed(e.options.callbackParams),this.__element.off("pointerup","li",a)};this.__element.on("pointerup","li",a)}__open(e,t){if(this.__isOpen)return;if(!this.__rowEntries)return;e?.append(this.__element);let n=()=>{this.__attrHandler.autoClose&&$("body").on("pointerdown",this.__bodyPressedHandler),this.eventHandler.raise(a.ContextMenuEvents.onMenuOpen),this.eventHandler.raise(a.ContextMenuEvents.onMenuToggle)};null!=t&&t?(this.__element.animate({width:"30%"},200,n),this.__openedSideways=!0):null!=this.__attrHandler.rowEntryHeight&&this.__element.animate({"min-height":this.__attrHandler.rowEntryHeight*this.__rowEntries.length+"px"},200,n),this.__isOpen=!0}__close(){if(!this.__isOpen)return;this.__attrHandler.autoClose&&$("body").off("pointerdown",this.__bodyPressedHandler);let e=()=>{this.__element.detach(),this.eventHandler.raise(a.ContextMenuEvents.onMenuClose),this.eventHandler.raise(a.ContextMenuEvents.onMenuToggle)};this.__openedSideways?this.__element.animate({width:0},200,e):this.__element.animate({"min-height":0},200,e),this.__openedSideways=!1,this.__isOpen=!1}__addRowEntry(e){this.__rowEntries||(this.__rowEntries=[]);let t=this.__id+"-row-entry",n=1;for(;this.__rowEntries.find((e=>e.rowEntry.getId()===t));)t=this.__id+"-row-entry-"+n,n++;let i=new a.RowEntry(t,this);return e&&(e.text&&i.textHandler.setText(e.text),e.controls&&(e.controls instanceof Array?i.controlContainer.addControls(e.controls):i.controlContainer.addControl(e.controls)),void 0!==e.controlsHorizontalAlignment&&i.controlContainer.setControlsHorizonzalAlignment(e.controlsHorizontalAlignment)),this.__rowEntries.push({rowEntry:i,options:e}),this.__element.append(i.getElement()),this.__isOpen&&null!=this.__attrHandler.rowEntryHeight&&this.__element.animate({"min-height":this.__attrHandler.rowEntryHeight*this.__rowEntries.length+"px"},200),e.cbOnCreated&&e.cbOnCreated(i),i}toggleOpen(e,t){this.__isOpen?this.__close():this.__open(e,t)}open(e,t){this.__open(e,t)}close(){this.__close()}addRowEntry(e){let t;if(e instanceof Array){t=[];for(let a=0;a<e.length;a++)t.push(this.__addRowEntry(e[a]))}else t=this.__addRowEntry(e);return t}removeRowEntry(e){if(!this.__rowEntries)return!1;let t;if(t="string"==typeof e?this.getRowEntry(e):e,!t)return!1;for(let e=0;e<this.__rowEntries.length;e++)if(this.__rowEntries[e].rowEntry.getId()===t.getId())return this.__rowEntries[e].rowEntry.getElement().detach(),this.__rowEntries[e].rowEntry.destroy(),this.__rowEntries.splice(e,1),!0;return!1}getRowEntriesCount(){return this.__rowEntries?this.__rowEntries.length:0}getRowEntry(e){let t;if(this.__rowEntries)for(let a=0;a<this.__rowEntries.length;a++)if(this.__rowEntries[a].options?.name===e){t=this.__rowEntries[a].rowEntry;break}return t}getRowEntries(){let e=[];if(this.__rowEntries)for(let t=0;t<this.__rowEntries.length;t++)e.push(this.__rowEntries[t].rowEntry);return e}getIsOpen(){return null!=this.__isOpen&&this.__isOpen}setAttributes(e){return super.setAttributes(e),void 0!==e.autoClose&&this.setAutoClose(e.autoClose),void 0!==e.rowEntryHeight&&this.setRowEntryHeight(e.rowEntryHeight),this}getAttributes(){return this.__attrHandler.getRef()}setRowEntryHeight(e){return this.__attrHandler.checkAttribute(e,"rowEntryHeight",{validator:"number"})?(null==e&&(e=30),this.__attrHandler.rowEntryHeight=e,this.__processRowEntryHeight(),this):this}__processRowEntryHeight(){null==this.__attrHandler.rowEntryHeight?this.__element.css("--row-entry-height",""):this.__element.css("--row-entry-height",this.__attrHandler.rowEntryHeight+"px")}getRowEntryHeight(){return this.__attrHandler.rowEntryHeight}setAutoClose(e){return this.__attrHandler.checkAttribute(e,"autoClose",{validator:"boolean"})?(null==e&&(e=!0),this.__attrHandler.autoClose=e,this):this}getAutoClose(){return this.__attrHandler.autoClose}}t.ContextMenu=a,function(a){let n;!function(e){e.onMenuOpen="onMenuOpen",e.onMenuClose="onMenuClose",e.onMenuToggle="onMenuToggle"}(n=a.ContextMenuEvents||(a.ContextMenuEvents={})),a.createContextMenuAndButton=function(i){i.parent||(i.parent=null);let s=new t.ToggleButton(i.id+"-context-menu-button",i.parent);s.iconHandler.setIcon(e.Icons.Standard.MenuBurger.path,!0).setIconHeight(60,"%").setIconWidth(60,"%");let r,o=new a(i.id+"-context-menu",i.parent);i.rowEntryOptions&&o.addRowEntry(i.rowEntryOptions);let l,d=()=>{if(!o.getIsOpen()){if(i.root)o.open(i.root);else{let e=s.getElement().offset(),t=s.getElement().outerHeight(),a=$(window).outerWidth(),n=o.getElement().outerWidth(),i=e.left;a&&n&&i>a-n&&(i=a-n),o.layoutHandler.setAttributes({left:i,top:e.top+t}),o.open($("body"))}null!=r&&r()}},h=e=>{e.destroy(),null!=r&&r(),s.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,_)},_=e=>{e.destroy(),r=s.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,d),s.eventHandler.register(t.BaseNode.BaseNodeEvents.onDetached,h)};s.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,_);let c=e=>{e.destroy(),null!=l&&l(),o.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,u)},u=a=>{a.destroy(),l=o.eventHandler.register(n.onMenuToggle,(()=>{s.setToggleState(o.getIsOpen()),o.getIsOpen()||(i.root||e.System.OverlayContainer.remove(o.getElement()),r=s.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,d))})),o.eventHandler.register(t.BaseNode.BaseNodeEvents.onDetached,c)};return o.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,u),i.parent&&e.isIEventHandler(i.parent)&&i.parent.eventHandler.register(t.BaseNode.BaseNodeEvents.onDestroyed,((e,t)=>{e.destroy(),s.destroy(),o.destroy()})),{button:s,menu:o}},a.openContextMenu=function(e){let t=new a(Date.now+"-context-menu");return e.rowEntryOptions&&t.addRowEntry(e.rowEntryOptions),t.layoutHandler.setLeft(e.position.left),t.layoutHandler.setTop(e.position.top),t.open($("body")),t};class i extends t.TextControl{constructor(e,a){super(e,a),this.controlContainer=new t.ControlContainer(this.__id+"-control-container",this),this.__controlCreatorCollectionChangedHandler=(e,t)=>{this.controlContainer.getControls().length>0?this.__element.append(this.controlContainer.getElement()):this.controlContainer.getElement().detach()},this.__element=$("<li>").addClass(this.__element[0].classList.toString()),this.__element.attr("id",this.__id),this.controlContainer.onControlsCollectionChanged(this.__controlCreatorCollectionChangedHandler)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.controlContainer.destroy(),super.destroy()}onTextChanged(e){super.onTextChanged(e),null==e?this.textHandler.getTextElement().detach():this.__element.append(this.textHandler.getTextElement())}}a.RowEntry=i}(a=t.ContextMenu||(t.ContextMenu={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.TextControl{constructor(e,i){super(e,i),this.valueHandler=new t.System.ValueHandler(this),this.resizeHandler=new a.ResizeHandler(this),this.__localeChangedHandler=()=>{this.__processMode()},this.__element.addClass("date-time-field"),this.__element.append(this.textHandler.getTextElement()),this.setReadOnly(!0),this.setMode(n.Mode.dateTime)}__attach(){this.__isAttached||(e.EventProvider.register(t.TcHmiEvents.onLocaleChanged,this.__localeChangedHandler),this.__processMode(),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__btn?.destroy(),delete this.__btn,this.valueHandler.destroy(),this.resizeHandler.destroy(),null!=this.__destroyOnButtonPressed&&(this.__destroyOnButtonPressed(),delete this.__destroyOnButtonPressed),super.destroy()}onResized(){this.__element.css("--used-height",this.__element.innerHeight()+"px")}onValueChanged(e){this.setDate(e)}__onButtonPressed(){let e=e=>{this.setDate(e),this.eventHandler.raise(n.DateTimeFieldEvents.onUserInteractionFinished)};switch(this.__attrHandler.mode){case n.Mode.date:a.DateTimePicker.openDatePickerDialog(null!=this.__attrHandler.date?this.__attrHandler.date:new Date,t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.SelectNewDate),e);break;case n.Mode.time:a.TimePicker.openTimePickerDialog(null!=this.__attrHandler.date?this.__attrHandler.date:new Date,t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.SelectNewTime),e);break;default:a.DateTimePicker.openDateTimePickerDialog(null!=this.__attrHandler.date?this.__attrHandler.date:new Date,t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.SelectNewDate),e)}}openPicker(){this.__onButtonPressed()}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.date&&this.setDate(e.date),void 0!==e.mode&&this.setMode(e.mode),this}getAttributes(){return this.__attrHandler.getRef()}setDate(e){return this.__attrHandler.checkAttribute(e,"date",{validator:"date"})?(this.__attrHandler.date=e,this.__processDate(),null!=this.__attrHandler.date&&this.valueHandler.processChangedValue(this.__attrHandler.date),this.eventHandler.raise(n.DateTimeFieldEvents.onDateChanged),this):this}__processDate(){null==this.__attrHandler.date?this.setDate(new Date):this.__processMode()}getDate(){return this.__attrHandler.date}setMode(e){return this.__attrHandler.checkAttribute(e,"mode",{validator:"number"})?(null==e&&(e=n.Mode.dateTime),this.__attrHandler.mode=e,this.__processMode(),this):this}__processMode(){if(null!=this.__destroyLocaleWatch&&this.__destroyLocaleWatch(),null!=this.__attrHandler.date)switch(this.__attrHandler.mode){case n.Mode.dateTime:this.__destroyLocaleWatch=t.Locale.Localization.watchText(t.Locale.WeekDaysShortLangKey[t.Helper.Date.getWeekday(this.__attrHandler.date)-1],(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&this.textHandler.setText(e.text+" "+this.__attrHandler.date.toLocaleString())}));break;case n.Mode.date:this.__destroyLocaleWatch=t.Locale.Localization.watchText(t.Locale.WeekDaysShortLangKey[t.Helper.Date.getWeekday(this.__attrHandler.date)-1],(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&this.textHandler.setText(e.text+" "+this.__attrHandler.date.toLocaleDateString())}));break;case n.Mode.time:this.textHandler.setText(this.__attrHandler.date.toLocaleTimeString())}}getMode(){return this.__attrHandler.mode}__processReadOnly(){super.__processReadOnly(),null==this.__attrHandler.readOnly||!0===this.__attrHandler.readOnly?(this.__btn?.getElement().detach(),this.__btn?.destroy(),null!=this.__destroyOnButtonPressed&&(this.__destroyOnButtonPressed(),delete this.__destroyOnButtonPressed),delete this.__btn):null==this.__btn&&(this.__btn=new a.Button(this.__id+".button",this),this.__btn.iconHandler.setIcon(t.Icons.Standard.DateTime.path,!0),this.__element.append(this.__btn.getElement()),this.__destroyOnButtonPressed=this.__btn.eventHandler.register(a.Button.ButtonEvents.onPressed,(()=>this.__onButtonPressed())))}}a.DateTimeField=n,function(e){let t,a;!function(e){e.onDateChanged="onDateChanged",e.onUserInteractionFinished="onUserInteractionFinished"}(t=e.DateTimeFieldEvents||(e.DateTimeFieldEvents={})),function(e){e[e.date=0]="date",e[e.time=1]="time",e[e.dateTime=2]="dateTime"}(a=e.Mode||(e.Mode={}))}(n=a.DateTimeField||(a.DateTimeField={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,a){super(e,a),this.__timePicker=new n(this.__id+"-time-picker",this),this.__datePicker=new t.Calendar(this.__id+"-date-picker",this),this.__resultField=new t.DateTimeField(this.__id+"-result-field",this),this.__element.addClass("date-time-picker"),this.__resultField.setReadOnly(!0),this.__datePicker.getElement().addClass("calendar");let i=$("<div>").addClass("right-column");i.append(this.__timePicker.getElement(),this.__resultField.getElement()),this.__element.append(this.__datePicker.getElement(),i)}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(this.__timePicker.eventHandler.register(n.TimePickerEvents.onTimeChanged,(()=>this.__onTimeChanged()))),this.__destroyersToCallOnDetach.push(this.__datePicker.eventHandler.register(t.Calendar.CalendarEvent.onSelectionChanged,((e,t,a)=>this.__onDateChanged(a)))),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__onTimeChanged(){if(null==this.__attrHandler.date)return;let e=new Date(this.__attrHandler.date),t=this.__timePicker.getTime();null!=t&&(e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds())),t!=this.__attrHandler.date&&(this.setDate(e),this.eventHandler.raise(a.DateTimePickerEvents.onDateTimeChanged))}__onDateChanged(e){if(null==this.__attrHandler.date)return;let n,i=new Date(this.__attrHandler.date);null!=e&&e.Type===t.Calendar.CalendarSelectionType.Date&&(n=e.Data,i.setDate(n.getDate()),i.setMonth(n.getMonth()),i.setFullYear(n.getFullYear())),this.setDate(i),this.eventHandler.raise(a.DateTimePickerEvents.onDateTimeChanged)}static openDateTimePickerDialog(e,n,i,s){let r=new a((new Date).getTime()+"-date-time-picker",null);r.setDate(e);return t.DialogWindow.openDialogWindow({appearance:{content:r.getElement(),headline:{textAttributes:{text:n}},buttons:t.DialogWindow.Buttons.OkCancel,modal:!0,layout:{maxWidth:a.DefaultDateTimePickerDialogSize.width,maxHeight:a.DefaultDateTimePickerDialogSize.height}},callbacks:{cbConfirmed:()=>{null!=i&&i(r.getDate())},cbClosed:()=>{null!=s&&s(e),r.destroy()}}})}static openDatePickerDialog(e,n,i,s){let r=new t.Calendar((new Date).getTime()+"-date-picker",null);r.getElement().css({position:"relative"}),r.layoutHandler.setHeight(100,"%").setWidth(100,"%"),r.setDisplayMode(t.Calendar.CalendarDisplayMode.DatePicker),r.setDate(e);return t.DialogWindow.openDialogWindow({appearance:{content:r.getElement(),headline:{textAttributes:{text:n}},buttons:t.DialogWindow.Buttons.OkCancel,modal:!0,layout:{maxWidth:a.DefaultDatePickerDialogSize.width,maxHeight:a.DefaultDatePickerDialogSize.height}},callbacks:{cbConfirmed:()=>{null!=i&&i(r.getSelectedDate())},cbClosed:()=>{null!=s&&s(e),r.destroy()}}})}setAttributes(e){return super.setAttributes(e),void 0!==e.date&&this.setDate(e.date),this}getAttributes(){return this.__attrHandler.getRef()}setDate(e){return this.__attrHandler.checkAttribute(e,"date",{validator:"date"})?(this.__attrHandler.date=e,this.__processDate(),this):this}__processDate(){this.__timePicker.setTime(this.__attrHandler.date),null!=this.__attrHandler.date&&this.__datePicker.setDate(this.__attrHandler.date),this.__resultField.setDate(this.__attrHandler.date)}getDate(){return this.__attrHandler.date}}t.DateTimePicker=a,function(e){let t;!function(e){e.onDateTimeChanged="onDateTimeChanged"}(t=e.DateTimePickerEvents||(e.DateTimePickerEvents={})),e.DefaultDateTimePickerDialogSize={width:650,height:450},e.DefaultDatePickerDialogSize={width:300,height:300}}(a=t.DateTimePicker||(t.DateTimePicker={}));class n extends t.Base{constructor(e,t){super(e,t),this.__hourSelector=new i(this.__id+"-hour-selector",this),this.__minuteSelector=new i(this.__id+"-minute-selector",this),this.__secondSelector=new i(this.__id+"-second-selector",this),this.__selectorChangedHandler=(e,t)=>this.__onSelectorChanged(t),this.__element.addClass("time-picker"),this.__hourSelector.setMinValue(0).setMaxValue(23).setReadOnly(!1),this.__minuteSelector.setMinValue(0).setMaxValue(59).setReadOnly(!1),this.__secondSelector.setMinValue(0).setMaxValue(59).setReadOnly(!1),this.__element.append(this.__hourSelector.getElement(),this.__minuteSelector.getElement(),this.__secondSelector.getElement())}__attach(){this.__isAttached||(this.__destroyersToCallOnDestroy.push(this.__hourSelector.eventHandler.register(i.NumberSelectFieldEvents.onNumberChanged,this.__selectorChangedHandler)),this.__destroyersToCallOnDestroy.push(this.__minuteSelector.eventHandler.register(i.NumberSelectFieldEvents.onNumberChanged,this.__selectorChangedHandler)),this.__destroyersToCallOnDestroy.push(this.__secondSelector.eventHandler.register(i.NumberSelectFieldEvents.onNumberChanged,this.__selectorChangedHandler)),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__onSelectorChanged(e){let t=e.getValue();if(null==t)return;let a=new Date(0,0,0,0,0,0,0);switch(null!=this.__attrHandler.time&&(a=new Date(this.__attrHandler.time)),e.getId()){case this.__hourSelector.getId():a.setHours(t);break;case this.__minuteSelector.getId():a.setMinutes(t);break;case this.__secondSelector.getId():a.setSeconds(t)}this.setTime(a),this.eventHandler.raise(n.TimePickerEvents.onTimeChanged)}static openTimePickerDialog(e,a,i,s){let r=new n((new Date).getTime()+"-time-picker",null);r.setTime(e).layoutHandler.setHeight(100).setWidth(200);t.DialogWindow.openDialogWindow({appearance:{content:r.getElement(),headline:{textAttributes:{text:a}},buttons:t.DialogWindow.Buttons.OkCancel,modal:!0,layout:{maxWidth:n.DefaultTimePickerDialogSize.width,maxHeight:n.DefaultTimePickerDialogSize.height}},callbacks:{cbConfirmed:()=>{null!=i&&i(r.getTime())},cbClosed:()=>{null!=s&&s(e),r.destroy()}}})}setAttributes(e){return super.setAttributes(e),void 0!==e.time&&this.setTime(e.time),this}getAttributes(){return this.__attrHandler.getRef()}setTime(e){return this.__attrHandler.checkAttribute(e,"time",{validator:"date"})?(this.__attrHandler.time=e,this.__processTime(),this):this}__processTime(){null==this.__attrHandler.time?(this.__hourSelector.setValue(null),this.__minuteSelector.setValue(null),this.__secondSelector.setValue(null)):(this.__hourSelector.setValue(this.__attrHandler.time.getHours()),this.__minuteSelector.setValue(this.__attrHandler.time.getMinutes()),this.__secondSelector.setValue(this.__attrHandler.time.getSeconds()))}getTime(){return this.__attrHandler.time}}t.TimePicker=n,function(e){let t;!function(e){e.onTimeChanged="onTimeChanged"}(t=e.TimePickerEvents||(e.TimePickerEvents={})),e.DefaultTimePickerDialogSize={width:350,height:200}}(n=t.TimePicker||(t.TimePicker={}));class i extends t.Base{constructor(a,n){super(a,n),this.__input=new t.InputBox(this.__id+"-input",this).setAttributes({digits:0,value:0}),this.__upButton=new t.Button(this.__id+"-up-button",this).setAttributes({iconPath:e.Icons.Standard.Up.path,cssClass:"up-button"}),this.__downButton=new t.Button(this.__id+"-down-button",this).setAttributes({iconPath:e.Icons.Standard.Down.path,cssClass:"down-button"}),this.__element.addClass("number-select-field"),this.__element.append(this.__upButton.getElement(),this.__input.getElement(),this.__downButton.getElement())}__attach(){this.__isAttached||(this.__destroyersToCallOnDestroy.push(this.__upButton.eventHandler.register(t.Button.ButtonEvents.onPressed,(()=>this.__onUpButtonPressed()))),this.__destroyersToCallOnDestroy.push(this.__downButton.eventHandler.register(t.Button.ButtonEvents.onPressed,(()=>this.__onDownButtonPressed()))),this.__destroyersToCallOnDestroy.push(this.__input.eventHandler.register(t.InputBox.InputBoxEvents.onUserInteractionFinished,(()=>this.setValue(this.__input.getValue())))),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__onUpButtonPressed(){if(null!=this.__attrHandler.value){if(null!=this.__attrHandler.maxValue&&this.__attrHandler.value+1>this.__attrHandler.maxValue)return void this.__upButton.setIsEnabled(!1);this.setValue(this.__attrHandler.value+1)}else null!=this.__attrHandler.maxValue&&1<this.__attrHandler.maxValue?this.setValue(1):this.setValue(this.__attrHandler.maxValue)}__onDownButtonPressed(){if(null!=this.__attrHandler.value){if(null!=this.__attrHandler.minValue&&this.__attrHandler.value-1<this.__attrHandler.minValue)return void this.__downButton.setIsEnabled(!1);this.setValue(this.__attrHandler.value-1)}else null!=this.__attrHandler.minValue&&-1>this.__attrHandler.minValue?this.setValue(-1):this.setValue(this.__attrHandler.minValue)}setAttributes(e){return super.setAttributes(e),void 0!==e.value&&this.setValue(e.value),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.orientation&&this.setOrientation(e.orientation),this}getAttributes(){return this.__attrHandler.getRef()}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:"number"})?(this.__attrHandler.value=e,this.__processValue(),this.eventHandler.raise(i.NumberSelectFieldEvents.onNumberChanged),this):this}__processValue(){this.__input.setValue(this.__attrHandler.value),null==this.__attrHandler.value?this.setValue(0):(null!=this.__attrHandler.minValue&&(this.__attrHandler.value<=this.__attrHandler.minValue?this.__downButton.setIsEnabled(!1):this.__downButton.setIsEnabled(!0)),null!=this.__attrHandler.maxValue&&(this.__attrHandler.value>=this.__attrHandler.maxValue?this.__upButton.setIsEnabled(!1):this.__upButton.setIsEnabled(!0)))}getValue(){return this.__attrHandler.value}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,this.__processMinValue(),this):this}__processMinValue(){this.__input.setMinValue(this.__attrHandler.minValue),null==this.__attrHandler.minValue?(this.__upButton.setIsEnabled(!0),this.__downButton.setIsEnabled(!0)):null!=this.__attrHandler.value&&(this.__attrHandler.value<=this.__attrHandler.minValue?this.__downButton.setIsEnabled(!1):this.__downButton.setIsEnabled(!0))}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,this.__processMaxValue(),this):this}__processMaxValue(){this.__input.setMaxValue(this.__attrHandler.maxValue),null==this.__attrHandler.maxValue?(this.__upButton.setIsEnabled(!0),this.__downButton.setIsEnabled(!0)):null!=this.__attrHandler.value&&(this.__attrHandler.value>=this.__attrHandler.maxValue?this.__upButton.setIsEnabled(!1):this.__upButton.setIsEnabled(!0))}getMaxValue(){return this.__attrHandler.maxValue}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){this.__attrHandler.orientation===e.Orientation.horizontal?this.__element.addClass("horizontal"):this.__element.removeClass("horizontal")}getOrientation(){return this.__attrHandler.orientation}__processReadOnly(){super.__processReadOnly(),this.__input?.setReadOnly(this.__attrHandler.readOnly)}}t.NumberSelectField=i,function(e){let t;!function(e){e.onNumberChanged="onNumberChanged"}(t=e.NumberSelectFieldEvents||(e.NumberSelectFieldEvents={}))}(i=t.NumberSelectField||(t.NumberSelectField={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.ContentWindow{constructor(e,a){super(e,a),this.__stopClosing=!1,this.setButtons(n.Buttons.Cancel),this.layoutHandler.setAutoUpdateAttributes(["left","top","width","height"]),this.__selectHandler=e=>{null!=e.button&&e.button!==t.MouseButtons.left||this.focus()},this.__minimizedDownHandler=e=>{if(null!=e.button&&e.button!==t.MouseButtons.left)return;let a=()=>{this.toggleMinimize(),this.__element.off("pointerup",a)};this.__element.on("pointerup",a),this.__element.off("pointerdown",this.__minimizedDownHandler)},this.__element.addClass("dialog-window"),i.register(this)}__attach(){this.__isAttached||(this.__element.hasClass("maximized")||null==this.__attrHandler.layout?.left&&null==this.__attrHandler.layout?.right&&null==this.__attrHandler.layout?.bottom&&null==this.__attrHandler.layout?.top&&this.__adjustPositionToCenter(),this.__makeDragable(),this.__element.on("pointerdown",this.__selectHandler),this.eventHandler.register(a.LayoutHandler.LayoutHandlerEvents.onAttributesAutoUpdated,(e=>{e.destroy(),this.__makeDragable()})),this.eventHandler.raise(n.DialogWindowEvents.onOpened),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__selectHandler),super.__detach())}destroy(){i.deregister(this),this.__defaultButtonsContainer?.destroy(),super.destroy()}onResized(){if(super.onResized(),this.__defaultButtonsContainer){let e=this.__defaultButtonsContainer.getElement().width(),t=Number(this.__defaultButtonsContainer.getElement().css("margin-right").replace("px",""));t=isNaN(t)?0:t,e=null!=e?e+t:0;let a=this.__headline.layoutHandler.getMaxWidth(),n=(null!=a?a:0)-e;this.__headline.layoutHandler.setMaxWidth(n)}}__adjustPositionToCenter(){if(null==this.__attrHandler.layout?.left&&null==this.__attrHandler.layout?.top){let e=$(window).outerWidth(),t=$(window).outerHeight();if(null!=t&&null!=e)if(e>0&&t>0){let a,n,i,s,r,o;if(null!=this.__attrHandler.layout?.maxHeight&&(n="%"===this.__attrHandler.layout.maxHeightUnit?t/100*this.__attrHandler.layout.maxHeight:this.__attrHandler.layout.maxHeight),null!=this.__attrHandler.layout?.maxWidth&&(a="%"===this.__attrHandler.layout.maxWidthUnit?e/100*this.__attrHandler.layout.maxWidth:this.__attrHandler.layout.maxWidth),null!=this.__attrHandler.layout?.minHeight&&(s="%"===this.__attrHandler.layout.minHeightUnit?t/100*this.__attrHandler.layout.minHeight:this.__attrHandler.layout.minHeight),null!=this.__attrHandler.layout?.minWidth&&(i="%"===this.__attrHandler.layout.minWidthUnit?e/100*this.__attrHandler.layout.minWidth:this.__attrHandler.layout.minWidth),o=null!=this.__attrHandler.layout?.height?"%"===this.__attrHandler.layout.heightUnit?t/100*this.__attrHandler.layout.height:this.__attrHandler.layout.height:this.__element.outerHeight(),r=null!=this.__attrHandler.layout?.width?"%"===this.__attrHandler.layout.widthUnit?e/100*this.__attrHandler.layout.width:this.__attrHandler.layout.width:this.__element.outerWidth(),void 0!==o?void 0!==s&&o<s?o=s:void 0!==n&&o>n&&(o=n):o=s,void 0!==r?void 0!==i&&r<i?r=i:void 0!==a&&r>a&&(r=a):r=i,void 0!==r)if(r>0){let t=e/2-r/2;t<=10&&(t=10),this.layoutHandler.setLeft(t)}else this.layoutHandler.setLeft(50);if(void 0!==o)if(o>0){let e=t/2-o/2;e<=10&&(e=10),this.layoutHandler.setTop(e)}else this.layoutHandler.setTop(50)}else this.layoutHandler.setLeft(0).setTop(0)}}__updateHeaderElementsOrder(){this.controlContainer.getElement().detach(),this.__defaultButtonsContainer?.getElement().detach(),this.__menuButton?.getElement().detach(),this.controlContainer.getControls().length>0&&this.__header.append(this.controlContainer.getElement()),this.__contextMenu&&this.__header.append(this.__menuButton.getElement()),null!=this.__attrHandler.buttons&&this.__defaultButtonsContainer&&this.__header.append(this.__defaultButtonsContainer.getElement())}__makeDragable(){this.__resetDragable();const e=this.layoutHandler.getWidth(),a=this.layoutHandler.getHeight();if(null==e||null==a)return;const i=this.__header.height();let s=-a+n.MoveLimitation;i&&(s=-a+i);let r={limitingContainer:$("body"),minTopDistance:0,minBottomDistance:s,minLeftDistance:-e+n.MoveLimitation,minRightDistance:-e+n.MoveLimitation};this.__openedModal&&(r.allowHorizontalMovement=!1,r.allowVerticalMovement=!1),t.Helper.DragableElement.makeDragable(this.__element,this.__header,r)}__resetDragable(){t.Helper.DragableElement.resetDragable(this.__element,this.__header)}open(e){return this.__isOpen?(this.__isMinimized&&this.toggleMinimize(),this.focus()):(void 0===e&&(e=this.__attrHandler.modal),e?(this.__openedModal=!0,t.System.OverlayContainer.set(this.__element)):(this.__openedModal=!1,$("body").append(this.__element),this.__element.addClass("resizeable")),this.__isOpen=!0),this}close(){if(!0===this.__isOpen){if(this.eventHandler.raise(n.DialogWindowEvents.onClosing),this.__stopClosing)return this.__stopClosing=!1,this;this.__openedModal?t.System.OverlayContainer.remove(this.__element):(this.__element.detach(),this.__element.removeClass("resizeable")),this.__isOpen=!1,this.__openedModal=!1,this.eventHandler.raise(n.DialogWindowEvents.onClosed)}return this}stopClosing(){this.__stopClosing=!0}confirm(){return!0===this.__isOpen&&(this.eventHandler.raise(n.DialogWindowEvents.onConfirmed),0==this.__stopClosing?this.close():this.__stopClosing=!1),this}focus(){return this.__header.addClass("selected"),this.__element.addClass("selected"),this.__element.css("--tchmi-ba-dialog-window-z-index",1),this.eventHandler.raise(n.DialogWindowEvents.onFocused),this}unfocus(e){this.__header.removeClass("selected"),this.__element.removeClass("selected"),e&&this.__element.css("--tchmi-ba-dialog-window-z-index",0)}getIsOpen(){return null!=this.__isOpen&&this.__isOpen}getHeader(){return this.__header}getContentContainer(){return this.__contentContainer}toggleMaximize(){this.__element.toggleClass("maximized"),this.__element.hasClass("maximized")?this.__layoutBeforeMaximized=this.layoutHandler.reset():this.__layoutBeforeMaximized&&this.layoutHandler.setAttributes(this.__layoutBeforeMaximized)}toggleMinimize(){this.__isMinimized?(this.__isMinimized=!1,this.__element.removeClass("minimized"),this.__element.append(this.__contentContainer),this.__layoutBeforeMinimized&&this.layoutHandler.setAttributes(this.__layoutBeforeMinimized),this.__makeDragable(),this.__headline.textHandler.setOverflow(a.TextHandler.Overflow.marquee),this.__element.off("pointerdown",this.__minimizedDownHandler)):(this.__isMinimized=!0,this.__element.addClass("minimized"),this.__element.on("pointerdown",this.__minimizedDownHandler),this.__contentContainer.detach(),this.__layoutBeforeMinimized=this.layoutHandler.reset(),this.__resetDragable(),this.__headline.textHandler.setOverflow(a.TextHandler.Overflow.ellipsis)),this.eventHandler.raise(n.DialogWindowEvents.onMinimizedChanged)}getIsMinimized(){return this.__isMinimized}setAttributes(e){return super.setAttributes(e),void 0!==e.buttons&&this.setButtons(e.buttons),void 0!==e.modal&&(this.__attrHandler.modal=e.modal),this}getAttributes(){return this.__attrHandler.getRef()}setButtons(e){return this.__attrHandler.checkAttribute(e,"buttons",{validator:"number"})?(this.__attrHandler.buttons=e,this.__processButtons(),this):this}__processButtons(){if(null===this.__attrHandler.buttons)this.__defaultButtonsContainer?.removeAllControls();else{if(this.__defaultButtonsContainer||(this.__defaultButtonsContainer=new a.ControlContainer(this.__id+"-default-buttons-container",this).setAttributes({cssClass:"controls-container default-buttons-container"})),this.__attrHandler.buttons!==n.Buttons.CancelSize&&this.__attrHandler.buttons!==n.Buttons.OkCancelSize||(null==this.__defaultButtonsContainer.getControl("minimize-button")&&this.__defaultButtonsContainer.addControl({name:"minimize-button",type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Minus.path,iconHeight:80,iconHeightUnit:"%",iconWidth:60,iconWidthUnit:"%",order:1},callback:()=>{this.toggleMinimize()}}),null==this.__defaultButtonsContainer.getControl("maximize-button")&&this.__defaultButtonsContainer.addControl({name:"maximize-button",type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Maximize.path,iconHeight:70,iconHeightUnit:"%",iconWidth:70,iconWidthUnit:"%",order:2},callback:()=>{this.toggleMaximize()}})),this.__attrHandler.buttons!==n.Buttons.OkCancel&&this.__attrHandler.buttons!==n.Buttons.OkCancelSize||null==this.__defaultButtonsContainer.getControl("confirm-button")&&this.__defaultButtonsContainer.addControl({name:"confirm-button",type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Confirm.path,order:3},callback:()=>{this.confirm()}}),this.__attrHandler.buttons===n.Buttons.Cancel||this.__attrHandler.buttons===n.Buttons.OkCancel||this.__attrHandler.buttons===n.Buttons.CancelSize||this.__attrHandler.buttons===n.Buttons.OkCancelSize){if(null==this.__defaultButtonsContainer.getControl("cancel-button")){let e=!1;this.__defaultButtonsContainer.addControl({name:"cancel-button",type:a.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Close.path,order:4},callback:()=>{e||(this.eventHandler.raise(n.DialogWindowEvents.onCanceled),this.close())},cbOnCreated:n=>{const s=e=>e.preventDefault(),r=e=>{e.button===t.MouseButtons.right&&(n.getElement().on("contextmenu",s),n.getElement().on("pointerup",o))},o=e=>{l(e),n.getElement().off("pointerup",o),n.getElement().off("contextmenu",s)},l=n=>{e=!0;const r=a.ContextMenu.openContextMenu({rowEntryOptions:[{text:t.Locale.Localization.getText(t.Locale.LangKey.CloseAllDialogs),onPressed:()=>{r.close(),i.closeAllOpenDialogs()}}],position:{left:n.pageX,top:n.pageY}});r.getElement().on("contextmenu",s),r.eventHandler.register(a.ContextMenu.ContextMenuEvents.onMenuClose,(()=>{e=!1,r.getElement().off("contextmenu",s),r.destroy()}))},d=t.Helper.PressAndHold.init(n.getElement(),(async e=>{l(e)}));n.getElement().on("pointerdown",r),n.eventHandler.register(a.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),n.getElement().off("pointerdown",r),d.stop()}))}})}this.__attrHandler.buttons===n.Buttons.Cancel&&null!=this.__defaultButtonsContainer.getControl("confirm-button")&&this.__defaultButtonsContainer.removeControl("confirm-button")}this.__header.append(this.__defaultButtonsContainer.getElement())}}getButtons(){return this.__attrHandler.buttons}static createDialogWindow(t){if(null==t)return null;if(null!=t.appearance&&null!=t.appearance.content){let s=0,r="TcHmi.BuildingAutomation.Controls.DialogWindow-"+s;for(;void 0!==i.getRegisteredDialog(r);)s++,r="TcHmi.BuildingAutomation.Controls.DialogWindow-"+s;let o=new n(r,null);if(void 0!==o){let i,s,l,d;o.setAttributes(t.appearance);let h=()=>{if(null!=t.callbacks?.cbClosed&&t.callbacks.cbClosed(),null!=i&&i(),null!=s&&s(),null!=l&&l(),null!=d&&d(),1==t.behaviour?.destroyOnClose){let e=e=>{e.destroy(),o.destroy()};o.eventHandler.register(a.BaseNode.BaseNodeEvents.onDetached,e)}let n=e.Controls.get(r+"-region");n&&(n.setTargetContent(""),n.destroy())},_=()=>{null!=t.callbacks?.cbConfirmed&&t.callbacks.cbConfirmed()},c=()=>{null!=t.callbacks?.cbClosing&&t.callbacks.cbClosing()},u=()=>{null!=t.callbacks?.cbCanceled&&t.callbacks.cbCanceled()},g=()=>{null!=t.callbacks?.cbOpened&&t.callbacks.cbOpened(),p()},p=o.eventHandler.register(n.DialogWindowEvents.onOpened,g);return t.appearance&&null!=t.appearance.buttons&&(i=o.eventHandler.register(n.DialogWindowEvents.onCanceled,u),s=o.eventHandler.register(n.DialogWindowEvents.onClosing,c),l=o.eventHandler.register(n.DialogWindowEvents.onClosed,h)),!t.appearance||t.appearance.buttons!==n.Buttons.OkCancel&&t.appearance.buttons!==n.Buttons.OkCancelSize||(d=o.eventHandler.register(n.DialogWindowEvents.onConfirmed,_)),null!=t.callbacks?.cbOnCreated&&t.callbacks.cbOnCreated(o),o}}return null}static openDialogWindow(e){null!=e&&this.createDialogWindow({...e,behaviour:{destroyOnClose:!0}})?.open(e.appearance?.modal)}static alert(e,i){return!0!==i?.skipLog&&(null!=i?.logger?i.logger.error(e):t.Logger.error(e)),new Promise(((t,s)=>{let r=$("<div>").addClass("dialog-window-alert-content-container"),o=i?.attr;null==o&&(o={}),null==o.fontSize&&(o.fontSize=14),null==o.fontWeight&&(o.fontWeight="Bold"),null==o.wordWrap&&(o.wordWrap=!0),null==o.overflow&&(o.overflow=a.TextHandler.Overflow.none),null==o.horizontalAlignment&&(o.horizontalAlignment="Left"),o.text=e;let l=new a.Textblock(Date.now().toString()+"-alert-msg-block",null).setAttributes({cssClass:"dialog-window-alert-msg",textAttributes:o});r.append(l.getElement()),null!=i?.callbacks?.cbOnTextBlockCreated&&i.callbacks.cbOnTextBlockCreated(l);let d=a.TextHandler.calculateTextSize(o,500);n.openDialogWindow({appearance:{modal:!0,headline:{textAttributes:{text:i?.headline?i.headline:"Alert"}},layout:{maxWidth:d.width+30,maxHeight:d.height+55},content:r,buttons:n.Buttons.Cancel},callbacks:{...i?.callbacks,cbClosed:()=>{null!=i?.callbacks?.cbClosed&&i.callbacks.cbClosed(),l.destroy(),t()}}})}))}static confirm(e,t){return new Promise(((i,s)=>{let r=$("<div>").addClass("dialog-window-alert-content-container");null==t&&(t={}),null==t.attr&&(t.attr={}),null==t.attr.fontSize&&(t.attr.fontSize=14),null==t.attr.fontWeight&&(t.attr.fontWeight="Bold"),null==t.attr.wordWrap&&(t.attr.wordWrap=!0),null==t.attr.overflow&&(t.attr.overflow=a.TextHandler.Overflow.none),null==t.attr.horizontalAlignment&&(t.attr.horizontalAlignment="Left"),t.attr.text=e;let o=new a.Textblock(Date.now().toString()+"-alert-msg-block",null).setAttributes({cssClass:"dialog-window-alert-msg",textAttributes:t.attr});r.append(o.getElement()),null!=t.callbacks?.cbOnTextBlockCreated&&t.callbacks.cbOnTextBlockCreated(o);let l=a.TextHandler.calculateTextSize(t.attr,500);n.openDialogWindow({appearance:{modal:!0,headline:{textAttributes:{text:t.headline?t.headline:"Confirm"}},layout:{maxWidth:l.width+20,maxHeight:l.height+55},content:r,buttons:n.Buttons.OkCancel},callbacks:{...t?.callbacks,cbClosed:()=>{null!=t?.callbacks?.cbClosed&&t.callbacks.cbClosed(),o.destroy()},cbCanceled:()=>{null!=t?.callbacks?.cbCanceled&&t.callbacks.cbCanceled(),i(!1)},cbConfirmed:()=>{null!=t?.callbacks?.cbConfirmed&&t.callbacks.cbConfirmed(),i(!0)}}})}))}static prompt(e,i,s){return new Promise(((r,o)=>{let l=$("<div>").addClass("dialog-window-alert-content-container prompt");null==s&&(s={}),null==s.attr&&(s.attr={}),null==s.attr.fontSize&&(s.attr.fontSize=14),null==s.attr.fontWeight&&(s.attr.fontWeight="Bold"),null==s.attr.wordWrap&&(s.attr.wordWrap=!0),null==s.attr.overflow&&(s.attr.overflow=a.TextHandler.Overflow.none),null==s.attr.horizontalAlignment&&(s.attr.horizontalAlignment="Left"),s.attr.text=e;let d=new a.Textblock(Date.now().toString()+"-alert-msg-block",null).setAttributes({cssClass:"dialog-window-alert-msg",textAttributes:s.attr});l.append(d.getElement()),null!=s.callbacks?.cbOnTextBlockCreated&&s.callbacks.cbOnTextBlockCreated(d);let h=new a.InputBox(Date.now().toString()+"-prompt-input",null).setAttributes({cssClass:"dialog-window-prompt-input",textAttributes:s.attr,readOnly:!1,dataType:t.DataType.string});l.append(h.getElement()),h.setValue(i);let _=a.TextHandler.calculateTextSize(s.attr,500),c=n.createDialogWindow({appearance:{modal:!0,headline:{textAttributes:{text:s.headline?s.headline:"Prompt"}},layout:{maxWidth:_.width+20,maxHeight:_.height+55+35},content:l,buttons:n.Buttons.OkCancel},callbacks:{...s?.callbacks,cbClosed:()=>{null!=s?.callbacks?.cbClosed&&s.callbacks.cbClosed(),d.destroy(),h.destroy()},cbCanceled:()=>{null!=s?.callbacks?.cbCanceled&&s.callbacks.cbCanceled(),r(null)},cbConfirmed:()=>{null!=s?.callbacks?.cbConfirmed&&s.callbacks.cbConfirmed();let e=h.getValue();r(null!=e?e:null)}},behaviour:{destroyOnClose:!0}})?.open();h.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,(e=>{e.destroy(),c?.confirm()}))}))}static promptNumericWithLimits(e,a,i,s,r){return new Promise((async(o,l)=>{let d,h=!1;do{let l=await n.prompt(`${e} (Min: ${i}; Max: ${s}):`,a.toString(),r);if(null==l)return void o(null);l=l.replace(",","."),d=Number(l),isNaN(d)?await n.alert(t.Locale.Localization.getText(t.Locale.LangKey.NaN)+"!"):null!=i&&null!=s&&(d<i||d>s)?await n.alert(tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ValueNotWithinLimits),i.toString(),s.toString())+"!"):h=!0}while(!h);o(d)}))}}a.DialogWindow=n,function(e){let t,a;!function(e){e[e.Cancel=0]="Cancel",e[e.CancelSize=1]="CancelSize",e[e.OkCancel=2]="OkCancel",e[e.OkCancelSize=3]="OkCancelSize"}(t=e.Buttons||(e.Buttons={})),function(e){e.onOpened="onDialogWindowOpened",e.onConfirmed="onDialogWindowConfirmed",e.onCanceled="onDialogWindowCanceled",e.onClosing="onDialogWindowClosing",e.onClosed="onDialogWindowClosed",e.onFocused="onDialogWindowFocused",e.onMinimizedChanged="onDialogWindowMinimizedChanged"}(a=e.DialogWindowEvents||(e.DialogWindowEvents={})),e.MoveLimitation=100}(n=a.DialogWindow||(a.DialogWindow={}));class i{static __onDialogOpened(e){if(this.__registeredDialogs.has(e.getId())){if(this.__openDialogs.set(e.getId(),e)){for(let t of this.__openDialogs.values())if(t.getId()!==e.getId()){let a=e.layoutHandler.getLeft(),n=e.layoutHandler.getTop();null!=a&&t.layoutHandler.getLeft()===a&&e.layoutHandler.setLeft(a+25),null!=n&&t.layoutHandler.getTop()===n&&e.layoutHandler.setTop(n+25)}return e.focus(),!0}return console.warn("The opened dialog "+e.getId()+" could not be added to the open dialog dictionary of the dialog window management."),!1}return console.warn("The opened dialog "+e.getId()+" was not registered in the dialog window management."),!1}static __onDialogClosed(e){return!!this.__openDialogs.delete(e.getId())||(console.warn("The closed dialog "+e.getId()+" was not in the open dialog dictionary of the dialog window management."),!1)}static __onDialogFocused(e){if(this.__openDialogs.has(e.getId())){if(this.__focusedDialog&&e.getId()===this.__focusedDialog.getId())return!0;this.__focusedDialog=e;for(let t of this.__openDialogs.values())t.getId()!==e.getId()&&t.unfocus(!0);return!0}return console.warn("The focused dialog "+e.getId()+" was not in the open dialog dictionary of the dialog window management."),!1}static __onDialogMinimizedChanged(e){if(this.__openDialogs.get(e.getId())){let e=0;for(let t of this.__openDialogs.values())t.getIsMinimized()&&(t.layoutHandler.setLeft(e),e+=205);return!0}return console.warn(`The minimized dialog ${e.getId()} was not found in DialogWindowManager.`),!1}static register(e){if(0==this.__registeredDialogs.has(e.getId())){let t=[];return t.push(e.eventHandler.register(n.DialogWindowEvents.onOpened,(()=>i.__onDialogOpened(e)))),t.push(e.eventHandler.register(n.DialogWindowEvents.onClosed,(()=>i.__onDialogClosed(e)))),t.push(e.eventHandler.register(n.DialogWindowEvents.onFocused,(()=>i.__onDialogFocused(e)))),t.push(e.eventHandler.register(n.DialogWindowEvents.onMinimizedChanged,(()=>i.__onDialogMinimizedChanged(e)))),this.__registeredDialogs.set(e.getId(),{dialog:e,dfs:t}),!0}return!1}static deregister(e){let t=this.__registeredDialogs.get(e.getId());return null!=t&&(t.dfs.forEach((e=>e())),this.__registeredDialogs.delete(e.getId()))}static getRegisteredDialogsCnt(){return this.__registeredDialogs.size}static getRegisteredDialog(e){return this.__registeredDialogs.get(e)?.dialog}static closeAllOpenDialogs(){this.__openDialogs.forEach((e=>e.close()))}}i.__openDialogs=new Map,i.__registeredDialogs=new Map}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.Icon{constructor(e,t){super(e,t),this.__iconShowInLegend=!0,this.__button=new a.Button(this.__id+"-button",this),this.__pressedHandler=()=>this.__onPressedHandler(),this.__element.addClass("event-icon"),this.setEventCount(1)}__attach(){this.__isAttached||(null!=this.__attrHandler.eventCondition&&this.__attrHandler.eventCondition>=t.BA.EventCondition.eTypeAlarm&&this.__attrHandler.eventCondition<=t.BA.EventCondition.eTypeOther&&(this.__button.setIsEnabled(!0),this.__destroyOnPressed=this.__button.eventHandler.register(a.Button.ButtonEvents.onPressed,this.__pressedHandler)),this.__setDisplayedEvent(),this.__destroyersToCallOnDetach.push(e.EventProvider.register(t.TcHmiEvents.onThemeDataChanged,(()=>{this.__setDisplayedEvent()}))),super.__attach())}__detach(){this.__isAttached&&(null!=this.__destroyOnPressed&&(this.__destroyOnPressed(),delete this.__destroyOnPressed),super.__detach())}destroy(){this.__button.destroy(),null!=this.__destroyOnPressed&&(this.__destroyOnPressed(),delete this.__destroyOnPressed),super.destroy()}__onPressedHandler(){null!=this.__attrHandler.acknowledgeMapping&&(e.Server.writeSymbol(this.__attrHandler.acknowledgeMapping,!0,(e=>{this.logger.checkServerResult(t.Logger.Severity.error,e,!1)})),this.logger.debug("Nothing was acknowledged in the PLC because no acknowledgeMapping was set!")),this.eventHandler.raise(n.EventIconEvents.onAcknowledged)}__setDisplayedEvent(){if(this.__element.removeClass("clickable"),null!=this.__attrHandler.eventCondition&&null!=this.__attrHandler.eventState){switch(this.__iconAttr=n.getEventIconAndColor(this.__attrHandler.eventCondition,this.__attrHandler.eventState),this.__attrHandler.eventCondition){case t.BA.EventCondition.eTypeAlarm:case t.BA.EventCondition.eTypeDisturb:case t.BA.EventCondition.eTypeMaintenance:case t.BA.EventCondition.eTypeNotification:case t.BA.EventCondition.eTypeOther:this.__attrHandler.readOnly||this.__element.addClass("clickable");case t.BA.EventCondition.eLockPrioLocalMedium:case t.BA.EventCondition.eLockPrioLocalHigh:}let e;this.__attrHandler.readOnly?(this.__button.getElement().detach(),e=this):(this.__element.append(this.__button.getElement()),e=this.__button,this.iconHandler.setIcon(null));let i=e.iconHandler.getSvg(),s=()=>{i&&this.__iconAttr&&null!=this.__attrHandler.eventCondition&&null!=this.__attrHandler.eventState&&(this.__attrHandler.eventCondition>t.BA.EventCondition.eTypeOther||(this.__attrHandler.eventState===t.BA.EventIconState.eIndicated?null!=this.__iconAttr.iconColor&&i.css({fill:"transparent",stroke:this.__iconAttr.iconColor.toString()}):null!=this.__iconAttr.iconColor&&(i.css({fill:this.__iconAttr.iconColor.toString(),stroke:this.__iconAttr.iconColor.toString()}),this.__attrHandler.eventCondition===t.BA.EventCondition.eTypeAlarm&&this.__attrHandler.eventState>t.BA.EventIconState.eNone&&i.css("stroke",""))))};i&&e.iconHandler.getIcon()===this.__iconAttr?.iconPath?s():e.eventHandler.register(a.BackgroundStyler.Events.onSvgLoaded,(t=>{t.destroy(),i=e.iconHandler.getSvg(),s()})),this.__iconAttr&&(this.__isAttached&&this.__legendIconHandler.show(),e.iconHandler.setAttributes(this.__iconAttr),this.__legendIconHandler.icon=this.__iconAttr)}}static getEventIconAndColor(e,a){if(null==e)return null;let i,s,r,o=n.EventConditionColor[e],l={iconPath:t.Icons.Standard.Confirm.path,iconColor:n.AckedIconColor,height:50,heightUnit:"%",width:50,widthUnit:"%",verticalAlignment:"Bottom",horizontalAlignment:"Right",backgroundColor:n.AckedIconBackgroundColor},d=!1;switch(e){case t.BA.EventCondition.eTypeAlarm:case t.BA.EventCondition.eTypeDisturb:case t.BA.EventCondition.eTypeMaintenance:case t.BA.EventCondition.eTypeNotification:case t.BA.EventCondition.eTypeOther:switch(e){case t.BA.EventCondition.eTypeAlarm:i=a===t.BA.EventIconState.eIndicated?t.Icons.Events.Event.AlarmIndicated.path:t.Icons.Events.Event.Alarm.path,s=t.Icons.Events.Event.Alarm.description;break;case t.BA.EventCondition.eTypeDisturb:i=a===t.BA.EventIconState.eIndicated?t.Icons.Events.Event.DisturbanceIndicated.path:t.Icons.Events.Event.Disturbance.path,s=t.Icons.Events.Event.Disturbance.description;break;case t.BA.EventCondition.eTypeMaintenance:i=a===t.BA.EventIconState.eIndicated?t.Icons.Events.Event.MaintenanceIndicated.path:t.Icons.Events.Event.Maintenance.path,s=t.Icons.Events.Event.Maintenance.description;break;case t.BA.EventCondition.eTypeNotification:i=a===t.BA.EventIconState.eIndicated?t.Icons.Events.Event.NotificationIndicated.path:t.Icons.Events.Event.Notification.path,s=t.Icons.Events.Event.Notification.description;break;case t.BA.EventCondition.eTypeOther:i=a===t.BA.EventIconState.eIndicated?t.Icons.Events.Event.OtherIndicated.path:t.Icons.Events.Event.Other.path,s=t.Icons.Events.Event.Other.description;break;default:return null}if(null!=a&&a<t.BA.EventIconState.ePresentAcked&&(o=n.GoneAckedColor,a===t.BA.EventIconState.eNone&&(i=t.Icons.Standard.Close.path)),a!==t.BA.EventIconState.eGoneAcked&&a!==t.BA.EventIconState.ePresentAcked||(l={...l,iconPath:t.Icons.Standard.Confirm.path,iconColor:n.AckedIconColor,iconStrokeWidth:25},d=!0),null!=a)switch(a){case t.BA.EventIconState.ePresent:r=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.EventIconStatePresent);break;case t.BA.EventIconState.ePresentAcked:r=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.EventIconStatePresentAcked);break;case t.BA.EventIconState.eGone:r=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.EventIconStateGone);break;case t.BA.EventIconState.eGoneAcked:r=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.EventIconStateGoneAcked);break;case t.BA.EventIconState.eIndicated:r=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.EventIconStateIndicated)}break;case t.BA.EventCondition.eFlagOverridden:i=t.Icons.Events.Flag.Overridden.path,s=t.Icons.Events.Flag.Overridden.description;break;case t.BA.EventCondition.eFlagOutOfService:i=t.Icons.Events.Flag.OutOfService.path,s=t.Icons.Events.Flag.OutOfService.description;break;case t.BA.EventCondition.eFlagFault:i=t.Icons.Events.Flag.Fault.path,s=t.Icons.Events.Flag.Fault.description;break;case t.BA.EventCondition.eFlagActiveEvent:i=t.Icons.Events.Flag.InAlarm.path,s=t.Icons.Events.Flag.InAlarm.description;break;case t.BA.EventCondition.ePrioLifeSafety:i=t.Icons.Events.Priority.Safety.path,s=t.Icons.Events.Priority.Safety.description;break;case t.BA.EventCondition.ePrioCritical:i=t.Icons.Events.Priority.Critical.path,s=t.Icons.Events.Priority.Critical.description;break;case t.BA.EventCondition.ePrioManualLocal:i=t.Icons.Events.Priority.ManualLocal.path,s=t.Icons.Events.Priority.ManualLocal.description;break;case t.BA.EventCondition.ePrioManualRemote:i=t.Icons.Events.Priority.ManualRemote.path,s=t.Icons.Events.Priority.ManualRemote.description;break;case t.BA.EventCondition.eLockPrioLocalMedium:case t.BA.EventCondition.eLockPrioMedium:i=t.Icons.Events.Lock.LockMedium.path,s=t.Icons.Events.Lock.LockMedium.description;break;case t.BA.EventCondition.eLockPrioLocalHigh:case t.BA.EventCondition.eLockPrioHigh:i=t.Icons.Events.Lock.LockHigh.path,s=t.Icons.Events.Lock.LockHigh.description;break;default:return null}if(e!==t.BA.EventCondition.eLockPrioLocalHigh&&e!==t.BA.EventCondition.eLockPrioLocalMedium||(l={...l,iconPath:t.Icons.Standard.Hand.path,iconColor:n.ManualIconColor,iconStrokeWidth:10},d=!0),null==s)throw new t.NullOrUndefinedVariableError("iconLangKey");const h={iconPath:i,iconColor:o,iconCategory:"Events",iconDescription:t.Helper.String.toLanguageKey(s)+(null!=r?" - "+t.Helper.String.toLanguageKey(r):"")};return h.iconOverlays=d?[l]:null,h}setAttributes(e){return super.setAttributes(e),void 0!==e.eventCondition&&this.setEventCondition(e.eventCondition),void 0!==e.eventState&&this.setEventState(e.eventState),void 0!==e.eventCount&&this.setEventCount(e.eventCount),void 0!==e.acknowledgeMapping&&this.setAcknowledgeSymbol(e.acknowledgeMapping),this}getAttributes(){return this.__attrHandler.getRef()}setEventCondition(e){return this.__attrHandler.checkAttribute(e,"eventCondition",{validator:"number"})?(this.__attrHandler.eventCondition=e,this.__processEventCondition(),this):this}__processEventCondition(){null!=this.__attrHandler.eventCondition&&this.__attrHandler.eventCondition>=t.BA.EventCondition.eTypeAlarm&&this.__attrHandler.eventCondition<=t.BA.EventCondition.eTypeOther?this.__button.getIsEnabled()||(this.__button.setIsEnabled(!0),this.__isAttached&&null==this.__destroyOnPressed&&(this.__destroyOnPressed=this.__button.eventHandler.register(a.Button.ButtonEvents.onPressed,this.__pressedHandler))):(this.__button.setIsEnabled(!1),null!=this.__destroyOnPressed&&(this.__destroyOnPressed(),delete this.__destroyOnPressed)),this.__isAttached&&this.__setDisplayedEvent()}getEventCondition(){return this.__attrHandler.eventCondition}setEventState(e){return this.__attrHandler.checkAttribute(e,"eventState",{validator:"number"})?(this.__attrHandler.eventState=e,this.__isAttached&&this.__setDisplayedEvent(),this):this}getEventState(){return this.__attrHandler.eventState}setEventCount(e){return this.__attrHandler.checkAttribute(e,"eventCount",{validator:"number"})?(this.__attrHandler.eventCount=e,this.__processEventCount(),this):this}__processEventCount(){null!=this.__attrHandler.eventCount&&this.__attrHandler.eventCount>1?a.Button.addBadge(this.__element,this.__attrHandler.eventCount):a.Button.addBadge(this.__element,0)}getEventCount(){return this.__attrHandler.eventCount}setAcknowledgeSymbol(e){return this.__attrHandler.checkAttribute(e,"acknowledgeMapping",{validator:"string"})?(this.__attrHandler.acknowledgeMapping=e,this):this}getAcknowledgeMapping(){return this.__attrHandler.acknowledgeMapping}setIcon(e){return this.__attrHandler.checkAttribute(e,"icon",{validator:"string"})?(this.__attrHandler.icon=e,this.__button.iconHandler.setIcon(e,!0),this):this}getIcon(){return this.__button.iconHandler.getIcon()}__processReadOnly(){super.__processReadOnly(),this.__isAttached&&this.__setDisplayedEvent()}__updateLegendIcon(){}}a.EventIcon=n,function(e){let a;!function(e){e.onAcknowledged="onAcknowledged"}(a=e.EventIconEvents||(e.EventIconEvents={})),e.GoneAckedColor=t.Color.RGBAColor.Black,e.EventConditionColor=[],e.EventConditionColor[t.BA.EventCondition.eTypeAlarm]=t.Color.RGBAColor.Red,e.EventConditionColor[t.BA.EventCondition.eTypeDisturb]=t.Color.RGBAColor.DarkOrange,e.EventConditionColor[t.BA.EventCondition.eTypeMaintenance]=t.Color.RGBAColor.TcHmiBlue,e.EventConditionColor[t.BA.EventCondition.eTypeNotification]=t.Color.RGBAColor.TcHmiBlue,e.EventConditionColor[t.BA.EventCondition.eTypeOther]=t.Color.RGBAColor.TcHmiBlue,e.EventConditionColor[t.BA.EventCondition.eFlagOverridden]=t.Color.RGBAColor.TcHmiBlue,e.EventConditionColor[t.BA.EventCondition.eFlagOutOfService]=t.Color.RGBAColor.DarkOrange,e.EventConditionColor[t.BA.EventCondition.eFlagFault]=t.Color.RGBAColor.DarkOrange,e.EventConditionColor[t.BA.EventCondition.eFlagActiveEvent]=t.Color.RGBAColor.Red,e.EventConditionColor[t.BA.EventCondition.ePrioLifeSafety]=t.Color.RGBAColor.Red,e.EventConditionColor[t.BA.EventCondition.ePrioCritical]=t.Color.RGBAColor.DarkOrange,e.EventConditionColor[t.BA.EventCondition.ePrioManualLocal]=t.Color.RGBAColor.DarkOrange,e.EventConditionColor[t.BA.EventCondition.ePrioManualRemote]=t.Color.RGBAColor.TcHmiBlue,e.EventConditionColor[t.BA.EventCondition.eLockPrioLocalMedium]=t.Color.RGBAColor.DarkOrange,e.EventConditionColor[t.BA.EventCondition.eLockPrioLocalHigh]=t.Color.RGBAColor.Red,e.EventConditionColor[t.BA.EventCondition.eLockPrioMedium]=t.Color.RGBAColor.DarkOrange,e.EventConditionColor[t.BA.EventCondition.eLockPrioHigh]=t.Color.RGBAColor.Red,e.AckedIconColor={r:0,g:200,b:0,a:1},e.ManualIconColor=t.Color.RGBAColor.White,e.AckedIconBackgroundColor={r:120,g:120,b:150,a:.8}}(n=a.EventIcon||(a.EventIcon={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.EventProvider.register(TcHmi.BuildingAutomation.TcHmiEvents.onThemeDataChanged,(()=>{"Base-Dark"===TcHmi.Theme.get()?TcHmi.BuildingAutomation.Components.EventIcon.GoneAckedColor=TcHmi.BuildingAutomation.Color.RGBAColor.Gray:TcHmi.BuildingAutomation.Components.EventIcon.GoneAckedColor=TcHmi.BuildingAutomation.Color.RGBAColor.Black})),function(e){!function(t){!function(a){class n extends a.TextControl{constructor(e,a){super(e,a),this.__warnColorActive=!1,this.baObjectHandler=new t.BaObjectHandler(this),this.valueHandler=new t.System.ValueHandler(this),this.__usedDataType=t.DataType.unknown,this.__keydownHandler=e=>this.__onKeyDown(e),this.__pasteHandler=e=>this.__onTextPaste(e),this.__focusinHandler=()=>this.__onFocusIn(),this.__focusoutHandler=e=>this.__onFocusOut(e),this.__input=$('<input autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-tchmi-input-mode="none" />').addClass("text-element"),this.__element.addClass("input-box"),this.setReadOnly(!0),this.setDigits(1)}__attach(){this.__isAttached||(this.__input.on("focusin",this.__focusinHandler),this.__input.on("click pointerdown",t.EventHandler.stopPropagationHandler),super.__attach())}__detach(){this.__isAttached&&(this.__input.off("keydown",this.__keydownHandler),this.__input.off("paste",this.__pasteHandler),this.__input.off("focusout",this.__focusoutHandler),this.__input.off("focusin",this.__focusinHandler),this.__input.off("click pointerdown",t.EventHandler.stopPropagationHandler),super.__detach())}destroy(){this.valueHandler.destroy(),this.baObjectHandler.destroy(),super.destroy()}__onKeyDown(e){let a=e.originalEvent,n=e.code;if(this.__usedDataType===t.DataType.unknown){let e=a.getModifierState("CapsLock"),i=a.getModifierState("Shift"),s=a.getModifierState("NumLock");t.Globals.Keyboard.isCodeNumberDigit(n)&&!e&&!i||t.Globals.Keyboard.isCodeNumberPad(n)&&!i&&s?this.__setUsedDataType(t.DataType.number):(t.Globals.Keyboard.isCodeLetterLatin(n)||t.Globals.Keyboard.isCodeNumberDigit(n)&&(e||i))&&this.__setUsedDataType(t.DataType.string)}this.__validateInput(a)||this.__setWarnColor(!1)}__onTextPaste(e){let a=e.originalEvent,n=a.clipboardData;if(null!==n){let e=n.getData("text"),i=this.__detectDataType(e);this.__usedDataType===t.DataType.number&&i!=t.DataType.number&&i!=t.DataType.integer&&(this.__setWarnColor(!1),a.preventDefault())}}__onFocusIn(){if(null!=this.__attrHandler.minValue&&null!=this.__attrHandler.maxValue&&this.__attrHandler.maxValue==this.__attrHandler.minValue&&this.logger.warn("Min and max values of silder are equal. No input will be possible!"),this.__input.on("keydown",this.__keydownHandler),this.__input.on("paste",this.__pasteHandler),this.__input.on("focusout",this.__focusoutHandler),(this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer)&&null!=this.__attrHandler.unit){let e=String(this.__input.val());e.indexOf(this.__attrHandler.unit)>0&&(e=e.replace(" "+this.__attrHandler.unit,""),this.__input.val(e))}this.__input.trigger("select"),this.baObjectHandler.baObject&&(this.__lowLimit||(this.__lowLimit=this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eLowLimit),this.__lowLimit&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eLowLimit,(e=>{e&&e.bEnable?this.setMinValue(e.fValue):this.setMinValue(null)}))),this.__highLimit||(this.__highLimit=this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eHighLimit),this.__highLimit&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eHighLimit,(e=>{e&&e.bEnable?this.setMaxValue(e.fValue):this.setMaxValue(null)})))),this.eventHandler.raise(n.InputBoxEvents.onFocusIn),e.EventProvider.raise(e.BuildingAutomation.Components.InputBox.InputBoxEvents.onFocusIn,this)}__onFocusOut(t){this.__input.off("keydown",this.__keydownHandler),this.__input.off("paste",this.__pasteHandler),this.__input.off("focusout",this.__focusoutHandler),this.__setWarnColor(!0),this.__endUserInteraction(),this.eventHandler.raise(n.InputBoxEvents.onFocusOut),e.EventProvider.raise(e.BuildingAutomation.Components.InputBox.InputBoxEvents.onFocusOut,this)}onValueChanged(e){this.setValue(e)}__endUserInteraction(){this.__input.off("keydown",this.__keydownHandler),this.__input.off("paste",this.__pasteHandler),this.__input.off("focusout",this.__focusoutHandler);let a=String(this.__input.val()),i=null;if(this.__usedDataType===t.DataType.unknown&&this.__setUsedDataType(this.__detectDataType(a)),this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer){a=a.replace(",",".");let e=Number(a);isNaN(e)?console.error("The entered text is not a number: "+a):(this.__checkMinMax(e)||(this.__setWarnColor(!1),null!=this.__attrHandler.minValue&&e<this.__attrHandler.minValue&&(e=this.__attrHandler.minValue),null!=this.__attrHandler.maxValue&&e>this.__attrHandler.maxValue&&(e=this.__attrHandler.maxValue)),e!=this.__attrHandler.value&&(i=e),this.__updateTextElements(e))}else a!=this.__attrHandler.value&&(i=a);if(null!=i){if(this.__setValueInternal(i),null!=this.__attrHandler.valueFeedback&&this.__attrHandler.value!=this.__attrHandler.valueFeedback){let e=()=>{this.__valueFeedbackReady&&this.__valueFeedbackReady(),null!=this.__attrHandler.valueFeedback&&this.__setValueInternal(this.__attrHandler.valueFeedback)};this.__valueFeedbackReady=this.busyHandler.setBusy("Waiting for ValueFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"})}null!=this.__attrHandler.value&&this.valueHandler.processChangedValue(this.__attrHandler.value),this.eventHandler.raise(n.InputBoxEvents.onUserInteractionFinished)}e.EventProvider.raise(e.BuildingAutomation.Components.InputBox.InputBoxEvents.onUserInteractionFinished,this)}__validateInput(e){let a=e.code,n=String(this.__input.val());if(null!=this.__attrHandler.unit&&n.indexOf(this.__attrHandler.unit)>-1&&n.replace(" "+this.__attrHandler.unit,""),t.Globals.Keyboard.isCodeMeta(a)||t.Globals.Keyboard.isCodeShift(a)||t.Globals.Keyboard.isCodeAlt(a)||a===t.Globals.Keyboard.Code.Tab||a===t.Globals.Keyboard.Code.CapsLock)return!0;if(this.__usedDataType!==t.DataType.number&&this.__usedDataType!==t.DataType.integer||!(t.Globals.Keyboard.isCodeNumber(a)||t.Globals.Keyboard.isCodeEnter(a)||t.Globals.Keyboard.isCodeArrow(a)||t.Globals.Keyboard.isCodeComma(a)||t.Globals.Keyboard.isCodeMinus(a)||a===t.Globals.Keyboard.Code.Backspace||a===t.Globals.Keyboard.Code.Delete||a===t.Globals.Keyboard.Code.NumpadComma||a===t.Globals.Keyboard.Code.Period)||e.getModifierState("CapsLock")||e.getModifierState("Shift")||e.getModifierState("Alt"))return this.__usedDataType===t.DataType.string||this.__usedDataType===t.DataType.unknown?(t.Globals.Keyboard.isCodeEnter(a)&&(e.preventDefault(),this.__endUserInteraction(),this.__input.trigger("blur")),!0):!(!e.getModifierState("Control")||e.getModifierState("Alt"))||(e.preventDefault(),!1);if(this.__usedDataType===t.DataType.integer&&(t.Globals.Keyboard.isCodeComma(a)||a===t.Globals.Keyboard.Code.Period))return e.preventDefault(),!1;if(null!=this.__attrHandler.digits&&this.__attrHandler.digits>-1&&this.__attrHandler.digits<=0&&(t.Globals.Keyboard.isCodeComma(a)||a===t.Globals.Keyboard.Code.Period))return e.preventDefault(),!1;if(t.Globals.Keyboard.isCodeComma(a)||a===t.Globals.Keyboard.Code.Period)for(let t=0;t<n.length;t++)if(","===n[t]||"."===n[t])return e.preventDefault(),!1;if(t.Globals.Keyboard.isCodeMinus(a))for(let t=0;t<n.length;t++)if("-"===n[t])return e.preventDefault(),!1;if(t.Globals.Keyboard.isCodeEnter(a)){if(e.preventDefault(),n=n.replace(",","."),!this.__checkMinMax(Number(n)))return!1;this.__endUserInteraction(),this.__input.trigger("blur")}return!0}__updateTextElements(e){null==e?(this.__input.val(""),this.textHandler.setText("")):this.__usedDataType!==t.DataType.number&&this.__usedDataType!==t.DataType.integer||"number"!=typeof e?(this.__input.val(e),this.textHandler.setText(e.toString())):(e=null!=this.__attrHandler.digits?e.toFixed(this.__attrHandler.digits):e.toFixed(0),this.__input.val(null!=this.__attrHandler.unit?e+" "+this.__attrHandler.unit:e),this.textHandler.setText(null!=this.__attrHandler.unit?e+" "+this.__attrHandler.unit:e.toString()))}__checkMinMax(e){return isNaN(e)?(console.error("The number to check is not a number: "+e),!1):null!=this.__attrHandler.minValue&&e<this.__attrHandler.minValue?(this.__element.attr("data-tooltip","Entered value is lower than minium value \nMinium value is: "+this.__attrHandler.minValue),this.__element.addClass("add-input-info"),this.__element.addClass("show-input-info"),setTimeout((()=>{this.__element.removeClass("show-input-info")}),3e3),this.__setValueInternal(this.__attrHandler.minValue),!1):!(null!=this.__attrHandler.maxValue&&e>this.__attrHandler.maxValue)||(this.__element.attr("data-tooltip","Entered value is higher than maximum value \nMaximum value is: "+this.__attrHandler.maxValue),this.__element.addClass("add-input-info"),this.__element.addClass("show-input-info"),setTimeout((()=>{this.__element.removeClass("show-input-info")}),3e3),this.__setValueInternal(this.__attrHandler.maxValue),!1)}__setWarnColor(e){if(e)null!=this.__oldBackgroundColor&&!0===this.__warnColorActive?this.backgroundStyler.setColor(this.__oldBackgroundColor):this.backgroundStyler.setColor(null),this.__warnColorActive=!1;else if(!1===this.__warnColorActive){if(this.__oldBackgroundColor=this.backgroundStyler.getColor(),null==this.__oldBackgroundColor)try{this.__oldBackgroundColor=t.Color.RGBAColor.fromCssString(this.__element.css("--tchmi-ba-background-styler-background-color"))}catch(e){this.__oldBackgroundColor=null}this.backgroundStyler.setColor(t.Color.RGBAColor.Red),this.__warnColorActive=!0,setTimeout((()=>{this.__setWarnColor(!0)}),1e3)}}__detectDataType(e){if("number"==typeof e)return Number.isInteger(e)?t.DataType.integer:t.DataType.number;if("string"==typeof e&&e.length>0){let a=Number(e);return isNaN(a)?t.DataType.string:this.__detectDataType(a)}return t.DataType.unknown}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.value&&this.setValue(e.value),e.valueFeedback&&this.setValueFeedback(e.valueFeedback),void 0!==e.dataType&&this.setDataType(e.dataType),void 0!==e.digits&&this.setDigits(e.digits),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.unit&&this.setUnit(e.unit),void 0!==e.baObject&&this.baObjectHandler.setBaObject(e.baObject),this}getAttributes(){return this.__attrHandler.getRef()}__setUsedDataType(e){return void 0===e?this:null!=e&&"number"!=typeof e?(this.__attrHandler.invalidAttribute("UsedDateType",e),this):e===this.__usedDataType?(this.__attrHandler.equalAttribute("UsedDataType"),this):(this.__usedDataType=e,this.__processUsedDataType(),this)}__processUsedDataType(){null==this.__usedDataType?this.__usedDataType=t.DataType.unknown:null!=this.__attrHandler.value&&(this.__usedDataType!==t.DataType.number&&this.__usedDataType!==t.DataType.integer||(isNaN(Number(this.__attrHandler.value))?this.__setValueInternal("0"):this.__setValueInternal(Number(this.__attrHandler.value)))),this.__updateTextElements(this.__attrHandler.value)}getUsedDataType(){return this.__usedDataType}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:["number","string"],skipEqualityCheck:!0})?e===this.__attrHandler.value||null!=e&&"number"==typeof e&&"number"==typeof this.__attrHandler.value&&null!=this.__attrHandler.digits&&e===Number(this.__attrHandler.value.toFixed(this.__attrHandler.digits))?(this.__attrHandler.equalAttribute("Value"),this):(null==this.__attrHandler.valueFeedback&&this.__setValueInternal(e),this):this}__setValueInternal(e){e!==this.__attrHandler.value&&(this.__attrHandler.value=e,this.__processValue(),this.eventHandler.raise(n.InputBoxEvents.onValueChanged))}__processValue(){if(null==this.__attrHandler.value)this.__setUsedDataType(null);else if(this.__usedDataType===t.DataType.unknown&&(null!=this.__attrHandler.dataType&&this.__attrHandler.dataType>t.DataType.unknown?this.__setUsedDataType(this.__attrHandler.dataType):this.__setUsedDataType(this.__detectDataType(this.__attrHandler.value))),(this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer)&&"number"!=typeof this.__attrHandler.value){let e=Number(this.__attrHandler.value);isNaN(e)?this.logger.warn("The value of text is not a number: "+this.__attrHandler.value):this.__attrHandler.value=e}this.__updateTextElements(this.__attrHandler.value)}getValue(){return this.__attrHandler.value}setValueFeedback(e){return this.__attrHandler.checkAttribute(e,"valueFeedback",{validator:["number","string"],skipEqualityCheck:!0})?e===this.__attrHandler.valueFeedback||null!=e&&"number"==typeof e&&"number"==typeof this.__attrHandler.valueFeedback&&null!=this.__attrHandler.digits&&e===Number(this.__attrHandler.valueFeedback.toFixed(this.__attrHandler.digits))?(this.__attrHandler.equalAttribute("ValueFeedback"),this):(this.__attrHandler.valueFeedback=e,null!=this.__attrHandler.valueFeedback?this.__processValueFeedback():this.__processValue(),this.__valueFeedbackReady&&this.__valueFeedbackReady(),this.eventHandler.raise(n.InputBoxEvents.onValueFeedbackChanged),this):this}__processValueFeedback(){if(null!=this.__attrHandler.valueFeedback&&(this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer)&&"number"!=typeof this.__attrHandler.valueFeedback){let e=Number(this.__attrHandler.valueFeedback);isNaN(e)?this.logger.warn("The value of text feedback is not a number: "+this.__attrHandler.valueFeedback):this.__attrHandler.valueFeedback=e}this.__setValueInternal(this.__attrHandler.valueFeedback)}getValueFeedback(){return this.__attrHandler.valueFeedback}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(this.__attrHandler.dataType=e,this.__processDataType(),this):this}__processDataType(){if(null==this.__attrHandler.dataType)this.__setUsedDataType(null);else if(this.__attrHandler.dataType===t.DataType.unknown&&null!==this.__attrHandler.value){let e=this.__detectDataType(this.__attrHandler.value);e>t.DataType.unknown&&this.__setUsedDataType(e)}else switch(this.__attrHandler.dataType){case t.DataType.number:case t.DataType.integer:this.__setUsedDataType(t.DataType.number),this.__attrHandler.dataType===t.DataType.integer&&this.setDigits(0);break;case t.DataType.string:this.__setUsedDataType(t.DataType.string);break;case t.DataType.unknown:this.__setUsedDataType(null);break;default:console.warn(`DataType of InputBox ${this.__id} is invalid!`)}this.__input.attr("data-tchmi-data-type",null!=this.__attrHandler.dataType?this.__attrHandler.dataType:t.DataType.string)}getDataType(){return this.__attrHandler.dataType}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,this.__processMinValue(),this):this}__processMinValue(){this.__attrHandler.minValue}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,this.__processMaxValue(),this):this}__processMaxValue(){this.__attrHandler.maxValue}getMaxValue(){return this.__attrHandler.maxValue}setUnit(a){if(!this.__attrHandler.checkAttribute(a,"unit",{validator:["string","number"]}))return this;if("number"==typeof a)if(t.Server.BaSite.Units.size>0)a=t.Helper.convertUnitToString(a),this.__attrHandler.unit=a,this.__processUnit();else{this.__attrHandler.unit=t.BA.Unit[a],this.__processUnit();let n=e.EventProvider.register("CustomBA.onUnitsLoaded",(()=>{this.__attrHandler.unit=t.Helper.convertUnitToString(a),this.__processUnit(),n()}))}else this.__attrHandler.unit=a,this.__processUnit();return this}__processUnit(){let e=String(this.__input.val());this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer?(null!==this.__oldUnit&&(e=e.replace(" "+this.__oldUnit,"")),null!=this.__attrHandler.unit&&(e=e+" "+this.__attrHandler.unit),this.__oldUnit=this.__attrHandler.unit,this.__input.val(e),this.textHandler.setText(e)):this.__oldUnit=this.__attrHandler.unit}getUnit(){return this.__attrHandler.unit}setDigits(e){return this.__attrHandler.checkAttribute(e,"digits",{validator:"number"})?(this.__attrHandler.dataType===t.DataType.integer&&0!==e&&(console.warn(`Data type of InputBox ${this.__id} is 'integer' and no digits are allowed! Processing with 0 digits!`),e=0),this.__attrHandler.digits=e,this.__updateTextElements(this.__attrHandler.value),this):this}getDigits(){return this.__attrHandler.digits}__processReadOnly(){super.__processReadOnly(),null==this.__attrHandler.readOnly||!0===this.__attrHandler.readOnly?(this.__element.removeClass("editable"),this.__element.append(this.textHandler.getTextElement()),this.__input.detach()):(this.__element.addClass("editable"),this.__element.append(this.__input),this.textHandler.getTextElement().detach())}processBaObject(){if(this.setValue(null),this.setValueFeedback(null),this.setDataType(null),this.valueHandler.setBaVariable(null),null!=this.baObjectHandler.baObject)if(null==this.baObjectHandler.baVariable){if(this.baObjectHandler.baObject.DataType!==t.DataType.number)return;this.setDataType(t.DataType.number),this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(e=>{this.setValueFeedback(e)})),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eOutputUnit)?this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eOutputUnit,(e=>{this.setUnit(e)})):this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,(e=>{this.setUnit(e)})),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess())}else this.valueHandler.setBaVariable(this.baObjectHandler.baVariable)}}a.InputBox=n,function(e){let t;!function(e){e.onFocusIn="onFocusIn",e.onFocusOut="onFocusOut",e.onUserInteractionFinished="onUserInteractionFinished",e.onValueChanged="onValueChanged",e.onValueFeedbackChanged="onValueFeedbackChanged"}(t=e.InputBoxEvents||(e.InputBoxEvents={}))}(n=a.InputBox||(a.InputBox={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.Base{constructor(i,r){super(i,r),this.__categories=new Map,this.__entries=[],this.__entryCounter=0,this.__icons=[],this.__iconsCustom=[],this.__iconsGlobal=[],this.__element.addClass("legend"),this.__tabWindow=new a.TabWindow(this.__id+"-tab-window",this).setAttributes({tabSizeAuto:!0}),this.__contentWindow=new a.ContentWindow(this.__id+"-content-window",this).setAttributes({headline:{textAttributes:{text:t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Legend)}}}),this.__constructLegend(),this.__updateLegend(),this.__destroyOnIconsChanged=e.EventProvider.register(s.onIconsChanged,(()=>{this.__updateLegend()}));let o=new e.Symbol("%i%"+a.Legend.IconsCustomSymbolName+"%/i%");this.__destroyIconsCustomGlobal=o.watch((e=>{0===e.error&&null!=e.value&&e.value.length>0&&this.__resolveIconPaths(e.value,(e=>{this.__iconsGlobal=e,this.__updateLegend()}))})),this.setVisibilityHeadline(!1),this.setTabPosition(t.Position.left),this.setEntryWidth(172,"px"),this.setIconSource(n.IconSource.All),this.setIconsCustom([])}__attach(){this.__isAttached||(super.__attach(),this.__processEntryWidth())}__detach(){this.__isAttached&&super.__detach()}destroy(){null!=this.__entries&&(this.__entries.forEach((e=>{e.icon.destroy(),e.label.destroy()})),this.__entries.length=0),null!=this.__categories&&(this.__categories.forEach((e=>{e.content.detach(),e.tab.destroy()})),this.__categories.clear()),null!=this.__icons&&(this.__icons.length=0),null!=this.__iconsCustom&&(this.__iconsCustom.length=0),null!=this.__tabWindow&&this.__tabWindow.destroy(),null!=this.__contentWindow&&this.__contentWindow.destroy(),null!=this.__destroyOnIconsChanged&&this.__destroyOnIconsChanged(),null!=this.__destroyObjectResolver&&this.__destroyObjectResolver(),null!=this.__destroyIconsCustomGlobal&&this.__destroyIconsCustomGlobal(),super.destroy()}__constructLegend(){this.__element.empty(),this.__tabWindow.setTabPosition(this.__attrHandler.tabPosition),this.__attrHandler.visibilityHeadline?(this.__contentWindow.setAttributes({content:this.__tabWindow.getElement()}),this.__element.append(this.__contentWindow.getElement())):this.__element.append(this.__tabWindow.getElement())}__getCategories(e){let t,a;if(0===e.length)return[];t=[];for(let e=0;e<this.__icons.length;e++)a=this.__icons[e].iconCategory,t.includes(a)||t.push(a);return t}__createEntry(e){let t,n=new a.Icon(this.__tabWindow.getId()+"-icon-"+this.__entryCounter,this).setAttributes({iconHeight:100,iconHeightUnit:"%",iconWidth:100,iconWidthUnit:"%",cssClass:"icon"});return n.iconHandler.setAttributes(e),t={icon:n,label:new a.Textblock(this.__tabWindow.getId()+"-label"+this.__entryCounter,this).setAttributes({textAttributes:{horizontalAlignment:"Left",text:e.iconDescription,wordWrap:!0},cssClass:"label"})},this.__entryCounter++,t}__resolveIconPaths(a,n){let i,s=[];for(let e=0;e<a.length;e++){let t={iconPath:a[e].iconPath};for(const n in a[e])"iconCategory"!==n&&"iconDescription"!==n&&(t[n]=a[e][n]);s.push(t)}null!=this.__destroyObjectResolver&&this.__destroyObjectResolver(),i=new e.Symbol.ObjectResolver(s),this.__destroyObjectResolver=i.watch((s=>{if(!this.logger.checkServerResult(t.Logger.Severity.warn,s))throw new Error("__resolveIconPaths(): Could not resolve icon paths!");if(null!=s.value)for(let n=0;n<a.length;n++){const i=s.value[n],r=a[n];for(const a in s.value[n])switch(a){case"iconRotationDirection":r[a]=e.ValueConverter.toNumber(i[a]);break;case"iconOverlays":const n=i[a];if(null!=n&&null!=r.iconOverlays)for(let a=0;a<n.length;a++){const i=n[a];r.iconOverlays[a]={...i,backgroundColor:t.Color.RGBAColor.fromSolidColor(i.backgroundColor),iconRotationDirection:e.ValueConverter.toNumber(i.iconRotationDirection),iconColor:t.Color.RGBAColor.fromSolidColor(i.iconColor)}}break;case"backgroundColor":case"iconColor":r[a]=t.Color.RGBAColor.fromSolidColor(i[a]);default:r[a]=i[a]}}null!=i&&i.destroy(),n(a)}))}__updateIcons(){let e=!1,t=!1,a=!1;switch(this.__icons.length=0,this.__attrHandler.iconSource){case n.IconSource.All:e=!0,a=!0,t=!0;break;case n.IconSource.OnlyBa:e=!0;break;case n.IconSource.OnlyCustom:a=!0;break;case n.IconSource.OnlyCustomGlobal:t=!0;break;case n.IconSource.BaAndCustom:e=!0,a=!0;break;case n.IconSource.BaAndCustomGlobal:e=!0,t=!0;break;case n.IconSource.CustomAndCustomGlobal:a=!0,t=!0}e&&(this.__icons=this.__icons.concat(i.getIcons())),a&&(this.__icons=this.__icons.concat(...this.__iconsCustom)),t&&(this.__icons=this.__icons.concat(...this.__iconsGlobal))}__updateTabCollection(){let e,t,a,n;if(null!=this.__tabWindow&&this.__tabWindow.removeAllTabs(),null!=this.__categories&&(this.__categories.forEach((e=>{e.content.detach()})),this.__categories.clear()),0!==this.__icons.length){e=this.__getCategories(this.__icons);for(let i=0;i<e.length;i++)a=this.__tabWindow.addTab(this.__tabWindow.getId()+"-tab-"+i),null!=a&&(t=e[i],a.text=t,n=$("<div>").addClass("entries"),null==this.__categories.get(t)&&(a.setContent(n),this.__categories.set(t,{tab:a,content:n})))}}__updateTabContent(){let e,t,a;if(null!=this.__entries&&(this.__entries.forEach((e=>{e.icon.destroy(),e.label.destroy()})),this.__entries.length=0),0!==this.__icons.length)for(let n=0;n<this.__icons.length;n++)e=this.__categories.get(this.__icons[n].iconCategory),null!=e?(t=this.__createEntry(this.__icons[n]),this.__entries.push(t),a=$("<div>").addClass("entry"),a.append(t.icon.getElement(),t.label.getElement()),e.content.append(a)):this.logger.warn("No matching category for '"+this.__icons[n].iconCategory+"' found! Entry was skipped.")}__updateLegend(){this.__updateIcons(),this.__updateTabCollection(),this.__updateTabContent()}setAttributes(e){return super.setAttributes(e),null!=e.visibilityHeadline&&this.setVisibilityHeadline(e.visibilityHeadline),null!=e.tabPosition&&this.setTabPosition(e.tabPosition),null!=e.entryWidth&&(this.__attrHandler.entryWidth=e.entryWidth),null!=e.entryWidthUnit&&(this.__attrHandler.entryWidthUnit=e.entryWidthUnit),null!=e.iconSource&&this.setIconSource(e.iconSource),null!=e.iconsCustom&&this.setIconsCustom(e.iconsCustom),this.setEntryWidth(this.__attrHandler.entryWidth,this.__attrHandler.entryWidthUnit),this}getAttributes(){return this.__attrHandler.getRef()}setVisibilityHeadline(e){return this.__attrHandler.checkAttribute(e,"visibilityHeadline",{validator:"boolean"})?(this.__attrHandler.visibilityHeadline=e,this.__processVisibilityHeadline(),this):this}__processVisibilityHeadline(){this.__constructLegend()}getVisibilityHeadline(){return this.__attrHandler.visibilityHeadline}setTabPosition(e){return this.__attrHandler.checkAttribute(e,"tabPosition",{validator:()=>null!=e&&e>=t.Position.left&&e<=t.Position.bottom})?(this.__attrHandler.tabPosition=e,this.__processTabPosition(),this):this}__processTabPosition(){this.__constructLegend()}getTabPosition(){return this.__attrHandler.tabPosition}setEntryWidth(e,t){return t=t||this.__attrHandler.entryWidthUnit,a.LayoutHandler.dimensionSetter(this.__attrHandler,"entryWidth",e,t)?(this.__processEntryWidth(),this):this}__processEntryWidth(){null!=this.__attrHandler.entryWidth&&null!=this.__attrHandler.entryWidthUnit&&null!=this.__tabWindow&&this.__tabWindow.getIsAttached()&&this.__tabWindow.getElement().css("--ba-js-width-entry",this.__attrHandler.entryWidth+this.__attrHandler.entryWidthUnit)}getEntryWidth(){return this.__attrHandler.entryWidth}getEntryWidthUnit(){return this.__attrHandler.entryWidthUnit}setIconSource(e){return this.__attrHandler.checkAttribute(e,"iconSource",{validator:"number"})?(null!=e&&this.__attrHandler.iconSource!==e&&(this.__attrHandler.iconSource=e,this.__processIconSource()),this):this}__processIconSource(){this.__updateLegend()}getIconSource(){return this.__attrHandler.iconSource}setIconsCustom(e){return this.__attrHandler.checkAttribute(e,"iconsCustom",{validator:()=>e instanceof Array})?(null==e||(this.__iconsCustom=e,this.__resolveIconPaths(this.__iconsCustom,(e=>{this.__iconsCustom=e,this.__updateLegend()}))),this):this}__processIconsCustom(){this.__updateLegend()}getIconsCustom(){return this.__iconsCustom}}a.Legend=n,function(e){let t;!function(e){e[e.All=0]="All",e[e.OnlyBa=1]="OnlyBa",e[e.OnlyCustom=2]="OnlyCustom",e[e.OnlyCustomGlobal=3]="OnlyCustomGlobal",e[e.BaAndCustom=4]="BaAndCustom",e[e.BaAndCustomGlobal=5]="BaAndCustomGlobal",e[e.CustomAndCustomGlobal=6]="CustomAndCustomGlobal"}(t=e.IconSource||(e.IconSource={})),e.IconsCustomSymbolName="BaLegendIconList"}(n=a.Legend||(a.Legend={}));a.LegendIconHandler=class{constructor(e){this.__icon=e||null}set icon(e){if(e instanceof Array){if(this.__icon instanceof Array&&t.Helper.Array.equals(e,this.__icon))return}else if(tchmi_equal(e,this.__icon))return;this.__icon=e,null!=this.__destroyIconWatch&&(this.hide(),this.show())}get icon(){return this.__icon}show(){if(null!=this.__icon){if(null==this.__destroyIconWatch)if(this.__icon instanceof Array)this.__destroyIconWatch=i.watchIcons(this.__icon);else{if(""===this.__icon.iconPath)return;this.__destroyIconWatch=i.watchIcon(this.__icon)}}else t.Logger.warn("No icon(s) set. Legend will not be updated.")}hide(){null!=this.__destroyIconWatch&&(this.__destroyIconWatch(),delete this.__destroyIconWatch)}destroy(){this.hide()}};class i{static __watchIcon(e){if(null==e.iconPath||""===e.iconPath)return"";let t,a=this.createKeyFromIconAttributes(e);return""===a?(console.log("LegendManager - watchIcon(): Could not create key for icon: ",e),a):(t=this.__iconCounts.get(a),null!=t?this.__iconCounts.set(a,++t):(this.__iconCounts.set(a,1),this.__icons.set(a,e),this.__hasIconsChanged=!0),a)}static __unwatchIcon(e){this.__decreaseIconCounter(e),this.__processIconsChange()}static __unwatchIcons(e){for(let t=0;t<e.length;t++)this.__decreaseIconCounter(e[t]);this.__processIconsChange()}static __decreaseIconCounter(e){let t=this.__iconCounts.get(e);null!=t&&(t--,t<=0?(this.__iconCounts.delete(e),this.__icons.delete(e),this.__hasIconsChanged=!0):this.__iconCounts.set(e,t))}static __processIconsChange(){this.__waitIconsChanged||this.__hasIconsChanged&&(this.__waitIconsChanged=!0,setTimeout((()=>{e.EventProvider.raise(s.onIconsChanged),this.__waitIconsChanged=!1,this.__hasIconsChanged=!1}),200))}static watchIcon(e){let t=this.__watchIcon(e);return this.__processIconsChange(),()=>{""!==t&&this.__unwatchIcon(t)}}static watchIcons(e){let t,a=[];for(let n=0;n<e.length;n++)t=this.__watchIcon(e[n]),""!==t&&a.push(t);return this.__processIconsChange(),()=>{this.__unwatchIcons(a)}}static getIcons(){return Array.from(this.__icons.values())}static createKeyFromIconAttributes(e){let t=e.iconPath+e.iconCategory+e.iconDescription;if(null!=e.iconOverlays&&e.iconOverlays.length>0){let a="",n=[];for(let t=0;t<e.iconOverlays.length;t++)n=e.iconOverlays[t].iconPath.split("/"),a+=n[n.length-1];t+=a}return t=t.replace(/\s/g,"").toLowerCase(),t}}let s;i.__icons=new Map,i.__iconCounts=new Map,i.__hasIconsChanged=!1,i.__waitIconsChanged=!1,function(e){e.onIconsChanged="onLegendManagerIconsChanged"}(s||(s={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.ValueField{constructor(a,n){super(a,n),this.resizeHandler=new t.ResizeHandler(this),this.baObjectHandler=new e.BaObjectHandler(this),this.__element.addClass("manual-override"),this.__manualModeButton=new t.ToggleButton(this.__id+"-manual-mode-button",this).setAttributes({iconPath:e.Icons.Standard.Hand.path,cssClass:"manual-mode-button"}),this.__element.append(this.__manualModeButton.getElement()),this.__baObjectIsEditable=!0,this.setManualEnable(!1)}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(this.__manualModeButton.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,(()=>this.__onManualModeToggled()))),this.__destroyersToCallOnDetach.push(this.eventHandler.register(t.ValueField.ValueFieldEvents.onUserInteractionFinished,(()=>this.__onUserInteractionFinished()))),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__manualModeButton.destroy(),super.destroy()}onResized(){this.__isAttached&&this.__element.css("--tchmi-ba-manual-override-height",this.__element.outerHeight()+"px")}__onManualModeToggled(){let t=this.__manualModeButton.getToggleState();if(null!=this.baObjectHandler.baObject){switch(this.baObjectHandler.baObject.Purpose){case e.BA.ObjectPurpose.eInput:this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.eOutOfService,t,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)}));break;case e.BA.ObjectPurpose.eValue:case e.BA.ObjectPurpose.eOutput:this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.eEnManualRm,t,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)&&this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.eValManualRm,this.__attrHandler.autoValue,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)}))}));break;case e.BA.ObjectPurpose.eOperation:throw new e.BaseError("This code part should not be reachable!");default:throw new e.BaseError("Not handled ObjectPurpose!")}this.__enableManualReady=this.busyHandler.setBusy("Waiting for feedback of eOutOfService/eEnManualRm",{cbOnTimeout:()=>{null!=this.__enableManualReady&&this.__enableManualReady(),this.__manualModeButton.setToggleState(!t)}})}else this.setManualEnable(t);this.eventHandler.raise(a.ManulOverrideEvents.onManualEnableToggled)}__onUserInteractionFinished(){const t=this.getValue();if(null!=this.baObjectHandler.baObject)switch(this.baObjectHandler.baObject?.Purpose){case e.BA.ObjectPurpose.eInput:break;case e.BA.ObjectPurpose.eValue:case e.BA.ObjectPurpose.eOutput:this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.eValManualRm,t,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)}));break;case e.BA.ObjectPurpose.eOperation:this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.ePresentValue,t,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)}))}else this.setManualValue(t);this.eventHandler.raise(a.ManulOverrideEvents.onManualValueChanged)}__onDataTypeChanged(){super.__onDataTypeChanged(),this.__processManualEnable()}processBaObject(){if(this.baObjectHandler.baObject){switch(this.__baObjectIsEditable=this.baObjectHandler.baObject.checkManualValueWriteAccess(),this.baObjectHandler.baObject.DataType){case e.DataType.boolean:this.setDataType(e.DataType.boolean),this.baObjectHandler.watchValueRange(e.BA.BaParameterId.ePresentValue,(e=>{this.setInactiveText(e?.get(0)),this.setActiveText(e?.get(1))}),!0);break;case e.DataType.number:this.setDataType(e.DataType.number),this.baObjectHandler.baObject.tryGetBaVariable(e.BA.BaParameterId.eOutputUnit)?this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eOutputUnit,(e=>{this.setUnit(e)})):this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eUnit,(e=>{this.setUnit(e)}));break;case e.DataType.enum:this.setDataType(e.DataType.enum),this.baObjectHandler.watchValueRange(e.BA.BaParameterId.ePresentValue,(e=>{this.setStateTexts(t.Combobox.toComboboxItemArray(e))}),!0)}switch(this.baObjectHandler.baObject.Purpose){case e.BA.ObjectPurpose.eInput:this.__baObjectIsEditable=!1,this.__manualModeButton.setVisibility(e.Visibility.Hidden),this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eOutOfService,(e=>{this.setManualEnable(e)})),this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{this.setAutoValue(e)}));break;case e.BA.ObjectPurpose.eValue:case e.BA.ObjectPurpose.eOutput:this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eEnManualRm,(e=>{this.setManualEnable(e)})),this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eValManualRm,(e=>{this.setManualValue(e)})),this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{this.setAutoValue(e)})),this.__manualModeButton.setVisibility(this.baObjectHandler.baObject.checkManualValueWriteAccess()?e.Visibility.Visible:e.Visibility.Hidden);break;case e.BA.ObjectPurpose.eOperation:this.setManualEnable(!0),this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{this.setAutoValue(e)})),this.__manualModeButton.setVisibility(e.Visibility.Hidden);break;default:this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{this.setAutoValue(e)})),this.__manualModeButton.setVisibility(e.Visibility.Hidden)}if(this.baObjectHandler.baObject.OperationType===e.BA.OperationType.eDisplayValue)this.__baObjectIsEditable=!1}}setAttributes(e){return super.setAttributes(e),void 0!==e.manualEnable&&this.setManualEnable(e.manualEnable),void 0!==e.manualValue&&this.setManualValue(e.manualValue),void 0!==e.manualValueFeedback&&this.setManualValueFeedback(e.manualValueFeedback),void 0!==e.autoValue&&this.setAutoValue(e.autoValue),void 0!==e.dataType&&this.setDataType(e.dataType),void 0!==e.activeText&&this.setActiveText(e.activeText),void 0!==e.inactiveText&&this.setInactiveText(e.inactiveText),void 0!==e.unit&&this.setUnit(e.unit),void 0!==e.stateTexts&&this.setStateTexts(e.stateTexts),this}getAttributes(){return this.__attrHandler.getRef()}setManualEnable(e){return this.__attrHandler.checkAttribute(e,"manualEnable",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.manualEnable=e,this.__processManualEnable(),this):this}__processManualEnable(){null!=this.__attrHandler.manualEnable&&(null!=this.__enableManualReady&&this.__enableManualReady(),1==this.__baObjectIsEditable?this.__valueField?.setReadOnly(!this.__attrHandler.manualEnable):this.__valueField?.setReadOnly(!0),this.__manualModeButton.setToggleState(this.__attrHandler.manualEnable))}getManualEnable(){return this.__attrHandler.manualEnable}setManualValue(e){return this.__attrHandler.checkAttribute(e,"manualValue",{validator:["boolean","number"]})?(this.__attrHandler.manualValue=e,this.__processManualValue(),this):this}__processManualValue(){null!=this.__attrHandler.manualValue&&this.setValue(this.__attrHandler.manualValue)}getManualValue(){return this.__attrHandler.manualValue}setManualValueFeedback(e){return this.__attrHandler.checkAttribute(e,"manualValueFeedback",{validator:["boolean","number"]})?(this.__attrHandler.manualValueFeedback=e,this.__processManualValueFeedback(),this):this}__processManualValueFeedback(){null!=this.__attrHandler.manualValueFeedback&&this.setValueFeedback(this.__attrHandler.manualValueFeedback)}getManualValueFeedback(){return this.__attrHandler.manualValueFeedback}setAutoValue(e){return this.__attrHandler.checkAttribute(e,"autoValue",{validator:["boolean","number"]})?(this.__attrHandler.autoValue=e,this.__processAutoValue(),this):this}__processAutoValue(){null!=this.__attrHandler.autoValue&&this.setValueFeedback(this.__attrHandler.autoValue)}getAutoValue(){return this.__attrHandler.autoValue}__processReadOnly(){super.__processReadOnly(),this.__manualModeButton.setReadOnly(this.__attrHandler.readOnly),0!=this.__attrHandler.manualEnable&&this.__valueField?.setReadOnly(this.__attrHandler.readOnly)}}t.ManualOverride=a,function(e){let t;!function(e){e.onManualEnableToggled="onManualOverrideManualEnableToggled",e.onManualValueChanged="onManualOverrideManualValueChanged"}(t=e.ManulOverrideEvents||(e.ManulOverrideEvents={}))}(a=t.ManualOverride||(t.ManualOverride={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(n,i){switch(super(n,i),this.__isPressed=!1,this.__displayAutoButton=!0,this.__curState=a.State.auto,this.baObjectHandler=new e.BaObjectHandler(this),this.__element.addClass("manual-override-binary"),this.__autoButton=new t.ToggleButton(this.__id+"-auto-position",this).setAttributes({cssClass:"state-button auto"}),this.__offButton=new t.ToggleButton(this.__id+"-off-position",this).setAttributes({cssClass:"state-button off"}),this.__onButton=new t.ToggleButton(this.__id+"-on-position",this).setAttributes({cssClass:"state-button on"}),a.DefaultAppearance){case a.Appearance.icons:this.__autoButton.iconHandler.setIcon(e.Icons.RoomAutomation.Automatic.path,!0),this.__offButton.iconHandler.setIcon(e.Icons.Standard.OnOff.path,!0),this.__onButton.iconHandler.setIcon(e.Icons.Standard.OnOff.path,!0);break;case a.Appearance.texts:this.__autoButton.textHandler.setText("Auto"),this.__offButton.textHandler.setText("Off"),this.__onButton.textHandler.setText("On");break;case a.Appearance.mixed:this.__autoButton.iconHandler.setIcon(e.Icons.RoomAutomation.Automatic.path,!0),this.__offButton.textHandler.setText("Off"),this.__onButton.textHandler.setText("On");break;default:throw new Error("Invalid DefaultAppearance!")}this.__curStateDisplay=$("<div>").addClass("current-state-display"),this.__element.append([this.__curStateDisplay,this.__autoButton.getElement(),this.__offButton.getElement(),this.__onButton.getElement()]),null==this.__attrHandler.manualEnable&&this.setManualEnable(!1),null==this.__attrHandler.manualValue&&this.setManualValue(!1),null==this.__attrHandler.autoValue&&this.setAutoValue(!1)}__attach(){this.__isAttached||(0!=this.checkAccess(e.Server.AccessRight.operate)&&(this.__destroyersToCallOnDetach.push(this.__autoButton.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,(()=>{this.setManualEnable(!1),this.eventHandler.raise(a.ManulOverrideBinaryEvents.onStateSelected)}))),this.__destroyersToCallOnDetach.push(this.__offButton.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,(()=>{this.setManualEnable(!0),this.setManualValue(!1),this.eventHandler.raise(a.ManulOverrideBinaryEvents.onStateSelected)}))),this.__destroyersToCallOnDetach.push(this.__onButton.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,(()=>{this.setManualEnable(!0),this.setManualValue(!0),this.eventHandler.raise(a.ManulOverrideBinaryEvents.onStateSelected)}))),this.__destroyersToCallOnDetach.push(this.eventHandler.register(a.ManulOverrideBinaryEvents.onStateSelected,(()=>this.__onStateSelected())))),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__autoButton.destroy(),this.__offButton.destroy(),this.__onButton.destroy(),super.destroy()}__onStateSelected(){switch(this.__curState){case a.State.auto:if(null!=this.baObjectHandler.baObject)switch(this.baObjectHandler.baObject?.Purpose){case e.BA.ObjectPurpose.eInput:throw new Error("This code part should not be reachable!");case e.BA.ObjectPurpose.eValue:case e.BA.ObjectPurpose.eOutput:let t=this.busyHandler.setBusy("Waiting for feedback of eEnManualRm",{cbOnTimeout:()=>{t(),this.setManualEnable(!0)}});this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.eEnManualRm,!1,(a=>{if(this.logger.checkServerResult(e.Logger.Severity.warn,a)){let a=this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eEnManualRm,(e=>{setTimeout((()=>{0==e&&(this.baObjectHandler.baObject?.stopWatchBaVariable(a),t())}),100)}))}}));break;case e.BA.ObjectPurpose.eOperation:throw new Error("This code part should not be reachable!");default:throw new Error("Not handled ObjectPurpose!")}break;case a.State.manualOff:case a.State.manualOn:let t=this.__curState===a.State.manualOn;if(null!=this.baObjectHandler.baObject)switch(this.baObjectHandler.baObject?.Purpose){case e.BA.ObjectPurpose.eInput:throw new Error("This code part should not be reachable!");case e.BA.ObjectPurpose.eValue:case e.BA.ObjectPurpose.eOutput:let a=this.busyHandler.setBusy("Waiting for feedback of eEnManualRm",{cbOnTimeout:()=>{a(),this.setManualEnable(!1)}});this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.eEnManualRm,!0,(n=>{if(this.logger.checkServerResult(e.Logger.Severity.warn,n)){let n=this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eEnManualRm,(e=>{setTimeout((()=>{1==e&&(this.baObjectHandler.baObject?.stopWatchBaVariable(n),a())}),100)})),i=this.busyHandler.setBusy("Waiting for feedback of eValManualRm",{cbOnTimeout:()=>{i(),this.setManualValue(!t)}});this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.eValManualRm,t,(a=>{if(this.logger.checkServerResult(e.Logger.Severity.warn,a)){let a=this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eValManualRm,(e=>{setTimeout((()=>{e==t&&(this.baObjectHandler.baObject?.stopWatchBaVariable(a),i())}),100)}))}}))}}));break;case e.BA.ObjectPurpose.eOperation:let n=this.busyHandler.setBusy("Waiting for feedback of ePresentValue",{cbOnTimeout:()=>{n(),this.setManualValue(!t)}});this.baObjectHandler.baObject.tryWriteBaVariableValue(e.BA.BaParameterId.ePresentValue,t,(a=>{if(this.logger.checkServerResult(e.Logger.Severity.warn,a)){let a=this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{setTimeout((()=>{e==t&&(this.baObjectHandler.baObject?.stopWatchBaVariable(a),n())}),100)}))}}))}break;default:throw new Error("Invalid current state!")}}__updateElements(){null!=this.__attrHandler.manualEnable&&null!=this.__attrHandler.manualValue&&null!=this.__attrHandler.autoValue&&(0==this.__displayAutoButton&&this.__autoButton.getElement().detach(),this.__autoButton.setToggleState(!1),this.__onButton.setToggleState(!1),this.__offButton.setToggleState(!1),this.__attrHandler.manualEnable?(this.__autoButton.setReadOnly(!1),this.__attrHandler.manualValue?(this.__onButton.setToggleState(!0),this.__onButton.setReadOnly(!0),this.__offButton.setReadOnly(!1),this.__curState=a.State.manualOn):(this.__offButton.setToggleState(!0),this.__offButton.setReadOnly(!0),this.__onButton.setReadOnly(!1),this.__curState=a.State.manualOff)):(this.__autoButton.setToggleState(!0),this.__autoButton.setReadOnly(!0),this.__onButton.setReadOnly(!1),this.__offButton.setReadOnly(!1),this.__curState=a.State.auto),this.__attrHandler.autoValue?this.__curStateDisplay.addClass("active"):this.__curStateDisplay.removeClass("active"))}processBaObject(){if(this.baObjectHandler.baObject&&this.baObjectHandler.baObject.DataType===e.DataType.boolean){switch(this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{this.setAutoValue(e)})),this.baObjectHandler.baObject.Purpose){case e.BA.ObjectPurpose.eInput:this.__displayAutoButton=!1,this.__updateElements();break;case e.BA.ObjectPurpose.eValue:case e.BA.ObjectPurpose.eOutput:this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eEnManualRm,(e=>{this.setManualEnable(e)})),this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.eValManualRm,(e=>{this.setManualValue(e)}));break;case e.BA.ObjectPurpose.eOperation:this.__displayAutoButton=!1,this.setManualEnable(!0),this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,(e=>{this.setManualValue(e)})),this.__updateElements();break;default:throw new Error("Not handled ObjectPurpose!")}this.setIsEnabled(this.baObjectHandler.baObject.checkManualValueWriteAccess())}}getCurrentState(){return this.__curState}setAttributes(e){return super.setAttributes(e),void 0!==e.manualEnable&&this.setManualEnable(e.manualEnable),void 0!==e.manualValue&&this.setManualValue(e.manualValue),void 0!==e.autoValue&&this.setAutoValue(e.autoValue),this}getAttributes(){return this.__attrHandler.getRef()}setManualEnable(e){return this.__attrHandler.checkAttribute(e,"manualEnable",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.manualEnable=e,this.__processManualEnable(),this):this}__processManualEnable(){null!=this.__attrHandler.manualEnable&&this.__updateElements()}getManualEnable(){return this.__attrHandler.manualEnable}setManualValue(e){return this.__attrHandler.checkAttribute(e,"manualValue",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.manualValue=e,this.__processManualValue(),this):this}__processManualValue(){null!=this.__attrHandler.manualValue&&this.__updateElements()}getManualValue(){return this.__attrHandler.manualValue}setAutoValue(e){return this.__attrHandler.checkAttribute(e,"autoValue",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.autoValue=e,this.__processAutoValue(),this):this}__processAutoValue(){null!=this.__attrHandler.autoValue&&this.__updateElements()}getAutoValue(){return this.__attrHandler.autoValue}__processReadOnly(){super.__processReadOnly(),this.setIsEnabled(!this.__attrHandler.readOnly)}}t.ManualOverrideBinary=a,function(e){let t,a,n;!function(e){e.onPressed="onManualOverrideBinaryPressed",e.onStateSelected="onManualOverrideBinaryStateSelected"}(t=e.ManulOverrideBinaryEvents||(e.ManulOverrideBinaryEvents={})),function(e){e[e.auto=0]="auto",e[e.manualOn=1]="manualOn",e[e.manualOff=2]="manualOff"}(a=e.State||(e.State={})),function(e){e[e.texts=0]="texts",e[e.icons=1]="icons",e[e.mixed=2]="mixed"}(n=e.Appearance||(e.Appearance={})),e.DefaultAppearance=n.mixed}(a=t.ManualOverrideBinary||(t.ManualOverrideBinary={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(e){class t extends e.TextControl{constructor(e,a){super(e,a),this.__radioButton=$("<input type='radio'></input>"),this.__stateChangedHandler=e=>{e.stopPropagation(),this.eventHandler.raise(t.RadioButtonEvents.onSelected)},this.__labelPressedHandler=e=>this.__onLabelPressed(e),this.__element.addClass("radio-button"),this.__element.append(this.__radioButton)}__attach(){if(this.__isAttached)return;this.__radioButton.trigger("change",this.__stateChangedHandler);let e=this.__element.find("label");e[0]&&e.on("click",this.__labelPressedHandler),super.__attach()}__detach(){if(!this.__isAttached)return;let e=this.__element.find("label");e[0]&&e.off("click",this.__labelPressedHandler),super.__detach()}destroy(){super.destroy()}onTextChanged(e){super.onTextChanged(e);let t=this.__element.find("label");null==e?null!=t[0]&&(t.text(""),t.detach()):(t[0]||(t=$(`<label for=${this.__id}></label>`).addClass("text-element"),this.__element.append(t),this.__isAttached&&t.on("click",this.__labelPressedHandler)),t.text(e))}__onLabelPressed(e){if(e.stopPropagation(),!this.__attrHandler.readOnly)if("click"===e.type)this.setRadioState(!0);else if("touchstart"===e.type){let e=this.__element.find("label");if(e[0]){let t=a=>{this.setRadioState(!0),e.off("touchend",t)};e.on("touchend",t)}}}setAttributes(e){return super.setAttributes(e),void 0!==e.radioGroup&&this.setRadioGroup(e.radioGroup),void 0!==e.checkmarkColor&&this.setCheckmarkColor(e.checkmarkColor),this}getAttributes(){return this.__attrHandler.getRef()}setRadioState(e){return void 0===e?this:null!=e&&"boolean"!=typeof e?(this.__attrHandler.invalidAttribute("RadioState",e),this):(this.__radioButton.prop("checked",e),this)}getRadioState(){return this.__radioButton.prop("checked")}setRadioGroup(e){return this.__attrHandler.checkAttribute(e,"radioGroup",{validator:"string"})?(this.__attrHandler.radioGroup=e,this.__processRadioGroup(),this):this}__processRadioGroup(){null==this.__attrHandler.radioGroup?this.__radioButton.removeProp("name"):this.__radioButton.prop("name",this.__attrHandler.radioGroup)}getRadioGroup(){return this.__attrHandler.radioGroup}setCheckmarkColor(e){return this.__attrHandler.checkColorAttribute(e,"checkmarkColor")?(this.__attrHandler.checkmarkColor=e,this.__processCheckmarkColor(),this):this}__processCheckmarkColor(){null==this.__attrHandler.checkmarkColor?this.__element.css("--tchmi-ba-checkbox-checkmark-color",""):this.__element.css("--tchmi-ba-checkbox-checkmark-color",this.__attrHandler.checkmarkColor.toString())}getCheckmarkColor(){return this.__attrHandler.checkmarkColor}__processReadOnly(){super.__processReadOnly();let e=this.__element.find("label");null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?(this.__radioButton.removeAttr("disabled"),this.setIsEnabled(!0),this.__isAttached&&e[0]&&e.on("click",this.__labelPressedHandler)):(this.__radioButton.attr("disabled","disabled"),this.setIsEnabled(!1),e[0]&&e.off("click",this.__labelPressedHandler))}}e.RadioButton=t,function(e){let t;!function(e){e.onSelected="onSelected"}(t=e.RadioButtonEvents||(e.RadioButtonEvents={}))}(t=e.RadioButton||(e.RadioButton={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.TextControl{constructor(e,n){super(e,n),this.baObjectHandler=new t.BaObjectHandler(this),this.resizeHandler=new a.ResizeHandler(this),this.valueHandler=new t.System.ValueHandler(this),this.__digits=0,this.__valueFeedbackReady=[],this.__input=$('<input type="range" max="100" min="0"/>'),this.__curValueDisplay=$("<div>").addClass("text-element limit-display current-value-display"),this.__unitDisplay=$("<div>").addClass("text-element limit-display unit-display"),this.__scaleContainer=$("<div>").addClass("scale-container"),this.__minValueDisplay=$("<div>").addClass("text-element limit-display minimum"),this.__maxValueDisplay=$("<div>").addClass("text-element limit-display maximum"),this.__changedHandler=e=>this.__onChanged(e),this.__downHandler=e=>this.__onDown(e),this.__moveHandler=e=>this.__onMove(e),this.__curValueDisplayPressedHandler=e=>this.__onCurValueDisplayPressed(e),this.__upHandler=e=>this.__onUp(e),this.__element.addClass("slider"),this.__element.append(this.__scaleContainer),this.__scaleContainer.append(this.__minValueDisplay),this.__scaleContainer.append(this.__maxValueDisplay),this.__element.append(this.__input),this.__element.append(this.__curValueDisplay),this.setShowValue(!0),this.setShowScale(!0),this.setMinValue(-100),this.setMaxValue(100),this.setStep(0),this.setOrientation(t.Orientation.horizontal),this.setSwitchMinMax(!1)}__attach(){this.__isAttached||(this.__input.on("pointerdown",this.__downHandler),this.__input.on("change",this.__changedHandler),this.__curValueDisplay.on("pointerdown",this.__curValueDisplayPressedHandler),this.__managePressAndHold=t.Helper.PressAndHold.init(this.__input,(()=>{this.__openValueInput()})),this.__processIsEnabled(),super.__attach())}__detach(){this.__isAttached&&(this.__input.off("pointerdown",this.__downHandler),this.__input.off("change",this.__changedHandler),this.__curValueDisplay.off("pointerdown",this.__curValueDisplayPressedHandler),this.__managePressAndHold?.stop(),super.__detach())}destroy(){this.resizeHandler.destroy(),this.baObjectHandler.destroy(),super.destroy()}onTextChanged(e){super.onTextChanged(e),null!=e?this.__element.append(this.textHandler.getTextElement()):this.textHandler.getTextElement().detach()}onResized(){let e=this.__element[0].getBoundingClientRect(),a=e.height,n=e.width;this.__attrHandler.orientation===t.Orientation.vertical?(this.__element.css("--tchmi-ba-slider-knob-width","10px"),this.__element.css("--tchmi-ba-slider-knob-height",n+(n/100+15)+"px"),this.__element.css("--tchmi-ba-slider-height",n+"px"),this.__element.css("--tchmi-ba-slider-width",a+"px")):(this.__element.css("--tchmi-ba-slider-knob-height",a+(a/100+15)+"px"),this.__element.css("--tchmi-ba-slider-knob-width","10px"),this.__element.css("--tchmi-ba-slider-height",a+"px"),this.__element.css("--tchmi-ba-slider-width",n+"px"))}onValueChanged(e){this.__setValueInternal(e)}__onChanged(e){if(0==this.__attrHandler.isEnabled)return e.stopPropagation(),void(null!=this.__attrHandler.valueFeedback&&null!=this.__attrHandler.valueFeedback?this.__input.val(this.__attrHandler.valueFeedback):null!=this.__attrHandler.value&&this.__input.val(this.__attrHandler.value))}__onDown(e){0!=this.__attrHandler.isEnabled?null!=e.button&&e.button!==t.MouseButtons.left||($(document).on("pointermove",this.__moveHandler),$(document).on("pointerup",this.__upHandler),this.__wasMoved=!1):e.stopPropagation()}__onMove(e){let t=this.__getValueFromHtml(),a=0;null!=this.__attrHandler.maxValue&&null!=this.__attrHandler.minValue&&(a=this.__attrHandler.maxValue>this.__attrHandler.minValue?(this.__attrHandler.maxValue-this.__attrHandler.minValue)*(n.SkipPressAndHoldThreshold/100):(this.__attrHandler.minValue-this.__attrHandler.maxValue)*(n.SkipPressAndHoldThreshold/100)),this.__managePressAndHold?.isPressed()&&null!=this.__attrHandler.value&&t>this.__attrHandler.value-a&&t<this.__attrHandler.value+a||(this.__setValueInternal(t),this.__wasMoved=!0,this.__managePressAndHold?.release())}__onUp(e){null!=this.__attrHandler.minValue&&null!=this.__attrHandler.maxValue&&this.__attrHandler.maxValue==this.__attrHandler.minValue&&this.logger.warn("Min and max values of silder are equal. No input will be possible!");let t=this.__getValueFromHtml();if(this.__wasMoved&&null!=this.__attrHandler.value&&t!==this.__attrHandler.value&&(this.__input.val(this.__attrHandler.value),t=this.__attrHandler.value),this.__setValueInternal(t),null!=this.__attrHandler.valueFeedback&&this.__attrHandler.value!=this.__attrHandler.valueFeedback){let e=()=>{this.__valueFeedbackReady.forEach((e=>e())),this.__valueFeedbackReady=[],null!=this.__attrHandler.valueFeedback&&null!=this.__attrHandler.valueFeedback&&this.__setValueInternal(this.__attrHandler.valueFeedback)};this.__valueFeedbackReady.push(this.busyHandler.setBusy("Waiting for ValueFeedback",{cbOnTimeout:e}))}null!=this.__attrHandler.value&&this.valueHandler.processChangedValue(this.__attrHandler.value),this.eventHandler.raise(n.SliderEvents.onUserInteractionFinished),$(document).off("pointermove",this.__moveHandler),$(document).off("pointerup",this.__upHandler)}__onCurValueDisplayPressed(e){0!=this.__attrHandler.isEnabled&&0!=this.checkAccess(t.Server.AccessRight.operate)&&(null!=e.button&&e.button!==t.MouseButtons.left||(this.__managePressAndHold?.release(),this.__openValueInput()))}__calculatePercentage(e){return null==this.__attrHandler.minValue||null==this.__attrHandler.maxValue?0:(e-this.__attrHandler.minValue)/(this.__attrHandler.maxValue-this.__attrHandler.minValue)*100}async __openValueInput(){if(null==this.__attrHandler.value)return;let e=await a.DialogWindow.promptNumericWithLimits(t.Locale.Localization.getText(t.Locale.LangKey.EnterValue),this.__attrHandler.value,this.__attrHandler.minValue,this.__attrHandler.maxValue);if(null!=e){if(this.__setValueInternal(e),null!=this.__attrHandler.valueFeedback&&this.__attrHandler.value!=this.__attrHandler.valueFeedback){let e=()=>{this.__valueFeedbackReady.forEach((e=>e())),this.__valueFeedbackReady=[],null!=this.__attrHandler.valueFeedback&&null!=this.__attrHandler.valueFeedback&&this.__setValueInternal(this.__attrHandler.valueFeedback)};this.__valueFeedbackReady.push(this.busyHandler.setBusy("Waiting for ValueFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"}))}this.valueHandler.processChangedValue(this.__attrHandler.value),this.eventHandler.raise(n.SliderEvents.onUserInteractionFinished)}}__getValueFromHtml(){let e=Number(this.__input.val());if(null==e||"number"!=typeof e)throw new Error("Value of slider input must always be of type number!");return e}__validateMinMax(){null!=this.__attrHandler.minValue&&null!=this.__attrHandler.maxValue&&this.__attrHandler.minValue==this.__attrHandler.maxValue?(this.logger.debug("Min and max values of silder are equal. No input will be possible!"),this.__oldEnabled,this.getIsEnabled(),void 0===this.__oldEnabled&&(this.__oldEnabled=!0),this.setIsEnabled(!1)):void 0!==this.__oldEnabled&&(this.setIsEnabled(this.__oldEnabled),delete this.__oldEnabled)}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.value&&this.setValue(e.value),void 0!==e.valueFeedback&&this.setValueFeedback(e.valueFeedback),void 0!==e.showValue&&this.setShowValue(e.showValue),void 0!==e.showScale&&this.setShowScale(e.showScale),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.orientation&&this.setOrientation(e.orientation),void 0!==e.switchMinMax&&this.setSwitchMinMax(e.switchMinMax),void 0!==e.step&&this.setStep(e.step),void 0!==e.ranges&&this.setRanges(e.ranges),void 0!==e.unit&&this.setUnit(e.unit),void 0!==e.knobAppearance&&this.setKnobAppearance(e.knobAppearance),this}getAttributes(){return this.__attrHandler.getRef()}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:"number",skipEqualityCheck:!0})?(null!=e&&(e=Number(e.toFixed(this.__digits))),this.__attrHandler.checkEquality(e,this.__attrHandler.value,"value")?(this.__setValueInternal(e),this):this):this}__setValueInternal(e){e!==this.__attrHandler.value&&(this.__attrHandler.value=e,this.__processValue(),this.eventHandler.raise(n.SliderEvents.onValueChanged))}__processValue(){null==this.__attrHandler.value?(this.__input.val(0),this.__curValueDisplay.html("null")):(this.__input.val(this.__attrHandler.value),this.__curValueDisplay.html(this.__attrHandler.value.toFixed(this.__digits)))}getValue(){return this.__attrHandler.value}setValueFeedback(e){return this.__attrHandler.checkAttribute(e,"valueFeedback",{validator:"number",skipEqualityCheck:!0})?(null!=e&&(e=Number(e.toFixed(this.__digits))),this.__attrHandler.checkEquality(e,this.__attrHandler.valueFeedback,"valueFeedback")?(this.__attrHandler.valueFeedback=e,null!=this.__attrHandler.valueFeedback&&this.__processValueFeedback(),this.__valueFeedbackReady.forEach((e=>e())),this.__valueFeedbackReady=[],this.eventHandler.raise(n.SliderEvents.onValueFeedbackChanged),this):this):this}__processValueFeedback(){null==this.__attrHandler.valueFeedback?(this.__feedbackSlider?.detach(),delete this.__feedbackSlider):(null==this.__feedbackSlider&&(this.__feedbackSlider=$('<input type="range" max="100" min="0"/>').addClass("feedback-slider"),this.__element.append(this.__feedbackSlider),this.__feedbackSlider.attr("disabled","disabled"),this.__processMinValue(),this.__processMaxValue(),this.__processOrientation(),this.__processStep()),this.__feedbackSlider?.val(this.__attrHandler.valueFeedback),this.__curValueDisplay.html(this.__attrHandler.valueFeedback.toFixed(this.__digits)))}getValueFeedback(){return this.__attrHandler.valueFeedback}setShowValue(e){return this.__attrHandler.checkAttribute(e,"showValue",{validator:"boolean"})?(this.__attrHandler.showValue=e,this.__processShowValue(),this):this}__processShowValue(){null!=this.__attrHandler.showValue&&!0===this.__attrHandler.showValue?this.__element.append(this.__curValueDisplay):this.__curValueDisplay.detach()}getShowValue(){return this.__attrHandler.showValue}setShowScale(e){return this.__attrHandler.checkAttribute(e,"showScale",{validator:"boolean"})?(this.__attrHandler.showScale=e,this.__processShowScale(),this):this}__processShowScale(){null!=this.__attrHandler.showScale&&!0===this.__attrHandler.showScale?this.__element.append(this.__scaleContainer):this.__scaleContainer.detach()}getShowScale(){return this.__attrHandler.showScale}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(null!=e&&null!=this.__attrHandler.maxValue&&e>this.__attrHandler.maxValue?(this.setMinValue(this.__attrHandler.maxValue),this.setMaxValue(e),this.setSwitchMinMax(!0)):(this.__attrHandler.minValue=e,this.__processMinValue(),this.setSwitchMinMax(!1)),this):this}__processMinValue(){null==this.__attrHandler.minValue?(this.__input.attr("min",-100),this.__feedbackSlider?.attr("min",-100),this.__minValueDisplay.html("-100")):(this.__input.attr("min",this.__attrHandler.minValue),this.__feedbackSlider?.attr("min",this.__attrHandler.minValue),this.__minValueDisplay.html(this.__attrHandler.minValue.toString())),this.__processValue(),this.__processRanges(),this.__validateMinMax()}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(null!=e&&null!=this.__attrHandler.minValue&&e<this.__attrHandler.minValue?(this.setMaxValue(this.__attrHandler.minValue),this.setMinValue(e),this.setSwitchMinMax(!0)):(this.__attrHandler.maxValue=e,this.__processMaxValue(),this.setSwitchMinMax(!1)),this):this}__processMaxValue(){null==this.__attrHandler.maxValue?(this.__input.attr("max",100),this.__maxValueDisplay.html("100"),this.__feedbackSlider?.attr("min",100)):(this.__input.attr("max",this.__attrHandler.maxValue),this.__feedbackSlider?.attr("max",this.__attrHandler.maxValue),this.__maxValueDisplay.html(this.__attrHandler.maxValue.toString())),this.__processValue(),this.__processRanges(),this.__validateMinMax()}getMaxValue(){return this.__attrHandler.maxValue}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this.__processRanges(),this):this}__processOrientation(){null!=this.__attrHandler.orientation&&this.__attrHandler.orientation===t.Orientation.vertical?(this.__element.addClass("vertical"),this.__input.attr("orient","vertical"),this.__feedbackSlider?.attr("orient","vertical")):(this.__element.removeClass("vertical"),this.__input.attr("orient","horizontal"),this.__feedbackSlider?.attr("orient","horizontal")),this.onResized()}getOrientation(){return this.__attrHandler.orientation}setSwitchMinMax(e){return this.__attrHandler.checkAttribute(e,"switchMinMax",{validator:"boolean"})?(this.__attrHandler.switchMinMax=e,this.__processSwitchMinMax(),this):this}__processSwitchMinMax(){null!=this.__attrHandler.switchMinMax&&(this.__attrHandler.switchMinMax?this.__element.addClass("switch-min-max"):this.__element.removeClass("switch-min-max"),this.__processValue())}getSwitchMinMax(){return this.__attrHandler.switchMinMax}setStep(e){return this.__attrHandler.checkAttribute(e,"step",{validator:"number"})?(this.__attrHandler.step=e,this.__processStep(),this):this}__processStep(){if(null==this.__attrHandler.step)this.__digits=0,this.__processValue(),this.__input.attr("step",0),this.__feedbackSlider?.attr("step",0);else{let e=this.__attrHandler.step.toString();if(e.indexOf(".")>-1){let t=e.split(".");this.__digits=t[1].length}else this.__digits=0;this.__processValue(),this.__input.attr("step",this.__attrHandler.step),this.__feedbackSlider?.attr("step",this.__attrHandler.step)}this.__processValue()}getStep(){return this.__attrHandler.step}setRanges(e){if(!this.__attrHandler.checkAttribute(e,"ranges",{validator:()=>e instanceof Array}))return this;if(null!=e)for(let t=0;t<e.length;t++)if(!n.isSliderRange(e[t]))return this.logger.invalidAttribute("Ranges",e[t]),this;return this.__attrHandler.ranges=e,this.__processRanges(),this}__processRanges(){if(null==this.__attrHandler.ranges)return null!=this.__oldBackgroundColor&&this.backgroundStyler.setColor(this.__oldBackgroundColor),void this.__element.removeClass("has-ranges");if(null==this.__attrHandler.minValue||null==this.__attrHandler.maxValue)return void console.warn(`MinValue or MaxValue was not set for slider ${this.__id}. No ranges were set!`);try{this.__oldBackgroundColor=t.Color.RGBAColor.fromCssString(this.__element.css("background-color"))}catch(e){this.__oldBackgroundColor=null}this.__attrHandler.ranges.sort(((e,t)=>e.start-t.start)),this.__element.addClass("has-ranges");let e="",a=new t.Color.LinearGradient;null==this.__attrHandler.orientation||this.__attrHandler.orientation===t.Orientation.horizontal?(e="linear-gradient(to right",a.direction="to Right"):a.direction="to Top",e="linear-gradient(to top";for(let t=0;t<this.__attrHandler.ranges.length;t++){let n=this.__attrHandler.ranges[t];if(n.start<this.__attrHandler.minValue){console.warn("Start value of range is smaller than the minimum value. Range will be ignored!");continue}let i=this.__calculatePercentage(n.start);if(null==n.end)if(t<this.__attrHandler.ranges.length-1){let s=this.__calculatePercentage(this.__attrHandler.ranges[t+1].start);if(e=e+", "+n.color+" "+i.toString()+"%, "+this.__attrHandler.ranges[t+1].color+" "+s.toString()+"%",a.stops.push({color:n.color,stop:i,stopUnit:"%"},{color:this.__attrHandler.ranges[t+1].color,stop:s,stopUnit:"%"}),s>=100)break}else e=e+", "+n.color+" "+i.toString()+"%, "+n.color+" 100%",a.stops.push({color:n.color,stop:i,stopUnit:"%"},{color:n.color,stop:100,stopUnit:"%"});else{if(n.end<n.start){console.warn("End value of range is smaller than the start value. Range will be ignored!");continue}if(n.end>this.__attrHandler.maxValue){console.warn("End value of range is bigger than the maximum value. Range will be ignored!");continue}let t=this.__calculatePercentage(n.end);e=e+", "+n.color+" "+i.toString()+"%, "+n.color+" "+t.toString()+"%",a.stops.push({color:n.color,stop:i,stopUnit:"%"},{color:n.color,stop:t,stopUnit:"%"})}}e+=")",this.backgroundStyler.setColor(a)}getRanges(){return this.__attrHandler.ranges}setUnit(a){if(!this.__attrHandler.checkAttribute(a,"unit",{validator:["string","number"]}))return this;if("number"==typeof a)if(t.Server.BaSite.Units.size>0)a=t.Helper.convertUnitToString(a),this.__attrHandler.unit=a,this.__processUnit();else{this.__attrHandler.unit=t.BA.Unit[a],this.__processUnit();let n=e.EventProvider.register("CustomBA.onUnitsLoaded",(()=>{this.__attrHandler.unit=t.Helper.convertUnitToString(a),this.__processUnit(),n()}))}else this.__attrHandler.unit=a,this.__processUnit();return this}__processUnit(){null!=this.__attrHandler.unit?(this.__unitDisplay.html(this.__attrHandler.unit),this.__element.append(this.__unitDisplay)):this.__unitDisplay.detach()}getUnit(){return this.__attrHandler.unit}setKnobAppearance(e){return this.__attrHandler.checkAttribute(e,"knobAppearance",{validator:"number"})?(this.__attrHandler.knobAppearance=e,this.__processKnobAppearance(),this):this}__processKnobAppearance(){if(this.__attrHandler.knobAppearance===n.KnobAppearance.round)this.__element.addClass("round-knob");else this.__element.removeClass("round-knob")}getKnobAppearance(){return this.__attrHandler.knobAppearance}__processIsEnabled(){super.__processIsEnabled(),0==this.__attrHandler.isEnabled||1==this.__attrHandler.readOnly?(this.__input.attr("disabled","disabled"),this.__element.addClass("tchmi-control-disabled"),this.__curValueDisplay.off("pointerdown",this.__curValueDisplayPressedHandler),this.__managePressAndHold?.stop()):(this.__input.removeAttr("disabled"),this.__element.removeClass("tchmi-control-disabled"),this.__isAttached&&this.__curValueDisplay.on("pointerdown",this.__curValueDisplayPressedHandler),this.__managePressAndHold?.resume())}__processReadOnly(){super.__processReadOnly(),this.__processIsEnabled()}processBaObject(){if(!this.baObjectHandler.baObject)return;if(this.baObjectHandler.baObject.DataType!==t.DataType.number)return;this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(e=>{this.setValueFeedback(e)})),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eOutputUnit)?this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eOutputUnit,(e=>{this.setUnit(e)})):this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,(e=>{this.setUnit(e)})),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eLowLimit)&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eLowLimit,(e=>{e&&e.bEnable?this.setMinValue(e.fValue):this.setMinValue(null)})),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eHighLimit)&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eHighLimit,(e=>{e&&e.bEnable?this.setMaxValue(e.fValue):this.setMaxValue(null)})),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess())}}a.Slider=n,function(e){let a,n;e.isSliderRange=function(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("color",t.Color.isRGBAColor),n.set("start","number"),null!=e.end&&n.set("end","number"),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},function(e){e[e.rectangle=0]="rectangle",e[e.round=1]="round"}(a=e.KnobAppearance||(e.KnobAppearance={})),function(e){e.onUserInteractionFinished="onUserInteractionFinished",e.onValueChanged="onValueChanged",e.onValueFeedbackChanged="onValueFeedbackChanged"}(n=e.SliderEvents||(e.SliderEvents={})),e.SkipPressAndHoldThreshold=2}(n=a.Slider||(a.Slider={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.TextControl{constructor(t,a){super(t,a),this.__table=$("<table>"),this.__columns=new Map,this.__originalData=[],this.__sortedData=[],this.__settingRowValuesInProgress=!1,this.__rowManipulators=[],this.__isResizing=!1,this.__sortableColumnPressedHandler=t=>{if("click"===t.type&&t.button!==e.MouseButtons.left)return;if(this.__isResizing)return;if(!$(t.target).hasClass("sortable"))return;let a=$(t.target),n=this.__columns.get(a.data("column-id"));if(!n)throw new Error(`Column for target ${a.data("id")} could not be found!`);this.__sortedColumn=n.opt,n.opt.sortable&&this.__sortData(n.opt.id)},this.__resizerPressedHandler=t=>{if("mousedown"===t.type&&t.button!==e.MouseButtons.left)return;if(!$(t.target).hasClass("resizer"))return;this.__isResizing=!0;let a=$(t.target).parent(),n=a.data("column-id"),i=this.__columns.get(n);if(!i)throw new Error(`Column for target ${a.data("id")} could not be found!`);if(!i.opt.resizeable)return;let s=!0;if(!s)return;let r=0;if("mousedown"===t.type){if(t.button!==e.MouseButtons.left)return;r=t.pageX}else r=t.touches[0].pageX;let o=a.width();if(void 0===o)return;let l=a.closest(".table-resizable").addClass("resizing"),d=e=>{if(s){let t=0;t="mousemove"===e.type?o+(e.pageX-r):o+(e.touches[0].pageX-r),void 0!==i.opt.minWidth&&i.opt.minWidth>0&&t<i.opt.minWidth&&(t=i.opt.minWidth),a.css("min-width",t+"px")}},h=e=>{s&&(l.removeClass("resizing"),s=!1),$(document).off("mousemove touchmove",d),$(document).off("mouseup touchend",h),setTimeout((()=>this.__isResizing=!1),100)};$(document).on("mousemove touchmove",d),$(document).on("mouseup touchend",h)},this.__doubleClickHandler=e=>{this.__resetColumnWidth()},this.__cellSelectedHandler=e=>this.__onCellSelected(e),this.__selectedHandler=e=>this.__onSelected(e),this.__element.addClass("table");let n=$("<div>").addClass("table-container").append(this.__table);this.__element.append(n),this.__table.append("\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t</tbody>"),this.__headerRow=this.__table.find("thead").find("tr"),this.__tableBody=this.__table.find("tbody")}__attach(){if(this.__isAttached)return;let e;super.__attach(),this.__element.on("mousedown touchstart","table th.resizeable div.resizer",this.__resizerPressedHandler),this.__element.on("click touch","table th.sortable",this.__sortableColumnPressedHandler),this.__element.on("dblclick","table th.resizeable div.resizer",this.__doubleClickHandler),this.__element.on("click touch","table tbody tr td",this.__cellSelectedHandler),this.__element.on("click touch",".table-container",this.__selectedHandler);for(let t of this.__columns.values()){if(e=t.th.width(),void 0===e)throw new Error("Width should be defined hete!");void 0!==t.opt.minWidth&&(e=t.opt.minWidth),void 0!==t.opt.defaultWidth&&(e=t.opt.defaultWidth),t.th.css("min-width",e+"px"),t.th.data("init-width",e)}this.__element.addClass("initialized")}__detach(){this.__isAttached&&(super.__detach(),this.__element.off("mousedown touchstart","table th.resizeable div.resizer",this.__resizerPressedHandler),this.__element.off("click touch","table th.sortable",this.__sortableColumnPressedHandler),this.__element.off("dblclick","table th.resizeable div.resizer",this.__doubleClickHandler),this.__element.off("click touch","table tbody tr td",this.__cellSelectedHandler),this.__element.off("click touch",".table-container",this.__selectedHandler),this.__element.removeClass("initialized"))}destroy(){this.removeAllData(),super.destroy()}__onSelected(t){return("mousedown"!==t.type||t.button===e.MouseButtons.left)&&(!!$(t.target).hasClass("table-container")&&(this.__unselectedRows(),!0))}__onCellSelected(t){if("mousedown"===t.type&&t.button!==e.MouseButtons.left)return!1;let n,i=$(t.currentTarget),s=i.data("row-index"),r=this.__tableBody.find("tr");for(let e=0;e<r.length;e++)n=$(r[e]),e===s?n.addClass("focused"):n.removeClass("focused");return this.__selectedCell=i,this.eventHandler.raise(a.TableEvents.onCellSelected,i),!0}__addColumn(e){let t,a=this.__headerRow.find("th");for(let n=0;n<a.length;n++)if(t=$(a[n]),t.data("column-id")===e.id)return;t=$("<th>"),e.title&&(t.html(e.title),t.addClass("has-title")),t.data("column-id",e.id),e.sortable&&t.addClass("sortable not-sorted"),e.resizeable&&(t.addClass("resizeable"),t.append($("<div>").addClass("resizer"))),this.__headerRow.append(t),0===this.__columns.size&&this.showRowNumbers(this.__element.hasClass("show-row-numbers")),this.__columns.set(e.id,{th:t,opt:e});for(let t=0;t<this.__originalData.length;t++)this.__originalData[t][e.id]&&this.__addDataCellElement(e.id,t)}__removeColumn(e){let t=this.__columns.get(e);if(t){t.th.detach();for(let t=0;t<this.__originalData.length;t++)this.__removeDataCellElement(e,t);this.__columns.delete(e),this.__resetColumnWidth()}else console.warn(`No column with id "${e}" found!`)}__addDataCellElement(e,n){let i=this.__tableBody.find("tr"),s=$(i[n]);s[0]||(s=$("<tr>"),s.data("init-row-index",i.length),this.__tableBody.append(s)),i=this.__tableBody.find("tr");let r=s.find("td");for(let t=0;t<r.length;t++)if($(r[t]).data("column-id")===e)return;let o=$("<td>");o.data({"column-id":e,"row-index":i.length-1});let l=this.__columns.get(e)?.opt;if(!l)throw new Error(`No value or column options were found for column id ${e}!`);switch(l.dataType){case a.ColumnOptionsDataType.boolean:case a.ColumnOptionsDataType.dateTime:case a.ColumnOptionsDataType.enum:case a.ColumnOptionsDataType.number:case a.ColumnOptionsDataType.integer:case a.ColumnOptionsDataType.string:let n=new t.ValueField(this.__id+"-"+e+"-"+(i.length-1),this);switch(n.getElement().data({"column-id":e,"row-index":i.length-1}),l.dataType){case a.ColumnOptionsDataType.boolean:void 0!==l.activeText&&n.setActiveText(l.activeText),void 0!==l.inactiveText&&n.setInactiveText(l.inactiveText),l.digits&&n.setDigits(l.digits);break;case a.ColumnOptionsDataType.number:l.unit&&n.setUnit(l.unit);break;case a.ColumnOptionsDataType.enum:l.stateTexts&&n.setStateTexts(l.stateTexts)}n.setDataType(l.dataType).setReadOnly(!l.editable),n.textHandler.setVerticalAlignment(l.textVerticalAlignment).setHorizontalAlignment(l.textHorizontalAlignment),o.append(n.getElement());let s=n.eventHandler.register(t.ValueField.ValueFieldEvents.onValueChanged,(e=>{if(this.__settingRowValuesInProgress)return;let t=n.getElement().data("row-index"),i=n.getElement().data("column-id"),s=this.__sortedData[t],r=s.dataIndex;if(void 0===s)throw new Error(`Data for data index ${r} and column id ${i} was not found!`);this.__originalData[r][i]=n.getValue(),this.eventHandler.raise(a.TableEvents.onDataChanged,[r,i,this.__originalData[r][i]])}));n.eventHandler.register(t.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),s()}));break;case a.ColumnOptionsDataType.event:let r=new t.EventIcon(this.__id+"-"+e+"-"+(i.length-1),this);o.append(r.getElement())}s.append(o)}__removeDataCellElement(e,t){let a,n,i,s=this.__tableBody.find("tr"),r=$(s[t]);if(!r[0])throw new Error(`No row was found for row index ${t}!`);a=r.find("td");for(let t=0;t<a.length;t++)if(n=$(a[t]),i=n.data("column-id"),i===e){let t=this.childrenHandler.getChildren().get(this.__id+"-"+e+"-"+r.data("init-row-index"));t&&(t.getElement().detach(),t.destroy()),n.detach();break}0===r.find("td").length&&r.detach()}__addData(e){if(a.isTableData(e)){this.__originalData.push(e);for(let e of this.__columns.keys())this.__addDataCellElement(e,this.__originalData.length-1)}else this.__attrHandler.invalidAttribute("Data",e)}__removeData(e){let t;for(t=0;t<this.__sortedData.length&&this.__sortedData[t].dataIndex!==e;t++);for(let e of this.__columns.keys())this.__removeDataCellElement(e,t);this.__sortedData.splice(t,1),this.__originalData.splice(e,1)}__createOriginalDataClone(){let e=[];for(let t=0;t<this.__originalData.length;t++)e.push({value:this.__originalData[t],dataIndex:t});return e}__sortData(t,a){let n=this.__columns.get(t);if(!n)throw new Error(`Column with id ${t} was not found!`);if(!n.opt.sortable)return;void 0===a&&(a=0,n.th.hasClass("not-sorted")?a=1:n.th.hasClass("asc")&&(a=-1));for(let[e,a]of this.__columns)a.opt.sortable&&(e!==t?a.th.addClass("not-sorted"):a.th.removeClass("not-sorted"),a.th.removeClass("desc"),a.th.removeClass("asc"));let i=!0,s=!1;if(this.__sortedData=this.__createOriginalDataClone(),0!==a){let n,r,o;for(;i;){for(i=!1,o=0;o<this.__sortedData.length-1;o++)if(s=!1,n=this.__sortedData[o].value[t],r=this.__sortedData[o+1].value[t],-1===a){if("object"!=typeof n||n instanceof Date||null==n||"object"!=typeof r||r instanceof Date||null==r){if(null==n&&null!=r){s=!0;break}if(null!=n&&null!=r&&n<r){s=!0;break}}else if(n.eventCondition<r.eventCondition){s=!0;break}}else if(1===a)if("object"!=typeof n||n instanceof Date||null==n||"object"!=typeof r||r instanceof Date||null==r){if(null!=n&&null==r){s=!0;break}if(null!=n&&null!=r&&n>r){s=!0;break}}else if(n.eventCondition>r.eventCondition){s=!0;break}s&&(e.Helper.Array.swapItems(this.__sortedData,o,o+1),i=!0)}}1===a?n.th.addClass("asc"):-1===a?n.th.addClass("desc"):n.th.addClass("not-sorted"),this.__updateRowValues()}__updateRowNumbers(){if(this.__element.hasClass("show-row-numbers")){let e,t=this.__tableBody.find("tr"),a=1;for(let n=0;n<t.length;n++)e=$(t[n]),e.hasClass("hide")||($(e.find("td")[0]).attr("data-row-index",a),a++)}}__updateRowValues(){let e,t,n;this.__settingRowValuesInProgress=!0;for(let i=0;i<this.__sortedData.length;i++){let s=this.__tableBody.find("tr")[i],r=$(s).find("td");if(s){for(let[s,o]of this.__columns)if(n=this.__sortedData[i].value[s],void 0!==n)switch(o.opt.dataType){case a.ColumnOptionsDataType.boolean:case a.ColumnOptionsDataType.dateTime:case a.ColumnOptionsDataType.enum:case a.ColumnOptionsDataType.number:case a.ColumnOptionsDataType.integer:case a.ColumnOptionsDataType.string:if(n instanceof Date||"object"!=typeof n){if(e=this.childrenHandler.getChildren().get(this.__id+"-"+s+"-"+i),!e)throw new Error("Value");e.setValue(n)}break;case a.ColumnOptionsDataType.image:if("string"==typeof n){let e;for(let t=0;t<r.length&&(e=$(r[t]),e.data("column-id")!==s);t++);e&&(e.addClass("use-image"),e.css("background-image","url("+n+")"))}break;case a.ColumnOptionsDataType.event:"object"!=typeof n||n instanceof Date||(t=this.childrenHandler.getChildren().get(this.__id+"-"+s+"-"+i),t&&t.setEventState(n?.eventState).setEventCondition(n?.eventCondition).setReadOnly(!0));break;default:throw new Error("Invalid data type for Table!")}for(let e=0;e<this.__rowManipulators.length;e++)this.__rowManipulators[e](this.__sortedData[i].value,$(s),r)}}this.__settingRowValuesInProgress=!1}__resetColumnWidth(){let e;for(let[t,a]of this.__columns){if(e=a.th.data("init-width"),void 0===e)throw new Error("Width should be defined hete!");a.th.css("min-width",e+"px")}}__unselectedRows(){let e,t=this.__tableBody.find("tr");for(let a=0;a<t.length;a++)e=$(t[a]),e.removeClass("focused");this.__selectedCell=void 0}addColumn(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__addColumn(e[t]);else this.__addColumn(e);return this}removeColumn(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__removeColumn(e[t]);else this.__removeColumn(e);return this}addData(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__addData(e[t]);else this.__addData(e);return this.__sortedColumn?this.__sortData(this.__sortedColumn.id,-1):(this.__sortedData=this.__createOriginalDataClone(),this.__updateRowValues()),this.__updateRowNumbers(),this.eventHandler.raise(a.TableEvents.onDataChanged),this}getData(){return this.__originalData}removeData(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__removeData(e[t]);else this.__removeData(e);return this.__updateRowNumbers(),this.eventHandler.raise(a.TableEvents.onDataChanged),this}removeAllData(){for(;this.__originalData.length>0;)this.__removeData(this.__originalData.length-1);return this.__updateRowNumbers(),this.eventHandler.raise(a.TableEvents.onDataChanged),this}showRowNumbers(e){let t=$(this.__headerRow.find("th")[0]);return e?(this.__element.addClass("show-row-numbers"),t.append($("<div>").addClass("row-number-place-holder")),this.__updateRowNumbers()):(this.__element.removeClass("show-row-numbers"),t.find(".row-number-place-holder").detach()),this}setRowManipulator(e){return this.__rowManipulators.push(e),this.__updateRowValues(),this}getSelectedCell(){return this.__selectedCell}getSelectedData(){if(!this.__selectedCell)return;let e=this.__selectedCell.data("row-index");return this.__sortedData[e].value}}!function(t){let a,n;!function(e){e.onDataChanged="onDataChanged",e.onCellSelected="onCellSelected"}(a=t.TableEvents||(t.TableEvents={})),function(e){e[e.unknown=0]="unknown",e[e.string=1]="string",e[e.number=2]="number",e[e.integer=3]="integer",e[e.boolean=4]="boolean",e[e.enum=7]="enum",e[e.dateTime=8]="dateTime",e[e.image=9]="image",e[e.event=10]="event"}(n=t.ColumnOptionsDataType||(t.ColumnOptionsDataType={})),t.isTableData=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;for(let e in t)n.set(e,["number","boolean","string","date","object",null]);e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}}(a||(a={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,t){super(e,t),a.useAnimation&&this.__element.addClass("use-animation"),this.__contentContainer=$("<div>").addClass("content-container"),this.__tabContainer=$("<div>").addClass("tab-container"),this.__tabs=new Map,this.__element.addClass("tab-window"),this.__element.append(this.__contentContainer),this.__element.append(this.__tabContainer)}__attach(){if(!this.__isAttached){if(!this.__selectedTab)for(let e of this.__tabs.values()){this.selectTab(e);break}super.__attach()}}__detach(){this.__isAttached&&super.__detach()}destroy(){this.removeAllTabs(),super.destroy()}set tabDistance(e){this.__attrHandler.checkAttribute(e,"tabDistance",{validator:"number"})&&(this.__attrHandler.tabDistance=e,null==e?this.__element.css("--tchmi-ba-tab-window-tab-distance",""):this.__element.css("--tchmi-ba-tab-window-tab-distance",e+"px"))}get tabDistance(){return this.__attrHandler.tabDistance}set tabContainerSize(e){this.__attrHandler.checkAttribute(e,"tabContainerSize",{validator:"number"})&&(this.__attrHandler.tabContainerSize=e,null==e?this.__element.css("--tchmi-ba-tab-window-tab-container-size",""):this.__element.css("--tchmi-ba-tab-window-tab-container-size",e+"px"))}get tabContainerSize(){return this.__attrHandler.tabContainerSize}set tabSizeAuto(e){this.__attrHandler.checkAttribute(e,"tabSizeAuto",{validator:"boolean"})&&(this.__attrHandler.tabSizeAuto=e,e?this.__element.addClass("tab-size-auto"):this.__element.removeClass("tab-size-auto"))}get tabSizeAuto(){return this.__attrHandler.tabSizeAuto}set tabIconPadding(e){this.__attrHandler.checkAttribute(e,"tabIconPadding",{validator:"number"})&&(this.__attrHandler.tabIconPadding=e,null==e?this.__element.css("--tchmi-ba-tab-window-tab-icon-padding",""):this.__element.css("--tchmi-ba-tab-window-tab-icon-padding",e+"px"))}get tabIconPadding(){return this.__attrHandler.tabIconPadding}addTab(e,n){if(!e){let t=0;for(e=this.__id+"-tab-"+t;this.__tabs.has(e);)t++,e=this.__id+"-tab-"+t}if(this.__tabs.has(e))return void console.warn("Tab with id "+e+" already exists!");let i=new a.Tab(e,this);null!=n&&i.setAttributes(n);let s=i.eventHandler.register(a.Tab.TabEvents.onContentChanged,((e,t)=>{null!=this.__selectedTab&&t.getId()===this.__selectedTab.getId()&&t.getElement()[0].classList.contains("selected")&&(this.__contentContainer.children().detach(),this.selectTab(t))}));return i.eventHandler.register(t.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),s()})),this.__tabs.set(e,i),this.__element.css("--tchmi-ba-tab-window-tab-cnt",String(this.__tabs.size)),this.__tabContainer.append(i.getElement()),1===this.__tabs.size&&(i.getElement().addClass("selected"),this.__isAttached&&this.selectTab(i)),i}removeTab(e){let t=this.__tabs.get(e);if(null==t)return console.warn("Tab with id "+e+" was not found and could not be removed!"),!1;if(this.__tabs.delete(e),null!=this.__selectedTab&&this.__selectedTab.getId()===t.getId())if(this.__tabs.size>0)for(let e of this.__tabs.values()){this.selectTab(e);break}else delete this.__selectedTab;return t.getContent()?.detach(),t.getElement().detach(),t.destroy(),!0}removeAllTabs(){for(let e of this.__tabs.values())e.getElement().detach(),e.destroy();this.__tabs=new Map,this.__contentContainer.children().detach()}getTab(e){return this.__tabs.get(e)}getSelectedTab(){return this.__selectedTab}getTabs(){return this.__tabs}selectTab(e){return"string"==typeof e&&this.__tabs.has(e)&&(e=this.__tabs.get(e)),!!(e instanceof a.Tab&&this.__tabs.has(e.getId()))&&(this.__updateSelectedTab(e),this.eventHandler.raise(a.TabWindowEvents.onTabSelected,e),!0)}__updateSelectedTab(e){for(let t of this.__tabs.values())t.getId()!==e.getId()?t.getElement().removeClass("selected"):t.getElement().addClass("selected");if(null!=this.__selectedTab){let e=this.__selectedTab.getContent();null!=e&&(e.detach(),this.__contentContainer.empty())}let t=e.getContent();null!=t&&this.__contentContainer.append(t),this.__selectedTab=e}setAttributes(e){if(super.setAttributes(e),void 0!==e.tabs)if(null===e.tabs)this.removeAllTabs();else for(let t=0;t<e.tabs.length;t++)this.addTab(void 0,e.tabs[t]);return void 0!==e.tabPosition&&this.setTabPosition(e.tabPosition),null!=e.tabDistance&&(this.tabDistance=e.tabDistance),null!=e.tabContainerSize&&(this.tabContainerSize=e.tabContainerSize),null!=e.tabSizeAuto&&(this.tabSizeAuto=e.tabSizeAuto),this}getAttributes(){return this.__attrHandler.getRef()}setTabPosition(t){return this.__attrHandler.checkAttribute(t,"tabPosition",{validator:()=>null!=t&&t>=e.Position.left&&t<=e.Position.bottom})?(this.__attrHandler.tabPosition=t,this.__processTabPosition(),this):this}__processTabPosition(){for(let t=0;t<=e.Position.bottom;t++)this.__element.removeClass("tab-position-"+e.Position[t]);null==this.__attrHandler.tabPosition?this.__element.addClass("tab-position-"+e.Position[e.Position.bottom]):this.__element.addClass("tab-position-"+e.Position[this.__attrHandler.tabPosition])}getTabPosition(){return this.__attrHandler.tabPosition}}t.TabWindow=a,function(a){let n;!function(e){e.onTabSelected="onTabSelected"}(n=a.TabWindowEvents||(a.TabWindowEvents={})),a.useAnimation=!0;class i extends t.TextControl{constructor(t,n){super(t,n),this.__element.addClass("tab"),this.__downHandler=t=>{null!=t.button&&t.button!==e.MouseButtons.left||this.__baParent instanceof a&&this.__baParent.selectTab(this.__id)},this.__element.append(this.textHandler.getTextElement())}__attach(){this.__isAttached||(this.__element.on("pointerdown",this.__downHandler),this.__destroyersToCallOnDetach.push(this.eventHandler.register(t.BackgroundStyler.Events.onSvgLoaded,(()=>{null==this.text&&this.textHandler.getTextElement().detach(),this.__element.addClass("has-icon")}))),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__downHandler),super.__detach())}destroy(){super.destroy()}set text(e){this.__element.append(this.textHandler.getTextElement()),this.textHandler.setText(e)}get text(){return this.textHandler.getText()}set icon(e){null==this.text&&this.textHandler.getTextElement().detach(),null==e&&null!=this.text&&this.__element.append(this.textHandler.getTextElement()),null!=e?this.__element.addClass("has-icon"):this.__element.removeClass("has-icon"),this.backgroundStyler.setImage(e,!0)}get icon(){return this.backgroundStyler.getImage()}setAttributes(e){return super.setAttributes(e),void 0!==e.content&&this.setContent(e.content),void 0!==e.tabBackgroundColorSelected&&this.setBackgroundColorSelected(e.tabBackgroundColorSelected),void 0!==e.textColorSelected&&this.setTextColorSelected(e.textColorSelected),this}getAttributes(){return this.__attrHandler.getRef()}setContent(e){return this.__attrHandler.checkAttribute(e,"content",{validator:"object"})?(this.__attrHandler.content=e,this.__processContent(),this):this}__processContent(){this.eventHandler.raise(a.Tab.TabEvents.onContentChanged)}getContent(){return this.__attrHandler.content}setBackgroundColorSelected(e){return this.__attrHandler.checkColorAttribute(e,"tabBackgroundColorSelected")?(this.__attrHandler.tabBackgroundColorSelected=e,this.__processBackgroundColorSelected(),this):this}__processBackgroundColorSelected(){null==this.__attrHandler.tabBackgroundColorSelected?this.__element.css("--tchmi-ba-tab-window-tab-background-color-selected",""):this.__element.css("--tchmi-ba-tab-window-tab-background-color-selected",this.__attrHandler.tabBackgroundColorSelected.toString())}getTabBackgroundColorSelected(){return this.__attrHandler.tabBackgroundColorSelected}setTextColorSelected(e){return this.__attrHandler.checkColorAttribute(e,"textColorSelected")?(this.__attrHandler.textColorSelected=e,this.__processTextColorSelected(),this):this}__processTextColorSelected(){null==this.__attrHandler.textColorSelected?this.__element.css("--tchmi-ba-tab-window-tab-text-color-selected",""):this.__element.css("--tchmi-ba-tab-window-tab-text-color-selected",this.__attrHandler.textColorSelected.toString())}getTextColorSelected(){return this.__attrHandler.textColorSelected}}a.Tab=i,function(e){let t;!function(e){e.onContentChanged="onContentChanged"}(t=e.TabEvents||(e.TabEvents={}))}(i=a.Tab||(a.Tab={}))}(a=t.TabWindow||(t.TabWindow={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.Button{constructor(e,n){super(e,n),this.baObjectHandler=new t.BaObjectHandler(this),this.resizeHandler=new a.ResizeHandler(this),this.__element.addClass("ui-icon"),this.setShowDisplays(!0),this.setConnectionColors(new t.Color.RGBAColor({r:144,g:185,b:234,a:1})),this.setConnectionsWidth(4)}__attach(){this.__isAttached||(t.Helper.IconBadges.appendBadgeElementsDimensionRectangle(this.__element,n.EventIconSize/2),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){if(this.__eventIcons?.forEach((e=>e.destroy())),delete this.__eventIcons,this.__displaysDataSymbols)for(let e of this.__displaysDataSymbols.keys())this.__removeDataSubscriptions(e);this.__displays?.forEach((e=>{e.getElement().off("pointerdown click",t.EventHandler.stopPropagationHandler),e.destroy()})),delete this.__displays,null!=this.__eventWatchIdentifier&&(this.baObjectHandler.baObject instanceof t.BA.BaEventObject||this.baObjectHandler.baObject instanceof t.BA.BaView)&&this.baObjectHandler.baObject.eventHandler.stopWatchEventsPerIcon(this.__eventWatchIdentifier),this.__destroyOnDeviceConnectionStateChanged&&this.__destroyOnDeviceConnectionStateChanged(),this.resizeHandler&&this.resizeHandler.destroy(),this.baObjectHandler.destroy(),super.destroy()}__onEventDataChanged(e){let t=[];for(let[a,i]of e){let e={activate:!0,eventCondition:null,eventState:null,eventCount:null};i.nCount>0&&(e.eventCondition=a,e.eventState=i.eMostPriorisedState,n.EnableEventCountBadge&&(e.eventCount=i.nCount),t.push(e))}this.setEventsData(t)}__onDisplayValueChanged(a){if(null!=this.__displays&&null!=this.__attrHandler.displaysData)for(let[i,s]of this.__displays)if(s.getId()===a.getId()){if(this.__attrHandler.displaysData.get(i).value=s.getValue(),this.__displaysDataSymbols){let n=this.__displaysDataSymbols.get(i);null!=n&&null!=n.valueMapping&&e.Server.writeSymbol(n.valueMapping,a.getValue(),(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e,!1)}))}this.eventHandler.raise(n.UiIconEvents.onDisplayValueChanged,s.getValue());break}}onResized(){this.__activateEvents()}__managePulse(){if(null==this.__attrHandler.eventsData)return this.__enablePulse(!1),void this.__element.removeClass("shows-pulse");let e=!1;for(let a=0;a<this.__attrHandler.eventsData.length;a++){let i=this.__attrHandler.eventsData[a];if(i.activate)if(null!=i.eventCondition&&"number"==typeof i.eventCondition&&null!=i.eventState&&"number"==typeof i.eventState){let a=i.eventCondition;if(null!=a&&a<=n.MaximumEventTypePulse.get(t.Server.BaSite.UserManagement.getBaRole())&&(i.eventState===t.BA.EventIconState.eGone||i.eventState===t.BA.EventIconState.ePresent)){e=!0;break}}else if(i.enablePulse){e=!0;break}}this.__enablePulse(e),e?this.__element.addClass("shows-pulse"):this.__element.removeClass("shows-pulse")}__manageIconStatus(){if(!0===n.AutoActivateIconStatus&&null!=this.__attrHandler.eventsData){let e=n.Status.invalid;for(let a=0;a<this.__attrHandler.eventsData.length;a++){let n=this.__attrHandler.eventsData[a];if(n.activate&&null!=n.eventCondition&&"number"==typeof n.eventCondition&&null!=n.eventState&&"number"==typeof n.eventState){let a=n.eventCondition;null!=a&&a>=t.BA.EventCondition.eTypeAlarm&&a<=t.BA.EventCondition.eTypeOther&&n.eventState>t.BA.EventIconState.eIndicated&&(0===e||a<e)&&(e=a)}}e!=n.Status.invalid&&this.setIconStatus(e)}}__enablePulse(a){a?null==this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse=e.EventProvider.register(t.TcHmiBaEvents.onNewPulse,(()=>{this.__element.addClass("pulse"),this.__element.on("animationend",(()=>{this.__element.removeClass("pulse")}))}))):this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse(),delete this.__destroyOnCustomBaPulse)}__createEventIcons(){if(null!=this.__attrHandler.eventsData){if(this.__eventIcons){for(let e=0;e<this.__eventIcons.length;e++){const t=this.__eventIcons[e];this.__removeEventSubscriptions(e),t.getElement().detach(),t.destroy()}delete this.__eventIcons}if(!(this.__attrHandler.eventsData.length<=0)){this.__eventIcons||(this.__eventIcons=[]);for(let i=0;i<this.__attrHandler.eventsData.length;i++){let s=this.__attrHandler.eventsData[i];if(null!=s.eventCondition&&s.eventCondition>n.MaximumEventConditionDisplayed.get(t.Server.BaSite.UserManagement.getBaRole()))continue;let r=this.__id+"-event-icon-"+i;const o=new a.EventIcon(r,this).setAttributes(s);o.getElement().on("pointerdown click",t.EventHandler.stopPropagationHandler),o.layoutHandler.setHeight(n.EventIconSize).setWidth(n.EventIconSize),this.__eventIcons.push(o);let l=o.eventHandler.register(a.EventIcon.EventIconEvents.onAcknowledged,(()=>this.baObjectHandler.baObject?.openParameterDialog("Events")));o.eventHandler.register(a.BaseNode.BaseNodeEvents.onDestroyed,(e=>{o.getElement().off("pointerdown click",t.EventHandler.stopPropagationHandler),e.destroy(),l()}));let d=this.__eventsDataSymbols?this.__eventsDataSymbols[i]:void 0,h=s.activate;"string"==typeof h&&e.Symbol.isSymbolExpression(h)&&(null==d?d={}:null!=d.activateSubscriptionId&&t.Server.subscriptionCollector.remove(d.activateSubscriptionId),d.activateMapping=t.Helper.String.toServerMapping(h),d.activateSubscriptionId=t.Server.subscriptionCollector.add(d.activateMapping,(e=>{s.activate=e,this.__activateEvents()}))),o.setAcknowledgeSymbol(s.acknowledgeMapping);let _=s.eventCondition,c=s.eventState;if(null!=_&&("string"==typeof _&&_.length>0||"number"==typeof _)&&null!=c&&("string"==typeof c&&c.length>0||"number"==typeof c)){if("string"==typeof _&&e.Symbol.isSymbolExpression(_))null==d?d={}:null!=d.eventConditionSubscriptionId&&t.Server.subscriptionCollector.remove(d.eventConditionSubscriptionId),d.eventConditionMapping=t.Helper.String.toServerMapping(_),d.eventConditionSubscriptionId=t.Server.subscriptionCollector.add(d.eventConditionMapping,(e=>{o?.setEventCondition(e)}));else{if("string"==typeof s.eventCondition&&(s.eventCondition=Number(s.eventCondition),isNaN(s.eventCondition))){console.warn(`A event description of ${this.__id} has an invalid value in property eventCondition!`),o.destroy();continue}o.setEventCondition(s.eventCondition)}if("string"==typeof c&&e.Symbol.isSymbolExpression(c))null==d?d={}:null!=d.eventStateSubscriptionId&&t.Server.subscriptionCollector.remove(d.eventStateSubscriptionId),d.eventStateMapping=t.Helper.String.toServerMapping(c),d.eventStateSubscriptionId=t.Server.subscriptionCollector.add(d.eventStateMapping,(e=>{o?.setEventState(e)}));else{if("string"==typeof s.eventState&&(s.eventState=Number(s.eventState),isNaN(s.eventState))){console.warn(`A event description of ${this.__id} has an invalid value in property eventState!`),o.destroy();continue}o.setEventState(s.eventState)}if(n.EnableEventCountBadge){let a=s.eventCount;if("string"==typeof a&&e.Symbol.isSymbolExpression(a))null==d?d={}:null!=d.eventCountSubscriptionId&&t.Server.subscriptionCollector.remove(d.eventCountSubscriptionId),d.eventCountMapping=t.Helper.String.toServerMapping(a),d.eventCountSubscriptionId=t.Server.subscriptionCollector.add(d.eventCountMapping,(e=>{o?.setEventCount(e)}));else{if("string"==typeof s.eventCount&&(s.eventCount=Number(s.eventCount),isNaN(s.eventCount))){console.warn(`A event description of ${this.__id} has an invalid value in property eventCount!`),o.destroy();continue}o.setEventCount(s.eventCount)}}}else o.setEventCondition(null),o.setEventState(null),o.setIsEnabled(null==s.isAcknowledgeable||s.isAcknowledgeable),o.setIcon(s.icon)}}}}__activateEvents(){if(null!=this.__attrHandler.eventsData&&null!=this.__eventIcons){let e=[],a=this.__element[0].clientWidth<n.AutoScaleEventIconThreshold||this.__element[0].clientHeight<n.AutoScaleEventIconThreshold;for(let a=0;a<this.__attrHandler.eventsData.length;a++){let n=this.__attrHandler.eventsData[a],i=this.__eventIcons[a];if(null!=i){if(n.activate){let n=t.CornerPosition.topRight;switch(a){case 0:n=t.CornerPosition.topRight;break;case 1:n=t.CornerPosition.bottomRight;break;case 2:n=t.CornerPosition.bottomLeft;break;case 3:n=t.CornerPosition.topLeft}e.push({element:i.getElement(),position:n})}else i.getIsAttached()&&i.getElement().detach();if(3===a)break}}t.Helper.IconBadges.appendBadgeElements(this.__element,e,{autoScale:a})}this.__managePulse(),this.__manageIconStatus(),this.eventHandler.raise(n.UiIconEvents.onActiveEventsChanged),this.eventHandler.raise(n.UiIconEvents.onDisplayedEventsChanged)}__removeEventSubscriptions(e){if(!this.__eventsDataSymbols)return;let a=this.__eventsDataSymbols[e];null!=a&&(null!=a.activateSubscriptionId&&t.Server.subscriptionCollector.remove(a.activateSubscriptionId),null!=a.eventConditionSubscriptionId&&t.Server.subscriptionCollector.remove(a.eventConditionSubscriptionId),null!=a.eventStateSubscriptionId&&t.Server.subscriptionCollector.remove(a.eventStateSubscriptionId),null!=a.eventCountSubscriptionId&&t.Server.subscriptionCollector.remove(a.eventCountSubscriptionId))}__removeDataSubscriptions(e){if(null==this.__displaysDataSymbols)return;const a=this.__displaysDataSymbols.get(e);null!=a&&(null!=a.valueSubscriptionId&&t.Server.subscriptionCollector.remove(a.valueSubscriptionId),null!=a.unitSubscriptionId&&t.Server.subscriptionCollector.remove(a.unitSubscriptionId),null!=a.readOnlySubscriptionId&&t.Server.subscriptionCollector.remove(a.readOnlySubscriptionId))}__processDisplayPositions(){if(null!=this.__displays&&null!=this.__attrHandler.displaysData)for(let[e,t]of this.__displays){const a=this.__attrHandler.displaysData.get(e);if(null==a)continue;null==a.position&&(a.position=n.DisplayPosition.top);for(let e=n.DisplayPosition.left;e<=n.DisplayPosition.bottomLeft;e++)t.getElement().removeClass(n.DisplayPosition[e]);t.getElement().addClass(n.DisplayPosition[a.position]);let i=[];for(let[e,t]of this.__attrHandler.displaysData)t.position==a.position&&i.push({name:e,order:t.order});i.length>1&&(i=i.sort(((e,t)=>null==e.order&&null==t.order?0:null==e.order&&null!=t.order?1:null==t.order&&null!=e.order||e.order>t.order?-1:0))),t.getElement().css("--tchmi-ba-ui-icon-display-number",i.findIndex((t=>t.name===e))),i.length>1&&t.getElement().addClass("count-over-1"),t.getElement().css("--tchmi-ba-ui-icon-display-count",i.length)}}__resolveDisplayAttributeSymbolExpression(a){if("string"!=typeof a||!e.Symbol.isSymbolExpression(a))throw new t.BaseError("Not a SymbolExpression!");let n=new e.SymbolExpression(a);switch(n.getType()){case e.SymbolType.Server:break;case e.SymbolType.PartialParam:n=t.Helper.Mapping.resolvePartialParam(this,n);break;default:throw new t.BaseError("Not handled SymbolExpression")}return t.Helper.String.toServerMapping(n)}processBaObject(){if(null==this.baObjectHandler.baObject)return void this.setEventsData(null);let a=this.baObjectHandler.baObject;if(a instanceof t.BA.BaView||a instanceof t.BA.BaEventObject){let n=this.busyHandler.setBusy("Watching events of BaObject",{showIndicator:t.BusyHandler.ShowEventLoading}),i=a.eventHandler.watchEventsPerIcon((e=>{this.__onEventDataChanged(e),n()}));null!=i?this.__eventWatchIdentifier=i:n(),null!=a&&null==this.__destroyOnDeviceConnectionStateChanged&&(this.__destroyOnDeviceConnectionStateChanged=e.EventProvider.register(a.Device.eventNames.onConnectionStateChanged,(()=>{if(a instanceof t.BA.BaView||a instanceof t.BA.BaEventObject)switch(a.Device.diagnostics.connectionState){case t.BA.BaDevice.ConnectionState.disabled:case t.BA.BaDevice.ConnectionState.unknown:case t.BA.BaDevice.ConnectionState.error:case t.BA.BaDevice.ConnectionState.disconnected:this.setEventsData(null),null!=this.__eventWatchIdentifier&&(a.eventHandler.stopWatchEventsPerIcon(this.__eventWatchIdentifier),delete this.__eventWatchIdentifier);break;case t.BA.BaDevice.ConnectionState.connected:this.processBaObject();break;case t.BA.BaDevice.ConnectionState.disconnecting:case t.BA.BaDevice.ConnectionState.connecting:break;default:throw new t.BaseError("Invalid connection state!")}})))}this.__processShowTag()}getConnection(e){let a=this.__element.children(".connection."+t.Position[e]);return a[0]?a:null}getDisplays(){return this.__displays}getDisplay(e){if(null==this.__displays)return null;const t=this.__displays.get(e);return null==t?null:t}addDisplay(e,n){null==this.__displays&&(this.__displays=new Map),null==this.__attrHandler.displaysData&&(this.__attrHandler.displaysData=new Map);let i=this.__displays?.get(e);if(null==i)return this.__attrHandler.displaysData.set(e,n),i=new a.InputBox(this.__id+"-display-"+e,this),i.getElement().on("pointerdown click",t.EventHandler.stopPropagationHandler),this.__displays.set(e,i),this.updateDisplay(e,n),this.__destroyersToCallOnDestroy.push(i.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,((e,t)=>this.__onDisplayValueChanged(t)))),i;throw new Error(`A display with name '${e}' has already been added.`)}updateDisplay(a,n){if(null==this.__attrHandler.displaysData)throw new Error("No display data available!");let i=this.__displays?.get(a);if(null==i)throw new Error(`No display with name '${a}' found.`);{this.__attrHandler.displaysData.set(a,{...this.__attrHandler.displaysData.get(a),...n});let s=this.__displaysDataSymbols?this.__displaysDataSymbols.get(a):void 0,r=n.value;null!=r&&"string"==typeof r&&e.Symbol.isSymbolExpression(r)&&(null==s?s={}:null!=s.valueSubscriptionId&&t.Server.subscriptionCollector.remove(s.valueSubscriptionId),s.valueMapping=this.__resolveDisplayAttributeSymbolExpression(r),s.valueSubscriptionId=t.Server.subscriptionCollector.add(s.valueMapping,(e=>{i?.setValueFeedback(e)})),n.value=void 0),null!=n.unit&&"string"==typeof n.unit&&e.Symbol.isSymbolExpression(n.unit)&&(null==s?s={}:null!=s.unitSubscriptionId&&t.Server.subscriptionCollector.remove(s.unitSubscriptionId),s.unitMapping=this.__resolveDisplayAttributeSymbolExpression(n.unit),s.unitSubscriptionId=t.Server.subscriptionCollector.add(s.unitMapping,(e=>{i?.setUnit(e)})),n.unit=void 0);let o=n.readOnly;null!=o&&("string"==typeof o&&e.Symbol.isSymbolExpression(o)?(null==s?s={}:null!=s.readOnlySubscriptionId&&t.Server.subscriptionCollector.remove(s.readOnlySubscriptionId),s.readOnlyMapping=this.__resolveDisplayAttributeSymbolExpression(o),s.readOnlySubscriptionId=t.Server.subscriptionCollector.add(s.readOnlyMapping,(e=>{i?.setReadOnly(e)})),n.readOnly=void 0):"boolean"!=typeof o&&(console.warn(`Wrong data input for attribute read only in UiIcon ${this.__id}!`),n.readOnly=!0)),s&&(this.__displaysDataSymbols||(this.__displaysDataSymbols=new Map),this.__displaysDataSymbols.set(a,s)),null==n.digits&&null!=this.__attrHandler.displayedDigits&&(n.digits=this.__attrHandler.displayedDigits),i.setAttributes(n),this.__processDisplayPositions(),this.__processShowDisplays()}}removeDisplay(e){const t=this.__displays?.get(e);return!(null==this.__attrHandler.displaysData||!t)&&(this.__attrHandler.displaysData.delete(e),null==this.__attrHandler.displaysData.size&&(this.__attrHandler.displaysData=null),this.__removeDataSubscriptions(e),t.getElement().detach(),t.destroy(),this.__displays?.delete(e),this.__processDisplayPositions(),this.__processShowDisplays(),!0)}setDisplayPosition(e,t){if(null==this.__attrHandler.displaysData||null==this.__displays)return;const a=this.__attrHandler.displaysData.get(e);null!=a&&0!=this.__displays.has(e)?(a.position=t,this.__processDisplayPositions()):this.logger.warn(`Can't set position of display with name ${e} because it does not exist!`)}setAttributes(e){return super.setAttributes(e),void 0!==e.displaysData&&this.setDisplaysData(e.displaysData),void 0!==e.displayedDigits&&this.setDisplayedDigits(e.displayedDigits),void 0!==e.isActive&&this.setIsActive(e.isActive),void 0!==e.hasEvent&&this.setHasEvent(e.hasEvent),void 0!==e.iconStatus&&this.setIconStatus(e.iconStatus),void 0!==e.borderStatus&&this.setBorderStatus(e.borderStatus),void 0!==e.eventsData&&this.setEventsData(e.eventsData),void 0!==e.showDisplays&&this.setShowDisplays(e.showDisplays),void 0!==e.connections&&this.setConnections(e.connections),void 0!==e.connectionExtensions&&this.setConnectionExtensions(e.connectionExtensions),void 0!==e.connectionsWidth&&this.setConnectionsWidth(e.connectionsWidth),void 0!==e.connectionColors&&this.setConnectionColors(e.connectionColors),this}getAttributes(){return this.__attrHandler.getRef()}setDisplaysData(e){return this.__attrHandler.checkAttribute(e,"displaysData",{validator:()=>e instanceof Map})?(this.__attrHandler.displaysData=e,this.__processDisplaysData(),this):this}__processDisplaysData(){if(null==this.__attrHandler.displaysData||this.__attrHandler.displaysData.size<=0){if(this.__displays){for(let[e,t]of this.__displays)this.__removeDataSubscriptions(e),t.getElement().detach(),t.destroy();delete this.__displays}}else{if(null!=this.__displays)for(const e of this.__displays.keys())0==this.__attrHandler.displaysData.has(e)&&this.removeDisplay(e);for(let[e,t]of this.__attrHandler.displaysData){let a=this.__displays?.get(e);null==a?a=this.addDisplay(e,t):this.updateDisplay(e,t)}}}getDisplaysData(){return this.__attrHandler.displaysData}setDisplayedDigits(e){return this.__attrHandler.checkAttribute(e,"displayedDigits",{validator:"number"})?(this.__attrHandler.displayedDigits=e,this.__processDisplayedDigits(),this):this}__processDisplayedDigits(){if(null!=this.__attrHandler.displayedDigits&&null!=this.__attrHandler.displaysData)for(let[e,t]of this.__attrHandler.displaysData)this.updateDisplay(e,t)}getDisplayedDigits(){return this.__attrHandler.displayedDigits}setIsActive(e){return this.__attrHandler.checkAttribute(e,"isActive",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.isActive=e,this.__processIsActive(),this):this}__processIsActive(){if(null!=this.__attrHandler.isActive){for(let e in t.EventType)this.__element.removeClass("has-event-"+e);this.__attrHandler.isActive?this.__element.addClass("is-active"):this.__element.removeClass("is-active")}else this.__element.removeClass("is-active")}getIsActive(){return this.__attrHandler.isActive}setHasEvent(e){return this.__attrHandler.checkAttribute(e,"hasEvent",{validator:"number"})?(this.__attrHandler.hasEvent=e,this.__processHasEvent(),this):this}__processHasEvent(){for(let e in t.EventType)this.__element.removeClass("has-event-"+e);null!=this.__attrHandler.hasEvent&&this.__attrHandler.hasEvent>t.EventType.invalid&&(this.__element.removeClass("is-active"),this.__element.addClass("has-event-"+t.EventType[this.__attrHandler.hasEvent]))}getHasEvent(){return this.__attrHandler.hasEvent}setIconStatus(e){return this.__attrHandler.checkAttribute(e,"iconStatus",{validator:"number"})?(this.__attrHandler.iconStatus=e,this.__processIconStatus(),this):this}__processIconStatus(){for(let e in n.Status)this.__element.removeClass("icon-status-"+e);null!=this.__attrHandler.iconStatus&&this.__attrHandler.iconStatus>n.Status.invalid?(this.__element.addClass("icon-status"),this.__element.addClass("icon-status-"+n.Status[this.__attrHandler.iconStatus])):this.__element.removeClass("icon-status"),this.__manageIconStatus()}getIconStatus(){return this.__attrHandler.iconStatus}setBorderStatus(e){return this.__attrHandler.checkAttribute(e,"borderStatus",{validator:"number"})?(this.__attrHandler.borderStatus=e,this.__processBorderStatus(),this):this}__processBorderStatus(){for(let e in n.Status)this.__element.removeClass("border-status-"+e);null!=this.__attrHandler.borderStatus&&this.__attrHandler.borderStatus>n.Status.invalid?(this.__element.addClass("border-status"),this.__element.addClass("border-status-"+n.Status[this.__attrHandler.borderStatus])):this.__element.removeClass("border-status")}getBorderStatus(){return this.__attrHandler.borderStatus}setEventsData(e){return this.__attrHandler.checkAttribute(e,"eventsData",{validator:"array"})?(this.__attrHandler.eventsData=e,this.__processEventsData(),this):this}__processEventsData(){if(null==this.__attrHandler.eventsData||this.__attrHandler.eventsData.length<=0){if(this.__eventIcons){for(let e=0;e<this.__eventIcons.length;e++){let t=this.__eventIcons[e];t.getIsAttached()&&t.getElement().detach(),t.destroy(),this.__removeEventSubscriptions(e)}delete this.__eventIcons}}else this.__createEventIcons();this.__activateEvents()}getEventsData(){return this.__attrHandler.eventsData}setShowDisplays(e){return this.__attrHandler.checkAttribute(e,"showDisplays",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.showDisplays=e,this.__processShowDisplays(),this):this}__processShowDisplays(){if(this.__attrHandler.showDisplays){if(null==this.__displays)return;for(let e of this.__displays.values())!1===e.getIsAttached()&&this.__element.append(e.getElement())}else{if(null==this.__displays)return;for(let e of this.__displays.values())!0===e.getIsAttached()&&e.getElement().detach()}}getShowDisplays(){return this.__attrHandler.showDisplays}setConnections(e){return this.__attrHandler.checkAttribute(e,"connections",{validator:"object"})?(this.__attrHandler.connections=e,this.__processConnections(),this):this}__processConnections(){if(null==this.__attrHandler.connections){let e=this.__element.children(".connection");e[0]&&e.detach()}else{for(let e in this.__attrHandler.connections){if(e.indexOf("Unit")>-1)continue;if("top"!=e&&"right"!=e&&"bottom"!=e&&"left"!=e)continue;let t=this.__attrHandler.connections[e],a=this.__element.children(".connection."+e);if(null==t||t<=0)a[0]&&a.detach();else{let n;switch(a[0]||(a=$("<div>").addClass("connection "+e),this.__element.append(a)),e){case"bottom":case"top":if(t>0&&a.css("height",t+"px"),this.__attrHandler.connectionExtensions){for(let t in this.__attrHandler.connectionExtensions)if("left"===t||"right"===t){n=a.children(".connection.extension."+e+"."+t);let i=this.__attrHandler.connectionExtensions[t];i?(n[0]||(n=$("<div>").addClass("connection extension "+e+" "+t),a.append(n)),i>0&&n.css("width",i+"px")):n[0]&&n.detach()}}else a.children(".connection.extension."+e+".left").detach(),a.children(".connection.extension."+e+".right").detach();break;case"right":case"left":if(t>0&&a.css("width",t+"px"),this.__attrHandler.connectionExtensions){for(let t in this.__attrHandler.connectionExtensions)if("top"===t||"bottom"===t){n=a.children(".connection.extension."+e+"."+t);let i=this.__attrHandler.connectionExtensions[t];i?(n[0]||(n=$("<div>").addClass("connection extension "+e+" "+t),a.append(n)),i>0&&n.css("height",i+"px")):n[0]&&n.detach()}}else a.children(".connection.extension."+e+".top").detach(),a.children(".connection.extension."+e+".bottom").detach()}}}this.__processConnectionColors()}}getConnections(){return this.__attrHandler.connections}setConnectionExtensions(e){return this.__attrHandler.checkAttribute(e,"connectionExtensions",{validator:"object"})?(this.__attrHandler.connectionExtensions=e,this.__processConnectionExtensions(),this):this}__processConnectionExtensions(){this.__processConnections()}getConnectionExtensions(){return this.__attrHandler.connectionExtensions}setConnectionsWidth(e){return this.__attrHandler.checkAttribute(e,"connectionsWidth",{validator:"number"})?(this.__attrHandler.connectionsWidth=e,this.__processConnectionsWidth(),this):this}__processConnectionsWidth(){null==this.__attrHandler.connectionsWidth?this.__element.css("--tchmi-ba-ui-icon-connections-width",""):this.__element.css("--tchmi-ba-ui-icon-connections-width",this.__attrHandler.connectionsWidth+"px")}getConnectionsWidth(){return this.__attrHandler.connectionsWidth}setConnectionColors(e){if(!this.__attrHandler.checkColorAttribute(e,"connectionColors",{doNotlogError:!0})&&!this.__attrHandler.checkAttribute(e,"connectionColors",{validator:t.Color.isIFourSidedColor}))return this;let a;return a=e instanceof t.Color.RGBAColor?{left:e,right:e,top:e,bottom:e}:e,this.__attrHandler.connectionColors=a,this.__processConnectionColors(),this}__processConnectionColors(){if(null==this.__attrHandler.connectionColors)this.__element.find(".connection").css("background-color","");else for(let e in this.__attrHandler.connectionColors)null==this.__attrHandler.connectionColors[e]?this.__element.children(".connection."+e).css("background-color",""):this.__element.children(".connection."+e).css("background-color",this.__attrHandler.connectionColors[e].toString())}getConnectionColors(){return this.__attrHandler.connectionColors}setShowTag(e){return this.__attrHandler.checkAttribute(e,"showTag",{validator:"number"})?(this.__attrHandler.showTag=e,this.__processShowTag(),this):this}__processShowTag(){const e="tagDisplay";if(null==this.baObjectHandler.baObject||null==this.__attrHandler.showTag)this.removeDisplay(e);else{if(null==this.baObjectHandler.baObject.Params)throw new Error("BaObject not loaded yet! Make sure to loadAttributes of BaObject!");let a=this.getDisplay(e);null==a&&(a=this.addDisplay(e,{readOnly:!0,textAttributes:{fontWeight:"Bold"}})),this.updateDisplay(e,{position:this.__attrHandler.showTag,value:t.Helper.String.toSymbolExpression(this.baObjectHandler.baObject.Params?.get(t.BA.BaParameterId.eTag).Mapping,"s")})}}getShowTag(){return this.__attrHandler.showTag}}a.UiIcon=n,function(e){let a,n,i;!function(e){e.onActiveEventsChanged="onUiIconActiveEventsChanged",e.onDisplayedEventsChanged="onUiIconDisplayedEventsChanged",e.onDisplayValueChanged="onUiIconDisplayValueChanged"}(a=e.UiIconEvents||(e.UiIconEvents={})),function(e){e[e.left=0]="left",e[e.top=1]="top",e[e.right=2]="right",e[e.bottom=3]="bottom",e[e.topLeft=4]="topLeft",e[e.topRight=5]="topRight",e[e.bottomRight=6]="bottomRight",e[e.bottomLeft=7]="bottomLeft"}(n=e.DisplayPosition||(e.DisplayPosition={})),function(e){e[e.invalid=0]="invalid",e[e.alarm=1]="alarm",e[e.disturb=2]="disturb",e[e.maintenance=3]="maintenance",e[e.notification=4]="notification",e[e.other=5]="other",e[e.active=20]="active",e[e.inactive=21]="inactive"}(i=e.Status||(e.Status={})),e.AutoActivateIconStatus=!1,e.EnableEventCountBadge=!0,e.MaximumEventTypePulse=new Map([[t.BA.Role.eGuest,t.BA.EventType.eDisturb],[t.BA.Role.eBasic,t.BA.EventType.eDisturb],[t.BA.Role.eAdvanced,t.BA.EventType.eDisturb],[t.BA.Role.eExpert,t.BA.EventType.eDisturb],[t.BA.Role.eInternal,t.BA.EventType.eDisturb]]),e.MaximumEventConditionDisplayed=new Map([[t.BA.Role.eGuest,t.BA.EventCondition.eTypeOther],[t.BA.Role.eBasic,t.BA.EventCondition.eTypeOther],[t.BA.Role.eAdvanced,t.BA.EventCondition.eEventIconDisplayed],[t.BA.Role.eExpert,t.BA.EventCondition.eEventIconDisplayed],[t.BA.Role.eInternal,t.BA.EventCondition.eEventIconDisplayed]]),e.EventIconSize=30,e.AutoScaleEventIconThreshold=40}(n=a.UiIcon||(a.UiIcon={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(a,n){super(a,n),this.__originalLeft=null,this.__originalTop=null,this.__originalRight=null,this.__originalBottom=null,this.__originalMouseX=null,this.__originalMouseY=null,this.__maxPos=null,this.valueField=new t.ValueField(this.__id+"-value-field",this),this.__startTimeDisplay=$("<div>").addClass("time-display start"),this.__resizerStart=$("<div>").addClass("resizer start"),this.__contentContainer=$("<div>").addClass("content-container"),this.__element.addClass("daily-schedule-entry"),this.__elementPressedHandler=e=>this.__onElementPressed(e),this.__pressEndHandler=e=>this.__onPressEnd(e),this.__moveHandler=e=>this.__onMoved(e),this.__resizerPressedHandler=e=>this.__onResizerPressed(e),this.__editButtonPressedHandler=()=>this.__onEditButtonPressed(),this.__deleteButtonPressedHandler=()=>this.__onDeleteButtonPressed(),this.__cbStateChangedHandler=()=>this.__onCbStateChanged();let i=[{onPressed:this.__editButtonPressedHandler,cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Edit,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)})))}},{onPressed:this.__deleteButtonPressedHandler,cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Delete,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)})))}},{name:"select-state",controls:{type:t.ComponentType.Combobox,callback:this.__cbStateChangedHandler,name:"cb",settings:{readOnly:!1,data:[{text:"value",value:e.BA.SchedEntryState.eValue},{text:"null",value:e.BA.SchedEntryState.eNull}]}},cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.State,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text+":")})))}}],s=t.ContextMenu.createContextMenuAndButton({id:this.__id,root:this.__element,parent:this,rowEntryOptions:i});this.__contextMenu=s.menu,this.__menuButton=s.button,this.__menuButton.getElement().addClass("menu-button"),this.__element.append(this.__startTimeDisplay),this.__element.append(this.__resizerStart),this.__cbState=this.__contextMenu.getRowEntry("select-state")?.controlContainer.getControl("cb"),this.__element.append(this.__contentContainer),this.valueField.getElement().addClass("value-field"),this.setAllowMoving(!0),this.setSnapPeriode(1),this.valueField.setActiveText(e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.Active)),this.valueField.setInactiveText(e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.Inactive))}__attach(){this.__isAttached||(this.__element.on("mousedown touchstart",this.__elementPressedHandler),this.__resizerStart.on("mousedown touchstart",this.__resizerPressedHandler),this.__destroyersToCallOnDetach.push(this.valueField.eventHandler.register(t.ValueField.ValueFieldEvents.onValueChanged,(()=>this.__onValueChanged()))),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("mousedown touchstart",this.__elementPressedHandler),this.__resizerStart.off("mousedown touchstart",this.__resizerPressedHandler),super.__detach())}destroy(){this.valueField.destroy();let e=this.childrenHandler.getChildren().get(this.__id+"-null-indicator");e?.destroy(),super.destroy()}__onElementPressed(t){t.stopPropagation(),"mousedown"===t.type&&t.button!==e.MouseButtons.left||"input"!==t.target.localName&&this.__attrHandler.allowMoving&&this.__resizerPressedHandler(t)}__onPressEnd(e){$(window).off("mousemove touchmove",this.__moveHandler),$(window).off("mouseup touchend",this.__pressEndHandler)}__onMoved(t){if(null==this.__attrHandler.startTime||null==this.__attrHandler.endTime||null==this.__attrHandler.offset||null==this.__maxPos)return;let a=this.__currentTarget;if(null==a)return;let n=this.__attrHandler.startTime.toSeconds(),i=this.__attrHandler.endTime.toSeconds(),s=null,r=null;if("mousemove"===t.type?(s=t.pageX,r=t.pageY):"touchmove"===t.type&&(s=t.touches[0].pageX,r=t.touches[0].pageY),null!==s&&null!==r){switch(this.__attrHandler.orientation){case e.Orientation.vertical:if(null===this.__originalTop||null===this.__originalBottom||null===this.__originalMouseY)return;a.classList.contains("start")?n=Math.floor((this.__originalTop+(r-this.__originalMouseY))/this.__attrHandler.offset):(n=Math.floor((this.__originalTop+(r-this.__originalMouseY))/this.__attrHandler.offset),i=Math.floor((this.__maxPos-this.__originalBottom+(r-this.__originalMouseY))/this.__attrHandler.offset));break;case e.Orientation.horizontal:if(null===this.__originalLeft||null===this.__originalRight||null===this.__originalMouseX)return;a.classList.contains("start")?n=Math.floor((this.__originalLeft+(s-this.__originalMouseX))/this.__attrHandler.offset):(n=Math.floor((this.__originalLeft+(s-this.__originalMouseX))/this.__attrHandler.offset),i=Math.floor((this.__maxPos-this.__originalRight+(s-this.__originalMouseX))/this.__attrHandler.offset));break;default:throw new e.BaseError("Invalid orientation!")}this.__validateNewTimes(n,i)}}__onResizerPressed(t){if(t.stopPropagation(),0!=this.checkAccess(e.Server.AccessRight.operate)&&("mousedown"!==t.type||t.button===e.MouseButtons.left)&&!0!==this.__attrHandler.readOnly){switch(this.__attrHandler.orientation){case e.Orientation.vertical:this.__originalTop=Number(this.__element.css("top").replace("px","")),this.__originalBottom=Number(this.__element.css("bottom").replace("px","")),"mousedown"===t.type?this.__originalMouseY=t.pageY:"touchstart"===t.type&&(this.__originalMouseY=t.touches[0].pageY);break;case e.Orientation.horizontal:this.__originalLeft=Number(this.__element.css("left").replace("px","")),this.__originalRight=Number(this.__element.css("right").replace("px","")),"mousedown"===t.type?this.__originalMouseX=t.pageX:"touchstart"===t.type&&(this.__originalMouseX=t.touches[0].pageX);break;default:throw new e.BaseError("Invalid orientation!")}this.__currentTarget=t.currentTarget,$(window).on("mousemove touchmove",this.__moveHandler),$(window).on("mouseup touchend",this.__pressEndHandler)}}__onValueChanged(){if(null!=this.__attrHandler.unionValue){switch(this.__attrHandler.dataType){case e.DataType.boolean:this.__attrHandler.unionValue.bVal=this.valueField.getValue(),this.valueField.setValue(this.__attrHandler.unionValue.bVal);break;case e.DataType.number:this.__attrHandler.unionValue.rVal=this.valueField.getValue(),this.valueField.setValue(this.__attrHandler.unionValue.rVal);break;case e.DataType.enum:this.__attrHandler.unionValue.udiVal=this.valueField.getValue(),this.valueField.setValue(this.__attrHandler.unionValue.udiVal)}this.__updateStateColors(),this.eventHandler.raise(a.DailyScheduleEntryEvents.onValueChanged)}}__onEditButtonPressed(){if(this.__contextMenu.close(),null!=this.__attrHandler.startTime&&null!=this.__attrHandler.endTime){let a,n,i=t=>{a=e.BA.BaTime.fromDate(t)},s=async i=>{if(null==a&&(a=e.BA.BaTime.fromDate(i)),this.__baParent instanceof t.DailySchedule)if(e.Helper.Map.getNext(this.__baParent.getScheduleEntries(),this.__id)){let i=t=>{n=e.BA.BaTime.fromDate(t)},s=async i=>{null==n&&(n=e.BA.BaTime.fromDate(i)),this.__validateNewTimes(a.toSeconds(),n.toSeconds())||await t.DialogWindow.alert("Input was not valid!")};t.TimePicker.openTimePickerDialog(this.__attrHandler.endTime.toDate(),e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.SelectNewEndTime),i,s)}else this.__validateNewTimes(a.toSeconds(),this.__attrHandler.endTime.toSeconds())||await t.DialogWindow.alert("Input was not valid!")};t.TimePicker.openTimePickerDialog(this.__attrHandler.startTime.toDate(),e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.SelectNewStartTime),i,s)}}async __onDeleteButtonPressed(){this.__contextMenu.close(),await t.DialogWindow.confirm("Do you really want to delete this entry?")&&this.eventHandler.raise(a.DailyScheduleEntryEvents.onEntryDeleted)}__onCbStateChanged(){this.__contextMenu.close(),this.setState(this.__cbState?.getSelectedValue())}__validateNewTimes(n,i,s){if(null==this.__attrHandler.startTime||null==this.__attrHandler.endTime)return!1;let r=!1,o=!1,l=!0;if(n!==this.__attrHandler.startTime.toSeconds()){if(null!=this.__attrHandler.minStartTime){let e=this.__attrHandler.minStartTime.toSeconds();n<e&&(n=e,o=!0)}if(i-n<t.WeeklySchedule.MinEntryTime)n=i-t.WeeklySchedule.MinEntryTime;else if(n<=a.minSeconds)n=a.minSeconds,o=!0;else if(n>=a.maxSeconds)n=a.maxSeconds-t.WeeklySchedule.MinEntryTime;else if(s){if(this.__baParent instanceof t.DailySchedule){e.Helper.Map.getPrevious(this.__baParent.getScheduleEntries(),this.__id),e.Helper.Map.getNext(this.__baParent.getScheduleEntries(),this.__id)}}else l=!1}else l=!1;if(i!==this.__attrHandler.endTime.toSeconds()){if(null!=this.__attrHandler.maxEndTime){let e=this.__attrHandler.maxEndTime.toSeconds();i>e&&(i=e,r=!0,l=!0)}if(i-n<t.WeeklySchedule.MinEntryTime)i=n+t.WeeklySchedule.MinEntryTime,r=!0,l=!0;else if(i>=a.maxSeconds)i=a.maxSeconds,r=!0,l=!0;else if(i<=a.minSeconds)i=a.minSeconds,l=!0;else if(s){if(this.__baParent instanceof t.DailySchedule){e.Helper.Map.getPrevious(this.__baParent.getScheduleEntries(),this.__id),e.Helper.Map.getNext(this.__baParent.getScheduleEntries(),this.__id)}l=!0}else l=!1}else l=!1;return r||this.setStartTime(e.BA.BaTime.fromSeconds(n)),o||this.setEndTime(e.BA.BaTime.fromSeconds(i)),!l}__updateStateColors(){if(null==this.__attrHandler.unionValue)return;let n=this.__attrHandler.stateColors;switch(null==n&&(n=a.StateColors),this.__attrHandler.dataType){case e.DataType.boolean:this.__attrHandler.unionValue.bVal?this.backgroundStyler.setColor(n.binary.true):this.backgroundStyler.setColor(n.binary.false);break;case e.DataType.number:n.analog=e.Helper.Array.mergeSort(n.analog,!1,((e,t)=>e.start>t.start));for(let t=0;t<n.analog.length;t++){if(n.analog[t].start==this.__attrHandler.unionValue.rVal){this.backgroundStyler.setColor(n.analog[t].color);break}if(n.analog[t].start>this.__attrHandler.unionValue.rVal){if(0==t){this.backgroundStyler.setColor(n.analog[t].color);break}this.backgroundStyler.setColor(e.Color.getFadeColor(n.analog[t-1].color,n.analog[t-1].start,n.analog[t].color,n.analog[t].start,this.__attrHandler.unionValue.rVal));break}if(n.analog[t].start<this.__attrHandler.unionValue.rVal&&t==n.analog.length-1){this.backgroundStyler.setColor(n.analog[t].color);break}}break;case e.DataType.enum:null!=n.multistate[this.__attrHandler.unionValue.udiVal]?(this.errorIndicator.reset(),this.backgroundStyler.setColor(n.multistate[this.__attrHandler.unionValue.udiVal])):(this.errorIndicator.set(t.ErrorIndicator.ErrorLevel.error),this.backgroundStyler.setColor(null))}}updateStartPos(t){if(null!=this.__attrHandler.offset&&null!=t){let a=this.__attrHandler.offset*t.toSeconds();switch(this.__attrHandler.orientation){case e.Orientation.vertical:this.__element.css({top:a+"px",left:"0"});break;case e.Orientation.horizontal:this.__element.css({left:a+"px",top:"0"});break;default:throw new e.BaseError("Invalid orientation!")}}}updateEndPos(t){if(null!=this.__attrHandler.offset&&null!=t){let a=this.__attrHandler.offset*(86400-e.Helper.DateTime.convertSTTimeToSeconds(t));switch(this.__attrHandler.orientation){case e.Orientation.vertical:this.__element.css({bottom:a+"px",right:"0"});break;case e.Orientation.horizontal:this.__element.css({right:a+"px",bottom:"0"});break;default:throw new e.BaseError("Invalid orientation!")}}}setAttributes(e){return super.setAttributes(e),void 0!==e.startTime&&this.setStartTime(e.startTime),void 0!==e.endTime&&this.setEndTime(e.endTime),void 0!==e.minStartTime&&this.setMinStartTime(e.minStartTime),void 0!==e.maxEndTime&&this.setMaxEndTime(e.maxEndTime),void 0!==e.orientation&&this.setOrientation(e.orientation),void 0!==e.allowMoving&&this.setAllowMoving(e.allowMoving),void 0!==e.offset&&this.setOffset(e.offset),void 0!==e.snapPeriode&&this.setSnapPeriode(e.snapPeriode),void 0!==e.state&&this.setState(e.state),void 0!==e.stateColors&&this.setStateColors(e.stateColors),void 0!==e.unionValue&&this.setValue(e.unionValue),void 0!==e.dataType&&this.setDataType(e.dataType),this.valueField.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}setOffset(e){return this.__attrHandler.checkAttribute(e,"offset",{validator:"number"})?(this.__attrHandler.offset=e,this.__maxPos=24*(e||0)*60*60,null!=this.__attrHandler.startTime&&this.updateStartPos(this.__attrHandler.startTime),null!=this.__attrHandler.endTime&&this.updateEndPos(this.__attrHandler.endTime),this):this}getOffset(){return this.__attrHandler.offset}setStartTime(t){return this.__attrHandler.checkAttribute(t,"startTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?(null!=t&&null!=this.__attrHandler.snapPeriode&&t.snapToPeriode(60*this.__attrHandler.snapPeriode),this.__attrHandler.startTime?.equals(t)?(this.__attrHandler.equalAttribute("StartTime"),this):(this.__attrHandler.startTime=t,this.updateStartPos(this.__attrHandler.startTime),null!=this.__attrHandler.startTime?this.__startTimeDisplay?.html(this.__attrHandler.startTime.toString(e.BA.BaTime.TimeStringFormat.minutes)):this.__startTimeDisplay?.html("null"),this.eventHandler.raise(a.DailyScheduleEntryEvents.onStartTimeChanged),this)):this}getStartTime(){return this.__attrHandler.startTime}setEndTime(t){return this.__attrHandler.checkAttribute(t,"endTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?(null!=t&&null!=this.__attrHandler.snapPeriode&&t.snapToPeriode(60*this.__attrHandler.snapPeriode),this.__attrHandler.endTime?.equals(t)?(this.__attrHandler.equalAttribute("EndTime"),this):(this.__attrHandler.endTime=t,this.updateEndPos(this.__attrHandler.endTime),this.eventHandler.raise(a.DailyScheduleEntryEvents.onEndTimeChanged),this)):this}getEndTime(){return this.__attrHandler.endTime}setMinStartTime(t){return this.__attrHandler.checkAttribute(t,"minStartTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?this.__attrHandler.minStartTime?.equals(t)?(this.__attrHandler.equalAttribute("MinStartTime"),this):(this.__attrHandler.minStartTime=t,this):this}getMinStartTime(){return this.__attrHandler.minStartTime}setMaxEndTime(t){return this.__attrHandler.checkAttribute(t,"maxEndTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?this.__attrHandler.maxEndTime?.equals(t)?(this.__attrHandler.equalAttribute("MaxEndTime"),this):(this.__attrHandler.maxEndTime=t,this):this}getMaxEndTime(){return this.__attrHandler.maxEndTime}setSnapPeriode(e){return this.__attrHandler.checkAttribute(e,"snapPeriode",{validator:"number"})?(null==e&&(e=1),this.__attrHandler.snapPeriode=e,null==this.__attrHandler.snapPeriode&&(this.__attrHandler.snapPeriode=1),null!=this.__attrHandler.startTime&&this.setStartTime(this.__attrHandler.startTime.snapToPeriode(60*this.__attrHandler.snapPeriode)),null!=this.__attrHandler.endTime&&this.setEndTime(this.__attrHandler.endTime.snapToPeriode(60*this.__attrHandler.snapPeriode)),this):this}getSnapPeriode(){return this.__attrHandler.snapPeriode}setState(e){return this.__attrHandler.checkAttribute(e,"state",{validator:"number"})?(this.__attrHandler.state=e,this.__processState(),this.eventHandler.raise(a.DailyScheduleEntryEvents.onStateChanged),this):this}__processState(){if(this.__attrHandler.state===e.BA.SchedEntryState.eValue){this.__contentContainer.append(this.valueField.getElement());let e=this.childrenHandler.getChildren().get(this.__id+"-null-indicator");e&&(e.getElement().detach(),e.destroy())}else{this.valueField.getElement().detach();let e=new t.Textblock(this.__id+"-null-indicator",this);e.textHandler.setText("null"),e.getElement().addClass("value-field"),this.__contentContainer.append(e.getElement())}this.__cbState?.setSelectedValue(this.__attrHandler.state),this.__updateStateColors(),this.valueField.setStateTexts(this.__attrHandler.stateTexts)}getState(){return this.__attrHandler.state}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(this.__attrHandler.dataType=e,this.__processDataType(),this):this}__processDataType(){if(null!=this.__attrHandler.dataType)switch(this.__attrHandler.dataType){case e.DataType.boolean:this.valueField.setDataType(e.DataType.boolean);break;case e.DataType.number:this.valueField.setDataType(e.DataType.number),this.valueField.getElement().css({"max-width":"100px"});break;case e.DataType.enum:this.valueField.setDataType(e.DataType.enum)}else this.valueField.setDataType(null);this.__processValue()}getDataType(){return this.__attrHandler.dataType}setValue(e){return this.__attrHandler.checkAttribute(e,"unionValue",{validator:"object"})?(this.__attrHandler.unionValue=e,null!==this.__attrHandler.dataType&&this.__processValue(),this.eventHandler.raise(a.DailyScheduleEntryEvents.onValueChanged),this):this}__processValue(){if(null!=this.__attrHandler.dataType&&null!=this.__attrHandler.unionValue){switch(this.__attrHandler.dataType){case e.DataType.boolean:this.valueField.setValue(this.__attrHandler.unionValue.bVal);break;case e.DataType.number:this.valueField.setValue(this.__attrHandler.unionValue.rVal),this.valueField.getElement().css({"max-width":"100px"});break;case e.DataType.enum:this.valueField.setValue(this.__attrHandler.unionValue.udiVal)}this.__updateStateColors()}else this.valueField.setValue(null)}getValue(){return this.__attrHandler.unionValue}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){switch(this.__attrHandler.orientation){case e.Orientation.vertical:this.__resizerStart.removeClass("horizontal"),this.__element.removeClass("horizontal"),this.__startTimeDisplay.removeClass("horizontal"),this.__contextMenu.getElement().removeClass("horizontal"),this.__menuButton.getElement().removeClass("horizontal"),this.__contentContainer.removeClass("horizontal"),this.__resizerStart.addClass("vertical"),this.__element.addClass("vertical"),this.__startTimeDisplay.addClass("vertical"),this.__contextMenu.getElement().addClass("vertical"),this.__menuButton.getElement().addClass("vertical"),this.__contentContainer.addClass("vertical");break;case e.Orientation.horizontal:this.__resizerStart.removeClass("vertical"),this.__element.removeClass("vertical"),this.__startTimeDisplay.removeClass("vertical"),this.__contextMenu.getElement().removeClass("vertical"),this.__menuButton.getElement().removeClass("vertical"),this.__contentContainer.removeClass("vertical"),this.__resizerStart.addClass("horizontal"),this.__element.addClass("horizontal"),this.__startTimeDisplay.addClass("horizontal"),this.__contextMenu.getElement().addClass("horizontal"),this.__menuButton.getElement().addClass("horizontal"),this.__contentContainer.addClass("horizontal");break;default:throw new e.BaseError("Invalid orientation!")}}getOrientation(){return this.__attrHandler.orientation}setAllowMoving(e){return this.__attrHandler.checkAttribute(e,"allowMoving",{validator:"boolean"})?(this.__attrHandler.allowMoving=e,this.__processAllowMoving(),this):this}__processAllowMoving(){}getAllowMoving(){return this.__attrHandler.allowMoving}setStateColors(e){return this.__attrHandler.checkAttribute(e,"stateColors",{validator:"object"})?(this.__attrHandler.stateColors=e,this.__processStateColors(),this):this}__processStateColors(){null!=this.__attrHandler.dataType&&null!=this.__attrHandler.unionValue&&null!=this.__attrHandler.stateColors&&null!=this.__attrHandler.state&&(this.__attrHandler.state===e.BA.SchedEntryState.eValue?this.__updateStateColors():this.backgroundStyler.setColor(null))}getStateColors(){return this.__attrHandler.stateColors}__processReadOnly(){super.__processReadOnly(),null!==this.__attrHandler.readOnly&&(this.valueField.setReadOnly(this.__attrHandler.readOnly),this.__processAllowMoving(),!1===this.__attrHandler.readOnly?this.__element.append(this.__menuButton.getElement()):this.__menuButton.getElement().detach())}}t.DailyScheduleEntry=a,function(t){let a;!function(e){e.onEntryDeleted="onEntryDeleted",e.onValueChanged="onValueChanged",e.onStateChanged="onStateChanged",e.onStartTimeChanged="onStartTimeChanged",e.onEndTimeChanged="onEndTimeChanged"}(a=t.DailyScheduleEntryEvents||(t.DailyScheduleEntryEvents={})),t.minSeconds=0,t.maxSeconds=86399,t.StateColors={analog:[{start:0,color:e.Color.RGBAColor.Gray},{start:100,color:e.Color.RGBAColor.Blue}],binary:{false:e.Color.RGBAColor.Gray,true:e.Color.RGBAColor.TcHmiGreen},multistate:[e.Color.RGBAColor.MetallicSilver,e.Color.RGBAColor.Gray,e.Color.RGBAColor.Goldenrod,e.Color.RGBAColor.Cantaloupe,e.Color.RGBAColor.RedFox,e.Color.RGBAColor.ChilliPepper,e.Color.RGBAColor.PlumVelvet,e.Color.RGBAColor.BurntPink]}}(a=t.DailyScheduleEntry||(t.DailyScheduleEntry={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.Base{constructor(e,n){super(e,n),this.resizeHandler=new a.ResizeHandler(this),this.__data=new Map,this.__scheduleEntries=new Map,this.__hasChanges=!1,this.__headline=new a.Textblock(this.__id+"-headline",this),this.__scheduleEntriesContainer=$("<div>").addClass("schedule-entries-container"),this.__element.addClass("daily-schedule"),this.__element.append(this.__headline.getElement());let i=[{text:t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.AddEntry),onPressed:()=>this.__onAddEntryPressed()},{text:t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Reset),name:"reset-button",onPressed:()=>this.__onResetEntryPressed()},{text:t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Copy),name:"copy-button",onPressed:()=>this.__onCopyEntryPressed()},{text:t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Paste),name:"paste-button",onPressed:()=>this.__onPasteEntryPressed()}],s=a.ContextMenu.createContextMenuAndButton({id:this.__id,root:this.__element,parent:this,rowEntryOptions:i});this.__contextMenu=s.menu,this.__menuButton=s.button,this.__menuButton.getElement().addClass("menu-button"),this.__headline.getElement().append(s.button.getElement()),this.__scheduleEntriesContainer.css("height","calc(100% - "+this.__headline?.layoutHandler.getHeight()+")"),this.__element.append(this.__scheduleEntriesContainer),this.__resetEntry=this.__contextMenu.getRowEntry("reset-button"),this.setOrientation(t.Orientation.vertical),this.setActiveText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Active)),this.setInactiveText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Inactive))}__attach(){if(this.__isAttached)return;this.__processData();const e=this.__contextMenu.getRowEntry("paste-button");null!=e&&this.__destroyersToCallOnDetach.push(e.eventHandler.register(a.BaseNode.BaseNodeEvents.onAttached,(()=>{null==n.__localeStorage?e?.setIsEnabled(!1):e?.setIsEnabled(null!=n.__localeStorage.get("schedEntries"))}))),super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__headline?.destroy(),this.__scheduleEntries.forEach((e=>e.destroy())),this.resizeHandler.destroy(),super.destroy()}static __sortData(e,a){return t.Helper.DateTime.convertSTTimeToSeconds(e[1].stTime)<t.Helper.DateTime.convertSTTimeToSeconds(a[1].stTime)?-1:t.Helper.DateTime.convertSTTimeToSeconds(e[1].stTime)>t.Helper.DateTime.convertSTTimeToSeconds(a[1].stTime)?1:0}static __convertDataToArray(e){let t=[];for(let a of e.values())t.push(a);return t}__convertDataToMap(e){let a=new Map;for(let n=0;n<e.length;n++)e[n].eState>=t.BA.SchedEntryState.eValue&&a.set(this.__id+"-entry-"+n,e[n]);return a}__convertSchedEntriesToData(e){if(e=e.sort(((e,a)=>e.eState<=t.BA.SchedEntryState.eUndefined||t.Helper.DateTime.convertSTTimeToSeconds(e.stTime)>t.Helper.DateTime.convertSTTimeToSeconds(a.stTime)?1:-1)),null!=this.__attrHandler.maximumEntryCount&&this.__data.size>this.__attrHandler.maximumEntryCount)for(this.logger.warn("There are more daily entries set than allowed by maximumEntryCount!\n Data will be reduced to the allowed size.");e.length>this.__attrHandler.maximumEntryCount;)e.pop();return this.__convertDataToMap(e)}__setHasChanges(e){this.__hasChanges=e,this.__resetEntry?.setIsEnabled(e),this.eventHandler.raise(n.DailyScheduleEvents.onDataChanged)}__calculateOffset(){let e=0;switch(this.__attrHandler.orientation){case t.Orientation.vertical:let a=this.__scheduleEntriesContainer.innerHeight();void 0!==a&&a>0&&(e=a/86400);break;case t.Orientation.horizontal:let n=this.__scheduleEntriesContainer.innerWidth();void 0!==n&&n>0&&(e=n/86400);break;default:throw new t.BaseError("Invalid orientation!")}return e}resetChanges(){if(this.__oldData){this.__data=new Map;for(let[e,t]of this.__oldData)this.__data.set(e,JSON.parse(JSON.stringify(t)))}else this.__data=new Map;this.__processData(),this.__setHasChanges(!1)}resetHasChanges(){this.__setHasChanges(!1),this.__oldData=new Map;for(let[e,t]of this.__data)this.__oldData.set(e,JSON.parse(JSON.stringify(t)))}getScheduleEntries(){return this.__scheduleEntries}updatePositions(){this.__scheduleEntries.forEach((e=>{e.setOffset(this.__calculateOffset())}))}hasChanges(){return this.__hasChanges}appendTimeCursor(){if(null==this.__timeCursor){const e='<svg version="1.1"\n\t\t\t\t\t\twidth="10" height="10"\n\t\t\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t\tviewBox="0 0 10 10"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tstroke: var(--tchmi-ba-temp-adjust-slider-cursor-color, black);\n\t\t\t\t\t\t\tstroke-linecap: round;\n\t\t\t\t\t\t\tstroke-linejoin: round;\n\t\t\t\t\t\t">\n\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td="M 4 0.5 L 0.5 9.5 H 9.5 L 6 0.5 H 4" />\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</svg>',a=$(`<div>${e}</div>`).addClass("triangle before"),n=$(`<div>${e}</div>`).addClass("triangle after");switch(this.__attrHandler.orientation){case t.Orientation.vertical:case t.Orientation.horizontal:this.__timeCursor=$("<div>").addClass("time-cursor"),this.__timeCursor.append(a,n);break;default:throw new t.BaseError("Invalid orientation!")}this.__scheduleEntriesContainer.append(this.__timeCursor),this.__processCurrentDateTime()}}detachTimeCursor(){return null!=this.__timeCursor&&(this.__timeCursor.detach(),delete this.__timeCursor,!0)}onResized(){if(void 0!==this.__scheduleEntriesContainer){for(let e of this.__scheduleEntries.values())e.setOffset(this.__calculateOffset());this.__processCurrentDateTime()}}__onAddEntryPressed(){if(null==this.__attrHandler.maximumEntryCount&&(this.__attrHandler.maximumEntryCount=0,this.logger.warn("Maximum entry count is 0! This shouldn't be the case!")),this.__contextMenu.close(),this.__scheduleEntries.size<this.__attrHandler.maximumEntryCount){let e=e=>{let a=t.BA.createEmptyClassValue();if(this.__attrHandler.dataType===t.DataType.enum){let e=this.getStateTexts();e&&e.length>0&&null!=e[0].value&&(a.udiVal=e[0].value)}let n={eState:t.BA.SchedEntryState.eValue,stTime:t.Helper.DateTime.convertDateToBaTime(e),uValue:a};null!=this.__attrHandler.snapPeriode&&(n.stTime=new t.BA.BaTime(t.Helper.DateTime.convertDateToBaTime(e)).snapToPeriode(60*this.__attrHandler.snapPeriode).toIBaTime());let i=[];if(this.__data.size>0){let e=!1;for(let a of this.__data.values())!e&&t.Helper.DateTime.convertSTTimeToSeconds(a.stTime)>t.Helper.DateTime.convertSTTimeToSeconds(n.stTime)&&(i.push(n),e=!0),i.push(a);e||i.push(n)}else i.push(n);this.__data=this.__convertDataToMap(i),this.__processData(),this.__setHasChanges(!0)};a.TimePicker.openTimePickerDialog(new Date,t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.SelectNewStartTime),e)}else a.DialogWindow.alert(`More than '${this.__attrHandler.maximumEntryCount}' time stamps are not allowed!`,{logger:this.logger})}async __onResetEntryPressed(){this.__contextMenu.close(),this.hasChanges()&&await a.DialogWindow.confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmResetChanges))&&this.resetChanges()}async __onCopyEntryPressed(){this.__contextMenu.close();let a=this.getData();null!=a&&(a=t.Helper.Array.clone(a),null==n.__localeStorage&&(n.__localeStorage=new e.LocalStorage("TcHmi.BuildingAutomation.Components.DailySchedule",{})),n.__localeStorage.set("schedEntries",a))}async __onPasteEntryPressed(){if(this.__contextMenu.close(),null==n.__localeStorage)return;let e=n.__localeStorage.get("schedEntries");null!=e&&(this.__data=this.__convertSchedEntriesToData(e),this.__processData(),this.__setHasChanges(!0))}__onStartTimeChanged(e){let n=e.getId(),i=this.__data.get(n);if(null==i)return void console.warn(`There is no data for the changed entry in ${this.__id}!`);i.stTime=e.getStartTime().toIBaTime();let s=t.Helper.Map.getPrevious(this.__scheduleEntries,n)?.value;s&&(s.setEndTime(new t.BA.BaTime(e.getStartTime())),s.setMaxEndTime(new t.BA.BaTime(e.getEndTime()).subtractSeconds(a.WeeklySchedule.MinEntryTime)));let r=t.Helper.Map.getNext(this.__scheduleEntries,n)?.value;r&&r.setMinStartTime(new t.BA.BaTime(e.getStartTime()).addSeconds(a.WeeklySchedule.MinEntryTime)),this.__setHasChanges(!0)}__onEndTimeChanged(e){let a=e.getId();if(null==this.__data.get(a))return void console.warn(`There is no data for the changed entry in ${this.__id}!`);let n,i,s=this.__scheduleEntries.entries();do{if(n=s.next(),n.value[0]===a){if(i=s.next(),i.done)break;let a=this.__data.get(i.value[0]);if(null!=a&&a.eState>=t.BA.SchedEntryState.eValue){let t=e.getEndTime()?.toIBaTime();null==t||tchmi_equal(a.stTime,t)||(a.stTime=t,i.value[1].setStartTime(e.getEndTime()))}break}}while(!n.done);this.__setHasChanges(!0)}__onEntryDeleted(e){let t=e.getId();this.__data.has(t)||console.warn(`Deleted entry does not exist in data of ${this.__id}!`),this.__data.delete(t),e.destroy(),e.getElement().detach(),this.__scheduleEntries.delete(t),this.__processData(),this.__setHasChanges(!0)}__onValueChanged(e){let t=this.__data.get(e.getId());if(null!=t){let a=e.getValue();null!=a&&(t.uValue=a,this.__setHasChanges(!0))}}__onStateChanged(e){let t=this.__data.get(e.getId());if(null!=t){let a=e.getState();null!=a&&(t.eState=a,this.__setHasChanges(!0))}}setAttributes(e){return super.setAttributes(e),void 0!==e.title&&this.setTitle(e.title),void 0!==e.orientation&&this.setOrientation(e.orientation),void 0!==e.snapPeriode&&this.setSnapPeriode(e.snapPeriode),void 0!==e.stateColors&&this.setStateColors(e.stateColors),this.__scheduleEntries.forEach((t=>t.setAttributes(e))),this}getAttributes(){return this.__attrHandler.getRef()}setTitle(e){return this.__attrHandler.checkAttribute(e,"title",{validator:"string"})?(this.__attrHandler.title=e,this.__headline?.textHandler.setText(e),this):this}getTitle(){return this.__attrHandler.title}setData(e){if(void 0===e)return this.__attrHandler.invalidAttribute("Data",e),this;if(tchmi_equal(e,this.__data))return this.__attrHandler.equalAttribute("Data"),this;if(null==e)this.__data=new Map;else if(null!=e&&e instanceof Array)this.__data=this.__convertSchedEntriesToData(e);else{if(null!=this.__attrHandler.maximumEntryCount&&this.__data.size>this.__attrHandler.maximumEntryCount){this.logger.warn("There are more daily entries set than allowed by maximumEntryCount!\n Data will be reduced to the allowed size.");for(const e of this.__data.keys())if(this.__data.delete(e),this.__data.size<=this.__attrHandler.maximumEntryCount)break}this.__data=e}this.__processData(),this.__oldData=new Map;for(let[e,t]of this.__data)this.__oldData.set(e,JSON.parse(JSON.stringify(t)));return this.__hasChanges=!1,this.__resetEntry?.setIsEnabled(!1),this}__processData(){if(this.__data.size<=0||null===this.__attrHandler.orientation)for(let[e,t]of this.__scheduleEntries)t.getElement().detach(),t.destroy(),this.__scheduleEntries.delete(e);else{for(let[e,t]of this.__scheduleEntries)null==this.__data.get(e)&&(t.getElement().detach(),t.destroy(),this.__scheduleEntries.delete(e));let e,n=0,i=Array.from(this.__data);for(let[s,r]of this.__data){"string"==typeof r.eState&&(r.eState=Number(r.eState));let o=this.__scheduleEntries.get(s);if(r.eState>=t.BA.SchedEntryState.eValue){let l=r.stTime,d={nHour:23,nMinute:59,nSecond:59};for(let e=n+1;e<this.__data.size;e++)if(i[e][1].eState>=t.BA.SchedEntryState.eValue){d=i[e][1].stTime;break}if(null==o){o=new a.DailyScheduleEntry(s,this),o.setAttributes(this.__attrHandler).setOffset(this.__calculateOffset()).setStartTime(new t.BA.BaTime(l)).setEndTime(new t.BA.BaTime(d)).setAllowMoving(!0).setValue(r.uValue).setState(r.eState);let n=[];n.push(o.eventHandler.register(a.DailyScheduleEntry.DailyScheduleEntryEvents.onStartTimeChanged,((e,t)=>this.__onStartTimeChanged(t)))),n.push(o.eventHandler.register(a.DailyScheduleEntry.DailyScheduleEntryEvents.onEndTimeChanged,((e,t)=>this.__onEndTimeChanged(t)))),n.push(o.eventHandler.register(a.DailyScheduleEntry.DailyScheduleEntryEvents.onEntryDeleted,((e,t)=>this.__onEntryDeleted(t)))),n.push(o.eventHandler.register(a.DailyScheduleEntry.DailyScheduleEntryEvents.onValueChanged,((e,t)=>this.__onValueChanged(t)))),n.push(o.eventHandler.register(a.DailyScheduleEntry.DailyScheduleEntryEvents.onStateChanged,((e,t)=>this.__onStateChanged(t)))),o.eventHandler.register(a.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),n.forEach((e=>e()))})),e&&(o.setMinStartTime(new t.BA.BaTime(e?.getStartTime()).addSeconds(a.WeeklySchedule.MinEntryTime)),e.setMaxEndTime(new t.BA.BaTime(o?.getEndTime()).subtractSeconds(a.WeeklySchedule.MinEntryTime))),this.__scheduleEntriesContainer.append(o.getElement()),this.__scheduleEntries.set(s,o)}else o.setStartTime(new t.BA.BaTime(l)).setEndTime(new t.BA.BaTime(d)).setAllowMoving(!0).setValue(r.uValue).setState(r.eState)}else null!=o&&(o.destroy(),o.getElement().detach(),this.__scheduleEntries.delete(s));e=o,n++}t.Helper.Map.first(this.__scheduleEntries)&&t.Helper.Map.first(this.__scheduleEntries).value.setMinStartTime(t.BA.BaTime.fromSeconds(a.DailyScheduleEntry.minSeconds));let s=t.Helper.Map.last(this.__scheduleEntries);s&&(s.value.setMaxEndTime(t.BA.BaTime.fromSeconds(a.DailyScheduleEntry.maxSeconds)),s.value.setAllowMoving(!1))}}getData(){return n.__convertDataToArray(this.__data)}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(this.__attrHandler.dataType=e,this.__scheduleEntries.forEach((e=>e.setDataType(this.__attrHandler.dataType))),this):this}getDataType(){return this.__attrHandler.dataType}setSnapPeriode(e){return this.__attrHandler.checkAttribute(e,"snapPeriode",{validator:"number"})?(this.__attrHandler.snapPeriode=e,this.__scheduleEntries.forEach((t=>t.setSnapPeriode(e))),this):this}getSnapPeriode(){return this.__attrHandler.snapPeriode}setActiveText(e){return this.__attrHandler.checkAttribute(e,"activeText",{validator:"string"})?(this.__attrHandler.activeText=e,this.__scheduleEntries.forEach((t=>t.valueField.setActiveText(e))),this):this}getActiveText(){return this.__attrHandler.activeText}setInactiveText(e){return this.__attrHandler.checkAttribute(e,"inactiveText",{validator:"string"})?(this.__attrHandler.inactiveText=e,this.__scheduleEntries.forEach((t=>t.valueField.setInactiveText(e))),this):this}getInactiveText(){return this.__attrHandler.inactiveText}setUnit(e){return this.__attrHandler.checkAttribute(e,"unit",{validator:["string","number"]})?("number"==typeof e&&(e=t.Helper.convertUnitToString(e)),this.__attrHandler.unit=e,this.__scheduleEntries.forEach((t=>t.valueField.setUnit(e))),this):this}getUnit(){return this.__attrHandler.unit}setStateTexts(e){return this.__attrHandler.checkAttribute(e,"stateTexts",{validator:"array"})?(this.__attrHandler.stateTexts=e,this.__scheduleEntries.forEach((t=>t.valueField.setStateTexts(e))),this):this}getStateTexts(){return this.__attrHandler.stateTexts}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){switch(this.__scheduleEntries.forEach((e=>e.setOrientation(this.__attrHandler.orientation))),this.__attrHandler.orientation){case t.Orientation.vertical:this.__element.removeClass("horizontal");break;case t.Orientation.horizontal:this.__element.addClass("horizontal");break;default:throw new t.BaseError("Invalid orientation!")}this.__processData(),this.detachTimeCursor()&&this.appendTimeCursor()}getOrientation(){return this.__attrHandler.orientation}setStateColors(e){return this.__attrHandler.checkAttribute(e,"stateColors",{validator:()=>e instanceof Map})?(this.__attrHandler.stateColors=e,this.__scheduleEntries.forEach((t=>t.setStateColors(e))),this):this}getStateColors(){return this.__attrHandler.stateColors}setMaximumEntryCount(e){return this.__attrHandler.checkAttribute(e,"maximumEntryCount",{validator:"number"})?(this.__attrHandler.maximumEntryCount=e,this.__processMaximumEntryCount(),this):this}__processMaximumEntryCount(){null!=this.__attrHandler.maximumEntryCount&&this.__data.size>this.__attrHandler.maximumEntryCount&&this.logger.warn("There are more daily entries than set in maximumEntryCount!")}getMaximumEntryCount(){return this.__attrHandler.maximumEntryCount}setCurrentDateTime(e){return this.__attrHandler.checkAttribute(e,"currentDateTime",{validator:"date"})?(this.__attrHandler.currentDateTime=e,this.__processCurrentDateTime(),this):this}__processCurrentDateTime(){if(null==this.__timeCursor)return;let e;null==this.__attrHandler.currentDateTime?(e=new Date,e.setHours(0,0,0)):e=this.__attrHandler.currentDateTime;const a=e.getSeconds()+60*e.getMinutes()+3600*e.getHours(),n=(this.__calculateOffset()*a).toFixed();switch(this.__attrHandler.orientation){case t.Orientation.vertical:this.__timeCursor.css("top",n+"px");break;case t.Orientation.horizontal:this.__timeCursor.css("left",n+"px");break;default:throw new t.BaseError("Invalid orientation!")}}getCurrentDateTime(){return this.__attrHandler.currentDateTime}__processReadOnly(){super.__processReadOnly(),this.__scheduleEntries.forEach((e=>e.setReadOnly(this.__attrHandler.readOnly))),this.__attrHandler.readOnly?this.__menuButton.getElement().detach():this.__headline.getElement().append(this.__menuButton.getElement())}}a.DailySchedule=n,function(e){let t;!function(e){e.onDataChanged="onDataChanged"}(t=e.DailyScheduleEvents||(e.DailyScheduleEvents={}))}(n=a.DailySchedule||(a.DailySchedule={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.Base{constructor(e,i){super(e,i),this.__loadEntriesFromBaObject=!0,this.baObjectHandler=new t.BaObjectHandler(this),this.__daySchedules=[],this.__element.addClass("weekly-schedule");for(let e=0;e<7;e++){let i=new a.DailySchedule(this.__id+"-day-schedule-"+e,this);i.eventHandler.register(a.BaseNode.BaseNodeEvents.onAttached,(e=>{e.destroy();let t=i.eventHandler.register(a.DailySchedule.DailyScheduleEvents.onDataChanged,(()=>{this.eventHandler.raise(n.WeeklyScheduleEvents.onDataChanged)}));i.eventHandler.register(a.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),t()}))})),this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.WeekDaysLongLangKey[e],(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&i.setTitle(e.text)}))),this.__daySchedules.push(i)}this.setOrientation(n.DefaultOrientation),this.setReadOnly(!0)}__attach(){if(!this.__isAttached){for(let e=0;e<this.__daySchedules.length;e++)this.__element.append(this.__daySchedules[e].getElement());super.__attach()}}__detach(){if(this.__isAttached){for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].getElement().detach();super.__detach()}}destroy(){for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].destroy();this.baObjectHandler.destroy(),super.destroy()}processBaObject(){if(this.setScheduleEntries(null),null!=this.baObjectHandler.baObject){switch(this.setDataType(this.baObjectHandler.baObject.DataType),this.baObjectHandler.baObject.DataType){case t.DataType.boolean:null==this.__attrHandler.activeText&&null==this.__attrHandler.inactiveText&&this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,(e=>{this.setInactiveText(e?.get(0)),this.setActiveText(e?.get(1))}),!0);break;case t.DataType.number:null==this.__attrHandler.unit&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,(e=>{void 0!==e&&this.setUnit(e)}));break;case t.DataType.enum:null==this.__attrHandler.stateTexts&&this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,(e=>{let t=a.Combobox.toComboboxItemArray(e);this.setStateTexts(t)}),!0)}this.__loadEntriesFromBaObject&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eWeek,(e=>{void 0!==e&&(null==e?this.setScheduleEntries(null):(this.setMaximumEntryCount(e[0].length),this.setScheduleEntries(t.Helper.Array.clone(e))))})),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkParameterAccess(t.BA.BaParameterId.eWeek,t.BA.Scope.write))}}resetChanges(){for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].resetChanges()}async writeToPlc(){return new Promise((async(a,n)=>{if(this.hasChanges()){if(null!=this.baObjectHandler.baObject&&!this.__attrHandler.readOnly){let i=this.getScheduleEntries(),s=this.busyHandler.setBusy("Writing entries to PLC.");this.baObjectHandler.baObject.tryWriteBaVariableValue(t.BA.BaParameterId.eWeek,i,(t=>{t.error!=e.Errors.NONE?n(e.Log.buildMessage(t.details)):a(!0),s()}))}for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].resetHasChanges()}a(!1)}))}hasChanges(){for(let e=0;e<this.__daySchedules.length;e++)if(this.__daySchedules[e].hasChanges())return!0;return!1}set LoadEntriesFromBaObject(e){this.__loadEntriesFromBaObject=e}setAttributes(e){return super.setAttributes(e),void 0!==e.startDate&&this.setStartDate(e.startDate),void 0!==e.orientation&&this.setOrientation(e.orientation),void 0!==e.displayTimeCursor&&this.setDisplayTimeCursor(e.displayTimeCursor),void 0!==e.currentDateTime&&this.setCurrentDateTime(e.currentDateTime),void 0!==e.activeText&&this.setActiveText(e.activeText),void 0!==e.inactiveText&&this.setInactiveText(e.inactiveText),void 0!==e.stateTexts&&this.setStateTexts(e.stateTexts),void 0!==e.unit&&this.setUnit(e.unit),this}getAttributes(){return this.__attrHandler.getRef()}setScheduleEntries(e){if(void 0===e)return this.__attrHandler.invalidAttribute("ScheduleEntries",e),this;if(null==e)for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].setData(null);else{let t=this.busyHandler.setBusy("Processing entries");for(let t=0;t<e.length;t++)void 0!==this.__daySchedules[t]?this.__daySchedules[t].setData(e[t]):console.warn("The weekly schedule data contains more than "+this.__daySchedules.length+" days. Is this intended?");t()}return this.eventHandler.raise(n.WeeklyScheduleEvents.onDataChanged),this}getScheduleEntries(){let e=[];for(let t=0;t<this.__daySchedules.length;t++){this.__daySchedules[t].getData()&&e.push(this.__daySchedules[t].getData())}return e}setStartDate(e){if(!this.__attrHandler.checkAttribute(e,"startDate",{validator:"date"}))return this;this.__attrHandler.startDate=e;let a=this.__attrHandler.startDate;for(let e=0;e<this.__daySchedules.length;e++)null!=a?(this.__daySchedules[e].setTitle(a.toDateString()),a=new Date(a.getTime()+864e5)):this.__daySchedules[e].setTitle(t.Locale.Localization.getSymbolExpression(t.Locale.WeekDaysLongLangKey[e]));return this}getStartDate(){return this.__attrHandler.startDate}setDataType(e){return this.__daySchedules.forEach((t=>t.setDataType(e))),this}getDataType(){for(let e of this.__daySchedules.values())return e.getDataType();return null}setSnapPeriode(e){return this.__daySchedules.forEach((t=>t.setSnapPeriode(e))),this}getSnapPeriode(){for(let e of this.__daySchedules.values())return e.getSnapPeriode();return null}setActiveText(e){return this.__attrHandler.activeText=e,this.__daySchedules.forEach((t=>t.setActiveText(e))),this}getActiveText(){return this.__attrHandler.activeText}setInactiveText(e){return this.__attrHandler.inactiveText=e,this.__daySchedules.forEach((t=>t.setInactiveText(e))),this}getInactiveText(){return this.__attrHandler.inactiveText}setUnit(e){return"number"==typeof e&&(e=t.Helper.convertUnitToString(e)),this.__attrHandler.unit=e,this.__daySchedules.forEach((t=>t.setUnit(e))),this}getUnit(){return this.__attrHandler.unit}setStateTexts(e){return this.__attrHandler.stateTexts=e,this.__daySchedules.forEach((t=>t.setStateTexts(e))),this}getStateTexts(){return this.__attrHandler.stateTexts}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){switch(this.__attrHandler.orientation){case t.Orientation.vertical:this.__element.css({"grid-template-columns":"auto auto auto auto auto auto auto"});break;case t.Orientation.horizontal:this.__element.css({"grid-template-columns":"none"});break;default:throw new t.BaseError("Invalid orientation!")}this.__daySchedules.forEach((e=>e.setOrientation(this.__attrHandler.orientation))),this.__daySchedules.forEach((e=>e.updatePositions())),this.__daySchedules.forEach((e=>e.updatePositions())),this.__processDisplayTimeCursor()}getOrientation(){return this.__attrHandler.orientation}setStateColors(e){return this.__daySchedules.forEach((t=>t.setStateColors(e))),this}getStateColors(){for(let e of this.__daySchedules.values())return e.getStateColors();return null}setMaximumEntryCount(e){return this.__daySchedules.forEach((t=>t.setMaximumEntryCount(e))),this}getMaximumEntryCount(){for(let e of this.__daySchedules.values())return e.getMaximumEntryCount();return null}setDisplayTimeCursor(e){return this.__attrHandler.checkAttribute(e,"displayTimeCursor",{validator:"boolean"})?(this.__attrHandler.displayTimeCursor=e,this.__processDisplayTimeCursor(),this):this}__processDisplayTimeCursor(){1==this.__attrHandler.displayTimeCursor?this.__processCurrentDateTime():this.__daySchedules.forEach((e=>e.detachTimeCursor()))}getDisplayTimeCursor(){return this.__attrHandler.displayTimeCursor}setCurrentDateTime(e){return this.__attrHandler.checkAttribute(e,"currentDateTime",{validator:"date"})?(this.__attrHandler.currentDateTime=e,this.__processCurrentDateTime(),this):this}__processCurrentDateTime(){if(!this.__attrHandler.displayTimeCursor)return;if(null==this.__attrHandler.currentDateTime)return void this.__daySchedules.forEach((e=>e.detachTimeCursor()));let e=this.__attrHandler.currentDateTime.getDay();if(null!=e){0===e?e=6:e-=1;for(let t=0;t<this.__daySchedules.length;t++)t===e?(this.__daySchedules[t].appendTimeCursor(),this.__daySchedules[t].setCurrentDateTime(this.__attrHandler.currentDateTime)):this.__daySchedules[t].detachTimeCursor()}}getCurrentDateTime(){return this.__attrHandler.currentDateTime}__processReadOnly(){super.__processReadOnly(),this.__daySchedules.forEach((e=>e.setReadOnly(this.__attrHandler.readOnly)))}}a.WeeklySchedule=n,function(e){let a;!function(e){e.onDataChanged="onDataChanged"}(a=e.WeeklyScheduleEvents||(e.WeeklyScheduleEvents={})),e.MinEntryTime=1800,e.DefaultOrientation=t.Orientation.horizontal}(n=a.WeeklySchedule||(a.WeeklySchedule={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a{constructor(){this.__cur=[],this.__selected=[],this.__old=[],this.__direction=a.NavDirection.Invalid}set(t){if(this.__selected=e.Helper.Array.clone(t),this.__old=e.Helper.Array.clone(this.__cur),this.__cur.length<t.length)return this.__cur.push(t[t.length-1]),this.__direction=a.NavDirection.Forward,!0;if(this.__cur.length>t.length){for(let e=this.__cur.length;e>t.length-1;e--)this.__cur.pop();return this.__direction=a.NavDirection.Backward,this.__old[t.length-1]!=t[t.length-1]&&(this.__cur.push(t[t.length-1]),this.__direction=a.NavDirection.Stay),!0}return this.__cur.length===t.length?t.length>0&&(e.Helper.Array.equals(this.__cur,t)?(this.__cur.pop(),this.__direction=a.NavDirection.Backward):(this.__cur=e.Helper.Array.clone(t),this.__direction=a.NavDirection.Stay),!0):(console.error("Error in set method of Path.js. Current element has wrong level."),this.__direction=a.NavDirection.Invalid,!1)}getCurrent(){return this.__cur}getOld(){return this.__old}getSelected(){return this.__selected}getDirection(){return this.__direction}getClosePath(){let t=[];if(this.__old.length<=this.__cur.length){let a=!0;for(let e=0;e<this.__old.length;e++)this.__cur[e]!=this.__old[e]&&(a=!1);a||(t=e.Helper.Array.clone(this.__old))}else for(let e=0;e<this.__old.length;e++)t.push(this.__old[e]);return t}reset(){this.__cur=[],this.__old=[],this.__direction=a.NavDirection.Invalid}}t.Path=a,function(e){let t;!function(e){e[e.Invalid=-1]="Invalid",e[e.Backward=0]="Backward",e[e.Stay=1]="Stay",e[e.Forward=2]="Forward"}(t=e.NavDirection||(e.NavDirection={}))}(a=t.Path||(t.Path={}))}(e.Navigation||(e.Navigation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){t.Provider=[];class a{constructor(a){this.__path=new t.Path,this.__data=null,this.__navigations=new Map,this.__id=a,this.__logger=new e.Logger({name:this.__id})}__preparePath(t,a,n){if(void 0!==t){if(n||(n=[]),a&&(n.push(a),t.Path=e.Helper.Array.clone(n)),t.Children&&t.Children.size>0)for(let[e,a]of t.Children)this.__preparePath(a,e,n);n.pop()}}__setupNewNav(a,n,i){n.setNavigationProvider(this),void 0!==this.__data&&n.setData(this.__data),this.__navigations.set(a,n),i&&i.append(n.getElement());let s=n.eventHandler.register(t.BaseList.BaseListEvents.onEntrySelected,((e,t,a)=>{this.__changedNavigationId=t.getId(),this.select(a.getData())}));n.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{this.removeNavigation(n.getId()),e.destroy(),s()}))}getId(){return this.__id}createBaseListNavigation(e,a,n,i){let s=new t.BaseList(e,a);return null!=n&&s.setAttributes(n),this.__setupNewNav(e,s,i),s}createControlListNavigation(e,a,n,i){let s=new t.ControlList(e,a);return null!=n&&s.setAttributes(n),this.__setupNewNav(e,s,i),s}createParameterListNavigation(e,a,n,i){let s=new t.ParameterList(e,a);return null!=n&&s.setAttributes(n),this.__setupNewNav(e,s,i),s}createProjectNavigationListNavigation(e,a,n,i){let s=new t.ProjectNavigationList(e,a);return null!=n&&s.setAttributes(n),this.__setupNewNav(e,s,i),s}removeNavigation(e){let a=this.__navigations.get(e);return!!a&&(a.setNavigationProvider(null),this.__navigations.delete(e),0==this.__navigations.size&&t.Provider.splice(t.Provider.indexOf(this,1)),!0)}getNavigations(){return this.__navigations}select(e){if(null==e)return;let t=e.Path;if(t){if(this.__path.set(t))for(let[e,t]of this.__navigations)e!=this.__changedNavigationId&&t.select(this.__path)}else this.__path.reset();this.__changedNavigationId=void 0}getCurrentNode(){if(null==this.__data)return;let e=this.__path.getCurrent(),t=this.__data;for(let a=0;a<e.length;a++){if(null==t.Children||t.Children.size<=0)return;if(t=t.Children.get(e[a]),null==t)return}return t}setData(e){return void 0===e?(this.__logger.invalidAttribute("Data",e),this):tchmi_equal(e,this.__data)?(this.__logger.equalAttribute("Data"),this):(this.__data=e,this.__processData(),this)}__processData(){null!=this.__data&&this.__preparePath(this.__data);for(let e of this.__navigations.values())e.setData(this.__data)}getData(){return this.__data}}function n(e,t){if(e.IsTop!=t.IsTop)return!1;if(null==e.Children&&null==t.Children)return!!tchmi_equal(e,t);if(null==e.Children||null==t.Children)return!1;if(e.Children.size!=t.Children.size)return!1;for(let[a,i]of e.Children){let e=t.Children.get(a);if(!e)return!1;if(!n(i,e))return!1}return!0}t.NavigationProvider=a,t.createOrGetNavigationProvider=function(e){if(e)for(let a=0;a<t.Provider.length;a++){let i=t.Provider[a].getData();if(i&&null!=i.Children&&i.Children.size>0&&n(i,e))return t.Provider[a]}let i=new a("NavigationProvider"+t.Provider.length);return e&&i.setData(e),t.Provider.push(i),i}}(e.Navigation||(e.Navigation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends e.Components.Base{constructor(e,t){super(e,t),this.__entries=new Map,this.__element.addClass("base-list"),this.setSlideDuration(a.DefaultSlideDuration),this.setAutoCollapse(!0)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){for(let e of this.__entries.values())e.destroy();super.destroy()}__setEntryData(e,t){e.setSlideDuration(this.__attrHandler.slideDuration),e.setAutoCollapse(this.__attrHandler.autoCollapse),e.setData(t)}__createEntry(t,n=null){null==n&&(n=new a.BaseListEntry(t,this));let i=n.eventHandler.register(a.BaseListEntry.BaseListEntryEvents.onSelected,((e,t,n)=>{this.eventHandler.raise(a.BaseListEvents.onEntrySelected,n)})),s=n.eventHandler.register(a.BaseListEntry.BaseListEntryEvents.onClosed,((e,t,n)=>{this.eventHandler.raise(a.BaseListEvents.onEntryClosed,n)})),r=n.eventHandler.register(a.BaseListEntry.BaseListEntryEvents.onOpened,((e,t,n)=>{this.eventHandler.raise(a.BaseListEvents.onEntryOpened,n)}));return n.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),i(),s(),r()})),n}static getEntryFromEntriesByPath(e,t){for(let a of e.values()){let e=a.getPath();if(e[e.length-1]===t)return a}}hide(){super.hide();for(const e of this.__entries.values())e.hide(),e.getSublist()?.hide();return this}show(){super.show();for(const e of this.__entries.values())e.show(),e.getSublist()?.show();return this}select(t){if(!this.__attrHandler.data)return;if(!this.__attrHandler.data.IsTop)return;let n=e.Helper.Array.clone(t.getCurrent()),i=t.getClosePath();if(i.length>0){let e,t=this.__entries;for(let s=0;s<=n.length&&!(s>i.length-1);s++){if(e=a.getEntryFromEntriesByPath(t,i[s]),!e)throw new Error("No entry was found to close it!");if(e.getIsOpen()&&(t=e.getSublist()?.getEntries(),!t))throw new Error("Entries should be availiable here!")}e?.close()}n=e.Helper.Array.clone(t.getCurrent());let s,r=this.__entries;for(;n.length>0;){if(s=a.getEntryFromEntriesByPath(r,n[0]),!s)return void console.error(`Entry with id ${t[0]} was not found in BaseList ${this.__id}!`);let e=s.getData();if(!e||!e.Children||e.Children.size<=0)return void console.error(`Entry ${s.getId()} does not have any children but selected path has further children!`);if(s.open(),r=s.getSublist()?.getEntries(),!r)throw new Error("Entries should be defined here!");n.shift()}}getEntries(){return this.__entries}getEntry(e){for(let t of this.__entries.values()){let a=t.getData()?.name;if(null!=a&&a===e)return t}return null}closeAllEntries(){for(let e of this.__entries.values()){let t=e.getData();void 0!==t?.Children&&e.close()}}addEntry(e,t){null==this.__attrHandler.data&&(this.__attrHandler.data={}),null==this.__attrHandler.data?.Children&&(this.__attrHandler.data.Children=new Map),this.__attrHandler.data.Children.set(e,t);let a=this.__createEntry(this.__id+"-"+e);return this.__setEntryData(a,t),this.__element.append(a.getElement()),this.__entries.set(e,a),null!=t.cbOnCreated&&t.cbOnCreated.length>0&&t.cbOnCreated.forEach((e=>e(a))),a}hasEntry(e){return this.__entries.get(e)}removeEntry(e){if(null==this.__attrHandler.data||null==this.__attrHandler.data.Children)return!1;let t=this.__entries.get(e);return!(!this.__attrHandler.data.Children.has(e)||null==t)&&(t.getElement().detach(),t.destroy(),this.__entries.delete(e),this.__attrHandler.data.Children.delete(e),!0)}setNavigationProvider(e){return null!=e?this.__navigationProvider=e:delete this.__navigationProvider,this}getNavigationProvider(){return this.__navigationProvider}setAttributes(e){return super.setAttributes(e),void 0!==e.data&&this.setData(e.data),void 0!==e.slideDuration&&this.setSlideDuration(e.slideDuration),void 0!==e.sublistPadding&&this.setSublistPadding(e.sublistPadding,e.sublistPaddingUnit),void 0!==e.autoCollapse&&this.setAutoCollapse(e.autoCollapse),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return this.__attrHandler.checkAttribute(e,"data",{validator:"object"})?(this.__attrHandler.data=e,this.__processData(),this):this}__processData(){if(null==this.__attrHandler.data){for(let e of this.__entries.values())e.getElement().detach(),e.destroy();this.__entries.clear()}else{for(let[e,t]of this.__entries)null!=this.__attrHandler.data.Children&&null!=this.__attrHandler.data.Children.get(e)||(this.__entries.delete(e),t.getElement().detach(),t.destroy());if(null==this.__attrHandler.data.Children||this.__attrHandler.data.Children.size<=0){let e=this.__entries.get(this.__id+"-entry");e||(e=this.__createEntry(this.__id+"-entry"),this.__entries.set(e.getId(),e),this.__setEntryData(e,this.__attrHandler.data),this.__element.append(e.getElement()))}else for(let[e,t]of this.__attrHandler.data.Children){let a=this.__entries.get(e);null==a&&(a=this.__createEntry(this.__id+"-"+e),null!=t.cbOnCreated&&t.cbOnCreated.length>0&&t.cbOnCreated.forEach((e=>e(a))),this.__entries.set(e,a),this.__element.append(a.getElement())),this.__setEntryData(a,t)}}this.__navigationProvider?.setData(this.__attrHandler.data?this.__attrHandler.data:null)}getData(){return this.__attrHandler.data}setSlideDuration(e){return this.__attrHandler.checkAttribute(e,"slideDuration",{validator:"number"})?(this.__attrHandler.slideDuration=e,this.__processSlideDuration(),this):this}__processSlideDuration(){for(let e of this.__entries.values())e.setSlideDuration(this.__attrHandler.slideDuration)}getSlideDuration(){return this.__attrHandler.slideDuration}setSublistPadding(t,a){return e.Components.LayoutHandler.dimensionSetter(this.__attrHandler,"sublistPadding",t,a)?(this.__processSublistPadding(),this):this}__processSublistPadding(){null==this.__attrHandler.sublistPadding?this.__element.css("--tchmi-ba-base-list-sublist-padding",""):this.__element.css("--tchmi-ba-base-list-sublist-padding",this.__attrHandler.sublistPadding+(this.__attrHandler.sublistPaddingUnit?this.__attrHandler.sublistPaddingUnit:"px"))}getSublistPadding(){return this.__attrHandler.sublistPadding}getSublistPaddingUnit(){return this.__attrHandler.sublistPaddingUnit}setAutoCollapse(e){return this.__attrHandler.checkAttribute(e,"autoCollapse",{validator:"boolean"})?(this.__attrHandler.autoCollapse=e,this.__processAutoCollapse(),this):this}__processAutoCollapse(){for(let e of this.__entries.values())e.setAutoCollapse(this.__attrHandler.autoCollapse)}getAutoCollapse(){return this.__attrHandler.autoCollapse}}t.BaseList=a,function(t){let a;!function(e){e.onEntrySelected="onEntrySelected",e.onEntryOpened="onEntryOpened",e.onEntryClosed="onEntryClosed"}(a=t.BaseListEvents||(t.BaseListEvents={})),t.DefaultSlideDuration=200;class n extends e.Components.TextControl{constructor(t,a){super(t,a),this.__pressedHandler=t=>{if(null!=t.button&&t.button!==e.MouseButtons.left)return;t.stopPropagation();let a=()=>{if(this.__sublist){let e=this.__sublist.getEntries();for(let a of e.values())if(null!=a.getElement().find(t.target)[0])return}this.__onSelected(),this.__element.off("pointerup",a)};this.__element.on("pointerup",a)},this.__element.addClass("base-list-entry is-closed"),this.__attrHandler.autoCollapse=!1,this.__isOpen=!1,this.__selecting=!1}__attach(){this.__isAttached||(this.__element.on("pointerdown",this.__pressedHandler),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__pressedHandler),super.__detach())}destroy(){this.__sublist?.destroy(),super.destroy()}__onSelected(){this.__selecting||null==this.__attrHandler.data||(null!=this.__attrHandler.data.Children&&this.__attrHandler.data.Children.size>0&&this.toggleOpen(),this.eventHandler.raise(n.BaseListEntryEvents.onSelected,this)),this.__selecting=!0,setTimeout((()=>this.__selecting=!1),this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:t.DefaultSlideDuration)}__createSubList(){null==this.__sublist&&(this.__sublist=new t(this.__id+"-sublist",this));let a=this.__sublist.eventHandler.register(t.BaseListEvents.onEntrySelected,((e,a,n)=>{this.eventHandler.raise(t.BaseListEntry.BaseListEntryEvents.onSelected,n)})),n=this.__sublist.eventHandler.register(t.BaseListEvents.onEntryClosed,((e,a,n)=>{this.eventHandler.raise(t.BaseListEntry.BaseListEntryEvents.onClosed,n)})),i=this.__sublist.eventHandler.register(t.BaseListEvents.onEntryOpened,((e,a,n)=>{this.eventHandler.raise(t.BaseListEntry.BaseListEntryEvents.onOpened,n)}));this.__sublist.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),a(),n(),i()})),this.__sublist.setSublistPadding(this.__attrHandler.sublistPadding,this.__attrHandler.sublistPaddingUnit).setSlideDuration(this.__attrHandler.slideDuration).setAutoCollapse(this.__attrHandler.autoCollapse).getElement().addClass("sublist"),this.__sublist.setData(this.__attrHandler.data)}getPath(){if(!this.__attrHandler.data||!this.__attrHandler.data.Path)throw new Error(`Path of entry ${this.__id} was not set!`);return this.__attrHandler.data?.Path}toggleOpen(){!1===this.__isOpen?this.open():this.close()}open(e){if(!this.__isOpen&&(void 0===this.__sublist&&null!=this.__attrHandler.data&&null!=this.__attrHandler.data.Children&&this.__createSubList(),void 0!==this.__sublist)){this.__sublist.getElement().css("display","none"),this.__element.append(this.__sublist.getElement());let a=null!=this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:t.DefaultSlideDuration;if(null!=e&&(a=e),this.__sublist.getElement().slideDown(a,(()=>{this.eventHandler.raise(n.BaseListEntryEvents.onOpened,this)})),this.__isOpen=!0,this.__element.removeClass("is-closed"),this.__attrHandler.autoCollapse&&this.__baParent instanceof t){let t=this.__baParent.getEntries();for(let a of t.values()){a.getId()!=this.__id&&a.close();let t=this;for(;t instanceof n;){let a=t.getSiblings();for(let t of a)t.close(e);const n=t.getBaParent();if(null==n)break;t=n.getBaParent()}}}return!0}return!1}openAsync(e){return new Promise(((t,a)=>{let i=!1;this.eventHandler.register(n.BaseListEntryEvents.onOpened,(e=>{e.destroy(),t(i)})),i=this.open(e),0==i&&t(i)}))}close(e){if(this.__isOpen){if(void 0!==this.__sublist){let a=null!=this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:t.DefaultSlideDuration;null!=e&&(a=e),this.__sublist.getElement().slideUp(a,(()=>{this.__sublist?.closeAllEntries(),this.__sublist?.getElement().detach(),this.__isOpen=!1,this.__element.addClass("is-closed"),this.eventHandler.raise(n.BaseListEntryEvents.onClosed,this)}))}return!0}return!1}getSublist(){return this.__sublist}getIsOpen(){return this.__isOpen}addEntry(e,t){null==this.__attrHandler.data&&(this.__attrHandler.data={}),null==this.__attrHandler.data.Children&&(this.__attrHandler.data.Children=new Map),this.__attrHandler.data.Children.has(e)?this.logger.warn(`An entry with key '${e}' has already been added!`):(this.__attrHandler.data.Children.set(e,t),this.__processData())}hasEntry(e){return null!=this.__attrHandler.data&&null!=this.__attrHandler.data.Children&&this.__attrHandler.data.Children.has(e)}removeEntry(e){return null!=this.__attrHandler.data&&null!=this.__attrHandler.data.Children&&(!!this.__attrHandler.data.Children.delete(e)&&(this.__processData(),!0))}getSiblings(){let e=[];return null==this.__baParent||(e=Array.from(this.__baParent.getEntries().values()).filter((e=>e.getId()!==this.__id))),e}setAttributes(e){return super.setAttributes(e),void 0!==e.data&&this.setData(e.data),void 0!==e.slideDuration&&this.setSlideDuration(e.slideDuration),void 0!==e.sublistPadding&&this.setSublistPadding(e.sublistPadding,e.sublistPaddingUnit),void 0!==e.autoCollapse&&this.setAutoCollapse(e.autoCollapse),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return this.__attrHandler.checkAttribute(e,"data",{validator:"object"})?(this.__attrHandler.data=e,this.__processData(),this):this}__processData(){if(null!=this.__attrHandler.data){if(this instanceof n&&this.__attrHandler.data.Title&&(this.textHandler.setText(this.__attrHandler.data.Title),this.textHandler.getTextElement().parent()[0]||this.__element.append(this.textHandler.getTextElement())),null!=this.__attrHandler.data.Children&&this.__attrHandler.data.Children.size>0&&(this.__element.addClass("is-selectable"),this.textHandler.setDecorationLine("underline").setDecorationStyle("solid"),null!=this.__sublist)){let e=this.__sublist.getData();if(null!=e&&null!=e.Children&&this.__attrHandler.data.Children.size===e.Children.size)for(let[t,a]of e.Children)this.__attrHandler.data.Children.has(t)||e.Children.delete(t);this.__sublist.setData(this.__attrHandler.data)}}else null!=this.__sublist&&(this.close(),this.__sublist.getElement().detach(),this.__sublist.destroy(),this.__sublist=void 0),this.__element.removeClass("is-selectable"),this.textHandler.setDecorationLine("none")}getData(){return this.__attrHandler.data}setSlideDuration(e){return this.__attrHandler.checkAttribute(e,"slideDuration",{validator:"number"})?(this.__attrHandler.slideDuration=e,this.__processSlideDuration(),this):this}__processSlideDuration(){this.__sublist?.setSlideDuration(this.__attrHandler.slideDuration)}getSlideDuration(){return this.__attrHandler.slideDuration}setSublistPadding(t,a){return e.Components.LayoutHandler.dimensionSetter(this.__attrHandler,"sublistPadding",t,a)?(this.__processSublistPadding(),this):this}__processSublistPadding(){this.__sublist?.setSublistPadding(this.__attrHandler.sublistPadding,this.__attrHandler.sublistPaddingUnit)}getSublistPadding(){return this.__attrHandler.sublistPadding}getSublistPaddingUnit(){return this.__attrHandler.sublistPaddingUnit}setAutoCollapse(e){return this.__attrHandler.checkAttribute(e,"autoCollapse",{validator:"boolean"})?(this.__attrHandler.autoCollapse=e,this.__processAutoCollapse(),this):this}__processAutoCollapse(){this.__sublist?.setAutoCollapse(this.__attrHandler.autoCollapse)}getAutoCollapse(){return this.__attrHandler.autoCollapse}}t.BaseListEntry=n,function(e){let t;!function(e){e.onSelected="onEntrySelected",e.onOpened="onOpened",e.onClosed="onClosed"}(t=e.BaseListEntryEvents||(e.BaseListEntryEvents={}))}(n=t.BaseListEntry||(t.BaseListEntry={}))}(a=t.BaseList||(t.BaseList={}))}(e.Navigation||(e.Navigation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){let t,a;!function(t){class a extends t.BaseList{constructor(e,t){super(e,t),this.__entries=new Map,this.__element.addClass("control-list")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__setEntryData(e,t){super.__setEntryData(e,t)}__createEntry(e,t=null){return null==t&&(t=new a.ControlListEntry(e,this)),super.__createEntry(e,t),t}addEntry(e,t){return super.addEntry(e,t)}getEntry(e){return super.getEntry(e)}setData(e){return super.setData(e),this}getData(){return this.__attrHandler.data}}t.ControlList=a,function(a){class n extends t.BaseList.BaseListEntry{constructor(t,a){super(t,a),this.__element.addClass("control-list-entry");let n=$("<div>").addClass("content-container");this.__element.append(n),this.controlContainer=new e.Components.ControlContainer(this.__id+"-control-container",this),this.controlContainer.setControlsHorizonzalAlignment("Right").getElement().addClass("control-container"),this.textHandler.setHorizontalAlignment("Left").getTextElement().addClass("title"),n.append(this.controlContainer.getElement())}__attach(){this.__isAttached||(this.controlContainer.getElement().on("pointerdown",e.EventHandler.stopPropagationHandler),super.__attach())}__detach(){this.__isAttached&&(this.controlContainer.getElement().off("pointerdown",e.EventHandler.stopPropagationHandler),super.__detach())}destroy(){this.controlContainer.destroy(),super.destroy()}onTextChanged(e){super.onTextChanged(e),this.__element.children(".content-container").append(this.textHandler.getTextElement())}__createSubList(){void 0===this.__sublist&&(this.__sublist=new a(this.__id+"-sublist",this)),super.__createSubList()}addEntry(e,t){super.addEntry(e,t)}getSublist(){return super.getSublist()}setData(e){return super.setData(e),this}getData(){return this.__attrHandler.data}__processData(){super.__processData(),null!=this.__attrHandler.data?.controls&&(this.controlContainer.getControls().length>0&&this.controlContainer.removeAllControls(),this.__attrHandler.data.controls instanceof Array?this.controlContainer.addControls(this.__attrHandler.data.controls):this.controlContainer.addControl(this.__attrHandler.data.controls))}}a.ControlListEntry=n}(a=t.ControlList||(t.ControlList={}))}(t=e.Navigation||(e.Navigation={})),function(t){t.BaView.prototype.toControlListData=function(a){if(!this.getIsValid())throw new Error("Converting BaView into data for ControlList is only possible when the BaView and its children have been loaded! Please call baView.loadAttributes(true) first!");if(null==this.texts)throw new Error("Converting BaView into data for ControlList is only possible when the texts of the a BaView and its children have been load. Please call baView.loadTexts(true) first!");let n={Title:this.texts.instDescription};if(a&&a.editEntry&&a.editEntry(this,n),this instanceof t.BaView&&null!=this.Children&&this.Children.size>0)for(var[i,s]of(n.Children=new Map,this.Children)){let r={};if(s instanceof t.BaView){if(r=s.toControlListData(a),null!=r.Children){r.Children.size>0&&n.Children.set(i,r)}}else{if(null!=a?.filter&&0==a.filter(s))continue;if(null==s.texts)throw new Error("Converting BaView into data for ControlList is only possible when the texts of the a BaView and its children have been load. Please call baView.loadTexts(true) first!");r.Title=s.texts.instDescription,a&&a.editEntry&&a.editEntry(s,r),n.Children.set(i,r)}if(null==r.controls&&(r.controls=[]),r.controls instanceof Array){const t=s;r.controls.push({type:e.Components.ComponentType.Button,settings:{iconPath:s.getIconAttributes().iconPath,iconHeight:60,iconHeightUnit:"%",iconWidth:60,iconWidthUnit:"%",layout:{maxWidth:25}},callback:()=>{t.openParameterDialog()}})}}return n}}(a=e.BA||(e.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.BaseList{constructor(e,a){super(e,a),this.baObjectHandler=new t.BaObjectHandler(this),this.__attrHandler.valueHandler||(this.__attrHandler.valueHandler={}),void 0===this.__attrHandler.valueHandler.autoWrite&&(this.__attrHandler.valueHandler.autoWrite=!1),void 0===this.__attrHandler.baUsedTitle&&this.setBaUsedTitle(t.BA.BaParameterId.eInstDescription),this.__element.addClass("parameter-list"),this.__entries=new Map}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.baObjectHandler.destroy(),super.destroy()}__createEntry(e,a=null){null==a&&(a=new n.ParameterListEntry(e,this)),super.__createEntry(e,a);let i=a.eventHandler.register(n.ParameterListEntry.ParameterListEntryEvents.onValueChanged,((e,t,a)=>{this.eventHandler.raise(n.ParameterListEvents.onEntryValueChanged,a)}));return a.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),i()})),a}__setEntryData(e,t){e.setBaUsedTitle(this.__attrHandler.baUsedTitle),e.setAttributes({valueHandler:{autoWrite:this.__attrHandler.valueHandler?.autoWrite}}),super.__setEntryData(e,t)}processBaObject(){null==this.__attrHandler.data&&(this.__attrHandler.data={}),this.baObjectHandler.baObject instanceof t.BA.BaBasicObject&&(this.__attrHandler.data=this.baObjectHandler.baObject),this.__processData()}addEntry(e,t){return super.addEntry(e,t)}setAttributes(e){if(super.setAttributes(e),void 0!==e.baUsedTitle&&this.setBaUsedTitle(e.baUsedTitle),void 0!==e.valueHandler){this.__attrHandler.valueHandler=e.valueHandler;for(let e of this.__entries.values())e.setAttributes({valueHandler:{autoWrite:this.__attrHandler.valueHandler?.autoWrite}})}return this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return e instanceof t.BA.BaBasicObject?this.baObjectHandler.setBaObject(e):super.setData(e),this}setBaUsedTitle(e){return this.__attrHandler.checkAttribute(e,"baUsedTitle",{validator:"number"})?(null==e&&(e=t.BA.BaParameterId.eInstDescription),this.__attrHandler.baUsedTitle=e,this.__processBaUsedTitle(),this):this}__processBaUsedTitle(){for(let e of this.__entries.values())e.setBaUsedTitle(this.__attrHandler.baUsedTitle)}getBaUsedTitle(){return this.__attrHandler.baUsedTitle}}a.ParameterList=n,function(n){let i;!function(e){e.onEntryValueChanged="onEntryValueChanged"}(i=n.ParameterListEvents||(n.ParameterListEvents={}));class s extends a.BaseList.BaseListEntry{constructor(e,a){super(e,a),this.__valueFieldAppended=!1,this.baObjectHandler=new t.BaObjectHandler(this),this.__contentContainer=$("<div>").addClass("content-container"),this.__element.append(this.__contentContainer),this.__element.addClass("parameter-list-entry"),this.textHandler.setHorizontalAlignment("Left"),this.textHandler.getTextElement().addClass("title")}__attach(){this.__isAttached||(null!=this.__valueField&&this.__appendValueField(!0),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){this.__mappingSymbol?.destroy(),this.__valueField?.destroy(),null!=this.__baVarWatchValueId&&this.__attrHandler.data instanceof t.BA.BaVariable&&this.__attrHandler.data.stopWatch(this.__baVarWatchValueId),null!=this.__destroyOnBaParameterInformationLoaded&&(this.__destroyOnBaParameterInformationLoaded(),delete this.__destroyOnBaParameterInformationLoaded),null!=this.__destroyOnValueFieldChanged&&(this.__destroyOnValueFieldChanged(),delete this.__destroyOnValueFieldChanged),this.baObjectHandler.destroy(),super.destroy()}onTextChanged(e){super.onTextChanged(e),this.__contentContainer.append(this.textHandler.getTextElement())}__createSubList(){null==this.__sublist&&(this.__sublist=new n(this.__id+"-sublist",this)),this.baObjectHandler.baObject&&(this.__attrHandler.data=this.baObjectHandler.baObject),super.__createSubList();let e=this.__sublist.eventHandler.register(n.ParameterListEvents.onEntryValueChanged,((e,t,a)=>{this.eventHandler.raise(n.ParameterListEntry.ParameterListEntryEvents.onValueChanged,a)}));this.__sublist.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,(t=>{t.destroy(),e()})),this.__sublist.setAttributes({valueHandler:{autoWrite:this.__attrHandler.valueHandler?.autoWrite}}),this.__sublist.setBaUsedTitle(this.__attrHandler.baUsedTitle)}__appendValueField(e){null!=this.__valueField&&(e?0==this.__valueFieldAppended&&(this.__contentContainer.append(this.__valueField.getElement()),this.__destroyOnValueFieldChanged=this.__valueField.eventHandler.register(t.Components.ValueField.ValueFieldEvents.onValueChanged,(()=>{this.__attrHandler.data&&(this.__attrHandler.data.Value=this.__valueField?.getValue()),this.eventHandler.raise(s.ParameterListEntryEvents.onValueChanged,this,this.__valueField?.getValue())})),this.__valueField.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler),this.__valueFieldAppended=!0):1==this.__valueFieldAppended&&(this.__valueField.getElement().off("pointerdown",t.EventHandler.stopPropagationHandler),null!=this.__destroyOnValueFieldChanged&&(this.__destroyOnValueFieldChanged(),delete this.__destroyOnValueFieldChanged),this.__valueField.getElement().detach(),this.__valueFieldAppended=!1))}__createValueField(){return new t.Components.ValueField(this.__id+"-value-field",this).setAttributes({valueHandler:this.__attrHandler.valueHandler})}setAttributes(e){return super.setAttributes(e),void 0!==e.baUsedTitle&&this.setBaUsedTitle(e.baUsedTitle),void 0!==e.title&&this.setTitle(e.title),void 0!==e.valueHandler&&(this.__attrHandler.valueHandler=e.valueHandler),this.__valueField?.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return e instanceof t.BA.BaVariable?this.setBaParameter(e):e instanceof t.BA.BaBasicObject?this.baObjectHandler.setBaObject(e):super.setData(e),this}getData(){return this.__attrHandler.data}setValue(e){return void 0===e?this:null==this.__attrHandler.data?(console.error(`Attribute 'Data' of ParameterListEntry ${this.__id} was not set!`),this):tchmi_equal(e,this.__attrHandler.data.Value)?(this.__attrHandler.equalAttribute("Value"),this):(this.__attrHandler.data.Value=e,this.__processValue(),this)}__processValue(){if(null!=this.__attrHandler.data)if(null==this.__attrHandler.data.Value)null!=this.__valueField?.getValueFeedback()?this.__valueField?.setValueFeedback(null):this.__valueField?.setValue(null);else if(null!=this.__attrHandler.data)switch(this.__attrHandler.data.DataType){case t.DataType.boolean:case t.DataType.number:case t.DataType.integer:case t.DataType.enum:case t.DataType.string:case t.DataType.dateTime:null!=this.__valueField?.getValueFeedback()?this.__valueField.setValueFeedback(this.__attrHandler.data.Value):this.__valueField.setValue(this.__attrHandler.data.Value)}else console.warn("Set data of Entry "+this.__id+" before setting the value of it!")}getValue(){return null==this.__attrHandler.data?null:this.__attrHandler.data.Value}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,null!=this.__attrHandler.data?this.__attrHandler.data.DataType===t.DataType.number&&this.__valueField.setMinValue(this.__attrHandler.minValue):console.warn("Set data of Entry "+this.__id+" before setting the value of it"),this):this}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,null!=this.__attrHandler.data?this.__attrHandler.data.DataType===t.DataType.number&&this.__valueField.setMaxValue(this.__attrHandler.maxValue):console.warn("Set data of Entry "+this.__id+" before setting the maxValue of it"),this):this}getMaxValue(){return this.__attrHandler.maxValue}setBaUsedTitle(e){return this.__attrHandler.checkAttribute(e,"baUsedTitle",{validator:"number"})?(null!=this.baObjectHandler.baObject&&null!=this.__attrHandler.baUsedTitle&&null!=this.__baUsedTitleWatchId&&this.baObjectHandler.baObject.stopWatchBaVariable(this.__baUsedTitleWatchId),null==e&&(e=t.BA.BaParameterId.eInstDescription),this.__attrHandler.baUsedTitle=e,this.__processBaUsedTitle(),this):this}__processBaUsedTitle(){null!=this.baObjectHandler.baObject&&null!=this.__attrHandler.baUsedTitle&&(this.__baUsedTitleWatchId=this.baObjectHandler.tryWatchBaVariable(this.__attrHandler.baUsedTitle,(e=>{e&&this.textHandler.setText(e)})),null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setBaUsedTitle(this.__attrHandler.baUsedTitle)))}getBaUsedTitle(){return this.__attrHandler.baUsedTitle}setTitle(e){return this.__attrHandler.checkAttribute(e,"title",{validator:"string"})?(this.__attrHandler.title=e,this.textHandler.setText(e),this):this}getTitle(){return this.__attrHandler.title}processBaObject(){if(null!=this.baObjectHandler.baObject){this.__attrHandler.data=this.baObjectHandler.baObject,this.__processData(),this.__processBaUsedTitle();let e=!1;if(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate)if(t.Server.BaSite.PrimitveBaObjects.indexOf(this.baObjectHandler.baObject.Identifier.ObjectType)>-1){if(this.baObjectHandler.baObject.DataType===t.DataType.boolean||this.baObjectHandler.baObject.DataType===t.DataType.number||this.baObjectHandler.baObject.DataType===t.DataType.enum){if(null==this.__valueField)return;this.__valueField.baObjectHandler.setBaObject(this.baObjectHandler.baObject)}}else e=!0;else this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eStructurize||this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eAggregate?e=!0:console.error("Object purpose of menu entry is unknown");e&&null!=this.__valueField&&(this.__appendValueField(!1),this.__valueField.destroy(),delete this.__valueField)}}setBaParameter(e){return t.BA.BaVariable.isIBaVariableAttributes(e)?(tchmi_equal(this.__baParameter,e)||(this.__baParameter=e,this.__processBaParameter()),this):this}__processBaParameter(){if(this.__baParameter instanceof t.BA.BaVariable){if(!t.Server.BaSite.UserManagement.checkAccess(this.__baParameter.Access.Read))return void this.__element.detach();this.__attrHandler.data=this.__baParameter,null==this.__valueField&&(this.__valueField=this.__createValueField()),this.__valueField.setValueHandler({baVariable:this.__baParameter});let a=this.busyHandler.setBusy(`Watching value of BaVariable '${this.__baParameter.InstanceName}' for paremeter list entry.`);this.__baVarWatchValueId=this.__baParameter.watch((e=>{null!=e&&this.__attrHandler.data&&(this.__attrHandler.data.Value=e,this.__processData()),a()})),this.setTitle(this.__baParameter.Info.Title),this.__baParameter.ID!=t.BA.BaParameterId.Additional?this.__destroyOnBaParameterInformationLoaded=e.EventProvider.register(t.Server.BaSite.Events.onBaStandardParameterInformationLoaded,(()=>{this.setTitle(this.__baParameter?.Title)})):this.__destroyOnBaParameterInformationLoaded=e.EventProvider.register(t.Server.BaSite.Events.onBaAdditionalParameterInformationLoaded,(()=>{this.setTitle(this.__baParameter?.Title)})),t.BA.BaVariable.isIBaEnumeratingParameterInfo(this.__baParameter.Info)?this.baObjectHandler.watchValueRange(this.__baParameter,(e=>{null!=e&&this.__valueField instanceof t.Components.ValueField?this.__baParameter.DataType===t.DataType.enum?this.__valueField.setStateTexts(t.Components.Combobox.toComboboxItemArray(e)):this.__baParameter.DataType===t.DataType.boolean&&(this.__valueField.setActiveText(e.get(1)),this.__valueField.setInactiveText(e.get(0))):this.logger.warn(`Could not set state texts of ${this.__id}!`)})):t.BA.BaVariable.isIBaDecoratingParameterInfo(this.__baParameter.Info)?this.__baParameter.getDecoratingInfoAsync().then((e=>{null!=e&&this.__valueField instanceof t.Components.ValueField&&"number"==typeof e&&this.__valueField.setUnit(e)})).catch((e=>{t.BaseError.warn(e,this.logger)})):t.BA.BaVariable.isIBaEnumeratedParameterInfo(this.__baParameter.Info)?this.__baParameter.DataType===t.DataType.enum?this.__valueField.setStateTexts(t.Components.Combobox.toComboboxItemArray(this.__baParameter.Info.Enumerated)):(this.__valueField.setActiveText(this.__baParameter.Info.Enumerated[1]),this.__valueField.setInactiveText(this.__baParameter.Info.Enumerated[2])):t.BA.BaVariable.isIBaDecoratedParameterInfo(this.__baParameter.Info)&&this.__valueField.setUnit(this.__baParameter.Info.Decorated),this.__processData()}}getBaParameter(){return this.__baParameter}__processData(){if(super.__processData(),null!=this.__attrHandler.data)if(null==this.__attrHandler.data.Access?.Read||t.Server.BaSite.UserManagement.checkAccess(this.__attrHandler.data.Access?.Read)){switch(null!=this.__attrHandler.data.Title&&this.__attrHandler.data.Title.length>0&&this.setTitle(this.__attrHandler.data.Title),this.__attrHandler.data.DataType){case t.DataType.boolean:case t.DataType.number:case t.DataType.integer:case t.DataType.enum:case t.DataType.string:case t.DataType.dateTime:switch(null==this.__valueField&&(this.__valueField=this.__createValueField()),this.__attrHandler.data.DataType){case t.DataType.number:case t.DataType.integer:void 0!==this.__attrHandler.data.Unit&&this.__valueField.setUnit(this.__attrHandler.data.Unit),void 0!==this.__attrHandler.data.MinValue&&this.__valueField.setMinValue(this.__attrHandler.data.MinValue),void 0!==this.__attrHandler.data.MaxValue&&this.__valueField.setMaxValue(this.__attrHandler.data.MaxValue);break;case t.DataType.boolean:void 0!==this.__attrHandler.data.ActiveText&&this.__valueField.setActiveText(this.__attrHandler.data.ActiveText),void 0!==this.__attrHandler.data.InactiveText&&this.__valueField.setInactiveText(this.__attrHandler.data.InactiveText);break;case t.DataType.enum:if(null!=this.__attrHandler.data.EnumInfo){let e=[];for(let[t,a]of this.__attrHandler.data.EnumInfo)e.push({text:a,value:t});this.__valueField.setStateTexts(e)}this.__valueField.setDigits(0)}this.__valueField.setDataType(this.__attrHandler.data.DataType),this.__valueField.setValueHandler(this.__attrHandler.valueHandler),null!=this.__attrHandler.data.Value&&this.__valueField.setValue(this.__attrHandler.data.Value);break;case t.DataType.array:case t.DataType.object:switch(this.__appendValueField(!1),this.__valueField?.destroy(),delete this.__valueField,this.__attrHandler.data.DataType){case t.DataType.array:if(this.__attrHandler.data.Value){let e=this.__attrHandler.data.Value;if(e.length>0&&null!=this.__attrHandler.data.Children){const a=this.__attrHandler.data.Children;this.__attrHandler.data.Children=new Map;for(let n=0;n<e.length;n++){let i=n,s={DataType:void 0!==this.__attrHandler.data.ArrayType?this.__attrHandler.data.ArrayType:t.Helper.detectDataType(e[n]),Title:a.get("["+i+"]").Title,Mapping:this.__attrHandler.data.Mapping+"["+i+"]",Value:e[n]};this.__attrHandler.data.Children.set(n.toString(),s)}this.__attrHandler.data.DataType=t.DataType.object,this.__processData()}}case t.DataType.object:if(this.__attrHandler.data.Value&&t.Helper.detectDataType(this.__attrHandler.data.Value)===t.DataType.object&&!this.__attrHandler.data.Children){this.__attrHandler.data.Children=new Map;for(let e in this.__attrHandler.data.Value){let a={};a.Title=e,a.DataType=t.Helper.detectDataType(this.__attrHandler.data.Value[e]),a.Mapping=this.__attrHandler.data.Mapping+"::"+e,a.Value=this.__attrHandler.data.Value[e],this.__attrHandler.data.Children.set(e,a)}this.__processData()}}break;case t.DataType.unknown:break;default:return void this.logger.error(`Invalid data type '${this.__attrHandler.data.DataType}' was set for ParameterListEntry`,this.__attrHandler)}null!=this.__valueField&&(this.__attrHandler.data instanceof t.BA.BaBasicObject||(null!=this.__attrHandler.data.Access?.Write?t.Server.BaSite.UserManagement.checkAccess(this.__attrHandler.data.Access?.Write)?this.__valueField?.setReadOnly(!1):this.__valueField?.setReadOnly(!0):this.__attrHandler.data instanceof t.BA.BaVariable?this.__valueField?.setReadOnly(!0):null!=this.__attrHandler.data.ReadOnly?this.__valueField?.setReadOnly(this.__attrHandler.data.ReadOnly):this.__valueField?.setReadOnly(!0),this.__valueField?.setValue(this.__attrHandler.data.Value)),this.__valueField.getElement().addClass("value-field"),this.__valueField.textHandler.setVerticalAlignment("Center").setHorizontalAlignment("Left").setFontSize(this.textHandler.getFontSize()),this.__appendValueField(!0))}else this.__element.detach()}__processReadOnly(){super.__processReadOnly(),this.__valueField?.setReadOnly(this.__attrHandler.readOnly)}}n.ParameterListEntry=s,function(e){let t;!function(e){e.onValueChanged="onValueChanged"}(t=e.ParameterListEntryEvents||(e.ParameterListEntryEvents={}))}(s=n.ParameterListEntry||(n.ParameterListEntry={}))}(n=a.ParameterList||(a.ParameterList={}))}(t.Navigation||(t.Navigation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends a.ParameterList{constructor(e,t){super(e,t),this.__entrySelectedHandler=()=>{this.__baParent instanceof n.ProjectNavigationListEntry||(this.setContentViewButtonOffset(this.hasEntryWithContentView()),this.__onDisplayedEventsChanged())},this.__displayedEventsChangedHandler=()=>{this.__baParent instanceof n.ProjectNavigationListEntry||this.__onDisplayedEventsChanged()},this.__entries=new Map,this.setShowEvents(!0),this.setShowObjectType(!0),this.setShowValue(!0)}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(this.eventHandler.register(a.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler)),this.__destroyersToCallOnDetach.push(this.eventHandler.register(a.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler)),this.__destroyersToCallOnDetach.push(this.eventHandler.register(n.ProjectNavigationListEvents.onEntryDisplayedEventsChanged,this.__displayedEventsChangedHandler)),this.__baParent instanceof n.ProjectNavigationListEntry||this.__entrySelectedHandler(),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__setEntryData(e,t){e.setShowValue(this.__attrHandler.showValue),e.setShowEvents(this.__attrHandler.showEvents),e.setShowObjectType(this.__attrHandler.showObjectType),super.__setEntryData(e,t)}__createEntry(e,a=null){null==a&&(a=new n.ProjectNavigationListEntry(e,this)),super.__createEntry(e,a);let i=a.eventHandler.register(n.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onActiveEventsChanged,((e,t,a)=>{this.eventHandler.raise(n.ProjectNavigationListEvents.onEntryActiveEventsChanged,a)})),s=a.eventHandler.register(n.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,((e,t,a)=>{this.eventHandler.raise(n.ProjectNavigationListEvents.onEntryDisplayedEventsChanged,a)})),r=a.eventHandler.register(n.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onContentViewButtonPressed,((e,t,a)=>{this.eventHandler.raise(n.ProjectNavigationListEvents.onEntryContentViewButtonPressed,a)}));return a.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),i(),s(),r()})),a}__onDisplayedEventsChanged(){let e=this.getMostDisplayedEvents();this.setMostEvents(e),this.hideObjects(),this.setContentViewButtonOffset(this.hasEntryWithContentView())}getMostDisplayedEvents(){let e=0;for(let a of this.__entries.values()){let n=a.getDisplayedEventsCnt();if(e<n&&(e=n),a.baObjectHandler.baObject?.Purpose===t.BA.ObjectPurpose.eStructurize||a.baObjectHandler.baObject?.Purpose===t.BA.ObjectPurpose.eAggregate){let t=a.getSublist();if(null!=t){let a=t.getMostDisplayedEvents();e<a&&(e=a)}}}return e}async filterChildrenAsync(e,a=[]){if(null==this.__attrHandler.data||"string"!=typeof e)return!1;if(e.length<=0)return this.__currentFilter=null,this.show(),this.closeAllEntries(),!1;this.__currentFilter={filter:e,options:a};let n=!1;for(let i of this.__entries.values()){let s=i.baObjectHandler.baObject;if(null==s)return!1;if(s instanceof t.BA.BaView){if(s.filterChildren((t=>t.matchesTextFilter(e,a))).length>0){if(i.show(),n=!0,s.matchesTextFilter(e,a)){i.close(0);continue}await i.openAsync(0);let r=i.getSublist();if(null==r)throw new t.BaseError("Opening entry was not successful!");s.matchesTextFilter(e,a)?await(r?.filterChildrenAsync("",a)):await(r?.filterChildrenAsync(e,a))}else s.matchesTextFilter(e,a)?i.show():(i.close(0),i.hide())}else s.matchesTextFilter(e,a)?i.show():i.hide()}return n}hideObjects(){if(null!=this.__attrHandler.data)for(let e of this.__entries.values()){let t=e.getSublist();null!=t&&t.hideObjects(),this.__currentFilter&&e.baObjectHandler.baObject?.matchesTextFilter(this.__currentFilter.filter,this.__currentFilter.options)&&e.show()}}changeEvent(e,t){if(null!=this.__attrHandler.data)for(let a of this.__entries.values()){let n=a.getSublist();null!=n&&n.changeEvent(e,t),!0===t?a.showEvent(e):a.hideEvent(e),a.getDisplayedEventsCnt()<=0?a.hide():a.show()}}hasEntryWithContentView(){for(let e of this.__entries.values()){if(e.hasContentViewButton())return!0;if(e.getIsOpen()&&e.getSublist().hasEntryWithContentView())return!0}return!1}setContentViewButtonOffset(e){for(let t of this.__entries.values())t.hasContentViewButton()||!0!==e?(t.getElement().removeClass("has-no-content-view-button"),null!=t.getSublist()&&t.getSublist().setContentViewButtonOffset(e)):(t.getElement().addClass("has-no-content-view-button"),t.getIsOpen()&&t.getSublist().setContentViewButtonOffset(e))}getCurrentFilter(){return this.__currentFilter}setAttributes(e){return super.setAttributes(e),void 0===e.mostEvents&&this.setMostEvents(e.mostEvents),void 0===e.showEvents&&this.setShowEvents(e.showEvents),void 0===e.showObjectType&&this.setShowObjectType(e.showObjectType),void 0===e.showValue&&this.setShowValue(e.showValue),this}getAttributes(){return this.__attrHandler.getRef()}setMostEvents(e){if(!this.__attrHandler.checkAttribute(e,"mostEvents",{validator:"number",skipEqualityCheck:!0}))return this;this.__attrHandler.mostEvents=e;for(let t of this.__entries.values())t.setMostEvents(e);return this}getMostEvents(){return this.__attrHandler.mostEvents}setShowEvents(e){if(!this.__attrHandler.checkAttribute(e,"showEvents",{validator:"boolean"}))return this;this.__attrHandler.showEvents=e;for(let t of this.__entries.values())t.setShowEvents(e);return this}getShowEvents(){return this.__attrHandler.showEvents}setShowObjectType(e){if(!this.__attrHandler.checkAttribute(e,"showObjectType",{validator:"boolean"}))return this;this.__attrHandler.showObjectType=e;for(let t of this.__entries.values())t.setShowObjectType(e);return this}getShowObjectType(){return this.__attrHandler.showObjectType}setShowValue(e){if(!this.__attrHandler.checkAttribute(e,"showValue",{validator:"boolean"}))return this;this.__attrHandler.showValue=e;for(let t of this.__entries.values())t.setShowValue(e);return this}getShowValue(){return this.__attrHandler.showValue}processBaObject(){super.processBaObject(),this.__baParent instanceof n.ProjectNavigationListEntry||(this.setContentViewButtonOffset(this.hasEntryWithContentView()),this.baObjectHandler.baObject?.loadAttributes(!0,!0))}__processData(){super.__processData()}}a.ProjectNavigationList=n,function(n){let i;!function(e){e.onEntryActiveEventsChanged="onEntryActiveEventsChanged",e.onEntryDisplayedEventsChanged="onEntryDisplayedEventsChanged",e.onEntryContentViewButtonPressed="onEntryContentViewButtonPressed"}(i=n.ProjectNavigationListEvents||(n.ProjectNavigationListEvents={})),n.MaximumEventTypePulse=new Map([[t.BA.Role.eGuest,t.BA.EventType.eDisturb],[t.BA.Role.eBasic,t.BA.EventType.eDisturb],[t.BA.Role.eAdvanced,t.BA.EventType.eDisturb],[t.BA.Role.eExpert,t.BA.EventType.eDisturb],[t.BA.Role.eInternal,t.BA.EventType.eDisturb]]),n.MaximumEventConditionDisplayed=new Map([[t.BA.Role.eGuest,t.BA.EventCondition.eTypeOther],[t.BA.Role.eBasic,t.BA.EventCondition.eTypeOther],[t.BA.Role.eAdvanced,t.BA.EventCondition.eEventIconDisplayed],[t.BA.Role.eExpert,t.BA.EventCondition.eEventIconDisplayed],[t.BA.Role.eInternal,t.BA.EventCondition.eEventIconDisplayed]]),n.UseManualOverrideComponent=!0;class s extends a.ParameterList.ParameterListEntry{constructor(e,a){super(e,a),this.__eventTypeContainerAppended=!1,this.__objectTypeButtonAppended=!0,this.__displayedEventsCnt=0,this.__showPulse=!1,this.__changedParameters=new Map,this.__objectTypeButtonPressedHandler=()=>{0!=this.checkAccess(t.Server.AccessRight.operate)&&this.baObjectHandler.baObject?.openParameterDialog()},this.__contentViewButtonPressedHandler=()=>{this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onContentViewButtonPressed,this)},this.__element.addClass("project-navigation-list-entry"),this.__objectTypeButton=new t.Components.Button(this.__id+"-object-type-button",this),this.__eventIconContainer=$("<div>").addClass("event-icon-container"),this.__legendIconHandler=new t.Components.LegendIconHandler(t.Icons.convertIIconDataToIIconAttributes(t.Icons.ObjectType.StructuredView)),this.__objectTypeButton.getElement().addClass("object-type-button"),this.__objectTypeButton.iconHandler.setIcon(t.Icons.ObjectType.StructuredView.path,!0).setIconHeight(70,"%").setIconWidth(70,"%"),this.__contentContainer.append(this.__objectTypeButton.getElement()),this.textHandler.setText("..."),this.textHandler.getTextElement().addClass("title-textblock"),this.__contentContainer.append(this.textHandler.getTextElement()),this.textHandler.setVerticalAlignment("Center").setHorizontalAlignment("Left"),this.__contentContainer.append(this.__eventIconContainer),this.__eventTypeContainerAppended=!0}__attach(){this.__isAttached||(this.__eventIconContainer.on("pointerdown",t.EventHandler.stopPropagationHandler),this.__objectTypeButton.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler),this.__contentViewButton?.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler),this.__destroyOnObjectTypeButtonPressed=this.__objectTypeButton.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__objectTypeButtonPressedHandler),this.__destroyOnContentViewButtonPressed=this.__contentViewButton?.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__contentViewButtonPressedHandler),null!=this.__baVarList&&this.__destroyersToCallOnDestroy.push(this.__baVarList.eventHandler.register(a.ParameterList.ParameterListEvents.onEntryValueChanged,((e,n,i)=>{let s=i.getBaParent();if(null!=s&&(s=s?.getBaParent(),null!=s&&i instanceof a.ParameterList.ParameterListEntry&&s.getId()===this.__id)){let e=i.getData();e instanceof t.BA.BaVariable&&this.__changedParameters.set(e.ID,e)}}))),this.__managePulse(),this.__legendIconHandler.show(),super.__attach())}__detach(){this.__isAttached&&(this.__eventIconContainer.off("pointerdown",t.EventHandler.stopPropagationHandler),this.__objectTypeButton.getElement().off("pointerdown",t.EventHandler.stopPropagationHandler),this.__contentViewButton?.getElement().off("pointerdown",t.EventHandler.stopPropagationHandler),null!=this.__destroyOnObjectTypeButtonPressed&&this.__destroyOnObjectTypeButtonPressed(),null!=this.__destroyOnContentViewButtonPressed&&this.__destroyOnContentViewButtonPressed(),this.__legendIconHandler.hide(),super.__detach())}destroy(){if(null!=this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse(),delete this.__destroyOnCustomBaPulse),null!=this.__destroyOnObjectTypeButtonPressed&&(this.__destroyOnObjectTypeButtonPressed(),delete this.__destroyOnObjectTypeButtonPressed),null!=this.__destroyOnContentViewButtonPressed&&(this.__destroyOnContentViewButtonPressed(),delete this.__destroyOnContentViewButtonPressed),this.__objectTypeButton.destroy(),this.__contentViewButton?.destroy(),this.__activeEvents)for(let e=0;e<this.__activeEvents.length;e++)this.__activeEvents[e].destroy();null!=this.__eventsWatchIdentifier&&(this.baObjectHandler.baObject instanceof t.BA.BaEventObject||this.baObjectHandler.baObject instanceof t.BA.BaView)&&this.baObjectHandler.baObject.eventHandler.stopWatchEventsPerIcon(this.__eventsWatchIdentifier),super.destroy()}__onEventDataChanged(e){let a=this.__activeEvents?this.__activeEvents.length:0,i=0;for(let[a,s]of e){if(a>n.MaximumEventConditionDisplayed.get(t.Server.BaSite.UserManagement.getBaRole()))continue;let e;if(s.nCount>0){if(this.__activeEvents&&this.__activeEvents[i])e=this.__activeEvents[i];else{e=new t.Components.EventIcon(this.__id+"-event-icon-"+i,this),e.getElement().addClass("event-icon"),this.__activeEvents||(this.__activeEvents=[]),this.__activeEvents.push(e),1===this.__activeEvents.length&&e.getElement().addClass("first");let a=e.eventHandler.register(t.Components.EventIcon.EventIconEvents.onAcknowledged,(()=>{(this.baObjectHandler.baObject instanceof t.BA.BaView||this.baObjectHandler.baObject instanceof t.BA.BaEventObject)&&this.baObjectHandler.baObject.eventHandler.acknowledgeAsync().catch((e=>{t.BaseError.warn(e,this.logger)}))}));e.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),a()}))}e.setEventCondition(a),e.setEventState(s.eMostPriorisedState),e.setEventCount(s.nCount),i++}}if(this.__displayedEventsCnt=i-(a-this.__displayedEventsCnt),this.__activeEvents&&i<this.__activeEvents.length)for(let e=this.__activeEvents.length-1;e>=i;e--)this.__activeEvents[e].getElement().detach(),this.__activeEvents[e].destroy(),this.__activeEvents.pop();if(this.__attrHandler.showEvents&&(this.__eventTypeContainerAppended||(this.__contentContainer.append(this.__eventIconContainer),this.__isAttached&&this.__eventIconContainer.on("pointerdown",t.EventHandler.stopPropagationHandler),this.__eventTypeContainerAppended=!0)),this.__activeEvents)for(let e=a;e<this.__activeEvents.length;e++)this.__eventIconContainer.append(this.__activeEvents[e].getElement());this.__managePulse(),this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onActiveEventsChanged,this),this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,this)}__createSubList(){null==this.__sublist&&(this.__sublist=new n(this.__id+"-sublist",this)),super.__createSubList();let e=this.__sublist.eventHandler.register(n.ProjectNavigationListEvents.onEntryActiveEventsChanged,((e,t,a)=>{this.eventHandler.raise(n.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onActiveEventsChanged,a)})),a=this.__sublist.eventHandler.register(n.ProjectNavigationListEvents.onEntryDisplayedEventsChanged,((e,t,a)=>{this.eventHandler.raise(n.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,a)})),i=this.__sublist.eventHandler.register(n.ProjectNavigationListEvents.onEntryContentViewButtonPressed,((e,t,a)=>{this.eventHandler.raise(n.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onContentViewButtonPressed,a)}));this.__sublist.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,(t=>{t.destroy(),e(),a(),i()})),this.__sublist.setShowValue(this.__attrHandler.showValue).setShowEvents(this.__attrHandler.showEvents).setShowObjectType(this.__attrHandler.showObjectType).setMostEvents(this.__attrHandler.mostEvents)}__createValueField(){return n.UseManualOverrideComponent?new t.Components.ManualOverride(this.__id+"-value-field",this):super.__createValueField()}__updateAppearance(){null!=this.__attrHandler.showObjectType&&(this.__attrHandler.showObjectType?this.__objectTypeButtonAppended||(this.__contentContainer.append(this.__objectTypeButton.getElement()),this.__isAttached&&(this.__destroyOnObjectTypeButtonPressed=this.__objectTypeButton.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__objectTypeButtonPressedHandler)),this.__objectTypeButtonAppended=!0):this.__objectTypeButtonAppended&&(this.__objectTypeButton.getElement().detach(),null!=this.__destroyOnObjectTypeButtonPressed&&this.__destroyOnObjectTypeButtonPressed(),this.__objectTypeButtonAppended=!1)),null!=this.__attrHandler.showEvents&&(this.__attrHandler.showEvents?this.__eventTypeContainerAppended||(this.__contentContainer.append(this.__eventIconContainer),this.__eventIconContainer.on("pointerdown",t.EventHandler.stopPropagationHandler),this.__eventTypeContainerAppended=!0):this.__eventTypeContainerAppended&&(this.__eventIconContainer.off("pointerdown",t.EventHandler.stopPropagationHandler),this.__eventIconContainer.detach(),this.__eventTypeContainerAppended=!1)),null!=this.__attrHandler.showValue&&(this.__attrHandler.showValue?(this.__appendValueField(!0),this.__setValueFieldPositionOffset(0)):this.__appendValueField(!1))}__managePulse(){let e=!1;if(!this.__isOpen&&this.__activeEvents&&this.__activeEvents.length>0)for(let a=0;a<this.__activeEvents.length;a++){let i=this.__activeEvents[a],s=i.getEventCondition();if(null!=s&&s<=n.MaximumEventTypePulse.get(t.Server.BaSite.UserManagement.getBaRole())&&(i.getEventState()===t.BA.EventIconState.eGone||i.getEventState()===t.BA.EventIconState.ePresent)){e=!0;break}}this.__enablePulse(e),e?this.__element.addClass("shows-pulse"):(this.__element.removeClass("shows-pulse"),this.__element.removeClass("pulse"))}__enablePulse(a){this.__showPulse!==a&&(a?this.__destroyOnCustomBaPulse=e.EventProvider.register(t.TcHmiBaEvents.onNewPulse,(()=>{this.__element.addClass("pulse"),this.__element.on("animationend",(()=>{this.__element.removeClass("pulse")}))})):this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse(),delete this.__destroyOnCustomBaPulse),this.__showPulse=a)}__setValueFieldPositionOffset(e){null!=e?e>0?(this.__eventIconContainer?.addClass("use-value-field-offset"),this.__element.css("--event-icon-container-size-offset",String(e))):this.__eventIconContainer?.removeClass("use-value-field-offset"):(this.__element.css("--event-icon-container-size-offset","0"),this.__eventIconContainer?.removeClass("use-value-field-offset"))}open(e){return!!super.open(e)&&(this.__eventIconContainer.fadeTo(this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:a.BaseList.DefaultSlideDuration,.3),this.__managePulse(),!0)}openAsync(e){return new Promise((async(t,a)=>{const n=await super.openAsync(e);return n&&null!=this.baObjectHandler.baObject&&await(this.__sublist?.baObjectHandler.isLoadingBaObject()),t(n)}))}close(e){return!!super.close(e)&&(this.__eventIconContainer.fadeTo(this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:a.BaseList.DefaultSlideDuration,1,(()=>this.__eventIconContainer.css("opacity",""))),this.__isOpen?this.eventHandler.register(a.BaseList.BaseListEntry.BaseListEntryEvents.onClosed,(e=>{e.destroy(),this.__managePulse()})):this.__managePulse(),!0)}getTitleTextblock(){return this.textHandler.getTextElement()}getActiveEvents(){return this.__activeEvents}hideEvent(e){if(this.__activeEvents)for(let t=0;t<this.__activeEvents.length;t++)if(this.__activeEvents[t].getEventCondition()===e){this.__activeEvents[t].getElement().addClass("tchmi-ba-display-none"),this.__displayedEventsCnt--,this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,this);break}}showEvent(e){if(this.__activeEvents)for(let t=0;t<this.__activeEvents.length;t++)if(this.__activeEvents[t].getEventCondition()===e){this.__activeEvents[t].getElement().removeClass("tchmi-ba-display-none"),this.__displayedEventsCnt++,this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,this);break}}getDisplayedEventsCnt(){return this.__displayedEventsCnt}hasContentViewButton(){return null!=this.__contentContainer.children(".content-view-button")[0]}addContentViewButton(){null==this.__contentViewButton&&(this.__contentViewButton=new t.Components.Button(this.__id+"-content-view-button",this),this.__contentViewButton.iconHandler.setIcon(t.Icons.Standard.Right_Arrow.path,!0),this.__contentViewButton.getElement().addClass("content-view-button"),this.__contentContainer.append(this.__contentViewButton.getElement()),this.__isAttached&&(this.__destroyOnContentViewButtonPressed=this.__contentViewButton?.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__contentViewButtonPressedHandler),this.__contentViewButton?.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler)))}removeContentViewButton(){null!=this.__destroyOnContentViewButtonPressed&&this.__destroyOnContentViewButtonPressed(),this.__contentViewButton?.getElement().detach(),this.__contentViewButton?.destroy()}setAttributes(e){return super.setAttributes(e),void 0!==e.contentHeight&&this.setContentHeight(e.contentHeight,e.contentHeightUnit),this}getAttributes(){return this.__attrHandler.getRef()}setMostEvents(e){return this.__attrHandler.checkAttribute(e,"mostEvents",{validator:"number",skipEqualityCheck:!0})?(this.__attrHandler.mostEvents=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setMostEvents(e)),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getMostEvents(){return this.__attrHandler.mostEvents}setShowEvents(e){return this.__attrHandler.checkAttribute(e,"showEvents",{validator:"boolean"})?(this.__attrHandler.showEvents=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setShowEvents(e)),this.__updateAppearance(),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getShowEvents(){return this.__attrHandler.showEvents}setShowValue(e){return this.__attrHandler.checkAttribute(e,"showValue",{validator:"boolean"})?(this.__attrHandler.showValue=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setShowValue(e)),this.__updateAppearance(),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getShowValue(){return this.__attrHandler.showValue}setShowObjectType(e){return this.__attrHandler.checkAttribute(e,"showObjectType",{validator:"boolean"})?(this.__attrHandler.showObjectType=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setShowObjectType(e)),this.__updateAppearance(),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getShowObjectType(){return this.__attrHandler.showObjectType}setContentHeight(e,a){return t.Components.LayoutHandler.dimensionSetter(this.__attrHandler,"contentHeight",e,a)?(this.__processContentHeight(),this):this}__processContentHeight(){if(null!=this.__attrHandler.contentHeight&&(null==this.__attrHandler.contentHeightUnit&&(this.__attrHandler.contentHeightUnit="px"),this.__element.css("--content-height",this.__attrHandler.contentHeight+this.__attrHandler.contentHeightUnit),null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eStructurize||this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eAggregate)))for(let e of this.__sublist.getEntries().values())e.setContentHeight(this.__attrHandler.contentHeight,this.__attrHandler.contentHeightUnit)}getContentHeight(){return this.__attrHandler.contentHeight}getContentHeightUnit(){return this.__attrHandler.contentHeightUnit}processBaObject(){if(super.processBaObject(),null==this.baObjectHandler.baObject)return;let e=this.baObjectHandler.baObject.getIconAttributes();if(this.__objectTypeButton.iconHandler.setIcon(e.iconPath,!0),this.__legendIconHandler.icon=e,this.__isAttached&&this.__legendIconHandler.show(),this.baObjectHandler.baObject instanceof t.BA.BaView||this.baObjectHandler.baObject instanceof t.BA.BaEventObject){let e=this.busyHandler.setBusy("Watching events of BaObject",{showIndicator:t.BusyHandler.ShowEventLoading}),a=this.baObjectHandler.baObject.eventHandler.watchEventsPerIcon((t=>{this.__onEventDataChanged(t),e()}));null!=a?this.__eventsWatchIdentifier=a:e()}if(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate)switch(this.baObjectHandler.baObject.Identifier.ObjectType){case t.BA.ObjectType.eAnalogInput:case t.BA.ObjectType.eAnalogOutput:case t.BA.ObjectType.eAnalogValue:case t.BA.ObjectType.eBinaryInput:case t.BA.ObjectType.eBinaryOutput:case t.BA.ObjectType.eBinaryValue:case t.BA.ObjectType.eMultiStateInput:case t.BA.ObjectType.eMultiStateOutput:case t.BA.ObjectType.eMultiStateValue:case t.BA.ObjectType.eSchedule:case t.BA.ObjectType.eLoop:this.__attrHandler.showValue||null==this.__valueField||(this.__appendValueField(!1),this.__valueField.destroy(),delete this.__valueField);break;case t.BA.ObjectType.eEventClass:console.log("Was muss bei "+t.BA.ObjectType[this.baObjectHandler.baObject.Identifier.ObjectType]+" noch angezeigt werden?");break;case t.BA.ObjectType.eTrend:case t.BA.ObjectType.eCalendar:case t.BA.ObjectType.eObject:break;case t.BA.ObjectType.eProject:console.log("Was muss bei "+t.BA.ObjectType[this.baObjectHandler.baObject.Identifier.ObjectType]+" noch angezeigt werden?");break;default:console.error("Object type of menu entry is unknown!")}}}n.ProjectNavigationListEntry=s,function(e){let t;!function(e){e.onActiveEventsChanged="onActiveEventsChanged",e.onDisplayedEventsChanged="onDisplayedEventsChanged",e.onContentViewButtonPressed="onContentViewButtonPressed"}(t=e.ProjectNavigationListEntryEvents||(e.ProjectNavigationListEntryEvents={}))}(s=n.ProjectNavigationListEntry||(n.ProjectNavigationListEntry={}))}(n=a.ProjectNavigationList||(a.ProjectNavigationList={}))}(t.Navigation||(t.Navigation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a{constructor(t,a){this.echartsOption={triggerEvent:!0},this.__options=null,this.__axisClickedHandler=t=>{t.xAxisIndex!==this.getAxisIndex()&&t.yAxisIndex!==this.getAxisIndex()||this.__dataType!==e.DataType.boolean&&this.__openConfigureAxisDialog()},this.__id=t,this.__parent=a,this.__logger=new e.Logger({name:this.__id}),this.echartsOption.id=t,this.resetToDefault(),e.Storage.UserData.loadAxisOptionsAsync(this.__id).then((e=>{null!=e&&this.setOptions(e)})).catch((t=>e.BaseError.warn(t,this.__logger)))}__openConfigureAxisDialog(){let t=$("<div>").addClass("tchmi-ba-charting-axis-configure-dialog-content");t.css({position:"relative",height:"100%",width:"100%"});let n=new e.Navigation.ParameterList(this.__id+"-config-list",this.__parent),i={Children:new Map([["auto-scale",{DataType:e.DataType.boolean,Title:"Auto scale",ReadOnly:!1,Value:null!=this.__options&&this.__options.autoScale,ActiveText:"",InactiveText:""}],["min",{DataType:this.__dataType,Title:"Min",ReadOnly:!1,Value:null!=this.__options?.min?this.__options.min:0}],["max",{DataType:this.__dataType,Title:"Max",ReadOnly:!1,Value:null!=this.__options?.max?this.__options.max:0}]])};n.setData(i),t.append(n.getElement());let s={appearance:{content:t,headline:{textAttributes:{text:e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.AxisConfiguration)}},modal:!0,buttons:e.Components.DialogWindow.Buttons.Cancel,layout:{maxHeight:a.DefaultAxisOptionsDialogSize.height,maxWidth:a.DefaultAxisOptionsDialogSize.width}},callbacks:{cbClosed:()=>{n.destroy()}}};e.Components.DialogWindow.openDialogWindow(s);let r=n.eventHandler.register(e.Navigation.ParameterList.ParameterListEvents.onEntryValueChanged,(async(t,a,n)=>{try{let t={};switch(this.__options&&(t=e.Helper.Object.clone(this.__options)),n.getId()){case a.getId()+"-auto-scale":let e=n.getValue();null!=e?t.autoScale=e:delete t.autoScale;break;case a.getId()+"-min":let i=n.getValue();null!=i?t.min=i:delete t.min;break;case a.getId()+"-max":let s=n.getValue();null!=s?t.max=s:delete t.max}this.setOptions(t),this.__options&&await e.Storage.UserData.saveAxisOptionsAsync(this.__id,this.__options)}catch(t){e.BaseError.warn(t,this.__logger)}}));n.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,(e=>{e.destroy(),r()}))}updateEchartsOption(){}resetToDefault(){this.echartsOption.show=!0,this.echartsOption.gridIndex=0,this.echartsOption.minInterval=1,this.echartsOption.axisLine||(this.echartsOption.axisLine={}),this.echartsOption.axisLine.show=!0,this.echartsOption.axisTick||(this.echartsOption.axisTick={}),this.echartsOption.axisTick.show=!0,this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.show=!0,this.echartsOption.splitLine||(this.echartsOption.splitLine={}),this.echartsOption.splitLine.show=!0,this.updateColors()}getAxisIndex(){let t=0;if(this instanceof n)t=this.__parent.getYAxes().findIndex((e=>e.getId()===this.getId()));else{if(!(this instanceof i))throw new e.BaseError("Invalid axis instance!");t=this.__parent.getXAxes().findIndex((e=>e.getId()===this.getId()))}if(-1===t)throw new e.BaseError(`Axis '${this.getId()}' was not found in parent!`);return t}getId(){return this.__id}getFormatter(){return t=>{if("number"!=typeof t){if(null==!t.value)return"";t=t.value}switch(t instanceof Array&&(t=t[1]),this.__dataType){case e.DataType.number:if("number"!=typeof t)throw new Error("Data type of value should be number!");return this.__unit?t.toFixed(0)+this.__unit:t.toFixed(0);case e.DataType.dateTime:let a=new Date(t);return a.toLocaleTimeString()+"\n"+a.toLocaleDateString();case e.DataType.boolean:if("boolean"!=typeof(t=0!==t))throw new Error("Data type of value should be boolean!");return t?this.__activeText:this.__inactiveText;case e.DataType.enum:if("number"!=typeof t)throw new Error("Data type of value should be number!");return this.__stateTexts?this.__stateTexts.find((e=>e.value===t))?.text:t;default:return t.toFixed(2)}}}getRequiredSpace(){return this.__name?65:50}hide(){this.echartsOption.show&&(this.echartsOption.show=!1,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}getIsHided(){return null!=this.echartsOption.show&&!this.echartsOption.show}show(){this.echartsOption.show||(this.echartsOption.show=!0,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}updateColors(){this.echartsOption.axisLine||(this.echartsOption.axisLine={}),this.echartsOption.axisLine.lineStyle||(this.echartsOption.axisLine.lineStyle={}),this.echartsOption.axisLine.lineStyle.color=this.__color?this.__color.toString():this.__parent.getUsedColors().lines.toString(),this.echartsOption.axisPointer&&this.echartsOption.axisPointer.label&&this.echartsOption.axisPointer.label.show&&(this.echartsOption.axisPointer.label.backgroundColor=this.__color?this.__color.toString():this.__parent.getUsedColors().handles.toString())}addLinkedSeries(e){this.__linkedSeries||(this.__linkedSeries=[]),this.__linkedSeries.push(e)}removeLinkedSeries(e){if(!this.__linkedSeries)return!1;let t=this.__linkedSeries.length;return this.__linkedSeries=this.__linkedSeries.filter((t=>t.getId()!=e.getId())),t!=this.__linkedSeries.length||(this.__logger.warn("Removing link of series wasn not successfull because series wasn't found.",{series:e,axis:this}),!1)}getLinkedSeries(){return this.__linkedSeries}destroy(){}setName(e){return null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("Name",e),this):tchmi_equal(this.__name,e)?(this.__logger.equalAttribute("Name"),this):(null==e&&(e=void 0),this.__name=e,this.__processName(),this)}__processName(){this.echartsOption.name=this.__name,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getName(){return this.__name}setOptions(e){if(void 0===e||"object"!=typeof e)return this.__logger.invalidAttribute("Options",e),this;if(tchmi_equal(this.__options,e))return this.__logger.equalAttribute("Options"),this;if(null==e)this.__options=e;else for(let t in e)null==this.__options&&(this.__options={}),this.__options[t]=e[t];return this.__processOptions(),this}__processOptions(){this.__options&&(this.__options.autoScale?(delete this.echartsOption.min,delete this.echartsOption.max):(null!=this.__options.min&&(this.echartsOption.min=this.__options.min),null!=this.__options.max&&(this.echartsOption.max=this.__options.max)),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}getOptions(){return this.__options}setUnit(e){return null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("Unit",e),this):tchmi_equal(this.__unit,e)?(this.__logger.equalAttribute("Unit"),this):(null==e&&(e=void 0),this.__unit=e,this.__processUnit(),this)}__processUnit(){}getUnit(){return this.__unit}setColor(t){return null==t||t instanceof e.Color.RGBAColor?tchmi_equal(this.__color,t)?(this.__logger.equalAttribute("Color"),this):(null==t&&(t=void 0),this.__color=t,this.__processColor(),this):(this.__logger.invalidAttribute("Color",t),this)}__processColor(){this.updateColors(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getColor(){return this.__color}setActiveText(e){return void 0===e||null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("ActiveText",e),this):e===this.__activeText?(this.__logger.equalAttribute("ActiveText"),this):(this.__activeText=e,this.__processActiveText(),this)}__processActiveText(){}getActiveText(){return this.__activeText}setInactiveText(e){return void 0===e||null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("InactiveText",e),this):e===this.__inactiveText?(this.__logger.equalAttribute("InactiveText"),this):(this.__inactiveText=e,this.__processInactiveText(),this)}__processInactiveText(){}getInactiveText(){return this.__inactiveText}setStateTexts(e){return void 0===e?(this.__logger.invalidAttribute("StateTexts",e),this):tchmi_equal(e,this.__stateTexts)?(this.__logger.equalAttribute("StateTexts"),this):(this.__stateTexts=e,this.__processStateTexts(),this)}__processStateTexts(){}getStateTexts(){return this.__stateTexts}}t.Axis=a,function(e){e.DefaultAxisOptionsDialogSize={height:180,width:350}}(a=t.Axis||(t.Axis={})),t.isXAxisDataType=function(t){return"number"==typeof t&&(t===e.DataType.dateTime||t===e.DataType.number||t===e.DataType.unknown)},t.isYAxisDataType=function(t){return"number"==typeof t&&(t===e.DataType.boolean||t===e.DataType.number||t===e.DataType.enum||t===e.DataType.unknown)};class n extends a{constructor(e,t){super(e,t),this.echartsOption.position="left",this.__parent.getEchart().on("click","yAxis",this.__axisClickedHandler)}resetToDefault(){super.resetToDefault(),this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.margin=10,this.echartsOption.axisLabel.fontSize=this.__parent.getEchartOption().textStyle?.fontSize,this.echartsOption.axisLabel.formatter=this.getFormatter()}destroy(){this.__parent.getEchart().off("click",this.__axisClickedHandler),super.destroy()}setDataType(e){return null!=e&&"number"!=typeof e?(this.__logger.invalidAttribute("DataType",e),this):tchmi_equal(this.__dataType,e)?(this.__logger.equalAttribute("DataType"),this):(null==e&&(e=void 0),this.__dataType=e,this.__processDataType(),this)}__processDataType(){this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.show=!0,this.echartsOption.axisTick||(this.echartsOption.axisTick={}),this.echartsOption.axisTick.show=!0,this.echartsOption.axisPointer||(this.echartsOption.axisPointer={}),this.echartsOption.axisPointer.snap=!0,this.echartsOption.axisPointer.label||(this.echartsOption.axisPointer.label={}),this.echartsOption.axisPointer.label.show=!0,this.echartsOption.axisPointer.label.formatter=this.getFormatter(),this.__dataType===e.DataType.boolean?(this.setOptions({min:0,max:1}),this.echartsOption.axisPointer.label.show=!1):null==this.__options?.autoScale&&this.setOptions({autoScale:!0}),this.updateColors(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getDataType(){return this.__dataType}__processName(){super.__processName(),this.echartsOption.nameLocation="middle",this.echartsOption.nameGap=40,this.echartsOption.nameTextStyle||(this.echartsOption.nameTextStyle={}),this.echartsOption.nameTextStyle.fontSize=Number(this.__parent.getEchartOption().textStyle?.fontSize)+3,this.echartsOption.nameTextStyle.fontWeight="bold",this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}__processUnit(){super.__processUnit();let e=this.__unit;null==e&&(e=""),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}}t.YAxis=n;class i extends a{constructor(e,t){super(e,t),this.__showAxisHandle=!1,this.__parent.getEchart().on("click","xAxis",this.__axisClickedHandler)}updateEchartsOption(){if(super.updateEchartsOption(),this.__showAxisHandle&&this.echartsOption.axisPointer){let e=this.__parent.getEchartOption().xAxis;if(e instanceof Array){let t=e[this.getAxisIndex()].axisPointer?.value;null!=t&&(this.echartsOption.axisPointer.value=t)}}}updateColors(){super.updateColors(),this.__showAxisHandle&&this.echartsOption.axisPointer&&(this.echartsOption.axisPointer.handle={color:this.__parent.getUsedColors().handles.toString()})}resetToDefault(){super.resetToDefault(),this.echartsOption.position="bottom",this.echartsOption.axisPointer||(this.echartsOption.axisPointer={}),this.echartsOption.axisPointer.snap=!0,this.echartsOption.axisPointer.label||(this.echartsOption.axisPointer.label={}),this.echartsOption.axisPointer.label.show=!0,this.echartsOption.axisPointer.label.formatter=this.getFormatter(),this.updateColors()}setDataType(e){return null!=e&&"number"!=typeof e?(this.__logger.invalidAttribute("DataType",e),this):tchmi_equal(this.__dataType,e)?(this.__logger.equalAttribute("DataType"),this):(null==e&&(e=void 0),this.__dataType=e,this.__processDataType(),this)}__processDataType(){this.__dataType===e.DataType.dateTime?this.echartsOption.type="time":this.echartsOption.type="value",this.__processUnit(),this.__processName()}getDataType(){return this.__dataType}setShowAxisHandle(e){return null!=e&&"boolean"!=typeof e?(this.__logger.invalidAttribute("ShowAxisHandle",e),this):tchmi_equal(this.__showAxisHandle,e)?(this.__logger.equalAttribute("ShowAxisHandle"),this):(null==e&&(e=!1),this.__showAxisHandle=e,this.__processShowAxisHandle(),this)}__processShowAxisHandle(){this.echartsOption.axisPointer||(this.echartsOption.axisPointer={}),this.__showAxisHandle?this.echartsOption.axisPointer.handle={show:!0,size:30,color:this.__parent.getUsedColors().handles.toString()}:this.echartsOption.axisPointer.handle={show:!1},this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getShowAxisHandle(){return this.__showAxisHandle}__processName(){super.__processName(),this.__dataType===e.DataType.dateTime&&(this.echartsOption.name=""),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}__processUnit(){let e=this.__unit;null==e&&(e=""),this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.margin=10,this.echartsOption.axisLabel.fontSize=this.__parent.getEchartOption().textStyle?.fontSize,this.echartsOption.axisLabel.formatter=this.getFormatter(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}}t.XAxis=i}(e.Charting||(e.Charting={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){t.DotSize=3,t.DotSymbol="circle";class a{constructor(a,n,i){this.echartsOption={},this.__yAxis=null,this.__yAxisIndex=0,this.__xAxis=null,this.__xAxisIndex=0,this.__dataType={x:void 0,y:void 0},this.__baObject=null,this.__maxData={x:null,y:null},this.__minData={x:null,y:null},this.__isHided=!1,this.__seriesClickedHandler=e=>{if(e.seriesIndex===this.getSeriesIndex()&&console.log("[Test] Series clicked!",this,e),this.__data){let t=this.__data[e.dataIndex];t&&t.options&&t.options.onClicked&&t.options.onClicked(t)}},this.__id=a,this.__parent=n,this.logger=new e.Logger({name:this.__id}),this.echartsOption.id=a,this.__parent.getEchart().on("click","series",this.__seriesClickedHandler),i&&(i.name&&this.setName(i.name),i.data&&this.setData(i.data)),this.echartsOption.type="line",this.echartsOption.symbol=t.DotSymbol,this.echartsOption.symbolSize=t.DotSize,this.echartsOption.animation=!0,this.echartsOption.animationDuration=500,this.echartsOption.yAxisIndex=0,this.echartsOption.xAxisIndex=0,i&&(i.yAxis&&this.setYAxis(i.yAxis),i.xAxis&&this.setXAxis(i.xAxis),i.dataType&&this.setDataType(i.dataType),i.color&&this.setColor(i.color),i.baObject&&this.setBaObject(i.baObject))}__detectXAxisDataType(t,a){return t instanceof Date?e.DataType.dateTime:"number"==typeof t?a&&this.__dataType.y===e.DataType.enum?e.DataType.unknown:e.DataType.number:e.DataType.unknown}__detectYAxisDataType(t,a){return t instanceof Date?e.DataType.unknown:"number"==typeof t?a&&this.__dataType.y===e.DataType.enum?e.DataType.enum:e.DataType.number:"boolean"==typeof t?e.DataType.boolean:e.DataType.unknown}__validateData(e){if(e instanceof Array){let t=this.__detectXAxisDataType(e[0].x),a=this.__detectYAxisDataType(e[0].y,!0);for(let n=0;n<e.length;n++){let i=e[n].x;if(this.__detectXAxisDataType(i)!==t&&null!=e[n].x)return console.error("Data types of all x values of a series must be equal!"),!1;let s=e[n].y;if(this.__detectYAxisDataType(s,!0)!==a&&null!=e[n].y)return console.error("Data types of all y values of a series must be equal!"),!1}return!0}return!0}__validateAxis(a,n){if(a){let i=a.getDataType();if(i){if(n!=i)return this.logger.warn(`Data type '${e.DataType[i]}' of axis '${a.getId()}' does not match to '${e.DataType[n]}'!`,{axis:a,series:this}),!1}else a instanceof t.YAxis?n!==e.DataType.boolean&&n!==e.DataType.number||a.setDataType(n):n!==e.DataType.number&&n!==e.DataType.dateTime||a.setDataType(n)}return!0}updateEchartsOption(){}verify(){this.__errObj={series:this};let t=this.__data;if(!t||t.length<=0)return console.warn("Series does not contain any data!",this.__errObj),!1;if(!this.__errObj)throw new Error("Error object should be availiable here!");return this.__errObj.seriesDataType=this.__dataType,this.__errObj.yAxisIndex=this.__yAxisIndex,this.__errObj.yAxis=this.__parent.getYAxes()[this.__errObj.yAxisIndex],null==this.echartsOption.yAxisIndex||null==this.echartsOption.xAxisIndex?(console.error("YAxisIndex or xAxisIndex of echart option is not set!",this.__errObj),!1):this.__yAxisIndex!=this.echartsOption.yAxisIndex||this.__xAxisIndex!=this.echartsOption.xAxisIndex?(console.error("YAxisIndex or xAxisIndex of series and echart option are not equal!",this.__errObj),!1):this.__errObj.yAxis?(this.__errObj.yAxisDataType=this.__errObj.yAxis.getDataType(),null==this.__errObj.yAxisDataType||null==this.__errObj.seriesDataType.y||this.__errObj.yAxisDataType===this.__errObj.seriesDataType.y||(console.error(`Invalid series! Y data types are different! ${e.DataType[this.__errObj.yAxisDataType]} != ${e.DataType[this.__errObj.seriesDataType.y]}`,this.__errObj),!1)):(console.error(`Invalid series! YAxis with id ${this.__errObj.yAxisIndex} does not exist!`,this.__errObj),!1)}getSeriesIndex(){return this.__parent.getSeries().findIndex((e=>e.getId()===this.__id))}getId(){return this.__id}getMaxData(){return this.__maxData}getMinData(){return this.__minData}addData(e){if(!(e instanceof Array||a.isSeriesLineData(e)))return this.logger.invalidAttribute("Data",e),this;if(null!=e&&e instanceof Array)for(let t=0;t<e.length;t++)if(!a.isSeriesLineData(e[t]))return this.logger.invalidAttribute("Data",e[t]),this;if(this.__data){let t=JSON.parse(JSON.stringify(this.__data));t.forEach((e=>{"string"==typeof e.x&&(e.x=new Date(e.x))})),e instanceof Array?t=t.concat(e):t.push(e),this.__validateData(t)&&this.setData(t)}else this.setData(e);return this}hide(){this.__isHided||(this.__isHided=!0,this.echartsOption.data=[],this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}show(){this.__isHided&&(this.__isHided=!1,this.__processData())}getIsHided(){return this.__isHided}setName(e){return null!=e&&"string"!=typeof e?(this.logger.invalidAttribute("Name",e),this):tchmi_equal(this.__name,e)?(this.logger.equalAttribute("Name"),this):(null==e&&(e=void 0),this.__name=e,this.__processName(),this)}__processName(){this.echartsOption.name=this.__name,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getName(){return this.__name}setData(e){if(!(null==e||e instanceof Array||a.isSeriesLineData(e)))return this.logger.invalidAttribute("Data",e),this;if(null!=e&&e instanceof Array)for(let t=0;t<e.length;t++)if(!a.isSeriesLineData(e[t]))return this.logger.invalidAttribute("Data",e[t]),this;return tchmi_equal(this.__data,e)?(this.logger.equalAttribute("Data"),this):(null==e&&(e=void 0),e instanceof Array||void 0===e?this.__data=e:(this.__data=[],this.__data.push(e)),this.__processData(),this)}__processData(){if(this.__data&&this.__data.length>0){let t=null!=this.__dataType.x?this.__dataType.x:void 0,a=null!=this.__dataType.y?this.__dataType.y:void 0,n=[];this.__maxData={x:null,y:null},this.__minData={x:null,y:null};for(let i=0;i<this.__data.length;i++){let s={},r=this.__data[i].x;if(null!=r){if(void 0===t&&(t=this.__detectXAxisDataType(r)),this.__detectXAxisDataType(r)!==t&&null!=this.__data[i].x)return void console.error("Data types of all x values of a series must be equal!");r instanceof Date&&((null==this.__maxData.x||this.__maxData.x<r)&&(this.__maxData.x=r),(null==this.__minData.x||this.__minData.x>r)&&(this.__minData.x=r),r=r.toISOString())}let o=this.__data[i].y;if(null!=o){if(void 0===a&&(a=this.__detectYAxisDataType(o,!0)),this.__detectYAxisDataType(o,!0)!==a)return void console.error("Data types of all y values of a series must be equal!");(null==this.__maxData.y||this.__maxData.y<o)&&(this.__maxData.y=o),(null==this.__minData.y||this.__minData.y>o)&&(this.__minData.y=o),a===e.DataType.boolean&&(o=o?1:0)}let l=this.__data[i].options;l&&(s.symbol=l.symbol,s.symbolSize=l.symbolSize,s.symbolRotate=l.symbolRotate,s.itemStyle||(s.itemStyle={}),s.itemStyle.color=l.symbolColor?.toString(),s.name=l.name,s.label||(s.label={}),s.label.show=l.label?.show,s.label.formatter="{b}"),s.value=[r,o],n.push(s)}if(void 0!==t&&void 0!==this.__xAxisIndex&&!this.__validateAxis(this.__parent.getXAxes()[this.__xAxisIndex],t))return;if(this.__isHided||(this.echartsOption.data=n),this.__dataType.x=t,this.__dataType.y=a,void 0!==a&&void 0!==this.__yAxisIndex&&!this.__validateAxis(this.__parent.getYAxes()[this.__yAxisIndex],a))return}else this.echartsOption.data=[];switch(this.__dataType.y){case e.DataType.boolean:case e.DataType.enum:this.echartsOption.step="start";break;default:delete this.echartsOption.step}this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getData(){return this.__data}setYAxis(e){return void 0!==e&&(null==e||e instanceof t.YAxis)?(null!=this.__yAxis&&this.__yAxis.removeLinkedSeries(this),this.__yAxis=e,this.__yAxis?.addLinkedSeries(this),this.__yAxis?this.__yAxisIndex=this.__yAxis.getAxisIndex():this.__yAxisIndex=0,this.__processYAxis(),this):(this.logger.invalidAttribute("YAxis",e),this)}__processYAxis(){if(this.echartsOption.yAxisIndex=this.__yAxisIndex,null!=this.__yAxisIndex&&this.__dataType.y){let e=this.__parent.getYAxes()[this.__yAxisIndex];this.__validateAxis(e,this.__dataType.y),this.echartsOption.tooltip||(this.echartsOption.tooltip={}),this.echartsOption.tooltip.formatter=e.getFormatter()}this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getYAxis(){return this.__yAxis}getYAxisIndex(){return this.__yAxisIndex}setXAxis(e){return void 0!==e&&(null==e||e instanceof t.XAxis)?(null!=this.__xAxis&&this.__xAxis.removeLinkedSeries(this),this.__xAxis=e,this.__xAxis?.addLinkedSeries(this),this.__xAxis?this.__xAxisIndex=this.__xAxis.getAxisIndex():this.__xAxisIndex=0,this.__processXAxis(),this):(this.logger.invalidAttribute("XAxis",e),this)}__processXAxis(){if(this.echartsOption.xAxisIndex=this.__xAxisIndex,null!=this.__xAxisIndex&&this.__dataType.x){let e=this.__parent.getXAxes()[this.__xAxisIndex];this.__validateAxis(e,this.__dataType.x)}this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getXAxis(){return this.__xAxis}getXAxisIndex(){return this.__xAxisIndex}setDataType(e){return null!=this.__dataType.x&&null!=this.__dataType.y&&console.error(`DataType of series ${this.__id} has already been set!`),this.__dataType=e,this}getDataType(){return this.__dataType}setColor(t){return null==t||t instanceof e.Color.RGBAColor?tchmi_equal(this.__color,t)?(this.logger.equalAttribute("Color"),this):(null==t&&(t=void 0),this.__color=t,this.__processColor(),this):(this.logger.invalidAttribute("Color",t),this)}__processColor(){this.echartsOption.lineStyle||(this.echartsOption.lineStyle={}),this.echartsOption.lineStyle.color=this.__color?.toString(),this.echartsOption.itemStyle||(this.echartsOption.itemStyle={}),this.echartsOption.itemStyle.color=this.__color?.toString(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getColor(){return this.__color}setBaObject(t){return null==t||t instanceof e.BA.BaBasicObject?tchmi_equal(this.__color,t)?(this.logger.equalAttribute("BaObject"),this):t?.getIsValid()?(this.__baObject=t,this.__processBaObject(),this):this:(this.logger.invalidAttribute("BaObject",t),this)}__processBaObject(){}getBaObject(){return this.__baObject}}t.SeriesLine=a,function(t){t.isSeriesLineData=function(t){let a=!0;if(null!=t&&"object"==typeof t){let n=new Map;n.set("x",["number",()=>t.x instanceof Date]),n.set("y",["number","boolean",null]),e.TypeGuards.validateProperties(t,n)||(a=!1)}else a=!1;return a}}(a=t.SeriesLine||(t.SeriesLine={}))}(e.Charting||(e.Charting={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class n extends t.Components.Base{constructor(a,n){super(a,n),this.__showDataZoom=!1,this.__showXAxisHandle=!1,this.__echartsContainer=$("<div>").addClass("echarts-container"),this.__xAxes=[],this.__yAxes=[],this.__series=[],this.__usedColors={text:t.Color.RGBAColor.TcHmiBlue,handles:t.Color.RGBAColor.TcHmiBlue,lines:t.Color.RGBAColor.TcHmiBlue},this.__themeDataChangedHandler=()=>{switch(e.Theme.get()){case"Base":this.__usedColors={text:t.Color.RGBAColor.TcHmiBlue,handles:t.Color.RGBAColor.TcHmiBlue,lines:t.Color.RGBAColor.TcHmiBlue};break;case"Base-Dark":this.__usedColors={text:new t.Color.RGBAColor({r:255,g:255,b:255,a:1}),handles:new t.Color.RGBAColor({r:50,g:50,b:50,a:1}),lines:new t.Color.RGBAColor({r:255,g:255,b:255,a:1})}}this.__updateColors()},this.__autoDrawEnabled=!0,this.__minSpaceGrid=35,this.__spaceDataZoomSliderX={bottom:60,side:85},this.__spaceXAxisHandle=30,this.__element.addClass("chart"),this.__themeDataChangeDF=e.EventProvider.register(t.TcHmiEvents.onThemeDataChanged,this.__themeDataChangedHandler),this.__themeDataChangedHandler(),this.__element.append(this.__echartsContainer),this.__echart=echarts.init(this.__echartsContainer[0]),this.__echart.setOption({});let i=this.__echart.getOption();i.toolbox={orient:"horizontal",left:"right",top:"top",itemSize:25,itemGap:10,feature:{restore:{title:" ",show:!1},saveAsImage:{title:" ",show:!1}}},i.tooltip={trigger:"item",axisPointer:{type:"cross",snap:!0}},i.grid={top:20,right:this.__minSpaceGrid,bottom:this.__minSpaceGrid,left:this.__minSpaceGrid},this.__echart.setOption(i),this.resizeHandler=new t.Components.ResizeHandler(this,this.__echartsContainer),TCHMI_DESIGNER||this.__validateAddedSeries()}__attach(){this.__isAttached||(super.__attach(),this.onResized(),this.__destroyersToCallOnDetach.push(this.eventHandler.register(n.ChartEvents.onOptionsChanged,(()=>{this.__collectChangesTimeoutId||(this.__collectChangesTimeoutId=setTimeout((()=>{clearTimeout(this.__collectChangesTimeoutId),delete this.__collectChangesTimeoutId,this.__updateEchartsOption()}),50))}))),this.eventHandler.raise(n.ChartEvents.onOptionsChanged))}__detach(){super.__detach()}destroy(){this.__themeDataChangeDF&&this.__themeDataChangeDF(),this.resizeHandler.destroy(),super.destroy()}onResized(){this.__echart.resize({width:this.__echartsContainer.width(),height:this.__echartsContainer.height()})}__onSeriesAdded(e){}__onSeriesRemoved(e){}__updateEchartsOption(){if(!this.__autoDrawEnabled)return;if(this.busyHandler.getIsBusy())return;if(this.__xAxes.length<=0||this.__yAxes.length<=0)return;let e=this.__echart.getOption();if(e.textStyle||(e.textStyle={}),e.textStyle.color=this.__usedColors.text.toString(),e.axisPointer instanceof Array){let t=e.axisPointer[0];t||(t={}),t.handle||(t.handle={}),t.handle.color=this.__usedColors.handles.toString(),e.axisPointer[0]=t}else this.logger.warn("Check axisPointer in echart options. Should be an array");e.xAxis=[];for(let t of this.__xAxes.values())t.updateEchartsOption(),e.xAxis.push(t.echartsOption);e.yAxis=[];for(let t of this.__yAxes.values())t.updateEchartsOption(),e.yAxis.push(t.echartsOption);e.series=[];for(let t of this.__series.values())t.verify()&&(t.updateEchartsOption(),e.series.push(t.echartsOption));e.dataZoom||(e.dataZoom=[]);let t=[];for(let e=0;e<this.__xAxes.length;e++)t.push(e);e.dataZoom[0]={type:"slider",xAxisIndex:t,bottom:25,show:this.__showDataZoom,handleSize:"80%",handleIcon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleStyle:{color:this.__usedColors.handles.toString(),shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2},moveHandleSize:20,moveHandleStyle:{color:this.__usedColors.lines.toString()},textStyle:{color:this.__usedColors.text.toString()},labelFormatter:this.__xAxes[0]?.getFormatter(),start:e.dataZoom[0]?e.dataZoom[0].start:void 0,end:e.dataZoom[0]?e.dataZoom[0].end:void 0},e.dataZoom[1]={type:"inside",xAxisIndex:t,start:e.dataZoom[1]?e.dataZoom[1].start:void 0,end:e.dataZoom[1]?e.dataZoom[1].end:void 0},this.__echart.setOption(e,!0)}__setGrid(e,t){let a=this.__echart.getOption();if(a.grid instanceof Array){a.grid[t]||(a.grid[t]={});for(let n in e)null!=e[n]&&(a.grid[t][n]=e[n])}this.__echart.setOption(a)}__updateColors(){for(let e of this.__xAxes.values())e.updateColors();for(let e of this.__yAxes.values())e.updateColors();this.eventHandler.raise(n.ChartEvents.onOptionsChanged)}__validateAddedSeries(){this.__isAttached&&(this.__series.length>0?this.errorIndicator.reset():this.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.error))}addYAxis(e){if(e){for(let t=0;t<this.__yAxes.length;t++)if(e&&this.__yAxes[t].getId()===e)return void this.logger.error(`A YAxis with id ${e} was already added to chart ${this.__id}!`)}else{let t=0;for(e=this.__id+"-y-axis-"+t;this.__yAxes.findIndex((t=>t.getId()===e))>-1;)t++,e=this.__id+"-y-axis-"+t}let t=new a.YAxis(e,this);return this.__yAxes.push(t),setTimeout((()=>{this.__processShowDataZoom()}),100),this.updateGrid(),t}removeYAxis(e){let t;if(e instanceof a.YAxis?(t=e,e=e.getId()):t=this.getYAxis(e),!t)return this.logger.warn(`Removing YAxis with id ${e} failed, because YAxis was not found in YAxis collection of chart ${this.__id}!`),!1;let n=[];for(let e=0;e<this.__series.length;e++){let a=this.__series[e];if(a.getYAxisIndex()===t?.getAxisIndex())return this.logger.warn("Cannot remove y axis because it is used by a data series!",{usingSeries:a,yAxis:t}),!1;a.getYAxisIndex()>t.getAxisIndex()&&n.push(a)}this.__yAxes=this.__yAxes.filter((a=>a.getId()!==e||(t.destroy(),!1)));for(let e=0;e<n.length;e++){let a=n[e],i=a.getYAxisIndex()-1;i<0?this.logger.warn("Invalid axis was set",{newYAxisIndex:i,series:a,removedYAxis:t}):a.setYAxis(this.__yAxes[i])}return this.updateGrid(),!0}addXAxis(e){e||(e=this.__id+"-x-axis-"+this.__xAxes.length);for(let t=0;t<this.__xAxes.length;t++)if(this.__xAxes[t].getId()===e)return void this.logger.error(`A XAxis with id ${e} was already added to chart ${this.__id}!`);let t=new a.XAxis(e,this);return this.__xAxes.push(t),this.updateGrid(),t}removeXAxis(e){let t;e instanceof a.XAxis?(t=e,e=e.getId()):t=this.getXAxis(e);let i=this.__xAxes.length;return this.__xAxes=this.__xAxes.filter((a=>a.getId()!==e||(t.destroy(),!1))),this.eventHandler.raise(n.ChartEvents.onOptionsChanged),i!==this.__xAxes.length||(this.logger.warn(`Removing XAxis with id ${e} failed, because XAxis was not found in XAxis collection of chart ${this.__id}!`),!1)}getSeriesLine(e){let t;return t=e instanceof a.SeriesLine?e:this.__series.find((t=>t.getId()===e)),t}addSeriesLine(e,t){if(e||(e=this.__id+"-series-"+this.__series.length),null!=this.getSeriesLine(e))return void this.logger.warn(`A SeriesLine with id ${e} was already added to chart ${this.__id}!`);let n=new a.SeriesLine(e,this,t);return this.__series.push(n),this.__validateAddedSeries(),this.__onSeriesAdded(n),n}removeSeriesLine(e){const t=this.getSeriesLine(e);return t?(this.__series=this.__series.filter((e=>e.getId()!==t?.getId())),this.eventHandler.raise(n.ChartEvents.onOptionsChanged),this.__validateAddedSeries(),this.__onSeriesRemoved(t),!0):(this.logger.warn(`Removing series with id ${e} failed, because series was not found in series collection of chart ${this.__id}!`),!1)}removeAllSeriesLine(){this.__series.forEach((e=>this.removeSeriesLine(e)))}enableAutoDraw(e=!0){this.__autoDrawEnabled=e,this.eventHandler.raise(n.ChartEvents.onOptionsChanged)}updateGrid(){let e=0,t=0,a=0,i={};for(let n of this.__yAxes.values())if(0!==n.echartsOption.gridIndex)n.echartsOption.offset=0;else if(!n.getIsHided()){let i=n.echartsOption.position;if(e="left"===i?t:a,n.echartsOption.offset=e,"right"===i)a+=n.getRequiredSpace();else t+=n.getRequiredSpace()}i.left=t>0?t:this.__minSpaceGrid,i.right=a>0?a:this.__minSpaceGrid,i.bottom=this.__minSpaceGrid,this.__showDataZoom&&(i.bottom=i.bottom+this.__spaceDataZoomSliderX.bottom,i.left<this.__spaceDataZoomSliderX.side&&(i.left=this.__spaceDataZoomSliderX.side),i.right<this.__spaceDataZoomSliderX.side&&(i.right=this.__spaceDataZoomSliderX.side)),this.__showXAxisHandle&&(i.bottom=i.bottom+this.__spaceXAxisHandle),this.__setGrid(i,0),this.eventHandler.raise(n.ChartEvents.onOptionsChanged)}getEchart(){return this.__echart}setEchartOption(e){return this.__echart.setOption(e),this}getEchartOption(){return this.__echart.getOption()}getYAxes(){return this.__yAxes}getYAxis(e){return this.__yAxes.find((t=>t.getId()===e))}getXAxes(){return this.__xAxes}getXAxis(e){return this.__xAxes.find((t=>t.getId()===e))}getSeries(){return this.__series}getSpecificSeries(e){for(let t=0;t<this.__series.length;t++)if(this.__series[t].getId()===e)return this.__series[t]}restore(){this.__echart.dispatchAction({type:"restore"})}getUsedColors(){return this.__usedColors}setShowDataZoom(e){return void 0===e||null!=e&&"boolean"!=typeof e?(this.logger.invalidAttribute("ShowDataZoom",e),this):tchmi_equal(this.__showDataZoom,e)?(this.logger.equalAttribute("ShowDataZoom"),this):(null==e&&(e=!1),this.__showDataZoom=e,this.__yAxes.length>0&&this.__processShowDataZoom(),this)}__processShowDataZoom(){this.updateGrid(),this.eventHandler.raise(n.ChartEvents.onOptionsChanged)}getShowDataZoom(){return this.__showDataZoom}setShowXAxisHandle(e){return void 0===e||null!=e&&"boolean"!=typeof e?(this.logger.invalidAttribute("ShowXAxisHandle",e),this):tchmi_equal(this.__showXAxisHandle,e)?(this.logger.equalAttribute("ShowXAxisHandle"),this):(null==e&&(e=!1),this.__showXAxisHandle=e,this.__processShowXAxisHandle(),this)}__processShowXAxisHandle(){this.__xAxes[0]?.setShowAxisHandle(this.__showXAxisHandle),this.updateGrid()}getShowXAxisHandle(){return this.__showXAxisHandle}}a.Chart=n,function(e){let t;!function(e){e.onOptionsChanged="onOptionsChanged"}(t=e.ChartEvents||(e.ChartEvents={}))}(n=a.Chart||(a.Chart={}))}(t.Charting||(t.Charting={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Chart{constructor(t,a){super(t,a),this.__showHandleButtonChangedHandler=e=>{this.setShowXAxisHandle(e),this.__contextMenu.close()},this.__showDataZoomButtonChangedHandler=e=>{this.setShowDataZoom(e),this.__contextMenu.close()},this.__restoreButtonPressedHandler=()=>{this.restore(),this.__contextMenu.close()},this.__element.addClass("line-chart"),this.addXAxis(this.__id+"-x-axis-0"),this.addYAxis(this.__id+"-y-axis-0");let n=[{name:"x-axis-handle",controls:{type:e.Components.ComponentType.Checkbox,callback:this.__showHandleButtonChangedHandler,name:"checkbox",settings:{textAttributes:{horizontalAlignment:"Center"},readOnly:!1}}},{name:"x-axis-data-zoom",controls:{type:e.Components.ComponentType.Checkbox,callback:this.__showDataZoomButtonChangedHandler,name:"checkbox",settings:{textAttributes:{horizontalAlignment:"Center"},readOnly:!1}}},{onPressed:this.__restoreButtonPressedHandler,cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Restore,(a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)})))}}],i=e.Components.ContextMenu.createContextMenuAndButton({id:this.__id,parent:this,rowEntryOptions:n});this.__contextMenu=i.menu,this.__menuButton=i.button,this.__menuButton.getElement().addClass("line-chart-menu-button"),this.__element.append(this.__menuButton.getElement()),this.__contextMenu.getElement().addClass("line-chart-context-menu"),this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Cursor,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)&&(this.__contextMenu.getRowEntry("x-axis-handle")?.controlContainer.getControl("checkbox")?.setActiveText(t.text),this.__contextMenu.getRowEntry("x-axis-handle")?.controlContainer.getControl("checkbox")?.setInactiveText(t.text))}))),this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.DataZoom,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)&&(this.__contextMenu.getRowEntry("x-axis-data-zoom")?.controlContainer.getControl("checkbox")?.setActiveText(t.text),this.__contextMenu.getRowEntry("x-axis-data-zoom")?.controlContainer.getControl("checkbox")?.setInactiveText(t.text))}))),this.setShowDataZoom(!0)}__attach(){this.__isAttached||super.__attach()}__detach(){super.__detach()}destroy(){super.destroy(),this.__contextMenu.destroy()}__updateColors(){for(let e of this.__xAxes.values())e.echartsOption.splitLine?.lineStyle?.color&&(e.echartsOption.splitLine.lineStyle.color=this.__usedColors.lines.toString());for(let e of this.__yAxes.values())e.echartsOption.splitLine?.lineStyle?.color&&(e.echartsOption.splitLine.lineStyle.color=this.__usedColors.lines.toString());super.__updateColors()}addYAxis(e){let a=super.addYAxis(e);if(a)return a.echartsOption.splitLine={lineStyle:{color:this.__usedColors.lines.toString(),type:"dotted"}},this.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged),a}addXAxis(e){let a=super.addXAxis(e);if(a)return a.echartsOption.splitLine={lineStyle:{color:this.__usedColors.lines.toString(),type:"dotted"}},this.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged),a}removeAllSeriesLine(){super.removeAllSeriesLine(),this.__xAxes.forEach((e=>this.removeXAxis(e))),this.__yAxes.forEach((e=>this.removeYAxis(e))),this.addXAxis(this.__id+"-x-axis-0"),this.addYAxis(this.__id+"-y-axis-0")}updateGrid(){super.updateGrid();let e=!1;for(let t=0;t<this.__yAxes.length;t++)"right"===this.__yAxes[t].echartsOption.position&&(e=!0);e?this.__element.addClass("has-right-axis"):this.__element.removeClass("has-right-axis"),this.onResized()}getMaxData(){let e,t,a={x:null,y:null};return this.__series.forEach((n=>{e=n.getMaxData().x,(null==a.x||null!=e&&a.x<e)&&(a.x=e),t=n.getMaxData().y,(null==a.y||null!=t&&a.y<t)&&(a.y=t)})),a}getMinData(){let e,t,a={x:null,y:null};return this.__series.forEach((n=>{e=n.getMinData().x,(null==a.x||null!=e&&a.x>e)&&(a.x=e),t=n.getMinData().y,(null==a.y||null!=t&&a.y>t)&&(a.y=t)})),a}getMenuButton(){return this.__menuButton}getContextMenu(){return this.__contextMenu}__processShowDataZoom(){super.__processShowDataZoom();let e=this.__contextMenu.getRowEntry("x-axis-data-zoom")?.controlContainer.getControl("checkbox");e?.setState(this.__showDataZoom)}__processShowXAxisHandle(){super.__processShowXAxisHandle();let e=this.__contextMenu.getRowEntry("x-axis-handle")?.controlContainer.getControl("checkbox");e?.setState(this.__showXAxisHandle)}}t.LineChart=a}(e.Charting||(e.Charting={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){let a;!function(a){class n extends a.LineChart{constructor(e,a){super(e,a),this.__seriesSelectorsContainer=$("<div>").addClass("series-selectors-container"),this.__seriesSelectors=new t.Navigation.ControlList(this.__id+"-series-selectors",this),this.__openSeriesSelectorsTB=new t.Components.ToggleButton(this.__id+"-open-series-selector-button",this),this.__settings={},this.__binaryGridHeight=30,this.__openSeriesSelectorTBChangedHandler=()=>{this.__openSeriesSelectorsTB.getToggleState()?(this.__element.append(this.__seriesSelectorsContainer),this.__seriesSelectorsContainer.animate({width:"30%"},200),this.__contextMenu.close(),this.__openSeriesSelectorsTB.iconHandler.setIcon(t.Icons.Standard.Right.path,!0)):(this.__seriesSelectorsContainer.animate({width:0},200,(()=>{this.__seriesSelectorsContainer.detach()})),this.__openSeriesSelectorsTB.iconHandler.setIcon(t.Icons.Standard.Left.path,!0))},this.__updateButtonPressedHandler=()=>{if(this.baObjectHandler.baObject)if(this.baObjectHandler.baObject instanceof t.BA.BaView){this.baObjectHandler.baObject.getBaTrendObjects().forEach((e=>{this.__updateBaTrend(e,this.__autoUpdateBaTrend)}))}else this.__updateBaTrend(this.baObjectHandler.baObject,this.__autoUpdateBaTrend);else this.__series.forEach((e=>{let t=e.getBaObject();t&&this.__updateBaTrend(t,this.__autoUpdateBaTrend)}));this.__contextMenu.close()},this.__autoUpdateCbChangedHandler=async e=>{try{this.__autoUpdateBaTrend=e,this.__settings.autoUpdate=this.__autoUpdateBaTrend,await this.__saveSettingsAsync(),this.__updateButtonPressedHandler()}catch(e){t.BaseError.warn(e,this.logger)}},this.baObjectHandler=new t.BaObjectHandler(this),this.__element.addClass("trend");let n=$("<div>").addClass("content-container");n.append(this.__echartsContainer,this.__menuButton.getElement()),this.__element.append(n),this.__loadSettingsAsync(),this.__seriesSelectorsContainer.append(this.__seriesSelectors.getElement());let i={Title:"All series",controls:[{type:t.Components.ComponentType.Checkbox,name:"visibility-checkbox",settings:{state:!0,readOnly:!1,layout:{maxWidth:25}},callback:e=>{this.__onSeriesVisibilityChangedAsync(this.__id+"-select-all-series-selector",e)}}]};this.__seriesSelectors.addEntry(this.__id+"-select-all-series-selector",i),this.__openSeriesSelectorsTB.getElement().addClass("open-series-selectors-button"),this.__openSeriesSelectorsTB.iconHandler.setIcon(t.Icons.Standard.Left.path,!0),this.__xAxes[0].setDataType(t.DataType.dateTime);let s=this.__echart.getOption();s.axisPointer instanceof Array&&(s.axisPointer[0].link||(s.axisPointer[0].link=[]),s.axisPointer[0].link.push({xAxisIndex:"all"}),this.__echart.setOption(s)),this.__autoDrawEnabled=!1}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(this.__openSeriesSelectorsTB.eventHandler.register(t.Components.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__openSeriesSelectorTBChangedHandler)),super.__attach())}__detach(){super.__detach()}destroy(){if(super.destroy(),this.__openSeriesSelectorsTB.destroy(),this.__seriesSelectors.destroy(),this.__baTrendWatchIds)for(let[e,a]of this.__baTrendWatchIds){let n=t.BA.BaDevices?.get(e.deviceName)?.findBaObject(e.instancePath);n&&n.stopWatchBaVariable(a)}if(this.__baDescriptionWatchIds)for(let[e,t]of this.__baDescriptionWatchIds)null!=t.id&&t.object.stopWatchBaVariable(t.id);this.baObjectHandler.destroy()}__onSeriesAdded(e){if(super.__onSeriesAdded(e),!this.__seriesSelectors.getEntries().has(e.getId())){let a=e.getBaObject();if(a){let i={controls:[{type:t.Components.ComponentType.Button,name:"open-parameter-window-button",settings:{iconPath:t.Icons.Standard.NotFound.path,iconHeight:60,iconHeightUnit:"%",iconWidth:60,iconWidthUnit:"%",layout:{maxWidth:25}},callback:async()=>{try{const e=await(a?.tryReadBaVariable(t.BA.BaParameterId.eReferencedParam));if(this.__settings.displayedObjects===n.DisplayedObjects.trendObjects)e?.OwnerObject.openParameterDialog("Parameter");else e?.ReferenceObject.openParameterDialog("Parameter")}catch(e){t.BaseError.warn(e,this.logger)}}},{type:t.Components.ComponentType.Checkbox,name:"visibility-checkbox",settings:{state:!0,readOnly:!1,layout:{maxWidth:25}},callback:async a=>{try{await this.__onSeriesVisibilityChangedAsync(e.getId(),a)}catch(e){t.BaseError.warn(e,this.logger)}}}]};this.__seriesSelectors.addEntry(e.getId(),i).backgroundStyler.setColor(e.getColor())}else{let a={Title:e.getName(),controls:[{type:t.Components.ComponentType.Checkbox,name:"visibility-checkbox",settings:{state:!0,readOnly:!1,layout:{maxWidth:25}},callback:async a=>{try{await this.__onSeriesVisibilityChangedAsync(e.getId(),a)}catch(e){t.BaseError.warn(e,this.logger)}}}]};this.__seriesSelectors.addEntry(e.getId(),a).backgroundStyler.setColor(e.getColor())}}if(this.__series.length>1){this.__openSeriesSelectorsTB.getIsAttached()||this.__element.children(".content-container").append(this.__openSeriesSelectorsTB.getElement());for(let e=0;e<this.__series.length;e++)if(null!=this.__series[e].getBaObject()){this.__contextMenu.getRowEntry("select-displayed-object")||(this.__contextMenu.addRowEntry([{name:"select-displayed-object",controls:{type:t.Components.ComponentType.Combobox,name:"select-displayed-object-combobox",settings:{data:[{text:"Ref Object",value:n.DisplayedObjects.trendableObjects},{text:"Trend",value:n.DisplayedObjects.trendObjects}],readOnly:!1},callback:async e=>{try{await this.__selectDisplayedObjectAsync(e),this.__contextMenu.close()}catch(e){t.BaseError.warn(e,this.logger)}}}},{name:"select-displayed-description",controls:{type:t.Components.ComponentType.Combobox,name:"select-displayed-description-combobox",settings:{data:[{text:"InstDescription",value:t.BA.BaParameterId.eInstDescription},{text:"Description",value:t.BA.BaParameterId.eDescription},{text:"SymbolPath",value:t.BA.BaParameterId.eSymbolPath},{text:"ObjectName",value:t.BA.BaParameterId.eObjectName},{text:"InstObjectName",value:t.BA.BaParameterId.eInstObjectName}],readOnly:!1},callback:async e=>{try{await this.__selectDisplayedDescriptionAsync(e),this.__contextMenu.close()}catch(e){t.BaseError.warn(e,this.logger)}}}}]),this.__contextMenu.layoutHandler.setWidth(120)),this.__selectDisplayedObjectAsync(this.__settings.displayedObjects).catch((e=>t.BaseError.warn(e,this.logger)));break}this.__loadSettingsAsync()}else this.__openSeriesSelectorsTB.setToggleState(!1),this.__openSeriesSelectorTBChangedHandler(),this.__openSeriesSelectorsTB.getElement().detach()}__onSeriesRemoved(e){super.__onSeriesRemoved(e),this.__seriesSelectors.getEntries().has(e.getId())&&this.__seriesSelectors.removeEntry(e.getId())}async __onSeriesVisibilityChangedAsync(e,a){try{if(e===this.__id+"-select-all-series-selector"){let n;null==this.__settings.hiddenSeries&&(this.__settings.hiddenSeries=[]);for(let[i,s]of this.__seriesSelectors.getEntries())if(s instanceof t.Navigation.ControlList.ControlListEntry&&i!=e){if(n=this.getSeriesLine(i),s.controlContainer.getControl("visibility-checkbox")?.setState(a),!n)continue;this.__toggleSeriesVisibility(n,!0===a),!1===a&&this.__settings.hiddenSeries.push(n.getId())}await this.__saveSettingsAsync()}else{let t=this.getSeriesLine(e);t&&(this.__toggleSeriesVisibility(t,!0===a),null!=this.__settings&&(null==this.__settings.hiddenSeries&&(this.__settings.hiddenSeries=[]),!1===a?this.__settings.hiddenSeries.push(t.getId()):this.__settings.hiddenSeries=this.__settings.hiddenSeries.filter((e=>e!==t.getId())),await this.__saveSettingsAsync()))}}catch(e){throw new t.BaseError("Processing changed series visibility failed!",{cause:e})}}async __loadSettingsAsync(){try{let e=await t.Storage.UserData.loadTrendSettingsAsync(this.__id);if(null==e&&(e={},e.displayedObjects=t.Charting.Trend.DefaultDisplayedObjects,e.displayedDescription=t.Charting.Trend.DefaultDisplayedDescription),this.__settings=e,this.__contextMenu.getRowEntry("auto-update")?.controlContainer.getControl("auto-update-checkbox")?.setState(this.__settings?.autoUpdate),null!=this.__settings.hiddenSeries)for(const e of this.__series)this.__settings.hiddenSeries.find((t=>t===e.getId()))?this.__toggleSeriesVisibility(e,!1):this.__toggleSeriesVisibility(e,!0)}catch(e){throw new t.BaseError("Loading trend settings failed!",{cause:e})}}async __saveSettingsAsync(){try{if(null==this.__settings)throw new t.NullOrUndefinedVariableError("Settings");await t.Storage.UserData.saveTrendSettingsAsync(this.__id,this.__settings)}catch(e){throw new t.BaseError("Saving trend settings failed!",{cause:e})}}static __onlineTrendIntervalHandler(e){if(!n.__onlineTrends)return;let t,a=new Date;for(let[i,s]of n.__onlineTrends){let n=i.getContextMenu().getRowEntry("pause-entry")?.controlContainer.getControl("pause-entry-toggle-button");if(!n||!n.getToggleState())for(let n of s.keys()){if(t=i.getSpecificSeries(n.RefObject.Mapping),!t)continue;if(null==n.Value)return;let s={x:a,y:n.Value},r=t.getData();r&&r.length>e&&r.splice(0,1),t.addData(s)}}}static async __setBaTrendYAxisAsync(e,i,s){return new Promise(((r,o)=>{try{if(!i.getIsValid())throw new t.BaseError(i.isNotValidText);const l=i.Params.get(t.BA.BaParameterId.ePresentValue);if(null==l)throw new t.BaseError("BaObject does not cotain a PresentValue!");switch(i.DataType){case t.DataType.number:let d=i.tryGetBaVariable(t.BA.BaParameterId.eUnit);d||(d=i.tryGetBaVariable(t.BA.BaParameterId.eOutputUnit)),d&&e.baObjectHandler.watchBaVariable(d,(i=>{let o;if(void 0!==d){let r=t.Helper.convertUnitToString(i);if(null==e.getYAxes()[0].getLinkedSeries())o=e.getYAxes()[0];else for(let t of e.getYAxes().values())if(t.getUnit()===r){o=t;break}if(o||(o=e.addYAxis()),o.setDataType(s.getDataType().y),o.setUnit(r),"%"===r)o.setOptions({autoScale:1==o.getOptions()?.autoScale,min:0,max:100});else o.setOptions({autoScale:0!=o.getOptions()?.autoScale});s.setYAxis(o),s.setXAxis(e.getXAxes()[0]),s.getXAxis()?.resetToDefault(),e.busyHandler.getIsBusy()||n.__verifyBooleanAxis(e),e.eventHandler.raise(a.Chart.ChartEvents.onOptionsChanged)}r()}),!0);break;case t.DataType.boolean:let h=n.__setBinaryTrendAxes(e,s).yAxis;e.baObjectHandler.watchValueRange(l,(e=>{h?.setInactiveText(e?.get(0)),h?.setActiveText(e?.get(1)),r()}),!0);break;case t.DataType.enum:e.baObjectHandler.watchValueRange(l,(a=>{let i;if(void 0!==a){let o=t.Components.Combobox.toComboboxItemArray(a);if(null==e.getYAxes()[0].getLinkedSeries())i=e.getYAxes()[0];else for(let a of e.getYAxes().values())if(a.getDataType()===t.DataType.enum){i=a;break}if(i||(i=e.addYAxis()),i.setDataType(s.getDataType().y),i.echartsOption.axisLabel||(i.echartsOption.axisLabel={}),i.echartsOption.axisLabel.show=!1,i.echartsOption.splitLine||(i.echartsOption.splitLine={}),i.echartsOption.splitLine.show=!1,i.setStateTexts(o),null!=!i.echartsOption.min&&i.setOptions({autoScale:0!=i.getOptions()?.autoScale,min:0}),o){let e=i.getOptions()?.min,t=null;o.forEach((e=>{null==t?t=e.value:null!=e.value&&(t=Math.min(t,e.value))})),null!=t&&null!=e&&(t-=1,t!==e&&i.setOptions({min:t}))}if(null!=!i.echartsOption.max&&i.setOptions({autoScale:1==i.getOptions()?.autoScale,max:0}),o){let e=i.getOptions()?.max,t=null;o.forEach((e=>{null==t?t=e.value:null!=e.value&&(t=Math.max(t,e.value))})),null!=t&&null!=e&&(t+=1,t!==e&&i.setOptions({max:t}))}s.setYAxis(i),e.busyHandler.getIsBusy()||n.__verifyBooleanAxis(e),r()}}));break;default:e.logger.warn(`DataType ${t.DataType[i.DataType]} is not trendable!`,i),o()}}catch(e){o(new t.BaseError("Setting y-axis for BaTrend failed!",{cause:e}))}}))}static __verifyBooleanAxis(e){if(e.getSeries().length>0){let a;e.enableAutoDraw(!1);for(let i=0;i<e.getSeries().length;i++)a=e.getSeries()[i],a.getDataType().y===t.DataType.boolean&&0===a.getXAxisIndex()&&n.__setBinaryTrendAxes(e,a);e.enableAutoDraw()}}static __setBinaryTrendAxes(e,a){let n,i,s;0!=a.getYAxisIndex()&&(n=e.getYAxes()[a.getYAxisIndex()]);let r,o=e.addYAxis();if(null==o)throw new t.BaseError("Creating y-axis for binary trend failed!");a.setYAxis(o),null!=n&&(i=n.getActiveText(),s=n.getInactiveText(),e.removeYAxis(n)),o.setDataType(a.getDataType().y),null!=i&&o.setActiveText(i),null!=s&&o.setInactiveText(s),null==a.echartsOption.areaStyle&&(a.echartsOption.areaStyle={}),a.echartsOption.showSymbol=!0,r=e.getSeries().length>1?e.addXAxis():e.getXAxes()[0];let l=r?.getAxisIndex();return null!=r&&(null==r.echartsOption.axisTick&&(r.echartsOption.axisTick={}),r.echartsOption.axisTick.show=!1,null==r.echartsOption.axisLine&&(r.echartsOption.axisLine={}),r.echartsOption.axisLine.show=!0,null==r.echartsOption.splitLine&&(r.echartsOption.splitLine={}),r.echartsOption.splitLine.show=!1,e.getXAxes().length>1&&(null==r.echartsOption.axisLabel&&(r.echartsOption.axisLabel={}),r.echartsOption.axisLabel.show=!1,r.echartsOption.axisPointer.label.show=!1),r.echartsOption.gridIndex=l,a.setXAxis(r)),null!=o&&(o.setOptions({autoScale:1==o.getOptions()?.autoScale,min:0,max:1}),o.echartsOption.splitLine={show:!1},o.echartsOption.gridIndex=l),{xAxis:r,yAxis:o}}static async __addBaOnlineTrendDataSeriesAsync(e,i){try{if(!a.isYAxisDataType(i.DataType))throw new t.BaseError("Reference object has invalid data type!");let s={name:i.InstancePath,dataType:{y:i.DataType},color:t.Color.getPastelColor(e.getSeries().length)},r=e.addSeriesLine(i.Mapping,s);await n.__setBaTrendYAxisAsync(e,i,r);let o=i.tryGetBaVariable(t.BA.BaParameterId.ePresentValue);if(o){n.__onlineTrends||(n.__onlineTrends=new Map);let t=n.__onlineTrends.get(e);t||(t=new Map,n.__onlineTrends.set(e,t)),t.set(o,o.watch((e=>{})))}return r}catch(e){throw new t.BaseError("Adding BaOnline trend data series failed!",{cause:e})}}__updateBaTrend(e,a=!1){if(this.getSeriesLine(this.__id+"."+e.Mapping))if(a){this.__baTrendWatchIds||(this.__baTrendWatchIds=new Map);let a=e.tryWatchBaVariable(t.BA.BaParameterId.eLogBuffer,(t=>{t&&this.__processLogEntries(t,e)}));null!=a&&this.__baTrendWatchIds.set(e.IdentifierEx,a)}else if(e.tryReadBaVariable(t.BA.BaParameterId.eLogBuffer).then((t=>{t&&this.__processLogEntries(t,e)})).catch((e=>{t.BaseError.warn(e,this.logger)})),this.__baTrendWatchIds){let t=this.__baTrendWatchIds.get(e.IdentifierEx);t&&e.stopWatchBaVariable(t)}}__processLogEntries(e,a){let n=this.getSeriesLine(this.__id+"."+a.Mapping);if(n&&void 0!==e){let i,s,r=[],o=null;for(let a=0;a<e.length;a++){s={x:0,y:0},i=e[a];let l=null!=n.getDataType().y?n.getDataType().y:void 0;if(null==i.Value)if(null!=o)i.Value=o;else switch(l){case t.DataType.number:case t.DataType.enum:i.Value=0;break;case t.DataType.boolean:i.Value=!1}if(o=i.Value,s.y=i.Value,s.x=i.TimeStamp,r.push(s),i.Events)for(let e in i.Events)if(i.Events[e]){switch(s={x:0,y:0},s.y=i.Value,s.x=i.TimeStamp,s.options={},s.options.symbolSize=10,s.options.symbolOffset?s.options.symbolOffset=[0,s.options.symbolOffset[1]-15]:s.options.symbolOffset=[0,-10],e){case"Start":s.options.symbol="triangle",s.options.symbolRotate=-90,s.options.symbolColor=new t.Color.RGBAColor({r:0,g:255,b:0,a:1});break;case"Stop":s.options.symbol="rect",s.options.symbolRotate=0,s.options.symbolColor=new t.Color.RGBAColor({r:255,g:0,b:0,a:1});break;case"BufferPurged":s.options.symbol="pin",s.options.symbolRotate=0,s.options.symbolColor=new t.Color.RGBAColor({r:100,g:100,b:100,a:1});break;case"Interrupted":s.options.symbol="arrow",s.options.symbolRotate=0,s.options.symbolColor=new t.Color.RGBAColor({r:100,g:100,b:100,a:1})}r.push(s)}if(i.StatusFlags)for(let e in i.StatusFlags)if(i.StatusFlags[e]){switch(s={x:0,y:0},s.y=i.Value,s.x=i.TimeStamp,s.options={},s.options.symbolSize=10,s.options.symbolOffset?s.options.symbolOffset=[0,s.options.symbolOffset[1]-15]:s.options.symbolOffset=[0,-10],e){case"Fault":s.options.symbol="image://"+t.Icons.Events.Flag.Fault.path;break;case"InAlarm":s.options.symbol="image://"+t.Icons.Events.Flag.InAlarm.path;break;case"Overridden":s.options.symbol="image://"+t.Icons.Events.Flag.Overridden.path;break;case"OutOfService":s.options.symbol="image://"+t.Icons.Events.Flag.OutOfService.path}r.push(s)}}a.tryReadBaVariable(t.BA.BaParameterId.eDescription).then((e=>{n?.setName(e)})).catch((e=>{t.BaseError.warn(e,this.logger)})),n.setData(r),this.__xAxes.forEach((e=>{let t=this.getMinData().x;t instanceof Date&&(t=t.toISOString());let a=this.getMaxData().x;a instanceof Date&&(a=a.toISOString()),e.setOptions({autoScale:1==e.getOptions()?.autoScale,min:null==t?void 0:t,max:null==a?void 0:a})})),n.getId()===this.__series[this.__series.length-1].getId()&&this.enableAutoDraw()}}__toggleSeriesVisibility(e,a){let n=t.Helper.Map.findByKey(this.__seriesSelectors.getEntries(),(t=>t===e.getId()))?.value;n instanceof t.Navigation.ControlList.ControlListEntry&&n.controlContainer.getControl("visibility-checkbox")?.setState(a),a?(e.show(),e.getDataType().y===t.DataType.boolean?(this.__xAxes[e.getXAxisIndex()].show(),this.__yAxes[e.getYAxisIndex()].show()):this.__yAxes[e.getYAxisIndex()].show()):(e.hide(),e.getDataType().y===t.DataType.boolean?(this.__xAxes[e.getXAxisIndex()].hide(),this.__yAxes[e.getYAxisIndex()].hide()):function(e){let t=e.getLinkedSeries();if(t){let a,n=!0;for(let e=0;e<t.length;e++)if(a=t[e],!a.getIsHided()){n=!1;break}n?e.hide():e.show()}}(this.__yAxes[e.getYAxisIndex()])),this.updateGrid()}async __selectDisplayedObjectAsync(e){try{null!=e&&(this.__settings.displayedObjects=e),await this.__saveSettingsAsync();const a=this.__contextMenu.getRowEntry("select-displayed-object")?.controlContainer.getControl("select-displayed-object-combobox");if(null==a)throw new t.NullOrUndefinedVariableError("combobox");a.setSelectedValue(this.__settings.displayedObjects),await this.__selectDisplayedDescriptionAsync(this.__settings.displayedDescription)}catch(e){throw new t.BaseError("Selecting displayed object failed!",{cause:e})}}async __selectDisplayedDescriptionAsync(e){return new Promise((async(a,i)=>{try{null!=e&&(this.__settings.displayedDescription=e),await this.__saveSettingsAsync(),this.__contextMenu.getRowEntry("select-displayed-description")?.controlContainer.getControl("select-displayed-description-combobox")?.setSelectedValue(this.__settings.displayedDescription);let s=0;for(let r=0;r<this.__series.length;r++){let o=this.__seriesSelectors.getEntries().get(this.__series[r].getId());if(null==o)throw new t.NullOrUndefinedVariableError("entry");let l=this.__series[r].getBaObject();if(null==l)throw new t.NullOrUndefinedVariableError("baObj");s++,l.tryReadBaVariable(t.BA.BaParameterId.eReferencedParam).then((async d=>{s--;try{if(null==d)throw new t.BaseError(`No data returned for '${t.BA.BaParameterId[t.BA.BaParameterId.eReferencedParam]} of BaObject '${l?.InstancePath}''!`);let i;if(this.__settings.displayedObjects===n.DisplayedObjects.trendObjects)i=d.OwnerObject;else i=d.ReferenceObject;null==this.__baDescriptionWatchIds&&(this.__baDescriptionWatchIds=new Map);let h=this.__baDescriptionWatchIds.get(this.__series[r].getId());h&&null!=h.id&&h.object.stopWatchBaVariable(h.id),null!=e&&null==i.tryGetBaVariable(e)&&(e=t.Charting.Trend.DefaultDisplayedDescription,this.__settings.displayedDescription=e,await this.__saveSettingsAsync());let _=o.busyHandler.setBusy("Loading description");this.__baDescriptionWatchIds.set(this.__series[r].getId(),{object:i,id:i.tryWatchBaVariable(e,(e=>{e&&o.textHandler.setText(e),_()}))});const c=o.controlContainer.getControl("open-parameter-window-button");if(null==c)throw new t.NullOrUndefinedVariableError("paramWindowBtn");c.iconHandler.setIcon(i.getIconAttributes().iconPath,!0),0==s&&a()}catch(e){i(new t.BaseError("Processing eReferencedParam failed!",{cause:e}))}}))}}catch(e){i(new t.BaseError("Selecting displayed description failed!",{cause:e}))}}))}processBaObject(){if(this.baObjectHandler.baObject)if(this.baObjectHandler.baObject instanceof t.BA.BaView){let e=this.baObjectHandler.baObject.getBaTrendObjects();for(const t of e)t.loadAttributes().then((()=>{t.getIsValid()&&this.addBaTrend(t)}))}else this.baObjectHandler.baObject instanceof t.BA.BaBasicObject&&this.baObjectHandler.baObject.Identifier.ObjectType===t.BA.ObjectType.eTrend&&(this.baObjectHandler.baObject.loadAttributes().then((()=>{this.baObjectHandler.baObject?.getIsValid()&&(this.addBaTrend(this.baObjectHandler.baObject),this.__contextMenu.layoutHandler.setWidth(140))})),this.eventHandler.raise(a.Chart.ChartEvents.onOptionsChanged),this.__contextMenu.addRowEntry([{text:"Parameter",onPressed:()=>{this.baObjectHandler.baObject?.openParameterDialog("Parameter"),this.__contextMenu.close()}}]),this.__contextMenu.layoutHandler.setWidth(140))}addBaTrend(e){null==this.__contextMenu.getRowEntry("update-entry")&&(this.__contextMenu.addRowEntry([{text:"Update",name:"update-entry",onPressed:this.__updateButtonPressedHandler},{name:"auto-update",controls:{type:t.Components.ComponentType.Checkbox,name:"auto-update-checkbox",callback:this.__autoUpdateCbChangedHandler,settings:{textAttributes:{horizontalAlignment:"Center"},state:this.__settings?.autoUpdate,activeText:"Auto update",inactiveText:"Auto update",readOnly:!1}}}]),this.__contextMenu.layoutHandler.setWidth(110)),e.tryReadBaVariable(t.BA.BaParameterId.eReferencedParam).then((async i=>{try{if(null!=i){let s=this.addSeriesLine(this.__id+"."+e.Mapping,{color:t.Color.getPastelColor(this.__series.length),baObject:e});if(s){if(!i.ReferenceObject.getIsValid())throw new t.BaseError("Referred object is not valid. Please load attributes first!");if(t.Server.BaSite.PrimitveBaObjects.indexOf(i.ReferenceObject.Identifier.ObjectType)>-1){if(void 0===s.getDataType().y){if(!a.isYAxisDataType(i.ReferenceObject.DataType))throw new t.BaseError("Reference object has invalid data type!");s.setDataType({y:i.ReferenceObject.DataType})}await n.__setBaTrendYAxisAsync(this,i.ReferenceObject,s),await this.__loadSettingsAsync()}}this.__updateBaTrend(e,this.__settings?.autoUpdate)}else{let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.TrendWithNoReferencedObject),e.InstancePath);t.Components.DialogWindow.alert(a)}this.__validateAddedSeries()}catch(e){t.BaseError.warn(e,this.logger)}})).catch((e=>{t.BaseError.warn(e,this.logger)}))}removeBaTrend(e){return this.removeSeriesLine(this.__id+"."+e.Mapping)}containsBaTrend(e){return null!=this.getSeriesLine(this.__id+"."+e.Mapping)}updateGrid(){if(super.updateGrid(),this.__xAxes.length<2)return;let e=this.__echart.getOption().grid,t=this.__showDataZoom?this.__spaceDataZoomSliderX.bottom:20;if(e instanceof Array){for(let a=this.__xAxes.length-1;a>0;a--){e[a]||(e[a]={});let n=this.__xAxes.find((e=>e.echartsOption.gridIndex===a));n&&!n.echartsOption.show?e[a].height=0:(e[a].bottom=t,e[a].left=e[0].left,e[a].right=e[0].right,e[a].height=this.__binaryGridHeight,t+=this.__binaryGridHeight+10)}t=t-this.__binaryGridHeight+30,this.__showDataZoom?e[0].bottom=Number(e[0].bottom)+t-this.__spaceDataZoomSliderX.bottom:e[0].bottom=Number(e[0].bottom)+t;for(let t=0;t<e.length;t++)this.__setGrid(e[t],t)}}static async createBaOnlineTrendAsync(e,i,s){if(-1==t.Server.BaSite.PrimitveBaObjects.indexOf(e.Identifier.ObjectType)&&!(e instanceof t.BA.BaView&&e.getTrendableObjects().length>0))throw new t.BaseError("Can not create online trend for BaObject, because the ObjectType is not supported. If BaView was passed, no trendable objects where found inside of the BaView!");try{let r=t.Globals.CreatedBaseNodes.get(e.Mapping+"-online-trend");if(r)return r;i||(i=2e3),s||(s=100),r=new n(e.Mapping+"-online-trend",null),r.setShowDataZoom(!1);let o=[],l=[];if(e instanceof t.BA.BaView){if(l=e.getTrendableObjects(),l.length<=0)return r.logger.warn("No trends were found in BaView "+e.InstancePath),r}else l.push(e);o=[];for(let e=0;e<l.length;e++){let t=l[e];await t.loadAttributes(),t.getIsValid()&&o.push(await n.__addBaOnlineTrendDataSeriesAsync(r,t))}const d=[],h=new t.Logger({name:"CreateBaOnlineTrend"});return r.getContextMenu().addRowEntry([{onPressed:async()=>{const e=t.Locale.Localization.getText(t.Locale.LangKey.ConfirmResetLiveTrend);await t.Components.DialogWindow.confirm(e)&&o&&o.forEach((e=>e.setData(null))),r.__contextMenu.close()},cbOnCreated:e=>{d.push(t.Locale.Localization.watchText(t.Locale.LangKey.Reset,(a=>{h.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}},{name:"pause-entry",controls:{type:t.Components.ComponentType.ToggleButton,name:"pause-entry-toggle-button",cbOnCreated:e=>{d.push(t.Locale.Localization.watchText(t.Locale.LangKey.Pause,(a=>{h.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})))}}}]),r.getContextMenu().layoutHandler.setWidth(100),r?.enableAutoDraw(),r.eventHandler.raise(a.Chart.ChartEvents.onOptionsChanged),null==n.__onlineTrendIntervalId&&(n.__onlineTrendIntervalId=setInterval((()=>{n.__onlineTrendIntervalHandler(s)}),i)),r.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,((e,t)=>{e.destroy();let a=n.__onlineTrends?.get(t);if(a)for(let[e,t]of a)e.stopWatch(t);n.__onlineTrends?.delete(t),(!n.__onlineTrends||n.__onlineTrends.size<=0)&&n.__onlineTrendIntervalId&&(clearInterval(n.__onlineTrendIntervalId),delete n.__onlineTrends,delete n.__onlineTrendIntervalId),d.forEach((e=>e()))})),r}catch(e){throw new t.BaseError("Creating online trend failed!",{cause:e})}}}a.Trend=n,function(n){var i,s;let r;e.EventProvider.register(t.Server.BaSite.Events.onExtensionLoaded,(async e=>{try{e.destroy(),await o.initAsync(),await l.initAsync()}catch(e){t.BaseError.warn(e)}})),function(e){e[e.trendableObjects=0]="trendableObjects",e[e.trendObjects=1]="trendObjects"}(r=n.DisplayedObjects||(n.DisplayedObjects={})),n.DefaultDisplayedObjects=n.DisplayedObjects.trendableObjects,n.DefaultDisplayedDescription=t.BA.BaParameterId.eInstDescription;class o{static async initAsync(){try{this.collectionStorage=await t.Storage.UserData.loadTrendCollectionsAsync()}catch(e){throw new t.BaseError("Initializing of Trend.CollectionConfigurator failed!")}}static __getListConvertOptions(){return{editEntry:(e,a)=>{if("trendable-objects"===this.__displayedObjects&&!e.isTrendable())return;if("trend-objects"===this.__displayedObjects&&!(e instanceof t.BA.BaTrendObject))return;let n=!1;this.__currentOpt&&this.__currentOpt.collectionName&&this.collectionStorage&&null!=this.collectionStorage[this.__currentOpt.collectionName]&&null!=this.collectionStorage[this.__currentOpt.collectionName].baObjects.find((t=>t.instancePath===e.InstancePath&&t.deviceName===e.Device.Description))&&(n=!0,this.__selectedTrends.push({deviceName:e.Device.Description,instancePath:e.InstancePath})),a.controls=[{type:t.Components.ComponentType.Checkbox,name:"select-cb",settings:{readOnly:!1,state:n,layout:{maxWidth:25}},callback:async(a,n,i)=>{try{if(null==this.__selectedTrends)throw new t.NullOrUndefinedVariableError("__selectedTrends");if(!(e instanceof t.BA.BaObject))throw new t.InvalidTypeError("BaObject",{actualType:e.constructor.name,requiredType:t.BA.BaObject.constructor.name});if(a&&this.__selectedTrends.length>=this.__currentOpt.maxSelection&&(await t.Components.DialogWindow.alert(`It is not possible to add more objects / trends to trend collection!\nMaxmium amount of trends in a collection is ${this.__currentOpt.maxSelection}!`),i?.setState(!a)),e instanceof t.BA.BaTrendObject){const n=await e.tryReadBaVariable(t.BA.BaParameterId.eReferencedParam);if(!this.__selectedTrends)throw new t.NullOrUndefinedVariableError("__selectedTrends");null!=n?a?this.__selectedTrends.push({deviceName:n.ReferenceObject.Device.Description,instancePath:n.ReferenceObject.InstancePath}):null!=this.__selectedTrends.find((e=>e.instancePath===n.ReferenceObject.InstancePath&&e.deviceName===n.ReferenceObject.Device.Description))&&(this.__selectedTrends=this.__selectedTrends.filter((e=>e.instancePath!==n.ReferenceObject.InstancePath||e.deviceName!==n.ReferenceObject.Device.Description))):(await t.Components.DialogWindow.alert(`Trend object '${e.InstancePath}' has no reference object! Assign an trendable object first!`),i?.setState(!a))}else if(e.isTrendable()){const n=await e.getReferringObjectsAsync();if(!this.__selectedTrends)throw new t.NullOrUndefinedVariableError("__selectedTrends");if(a){if(null==this.__selectedTrends.find((t=>t.instancePath===e.InstancePath&&t.deviceName===e.Device.Description))){if(null!=n&&n.length<=0){if(!await t.Components.DialogWindow.confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmAssignToTrend)))return void i?.setState(!a);{let a=i.busyHandler.setBusy("Assiging to unused trend");try{await t.Server.BaSite.assignBaObjectToUnusedTrendAsync(e)}catch(e){throw e}finally{a()}}}this.__selectedTrends.push({deviceName:e.Device.Description,instancePath:e.InstancePath})}}else null!=this.__selectedTrends.find((t=>t.instancePath===e.InstancePath&&t.deviceName===e.Device.Description))&&(this.__selectedTrends=this.__selectedTrends.filter((t=>t.instancePath!==e.InstancePath||t.deviceName!==e.Device.Description)))}}catch(e){t.BaseError.warn(e)}}}]},filter:e=>"trendable-objects"===this.__displayedObjects?e.isTrendable():e instanceof t.BA.BaTrendObject}}static async __setListDataAsync(){this.__selectedTrends=[];try{if(this.__currentOpt&&this.__currentOpt.baView&&this.__configuratorDialog){this.__currentRoot={deviceName:this.__currentOpt.baView.Device.Description,instancePath:this.__currentOpt.baView.InstancePath};let e=this.__configuratorDialog.busyHandler.setBusy("Loading BaView");try{await this.__currentOpt.baView.loadAttributes(!0,!0),this.__list?.setData(this.__currentOpt.baView.toControlListData(this.__getListConvertOptions()))}catch(e){throw this.__configuratorDialog?.close(),new t.BaseError("Loading BaView for TrendCollectionConfigurator failed!",{cause:e})}finally{e()}}else{if(!this.__currentOpt||!this.__currentOpt.collectionName||null==this.collectionStorage)throw"Not_specified";try{let e=this.collectionStorage[this.__currentOpt.collectionName];if(!(e.root&&t.BA.BaDevices&&t.BA.BaDevices.size>0))throw"Not_specified";{let a=t.BA.BaDevices.get(e.root.deviceName)?.findBaObject(e.root.instancePath);if(!(a&&a instanceof t.BA.BaView))throw"Not_specified";this.__currentOpt.baView=a,await this.__setListDataAsync()}}catch(e){throw"Not_specified"}}}catch(e){if("Not_specified"===e){if(t.BA.BaDevices&&t.BA.BaDevices.size>0){let e={Children:new Map},a=0,n=this.__configuratorDialog.busyHandler.setBusy("Loading ProjectStructure");for(let[i,s]of t.BA.BaDevices)a++,s.ProjectStructure.loadAttributes(!0,!0).then((()=>{a--,e.Children.set(i,s.ProjectStructure.toControlListData(this.__getListConvertOptions())),0===a&&(this.__list?.setData(e),n())}))}}else t.BaseError.warn(e,this.logger)}}static async __saveCollectionAsync(){try{if(null!=this.__currentOpt?.collectionName&&(this.__currentCollectionName=this.__currentOpt.collectionName),null==this.__currentCollectionName)return await t.Components.DialogWindow.alert(t.Locale.Localization.getText(t.Locale.LangKey.AlertNoCollectionName)),!1;if(null==this.__selectedTrends)throw new t.NullOrUndefinedVariableError("__selectedTrends");let e=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmSaveTrendCollection),this.__currentCollectionName);if(await t.Components.DialogWindow.confirm(e)){let e=null!=this.collectionStorage?this.collectionStorage[this.__currentCollectionName]:null;e||(e={baObjects:[]}),e.baObjects=this.__selectedTrends,this.__currentRoot&&(e.root=this.__currentRoot),await t.Storage.UserData.saveTrendCollectionAsync(this.__currentCollectionName,e),await this.initAsync(),this.__selectedTrends.forEach((e=>{let a=t.BA.BaDevices?.get(e.deviceName)?.findBaObject(e.instancePath);a instanceof t.BA.BaObject&&(a instanceof t.BA.BaTrendObject?a.loadAttributes():a.getReferringObjectsAsync().then((e=>{if(null!=e){let a=e[0].OwnerObject;a instanceof t.BA.BaTrendObject&&a.loadAttributes()}})).catch((e=>{t.BaseError.warn(e,this.logger)})))})),l.openAsync(this.__currentCollectionName)}return!0}catch(e){throw new t.BaseError("Saving collection failed!",{cause:e})}}static async openAsync(e){return this.__list?.setData(null),delete this.__currentCollectionName,delete this.__currentRoot,delete this.__currentOpt,delete this.__selectedTrends,this.__currentOpt=e,this.__currentOpt||(this.__currentOpt={}),null==e?.maxSelection&&(this.__currentOpt.maxSelection=this.MAX_SELECTION),new Promise((async(a,n)=>{try{if(!this.__grid){if(this.__grid=$("<div>").addClass("tchmi-ba-trend-configurator-grid"),this.__nameContainer=new t.Components.ControlContainer("tchmi-ba-trend-configurator-name-container"),this.__nameContainer.setControlsHorizonzalAlignment("Left"),this.__nameContainer.addControls([{type:t.Components.ComponentType.Textblock,settings:{textAttributes:{horizontalAlignment:"Right",fontSize:14,fontWeight:"Bold",decorationLine:"underline"}},cbOnCreated:e=>{e.getElement().css("max-width","fit-content"),t.Locale.Localization.watchText(t.Locale.LangKey.TrendCollectionName,(a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text+":")}))}},{type:t.Components.ComponentType.InputBox,name:"name-input",settings:{dataType:t.DataType.string,readOnly:null!=this.__currentOpt?.collectionName,textAttributes:{horizontalAlignment:"Left"},layout:{maxWidth:250}},callback:async e=>{if(e.indexOf("-tab")>-1||e.indexOf("-list")>-1)await t.Components.DialogWindow.alert(`Invalid collection name '${e}'!`);else if(null==this.collectionStorage||null==this.collectionStorage[e])this.__currentCollectionName=e;else{let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.AlertDuplicateCollectionName),e);await t.Components.DialogWindow.alert(a)}}}]),!this.__grid)throw new t.NullOrUndefinedVariableError("__grid");this.__grid.append(this.__nameContainer.getElement()),this.__list=new t.Navigation.ControlList("tchmi-ba-trend-configurator-list",null).setAttributes({cssClass:"tchmi-ba-trend-configurator-list"}),this.__grid.append(this.__list.getElement())}if(!this.__configuratorDialog){let e=t.Components.ContextMenu.createContextMenuAndButton({id:"tchmi-ba-trend-configurator-context-menu",rowEntryOptions:[{controls:{type:t.Components.ComponentType.Combobox,settings:{readOnly:!1,data:[{text:"Trendable objects",value:"trendable-objects"},{text:"Trend objects",value:"trend-objects"}]},callback:async a=>{try{this.__displayedObjects=a,await this.__setListDataAsync(),e.menu.close()}catch(e){t.BaseError.warn(e,this.logger)}}}}]});e.menu.layoutHandler.setMinWidth(130),this.__configuratorDialog=new t.Components.DialogWindow("tchmi-ba-trend-configurator-dialog",null).setAttributes({content:this.__grid,modal:!1,buttons:t.Components.DialogWindow.Buttons.OkCancel,layout:{maxWidth:o.DefaultConfiguratorDialogWidth},controls:e.button}),t.Locale.Localization.watchText(t.Locale.LangKey.NewTrendCollection,(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&this.__configuratorDialog?.setHeadlineText(e.text)}))}let i=this.__configuratorDialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onConfirmed,(async()=>{try{this.__configuratorDialog?.stopClosing(),await this.__saveCollectionAsync()&&(a(),this.__configuratorDialog?.close())}catch(e){n(e)}}));this.__configuratorDialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,(async e=>{e.destroy(),i()}));let s=this.__nameContainer?.getControl("name-input");s&&s.setValue(null!=this.__currentOpt?.collectionName?this.__currentOpt.collectionName:"Collection name...").setReadOnly(null!=this.__currentOpt?.collectionName),e?.modal?this.__configuratorDialog.setButtons(t.Components.DialogWindow.Buttons.OkCancel):this.__configuratorDialog.setButtons(t.Components.DialogWindow.Buttons.OkCancelSize),this.__configuratorDialog.open(e?.modal),await this.__setListDataAsync()}catch(e){n(new t.BaseError("Opening CollectionConfigurator failed!",{cause:e}))}}))}static async selectCollectionAsync(){return new Promise((async(e,a)=>{if(null==this.collectionStorage||Object.keys(this.collectionStorage).length<=0){let a=t.Locale.Localization.getText(t.Locale.LangKey.AlertNoCollectionsCreated);return await t.Components.DialogWindow.alert(a,{skipLog:!0}),e(null)}let n=new t.Navigation.ControlList("tchmi-ba-trend-collection-select-list",null).setAttributes({layout:{width:100,widthUnit:"%",height:100,heightUnit:"%"}}),i={Children:new Map};for(let a in this.collectionStorage)i.Children.set(a,{Title:a,controls:{type:t.Components.ComponentType.Button,settings:{iconPath:t.Icons.Standard.Right_Arrow.path},callback:()=>{s?.close(),e(a)}}});n.setData(i);const s=t.Components.DialogWindow.createDialogWindow({appearance:{modal:!0,content:n.getElement(),buttons:t.Components.DialogWindow.Buttons.Cancel,headline:{textAttributes:{text:"Select trend collection"}},layout:{maxWidth:o.DefaultTrendCollectionSelectionDialogWidth}},callbacks:{cbClosed:()=>{n.destroy(),s?.destroy()}},behaviour:{destroyOnClose:!0}})?.open()}))}static getCollections(){return this.collectionStorage}static getCollection(e){return null!=this.collectionStorage&&null!=this.collectionStorage[e]?this.collectionStorage[e]:null}static hasCollection(e){return null!=this.getCollection(e)}static async removeObjectFromCollectionAsync(e,a){try{let n=this.getCollection(e);if(n){let i=n.baObjects.length;if(n.baObjects=n.baObjects.filter((e=>e.instancePath!==a.instancePath||e.deviceName!==a.deviceName)),i!=n.baObjects.length){if(n.baObjects.length<=0){let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmDeleteOfTrendCollectionWithNoObjects),e);await t.Components.DialogWindow.confirm(a)&&await this.deleteCollectionAsync(e,!1)}else await t.Storage.UserData.saveTrendCollectionAsync(e,n);return await this.initAsync(),!0}}return!1}catch(e){throw new t.BaseError("Removing object from trend collection failed!",{cause:e})}}static async deleteCollectionAsync(e,a=!0){if(!this.hasCollection(e))throw new t.BaseError(`Collection '${e}' cannot be deleted, because it does not exist!`);if(a){let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmDeleteTrendCollection),e);if(!await t.Components.DialogWindow.confirm(a))return!1}return await t.Storage.UserData.deleteTrendCollectionAsync(e),await this.initAsync(),!0}}i=o,o.logger=new t.Logger({name:"CollectionView",className:i.constructor.name}),o.__displayedObjects="trendable-objects",o.MAX_SELECTION=10,n.CollectionConfigurator=o,function(e){e.DefaultConfiguratorDialogWidth=1e3,e.DefaultTrendCollectionSelectionDialogWidth=400}(o=n.CollectionConfigurator||(n.CollectionConfigurator={}));class l{static async initAsync(){try{this.__collectionSelection=await t.Storage.UserData.loadTrendCollectionSelectionAsync()}catch(e){throw new t.BaseError("Initializing of Trend.CollectionView failed!")}}static __getSelectedCollectionName(){if(!this.__tabWindow)throw new t.NullOrUndefinedVariableError("__tabWindow");let e=this.__tabWindow.getSelectedTab()?.getId();return e?e.replace("-tab",""):null}static async addOrUpdateCollectionAsync(e){try{let n=t.Globals.CreatedBaseNodes.get(e+"-trend");if(n||(n=new a.Trend(e+"-trend",null),n.layoutHandler.setAttributes({width:100,widthUnit:"%",height:100,heightUnit:"%"}),await t.Storage.UserData.saveTrendCollectionSelectionAsync(e),await this.initAsync()),!this.__tabWindow)throw new t.NullOrUndefinedVariableError("__tabWindow");null==this.__tabWindow.getTab(e+"-tab")&&(this.__tabWindow.addTab(e+"-tab",{content:n.getElement(),textAttributes:{text:e}}),this.__tabWindow.selectTab(e+"-tab")),n.getSeries().length!=o.getCollection(e)?.baObjects.length&&n.removeAllSeriesLine();const i=o.getCollection(e);if(null==i)throw new t.NullOrUndefinedVariableError("collection");if(i.baObjects.length<=0)return void await this.removeCollectionAsync(e);for(const a of i.baObjects){let i=t.BA.BaDevices?.get(a.deviceName);if(i){let s=i.findBaObject(a.instancePath);if(s){if(s instanceof t.BA.BaObject)if(s instanceof t.BA.BaTrendObject)await s.loadAttributes(),s.getIsValid()&&!n.containsBaTrend(s)&&n.addBaTrend(s);else{const i=await s.getReferringObjectsAsync();if(null!=i){if(i.length<=0){let n=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmBaObjectNotTrendedRemoveFromCollection),a.instancePath,a.deviceName,e);return void(await t.Components.DialogWindow.confirm(n)&&(await o.removeObjectFromCollectionAsync(e,a),o.hasCollection(e)?await this.addOrUpdateCollectionAsync(e):await l.removeCollectionAsync(e,!1)))}let r=i[0].OwnerObject;r instanceof t.BA.BaTrendObject&&(await(s?.loadAttributes()),r.getIsValid()&&!n.containsBaTrend(r)&&n.addBaTrend(r))}}}else await t.Components.DialogWindow.confirm(`BaObject "${a.instancePath}" was not found in trend collection "${e}"!\nDo you want to remove it from the collection?`)&&await o.removeObjectFromCollectionAsync(e,a)}else await t.Components.DialogWindow.confirm(`Device ${a.deviceName} for trend collection '${e}' was not found!\nDo you want to remove the "${a.instancePath}" from the collection "${e}"?`)&&await o.removeObjectFromCollectionAsync(e,a)}}catch(e){throw new t.BaseError("Adding or updating of trend collection failed!",{cause:e})}}static async removeCollectionAsync(e,a=!0){try{if(a){let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmRemoveCollectionFromView),e);if(!await t.Components.DialogWindow.confirm(a))return}await t.Storage.UserData.deleteTrendCollectionSelectionAsync(e),await this.initAsync(),t.Globals.CreatedBaseNodes.get(e+"-trend")?.destroy(),this.__tabWindow?.removeTab(e+"-tab")}catch(e){throw new t.BaseError("Removing collection from trend collection view failed!",{cause:e})}}static async openAsync(e){try{if(this.__tabWindow||(this.__tabWindow=new t.Components.TabWindow("tchmi-ba-trend-collection-tab-window",null).setAttributes({layout:{width:100,widthUnit:"%",height:100,heightUnit:"%"}})),!this.__dialog){let e=t.Components.ContextMenu.createContextMenuAndButton({id:"tchmi-ba-trend-collection-dialog-window",rowEntryOptions:[{onPressed:async()=>{try{e.menu.close();const t=await o.selectCollectionAsync();null!=t&&await this.addOrUpdateCollectionAsync(t)}catch(e){t.BaseError.warn(e,this.logger)}},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.AddCollection,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}},{onPressed:async()=>{try{e.menu.close();let t=this.__getSelectedCollectionName();null!=t&&await this.removeCollectionAsync(t)}catch(e){t.BaseError.warn(e,this.logger)}},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.RemoveCollectionFromView,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}},{onPressed:async()=>{try{e.menu.close(),await o.openAsync()}catch(e){t.BaseError.warn(e,this.logger)}},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.NewTrendCollection,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}},{onPressed:async()=>{try{e.menu.close();let t=this.__getSelectedCollectionName();null!=t&&await o.openAsync({collectionName:t})}catch(e){t.BaseError.warn(e,this.logger)}},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.EditCollection,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}},{onPressed:async()=>{try{e.menu.close();const a=await o.selectCollectionAsync();null!=a&&(await o.deleteCollectionAsync(a),t.Globals.CreatedBaseNodes.get(a+"-trend")?.destroy(),this.__tabWindow?.getTab(a+"-tab")&&this.__tabWindow?.removeTab(a+"-tab"))}catch(e){t.BaseError.warn(e,this.logger)}},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.DeleteCollection,(a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}}]});this.__dialog=new t.Components.DialogWindow("tchmi-ba-trend-collection-dialog-window",null).setAttributes({buttons:t.Components.DialogWindow.Buttons.CancelSize,content:this.__tabWindow.getElement(),controls:e.button}),t.Locale.Localization.watchText(t.Locale.LangKey.TrendCollections,(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&this.__dialog?.setHeadlineText(e.text)}))}if(this.__dialog.open(),e){if(null==o.getCollection(e)){let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.AlertCollectionNameNotFound),e);return void await t.Components.DialogWindow.alert(a)}await this.addOrUpdateCollectionAsync(e)}else if(null!=this.__collectionSelection){let e=!1,a=!1;for(let n=0;n<this.__collectionSelection.length;n++)o.getCollection(this.__collectionSelection[n])?(await this.addOrUpdateCollectionAsync(this.__collectionSelection[n]),e=!0):(t.Storage.UserData.deleteTrendCollectionSelectionAsync(this.__collectionSelection[n]),a=!0);if(a&&await this.initAsync(),!e){const e=await o.selectCollectionAsync();null!=e&&await this.addOrUpdateCollectionAsync(e)}}else{const e=await o.selectCollectionAsync();null!=e&&await a.Trend.CollectionView.openAsync(e)}}catch(e){throw this.__dialog?.close(),new t.BaseError("Opening collection view failed!",{cause:e})}}static showsTrendCollections(){return null!=this.__collectionSelection&&this.__collectionSelection.length>0}}s=l,l.logger=new t.Logger({name:"CollectionView",className:s.constructor.name}),n.CollectionView=l}(n=a.Trend||(a.Trend={}))}(a=t.Charting||(t.Charting={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));