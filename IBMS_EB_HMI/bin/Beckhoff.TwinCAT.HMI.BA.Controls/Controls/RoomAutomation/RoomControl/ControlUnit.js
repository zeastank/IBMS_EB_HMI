var TcHmi;!function(e){!function(t){!function(n){!function(r){!function(r){class o extends t.Components.TextControl{constructor(e,r){super(e,r),this.__hasResetSymbol=!1,this.__oldPriority=null,this.__elementCreated=!1,this.setReadOnly(!1),this.__element.addClass("control-unit"),this.__priorityLegendIconHandler=new t.Components.LegendIconHandler,this.__resetManualModeLegendIconHandler=new t.Components.LegendIconHandler,this.__iconBadgeHandler=new t.Helper.IconBadges.Handler({id:this.getId(),container:this.getElement(),iconCssClass:"tchmi-ba-room-control-side-menu-alarm-icon"}),this.baObjectHandler=new t.BaObjectHandler(this),this.baInterfaceHandler=new t.BaInterfaceHandler(this),this.baInterfaceHandler.baInterfaceDefinition=n.System.BaseRoomControl.BaInterfaceDef,this.setBaInterfaceSymbolNames(n.System.BaseRoomControl.BaInterfaceSymbolNames)}__attach(){this.__isAttached||(null!=this.__attrHandler.priority&&this.__attrHandler.priority>0&&this.__priorityLegendIconHandler.show(),null!=this.__sideControl?.getControl(o.__resetManualButtonName)&&this.__baParent.sideMenuOpen&&null!=this.__resetManualModeLegendIconHandler.icon&&this.__resetManualModeLegendIconHandler.show(),this.__destroyersToCallOnDetach.push(this.__baParent.eventHandler.register(r.Control.ControlEvents.onSideMenuOpened,(()=>{null!=this.__resetManualModeLegendIconHandler.icon&&this.__resetManualModeLegendIconHandler.show()}))),this.__destroyersToCallOnDetach.push(this.__baParent.eventHandler.register(r.Control.ControlEvents.onSideMenuClosed,(()=>{this.__resetManualModeLegendIconHandler.hide()}))),super.__attach())}__detach(){this.__isAttached&&(this.__priorityLegendIconHandler.hide(),this.__resetManualModeLegendIconHandler.hide(),super.__detach())}destroy(){this.__controlContainer?.destroy(),this.__sideControl?.destroy(),this.__sideControlHeader?.destroy(),null!=this.__subscriptionIds&&(this.__subscriptionIds.forEach((e=>t.Server.subscriptionCollector.remove(e))),delete this.__subscriptionIds),null!=this.__propSymbols&&this.__propSymbols.forEach((e=>{e.symbol.destroy(),e.destroyWatch()})),this.__icon?.destroy(),this.baObjectHandler.destroy(),this.baInterfaceHandler.destroy(),this.__iconBadgeHandler.destroy(),super.destroy()}__onResetManualButtonPressed(){this.resetManualToPlc()}processBaObject(){}createElement(){this.__controlContainer||(this.__controlContainer=new t.Components.ControlContainer(this.__id+"-control-container",this).setAttributes({cssClass:"information-container"}),this.__iconContainer=$("<div>").addClass("icon-container"),this.__element.append(this.__iconContainer,this.__controlContainer.getElement()),this.__processError(),this.__processPriority()),this.__elementCreated=!0}getSideControl(){if(!this.__sideControlContainer){this.__sideControlContainer=$("<div>").addClass("side-control-container"),this.__sideControlHeader=new t.Components.ControlContainer(this.__id+"-side-control-header",this);let e={type:t.Components.ComponentType.Textblock,name:o.__nameFieldName,settings:{textAttributes:{text:this.__attrHandler.name,horizontalAlignment:"Center"}}};this.__sideControlHeader.addControl(e),null==this.__attrHandler.name&&(null!=this.baObjectHandler.baObject?this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eInstDescription,(e=>{this.setName(e)})):this.baInterfaceHandler.hasSubSymbol("name")&&this.baInterfaceHandler.watchSubSymbol("name",(e=>{this.setName(e)}))),this.__sideControlContainer.append(this.__sideControlHeader.getElement()),this.__sideControl=new t.Components.ControlContainer(this.__id+"-side-control",this),this.__sideControlContainer.append(this.__sideControl.getElement());let n=()=>{this.__sideControlContainer&&t.BusyHandler.detachBusyIndicator(this.__sideControlContainer)};this.busyHandler.checkForBusyChildren(n)&&this.__sideControlContainer&&t.BusyHandler.appendBusyIndicator(this.__sideControlContainer),this.__processError(),this.__processPriority()}return this.__sideControlContainer}resetManualToPlc(){throw new Error("Needs to be implemented from inherited classes!")}getIsLocked(){return n.System.BaseRoomControl.getIsLocked(this.__attrHandler)}getPriorityIcon(e){throw new Error("Needs to be implemented from inherited classes!")}hasManualPriority(){throw new Error("Needs to be implemented from inherited classes!")}hasResetManualSymbol(){return this.__hasResetSymbol}__handleProperty(n,r,o,i){if(!n)return;let s=n[r];if(o=o.bind(this),null!=s)if("string"==typeof s)if(e.Symbol.isSymbolExpression(s)&&s.indexOf("%s%")>-1){const e=t.Helper.String.toServerMapping(s);this.__attrHandler[r+"Mapping"]=e,this.__attrHandler[r]=null,null==this.__subscriptionIds&&(this.__subscriptionIds=[]),this.__subscriptionIds.push(t.Server.subscriptionCollector.add(e,(e=>{a(e)})))}else if(e.Symbol.isSymbolExpression(s)){const n=new e.Symbol(s),o=n.watch((e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&a(e.value)}));null==this.__propSymbols&&(this.__propSymbols=new Map);let i=this.__propSymbols.get(r);null==i?i={symbol:n,destroyWatch:o}:(i.symbol.destroy(),i.destroyWatch(),i.symbol=n,i.destroyWatch=o)}else a(s);else a(s);else o(null);function a(e){let n;if(null==e)n=null;else if(i instanceof Array){let r=typeof e;if("object"==r||"function"==r)throw Error();if(i.indexOf(r)>-1)n=e;else for(let r=0;r<i.length&&(n=t.Helper.convertToType(e,i[r]),null==n);r++);}else n=t.Helper.convertToType(e,i);o(n)}}__appendIconBadgeHandler(e=!0){let t=this.__sideControlContainer?.children(".tchmi-ba-room-control-side-menu-alarm-container");e?null!=this.__sideControlContainer&&(null!=t&&null!=t[0]||(t=$("<div>").addClass("tchmi-ba-room-control-side-menu-alarm-container"),this.__iconBadgeHandler.updateConfig({container:t}),this.__sideControlContainer.append(t))):null!=t&&t.detach()}__appendPriorityIcon(e){e?(null==this.__controlContainer?.getControl(o.__priorityIconName)&&this.__controlContainer?.addControl({type:t.Components.ComponentType.Icon,name:o.__priorityIconName,settings:{cssClass:"fixed-size",order:1}}),null!=this.__sideControl&&null==this.__sideControl.getControl(o.__priorityIconName)&&(this.__sideControl.addControl({type:t.Components.ComponentType.Icon,name:o.__priorityIconName,settings:{cssClass:"fixed-size",order:10}}),this.__sideControlContainer?.addClass("use-priority-icon"))):(this.__controlContainer?.removeControl(r.LightControl.__priorityIconName),null!=this.__sideControl&&(this.__sideControlContainer?.removeClass("use-priority-icon"),this.__sideControl.getControl(o.__priorityIconName)&&this.__sideControl.removeControl(o.__priorityIconName)))}__appendResetManualButton(e){e?null!=this.__sideControl&&(this.__sideControl.getControl(o.__resetManualButtonName)||(this.__sideControl.addControl({type:t.Components.ComponentType.Button,name:o.__resetManualButtonName,settings:{iconPath:t.Icons.RoomAutomation.ResetManual.path,iconHeight:70,iconHeightUnit:"%",iconWidth:70,iconWidthUnit:"%",cssClass:"fixed-size",order:11},callback:()=>this.__onResetManualButtonPressed()}),this.__resetManualModeLegendIconHandler.icon=t.Icons.convertIIconDataToIIconAttributes(t.Icons.RoomAutomation.ResetManual)),this.__isAttached&&null!=this.__resetManualModeLegendIconHandler.icon&&this.__resetManualModeLegendIconHandler.show()):(this.__sideControl?.removeControl(o.__resetManualButtonName),this.__resetManualModeLegendIconHandler.hide())}setAttributes(n){if(void 0!==n.baObject&&this.baObjectHandler.setBaObject(n.baObject),super.setAttributes(n),null!=n.resetManualSym){let t=n.resetManualSym;"string"==typeof t&&e.Symbol.isSymbolExpression(t)?(this.__attrHandler.resetManualSym=new e.Symbol(t),this.__hasResetSymbol=!0):this.__hasResetSymbol=!1}else this.__hasResetSymbol=!1;return null!=n.name&&"string"==typeof n.name&&(n.name.length>0?(this.__attrHandler.name=n.name,this.__processName()):e.Symbol.isSymbolExpression(n.name)&&(this.__attrHandler.nameSym=new e.Symbol(n.name),this.__attrHandler.nameSym.watch((e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&(this.__attrHandler.name=e.value,this.__processName())})))),this.baObjectHandler.baObject||(this.__handleProperty(n,"error",this.setError,"boolean"),this.__handleProperty(n,"priority",this.setPriority,"number")),void 0!==n.type&&(this.__attrHandler.type=n.type),this}getAttributes(){return this.__attrHandler.getRef()}setBaInterface(e){return this.baInterfaceHandler.setBaInterfaceSym(e,(()=>this.__processBaInterface())),this}__processBaInterface(){}getBaInterface(){return this.baInterfaceHandler.getBaInterfaceSym()}setBaInterfaceSymbolNames(e){return null!=e&&(this.baInterfaceHandler.baInterfaceSymNames=t.BaInterfaceHandler.convertToBaInterfaceSymbolNames(e)),this}getBaInterfaceSymbolNames(){return t.BaInterfaceHandler.convertToBaInterfaceSymbolNamesDesigner(this.baInterfaceHandler.baInterfaceSymNames)}setName(e){return this.__attrHandler.checkAttribute(e,"name",{validator:"string"})?(this.__attrHandler.name=e,this.__processName(),this):this}__processName(){let e=this.__sideControlHeader?.getControl(o.__nameFieldName);e?.textHandler.setText(this.__attrHandler.name)}getName(){return this.__attrHandler.name}setError(e){return this.__attrHandler.checkAttribute(e,"error",{validator:"boolean"})?(this.__attrHandler.error=e,this.__processError(),this):this}__processError(){1==this.__attrHandler.error?this.__iconBadgeHandler.addIcon(n.System.BaseRoomControl.ErrorIcon):this.__iconBadgeHandler.removeIcon(n.System.BaseRoomControl.ErrorIcon),this.__appendIconBadgeHandler(this.__iconBadgeHandler.hasIcons()),this.setIsEnabled(!this.getIsLocked())}getError(){return this.__attrHandler.error}setPriority(e){return this.__attrHandler.checkAttribute(e,"priority",{validator:"number"})?(this.__attrHandler.priority=e,this.__processPriority(),this.__baParent.onPriorityChanged(),this):this}__processPriority(){if(null!=this.__oldPriority){const e=this.getPriorityIcon(this.__oldPriority);null!=e&&this.__iconBadgeHandler.removeIcon(e),this.__oldPriority=null,this.__appendIconBadgeHandler(this.__iconBadgeHandler.hasIcons())}if(null==this.__attrHandler.priority)this.__appendPriorityIcon(!1),this.__priorityLegendIconHandler.hide();else{let e=this.getPriorityIcon(this.__attrHandler.priority);if(null!=e)if(this.__priorityLegendIconHandler.icon=e,this.__isAttached&&this.__priorityLegendIconHandler.show(),this.getIsLocked()&&!this.hasManualPriority())this.__appendPriorityIcon(!1),this.__iconBadgeHandler.addIcon(e),this.__oldPriority=this.__attrHandler.priority,this.__appendIconBadgeHandler(this.__iconBadgeHandler.hasIcons());else{let n={iconPath:e.iconPath,iconColor:new t.Color.RGBAColor(e.iconColor),iconHeight:80,iconHeightUnit:"%",iconWidth:80,iconWidthUnit:"%",useSVG:!0};this.__appendPriorityIcon(!0),this.__controlContainer?.getControl(o.__priorityIconName)?.iconHandler.setAttributes(n),this.__sideControl?.getControl(o.__priorityIconName)?.iconHandler.setAttributes(n)}else this.__appendPriorityIcon(!1),this.__priorityLegendIconHandler.hide()}this.hasManualPriority()&&this.__hasResetSymbol?this.__appendResetManualButton(!0):this.__appendResetManualButton(!1),this.setIsEnabled(!this.getIsLocked())}getPriority(){return this.__attrHandler.priority}}o.__nameFieldName="name-field",o.__resetManualButtonName="reset-manual-button",o.__priorityIconName="priority-icon",r.ControlUnit=o}(r.RoomControl||(r.RoomControl={}))}(n.RoomAutomation||(n.RoomAutomation={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));