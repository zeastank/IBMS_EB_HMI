var TcHmi;!function(t){!function(e){!function(s){!function(s){!function(i){class r extends i.ControlUnit{constructor(t,e){super(t,e),this.__brightnessFeedbackReady=[],this.__useCurrentBrightness=!1,this.__waitingForBrightnessFeedback=!1,this.baInterfaceHandler.baInterfaceDefinition=s.Light.BaInterfaceDef,this.setBaInterfaceSymbolNames(s.Light.BaInterfaceSymbolNames)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}createElement(){super.createElement(),this.__icon||(this.__icon=new s.Light.Icon(this.__id+"-light",this),this.__icon.setAttributes(this.__attrHandler).setReadOnly(!0).getElement().addClass("icon"),this.__iconContainer?.append(this.__icon.getElement())),this.__controlContainer?.getControl(r.__brightnessDisplayName)||this.__controlContainer?.addControl({type:e.Components.ComponentType.Textblock,name:r.__brightnessDisplayName,settings:{order:2}}),this.__updateElements()}getSideControl(){return this.__sideControlContainer=super.getSideControl(),this.__sideControlContainer.addClass("light"),"boolean"==typeof this.__attrHandler.brightness&&this.__sideControlContainer.addClass("boolean-brightness"),this.__sideControl&&(this.__sideControl.getElement(),this.__updateSideControl()),this.__sideControlContainer}writeBrightness(i){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=s.Light.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(s.Light.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&s.Light.writeBrightnessToPlc(i,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&s.Light.writeBrightnessToPlc(i,this.baInterfaceHandler),this.__attrHandler.brightnessMapping&&t.Server.writeSymbol(this.__attrHandler.brightnessMapping,i,(t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t,!1)})),this.__processChangedBrightness(i)}resetManualToPlc(){null==this.baInterfaceHandler.baInterfaceSymNames&&(this.baInterfaceHandler.baInterfaceSymNames=s.Light.BaInterfaceSymbolNames),this.baObjectHandler.baObject?.checkParams(s.Light.BaInterfaceDef,this.baInterfaceHandler.baInterfaceSymNames)&&s.Light.resetManualToPlc(this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&s.Light.resetManualToPlc(this.baInterfaceHandler),this.__attrHandler.resetManualSym&&this.__attrHandler.resetManualSym.write(!0,(t=>this.logger.checkServerResult(e.Logger.Severity.warn,t)))}getIsLocked(){return s.Light.getIsLocked(this.__attrHandler)}getPriorityIcon(t){return s.Light.getPriorityDisplayIcon(t)}hasManualPriority(){return s.Light.isManualPriority(this.__attrHandler.priority)}__processChangedBrightness(t){if(1!=this.busyHandler.getIsBusy()&&void 0!==t&&(this.__useCurrentBrightness=!0,this.__waitingForBrightnessFeedback=!0,this.setBrightness(t),null!=this.__attrHandler.brightnessFeedback&&t!=this.__attrHandler.brightnessFeedback)){let t=()=>{this.__brightnessFeedbackReady.forEach((t=>t())),this.__brightnessFeedbackReady=[],this.setBrightness(this.__attrHandler.brightnessFeedback)};this.__sideControlContainer&&0==this.busyHandler.getIsBusy()&&s.showBusyIndicator&&e.BusyHandler.appendBusyIndicator(this.__sideControlContainer);let i=this.logger.logPerformance(e.Logger.Severity.debug,"Brightness feedback response."),r=()=>{i(),this.__sideControlContainer&&e.BusyHandler.detachBusyIndicator(this.__sideControlContainer)};this.__brightnessFeedbackReady.push(this.busyHandler.setBusy("Waiting for BrightnessFeedback",{cbOnTimeout:t,cbOnReady:r,showIndicator:s.showBusyIndicator}))}}__updateElements(){if(null==this.__attrHandler.brightness)return;let t=this.__attrHandler.brightness;if(null!=this.__attrHandler.brightnessFeedback&&0==this.__useCurrentBrightness&&(t=this.__attrHandler.brightnessFeedback),this.__useCurrentBrightness=!1,this.__elementCreated&&(this.__icon?.setBrightness(t),s.Light.Icon.getBrightnessText(t,s.Light.MinimumBrightness,s.Light.MaximumBrightness,(t=>{this.__controlContainer?.getControl(r.__brightnessDisplayName)?.textHandler.setText(t)}))),this.__sideControl){let i=this.__sideControl.getControl(r.__brightnessCtrlName);0!=this.__attrHandler.readOnly&&(this.__sideControl.removeControl(r.__brightnessCtrlName),i=void 0),"number"==typeof t?(null==i||i instanceof e.Components.Slider||(this.__sideControl.removeControl(r.__brightnessCtrlName),this.__updateSideControl(),i=this.__sideControl.getControl(r.__brightnessCtrlName)),0==s.Light.showFeedbackInSlider?i?.setValue(t):(i?.setValue(this.__attrHandler.brightness),null!=this.__attrHandler.brightnessFeedback&&i?.setValueFeedback(this.__attrHandler.brightnessFeedback)),this.__sideControl.getControl(r.__lightSwitchName)?.setState(t>s.Light.MinimumBrightness)):"boolean"==typeof t&&(i instanceof e.Components.Checkbox||(this.__sideControl.removeControl(r.__brightnessCtrlName),this.__updateSideControl(),i=this.__sideControl.getControl(r.__brightnessCtrlName)),i?.setState(t))}}__updateSideControl(){if(null!=this.__sideControl&&null!=this.__attrHandler)if(0==this.__attrHandler.readOnly){this.__sideControl.removeControl(r.__noControlDisplayName);let t=this.__sideControl.getControl(r.__brightnessCtrlName);if(!t){switch(typeof this.__attrHandler.brightness){case"number":if(1==s.Light.ShowQuickLinks){let t=e.Components.ContextMenu.createContextMenuAndButton({id:this.__id,parent:this,rowEntryOptions:[{controls:[{type:e.Components.ComponentType.Button,callback:()=>{this.writeBrightness((s.Light.MaximumBrightness-s.Light.MinimumBrightness)/4+s.Light.MinimumBrightness),t.menu.close()}},{type:e.Components.ComponentType.Button,callback:()=>{this.writeBrightness((s.Light.MaximumBrightness-s.Light.MinimumBrightness)/2+s.Light.MinimumBrightness),t.menu.close()}},{type:e.Components.ComponentType.Button,callback:()=>{this.writeBrightness(3*(s.Light.MaximumBrightness-s.Light.MinimumBrightness)/4+s.Light.MinimumBrightness),t.menu.close()}}]}]});t.button.layoutHandler.setMaxWidth(30),this.__sideControl.addControl(t.button),this.__sideControl.childrenHandler.addChild(t.menu)}this.__sideControl.addControls([{type:e.Components.ComponentType.Slider,name:r.__brightnessCtrlName,settings:{layout:{maxHeight:10,minHeight:10,maxWidth:90,minWidth:90},showBusyIndicator:s.showBusyIndicator,knobAppearance:e.Components.Slider.KnobAppearance.round},callback:t=>{this.writeBrightness(t)}},{type:e.Components.ComponentType.Checkbox,name:r.__lightSwitchName,settings:{appearance:e.Components.Checkbox.Appearance.toggleSlider,readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:35,minWidth:35}},callback:t=>{this.writeBrightness(1==t?s.Light.MaximumBrightness:s.Light.MinimumBrightness)}}]);break;case"boolean":this.__sideControl.addControl({type:e.Components.ComponentType.Checkbox,name:r.__brightnessCtrlName,settings:{cssClass:"fixed-size",readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:40,minWidth:40},appearance:e.Components.Checkbox.Appearance.toggleSlider},callback:t=>{this.writeBrightness(t)}})}t=this.__sideControl.getControl(r.__brightnessCtrlName),this.__updateElements()}if(null==t)throw new Error("Brightness control not found!");if("number"==typeof this.__attrHandler.brightness){if(!(t instanceof e.Components.Slider))throw new Error("Brightness control should be a slider here!");if(t.setMinValue(s.Light.MinimumBrightness).setMaxValue(s.Light.MaximumBrightness),1==s.Light.ShowQuickLinks&&this.__attrHandler.lightColor){let t=this.__sideControl.childrenHandler.getChildren().get(this.__id+"-context-menu");if(null==t)throw new Error("Context menu should be available here!");let i=s.Light.MaximumBrightness-s.Light.MinimumBrightness;for(let r=0;r<t.getRowEntries()[0].controlContainer.getControls().length;r++){let n=t.getRowEntries()[0].controlContainer.getControls()[r],a=0;switch(r){case 0:a=i/4+s.Light.MinimumBrightness;break;case 1:a=i/2+s.Light.MinimumBrightness;break;case 2:a=3*i/4+s.Light.MinimumBrightness}n.setAttributes({layout:{maxWidth:30,minWidth:30},iconPath:e.Icons.RoomAutomation.Lamp2.path,iconHeight:90,iconHeightUnit:"%",iconWidth:90,iconWidthUnit:"%",iconColor:e.Color.getFadeColor(e.Color.RGBAColor.Black,s.Light.MinimumBrightness,this.__attrHandler.lightColor,s.Light.MaximumBrightness,a)})}}}}else null==this.__sideControl.getControl(r.__noControlDisplayName)&&this.__sideControl.addControl({type:e.Components.ComponentType.Textblock,name:r.__noControlDisplayName,settings:{textAttributes:{text:e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.NoControl)}}})}setAttributes(t){return super.setAttributes(t),this.baObjectHandler.baObject||(this.__handleProperty(t,"brightness",this.setBrightness,["number","boolean"]),this.__handleProperty(t,"brightnessFeedback",this.setBrightnessFeedback,["number","boolean"]),void 0!==t.lightColor&&this.setLightColor(t.lightColor)),this}getAttributes(){return this.__attrHandler.getRef()}__processBaInterface(){super.__processBaInterface(),s.Light.processBaInterface(this,{processError:t=>this.setError(t),processPriority:t=>this.setPriority(t),processHasBrightnessCmd:t=>this.setReadOnly(!t),processBrightness:t=>this.setBrightness(t),processBrightnessFeedback:t=>this.setBrightnessFeedback(t),processHasResetSymbol:t=>{this.__hasResetSymbol=t,this.__processPriority()}})}setBrightness(t){return this.__attrHandler.checkAttribute(t,"brightness",{validator:["number","boolean"]})?(this.__attrHandler.brightness=t,this.__processBrightness(),this.__baParent.onBrightnessChanged(),this):this}__processBrightness(){this.__updateElements()}getBrightness(){return this.__attrHandler.brightness}setBrightnessFeedback(t){return this.__attrHandler.checkAttribute(t,"brightnessFeedback",{validator:["number","boolean"]})?(this.__attrHandler.brightnessFeedback=t,null!=t&&this.__processBrightnessFeedback(),this):this}__processBrightnessFeedback(){if(null!=this.__attrHandler.brightnessFeedback){if(1==this.__waitingForBrightnessFeedback&&this.__attrHandler.brightnessFeedback!=this.__attrHandler.brightness)return;this.__brightnessFeedbackReady.forEach((t=>t())),this.__brightnessFeedbackReady=[],this.__updateElements(),this.__waitingForBrightnessFeedback=!1,this.__baParent.onBrightnessChanged()}}getBrightnessFeedback(){return this.__attrHandler.brightnessFeedback}setLightColor(t){return this.__attrHandler.checkColorAttribute(t,"lightColor")?(this.__attrHandler.lightColor=t,this.__icon?.setLightColor(t),this.__updateSideControl(),this):this}getLightColor(){return this.__attrHandler.lightColor}__processReadOnly(){super.__processReadOnly(),this.__updateElements()}processBaObject(){super.processBaObject(),null!=this.baObjectHandler.baObject&&(s.Light.processBaObject(this,this.baInterfaceHandler.baInterfaceSymNames,{processError:t=>this.setError(t),processPriority:t=>this.setPriority(t),processHasBrightnessCmd:t=>this.setReadOnly(!t),processBrightness:t=>this.setBrightness(t),processBrightnessFeedback:t=>this.setBrightnessFeedback(t),processHasResetSymbol:t=>{this.__hasResetSymbol=t,this.__processPriority()}}),this.busyHandler.checkForBusyChildren())}}r.__brightnessDisplayName="brightness-display",r.__brightnessCtrlName="brightness-ctrl",r.__lightSwitchName="light-switch",r.__noControlDisplayName="no-control-display",i.LightControl=r}(s.RoomControl||(s.RoomControl={}))}(s.RoomAutomation||(s.RoomAutomation={}))}(e.Controls||(e.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={}));