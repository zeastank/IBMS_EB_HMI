var TcHmi;!function(e){!function(t){!function(i){!function(a){class s extends i.System.UiIconFdbStp{constructor(e,i,a){super(e,i,a),this.__defaultBaTemplateDescription=s.BaTemplateDescription,this.__damperType=null,this.__flapPosition=null,this.__switchOpn=null,this.__switchCls=null,this.__legendIconHandler=new t.Components.LegendIconHandler}__previnit(){super.__previnit()}__init(){super.__init()}__attach(){super.__attach(),this.__displayMode>=s.DisplayMode.damper&&this.__displayMode<=s.DisplayMode.shutOffValve&&this.__legendIconHandler.show()}__detach(){super.__detach(),this.__legendIconHandler.hide()}destroy(){this.__keepAlive||(this.__destroyerLocaleWatch&&(this.__destroyerLocaleWatch.opened(),this.__destroyerLocaleWatch.closed(),delete this.__destroyerLocaleWatch,delete this.__texts),super.destroy())}__setDamperType(e){return this.__damperType=e,this}__processSwitches(){let e=null;null==this.__switchOpn||null==this.__switchCls||(this.__switchOpn&&!this.__switchCls?e=100:!this.__switchOpn&&this.__switchCls&&(e=0)),this.setFlapPosition(e)}getDamperType(){return this.__damperType}setFlapPosition(t){let i;return i="boolean"==typeof t?e.ValueConverter.toBoolean(t):e.ValueConverter.toNumber(t),null==i&&(i=this.getAttributeDefaultValueInternal("FlapPosition")),tchmi_equal(i,this.__flapPosition)||(this.__flapPosition=i,this.__processFlapPosition(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"FlapPosition"})),this}__processFlapPosition(){if(null==this.__flapPosition)this.__element.css("--tchmi-ba-damper-flap-rotation",""),this.setFeedback(null);else{let e,a=this.__baFc.getDisplay(i.System.UiIconFdbStp.feedbackDisplayName);if("boolean"==typeof this.__flapPosition){if(e=90+.9*(this.__flapPosition?s.openPosition:s.closePosition),a)if(0==s.usePercentageForBoolean){a.setDataType(t.DataType.string);let e=()=>{a?.setValue(this.__flapPosition?this.__texts?.opened:this.__texts?.closed)};null==this.__destroyerLocaleWatch?this.__destroyerLocaleWatch={opened:t.Locale.Localization.watchText(t.Locale.LangKey.Open,(i=>{t.Logger.checkServerResult(t.Logger.Severity.warn,i)&&null!=i.text&&(null==this.__texts&&(this.__texts={opened:"",closed:""}),this.__texts.opened=i.text,e())})),closed:t.Locale.Localization.watchText(t.Locale.LangKey.Closed,(i=>{t.Logger.checkServerResult(t.Logger.Severity.warn,i)&&null!=i.text&&(null==this.__texts&&(this.__texts={opened:"",closed:""}),this.__texts.closed=i.text,e())}))}:e()}else a.setDataType(t.DataType.number),a.setValue(this.__flapPosition?s.openPosition:s.closePosition),a.setUnit("%"),a.setDigits(0)}else e=90+.9*this.__flapPosition,a&&(a.setValue(this.__flapPosition),a.setUnit("%"),a.setDigits(0));this.__element.css("--tchmi-ba-damper-flap-rotation",e+"deg")}}getFlapPosition(){return"boolean"==typeof this.__flapPosition?this.__flapPosition?100:0:this.__flapPosition}processBaObject(){if(super.processBaObject(),this.setFeedback(null),this.setSetpoint(null),this.setCommand(null),this.__switchOpn=null,this.__switchCls=null,this.__processSwitches(),this.__setDamperType(s.Type.invalid),null==this.__baFc.baObjectHandler.baObject)return;let i=null,a=null,l=null,o=null,n=null;if(this.__baFc.baObjectHandler.baObject instanceof t.BA.BaView){if(this.__baFc.baObjectHandler.baObject.checkTemplate(s.BaTemplateDefinition,this.baTemplateHandler.baBaTemplateDescription,void 0,!1)&&(i=this.__baFc.baObjectHandler.baObject.getTemplateChild("swiOpn"),a=this.__baFc.baObjectHandler.baObject.getTemplateChild("swiCls"),i&&a&&(this.__baFc.baObjectHandler.tryWatchChildrenBaVariable(i,t.BA.BaParameterId.ePresentValue,(t=>{this.__switchOpn=e.ValueConverter.toBoolean(t),this.__processSwitches()})),this.__baFc.baObjectHandler.tryWatchChildrenBaVariable(a,t.BA.BaParameterId.ePresentValue,(t=>{this.__switchCls=e.ValueConverter.toBoolean(t),this.__processSwitches()})),this.__setDamperType(s.Type.dmp2P)),i&&a||(o=this.__baFc.baObjectHandler.baObject.getTemplateChild("setpoint"),o&&(this.__baFc.baObjectHandler.tryWatchChildrenBaVariable(o,t.BA.BaParameterId.ePresentValue,(e=>{this.setFlapPosition(e)})),this.__setDamperType(s.Type.analog)))),!(i&&a||o))return void t.Components.DialogWindow.alert(this.logger.warn(`Invalid BA template bound to ${this.__id}!`,this.__baFc.baObjectHandler.baObject));l=this.__baFc.baObjectHandler.baObject.getTemplateChild("feedback"),n=this.__baFc.baObjectHandler.baObject.getTemplateChild("command"),this.setFeedback(l),this.setSetpoint(o),this.setCommand(n)}else{if(null!=this.__baFc.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.ePresentValue)&&this.__baFc.baObjectHandler.baObject.DataType===t.DataType.boolean){let e=this.busyHandler.setBusy("Read present value.");this.__baFc.baObjectHandler.baObject.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,(t=>{e&&(e(),e=null),this.setFlapPosition(t)}))}}}__processDisplaysData(){super.__processDisplaysData(),this.__processFlapPosition()}__processDisplayMode(){let e;switch(super.__processDisplayMode(),this.__displayMode){case s.DisplayMode.custom:return;case s.DisplayMode.damper:e=t.Icons.HVAC.Damper;break;case s.DisplayMode.fireDamper:e=t.Icons.HVAC.Fire_damper;break;case s.DisplayMode.shutOffValve:e=t.Icons.HVAC.Shut_off_valve;break;default:throw new t.BaseError("Invalid DisplayMode!")}null!=e?(this.__legendIconHandler.icon=t.Icons.convertIIconDataToIIconAttributes(e),this.__isAttached&&this.__legendIconHandler.show(),this.__baFc.iconHandler.setIcon(e.path,!0)):this.__legendIconHandler.hide()}}s.openPosition=100,s.closePosition=0,s.usePercentageForBoolean=!1,a.Damper=s,function(e){let t,a;!function(e){e[e.invalid=-1]="invalid",e[e.damper=0]="damper",e[e.fireDamper=1]="fireDamper",e[e.shutOffValve=2]="shutOffValve",e[e.custom=i.System.UiIconFdbStp.CustomDisplayModeValue]="custom"}(t=e.DisplayMode||(e.DisplayMode={})),function(e){e[e.invalid=-1]="invalid",e[e.dmp2P=0]="dmp2P",e[e.analog=1]="analog"}(a=e.Type||(e.Type={})),e.BaTemplateDefinition={feedback:{optional:!0},setpoint:{optional:!0},command:{optional:!0},swiOpn:{optional:!0},swiCls:{optional:!0}},e.BaTemplateDescription={feedback:{identifier:"Fdb"},setpoint:{identifier:"Mdlt"},command:{identifier:"Cmd"},swiOpn:{identifier:"SwiOpn"},swiCls:{identifier:"SwiCls"}}}(s=a.Damper||(a.Damper={}))}(i.Plants||(i.Plants={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("Damper","TcHmi.BuildingAutomation.Controls.Plants",TcHmi.BuildingAutomation.Controls.Plants.Damper);