var TcHmi;!function(e){!function(t){!function(n){!function(n){class o extends n.TextControl{constructor(e,n,o){super(e,n,o),this.__attrHandler=new t.AttrHandler(this),this.__priorityLegendIconHandler=new t.Components.LegendIconHandler,this.__resetManualModeLegendIconHandler=new t.Components.LegendIconHandler,this.__iconBadgeHandler=new t.Helper.IconBadges.Handler({id:this.getId(),container:this.getElement(),iconCssClass:"tchmi-ba-room-control-alarm-badge-icon",attachingMode:t.Helper.IconBadges.Handler.AttachingMode.corners}),this.__loadBaChildren=!0,this.__loadTexts=!1,this.__controlContainerElement=$("<div>").addClass("control-container-element"),this.__controlContainers=new Map,this.__hasResetSymbol=!1,this.__oldPriority=null,this.__transitionendProcessed=!0,this.__bodyPressedHandler=e=>this.__onBodyPressed(e),this.__closeTransitionEndHandler=()=>{0==this.__transitionendProcessed&&(this.__transitionendProcessed=!0,this.__controlContainerElement.detach(),this.__controlContainerElement.off("transitionend",this.__closeTransitionEndHandler))}}__previnit(){null==this.__baFc&&(this.__baFc=new t.Components.Button(this.__id+"-ba-fc",this)),this.baObjectHandler=new t.BaObjectHandler(this),this.__baFc.iconHandler.setIconHeight(90,"%").setIconWidth(90,"%"),this.__baFc.getElement().addClass("base-element"),this.__element.append(this.__baFc.getElement()),this.baObjectHandler.loadChildren=this.__loadBaChildren,this.baObjectHandler.loadTexts=this.__loadTexts,this.baInterfaceHandler=new t.BaInterfaceHandler(this),this.baInterfaceHandler.baInterfaceDefinition=n.BaseRoomControl.BaInterfaceDef,this.setBaInterfaceSymbolNames(n.BaseRoomControl.BaInterfaceSymbolNames),super.__previnit()}__init(){super.__init()}__attach(){super.__attach(),t.Helper.IconBadges.appendBadgeElementsDimensionRectangle(this.__element,15),null!=this.__getControl(o.__buttonsContainerName,o.__resetManualButtonName)&&this.__controlContainerElement.hasClass("open")&&null!=this.__resetManualModeLegendIconHandler.icon&&this.__resetManualModeLegendIconHandler.show(),this.__processPriority(),1!=this.getReadOnly()&&this.__destroyersToCallOnDetach.push(this.__baFc.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,(()=>{this.__controlContainerElement.hasClass("open")?this.__closeControlContainer():(this.__openControlContainer(),setTimeout((()=>{$("body").on("click touchstart",this.__bodyPressedHandler)}),1))})))}__detach(){super.__detach(),this.__resetManualModeLegendIconHandler.hide(),this.__priorityLegendIconHandler.hide(),null!=this.__element.children(".control-container-element")[0]&&this.__closeControlContainer()}destroy(){if(!this.__keepAlive){for(let e of this.__controlContainers.values())e.destroy();this.__controlContainers=new Map,this.baObjectHandler.destroy(),this.baInterfaceHandler.destroy(),this.__iconBadgeHandler.destroy(),super.destroy()}}__onBodyPressed(e){let t=0,n=e.target.parentElement;for(;t<10&&n;){if(n.id===this.__id)return;n=n.parentElement,t++}this.__closeControlContainer(),$("body").off("click touchstart",this.__bodyPressedHandler)}__onResetManualButtonPressed(){this.resetManualToPlc(),e.EventProvider.raise(this.__id+".onManualReset")}__addControl(e,n,o){let r=this.__controlContainers.get(e);return null==r&&(r=new t.Components.ControlContainer(this.__id+"-control-container-"+e),null!=o&&r.getElement().css("order",o),this.__controlContainerElement.append(r.getElement()),this.__controlContainers.set(e,r),this.__updateControlContainerHeight()),r.addControl(n)}__addControls(e,n,o){let r=this.__controlContainers.get(e);return null==r&&(r=new t.Components.ControlContainer(this.__id+"-control-container-"+e),null!=o&&r.getElement().css("order",o),this.__controlContainerElement.append(r.getElement()),this.__controlContainers.set(e,r),this.__updateControlContainerHeight()),r.addControls(n)}__getControl(e,t){return this.__controlContainers.get(e)?.getControl(t)}__getControls(e){let t=this.__controlContainers.get(e);return null!=t?t.getControls():[]}__removeControl(e,t){let n=this.__controlContainers.get(e);return!(null==n||!n.removeControl(t))&&(n.getControls().length<=0&&(n.destroy(),this.__controlContainers.delete(e),this.__updateControlContainerHeight()),!0)}__removeAllControls(e){let t=this.__controlContainers.get(e);return null!=t&&(t.removeAllControls(),t.destroy(),this.__controlContainers.delete(e),this.__updateControlContainerHeight(),!0)}__updateControlContainerHeight(){this.__element.css("--tchmi-ba-base-control-element-control-container-height",40*this.__controlContainers.size+"px")}__openControlContainer(){this.__controlContainers.size>0&&(this.__element.children(".control-container-element")[0]||this.__controlContainerElement.hasClass("open")||(this.__element.append(this.__controlContainerElement),setTimeout((()=>{this.__controlContainerElement.addClass("open"),this.__oldZIndex=this.getZindex(),this.setZindex(100)}),10)),this.__isAttached&&null!=this.__resetManualModeLegendIconHandler.icon&&this.__resetManualModeLegendIconHandler.show())}__closeControlContainer(){this.__controlContainerElement.hasClass("open")&&(this.__controlContainerElement.removeClass("open"),this.__transitionendProcessed=!1,this.__controlContainerElement.on("transitionend",this.__closeTransitionEndHandler),setTimeout((()=>this.__closeTransitionEndHandler()),1e3),void 0!==this.__oldZIndex&&this.setZindex(this.__oldZIndex)),this.__resetManualModeLegendIconHandler.hide()}__appendResetManualButton(e){e?(null==this.__getControl(o.__buttonsContainerName,o.__resetManualButtonName)&&(this.__addControl(o.__buttonsContainerName,{type:t.Components.ComponentType.Button,name:o.__resetManualButtonName,settings:{iconPath:t.Icons.RoomAutomation.ResetManual.path,cssClass:"corner-element"},callback:()=>this.__onResetManualButtonPressed()},10),this.__resetManualModeLegendIconHandler.icon=t.Icons.convertIIconDataToIIconAttributes(t.Icons.RoomAutomation.ResetManual)),this.__isAttached&&null!=this.__resetManualModeLegendIconHandler.icon&&this.__resetManualModeLegendIconHandler.show()):(this.__removeControl(o.__buttonsContainerName,o.__resetManualButtonName),this.__resetManualModeLegendIconHandler.hide())}__processIsControllable(e){t.Server.BaSite.UserManagement.checkAccess(o.MinimumControlRole)?this.setReadOnly(!e):this.setReadOnly(!0)}resetManualToPlc(){throw new Error("Not implemented!")}static processBaObject(e,n,r){null==n&&(n=o.BaInterfaceSymbolNames);let a=e.baObjectHandler;if(null!=a)if(a.baObject?.checkParams(o.BaInterfaceDef,n,e,!0)){let e=a.baObject.tryGetBaVariable("error");null!=e&&a.watchBaVariable(e,(e=>{r.processError(e)}));let t=a.baObject.tryGetBaVariable("priority");null!=t&&a.watchBaVariable(t,(e=>{r.processPriority(e)}))}else a.baObject instanceof t.BA.BaView||a.baObject?.logInvalidBaObject(e.getId())}static processBaInterface(e,t){e.baInterfaceHandler.hasSubSymbol("error")&&e.baInterfaceHandler.watchSubSymbol("error",(e=>{t.processError(e)})),e.baInterfaceHandler.hasSubSymbol("priority")&&e.baInterfaceHandler.watchSubSymbol("priority",(e=>{t.processPriority(e)}))}processBaObject(){null==this.baObjectHandler.baObject?this.__removeControl(o.__buttonsContainerName,o.__openBaObjectButtonName):t.Server.BaSite.UserManagement.checkAccess(t.BA.Role.eAdvanced)&&null==this.__getControl(o.__buttonsContainerName,o.__openBaObjectButtonName)&&this.__addControl(o.__buttonsContainerName,{type:t.Components.ComponentType.Button,name:o.__openBaObjectButtonName,settings:{iconPath:t.Icons.ObjectType.Object.path,iconHeight:60,iconHeightUnit:"%",iconWidth:60,iconWidthUnit:"%",cssClass:"corner-element"},callback:()=>{null!=this.baObjectHandler.baObject?this.baObjectHandler.baObject.openNavigationDialog():this.logger.warn("Navigation dialog could not be opened, because no BaObject is available!")}},10)}static getIsLocked(e){return null!=e.error&&e.error}getIsLocked(){return o.getIsLocked(this.__attrHandler)}getPriorityIcon(e){throw new Error("Needs to be implemented from inherited classes!")}hasManualPriority(){throw new Error("Needs to be implemented from inherited classes!")}setAttributes(e){return super.setAttributes(e),void 0!==e.error&&this.setError(e.error),void 0!==e.priority&&this.setPriority(e.priority),this}setBaInterface(e){return this}getBaInterface(){return this.baInterfaceHandler.getBaInterfaceSym()}setBaInterfaceSymbolNames(e){return null!=e&&(this.baInterfaceHandler.baInterfaceSymNames=t.BaInterfaceHandler.convertToBaInterfaceSymbolNames(e),this.processBaObject()),this}getBaInterfaceSymbolNames(){return t.BaInterfaceHandler.convertToBaInterfaceSymbolNamesDesigner(this.baInterfaceHandler.baInterfaceSymNames)}setError(t){let n=e.ValueConverter.toBoolean(t);return null==n&&(n=this.getAttributeDefaultValueInternal("Error")),n===this.__attrHandler.error||(this.__attrHandler.error=n,e.EventProvider.raise(this.__id+".onPropertyChanged",["Error"]),this.__processError()),this}__processError(){null!=this.__attrHandler.error&&(1==this.__attrHandler.error?this.__iconBadgeHandler.addIcon(o.ErrorIcon):this.__iconBadgeHandler.removeIcon(o.ErrorIcon),this.setIsEnabled(!this.getIsLocked()))}getError(){return this.__attrHandler.error}setPriority(t){let n=e.ValueConverter.toNumber(t);return null==n&&(n=this.getAttributeDefaultValueInternal("Priority")),n===this.__attrHandler.priority||(this.__attrHandler.priority=n,e.EventProvider.raise(this.__id+".onPropertyChanged",["Priority"]),this.__processPriority()),this}__processPriority(){if(null!=this.__oldPriority){const e=this.getPriorityIcon(this.__oldPriority);null!=e&&this.__iconBadgeHandler.removeIcon(e),this.__oldPriority=null}if(null!=this.__attrHandler.priority){const e=this.getPriorityIcon(this.__attrHandler.priority);null!=e&&(this.__iconBadgeHandler.addIcon(e),this.__priorityLegendIconHandler.icon=e,this.__isAttached&&this.__priorityLegendIconHandler.show()),this.__oldPriority=this.__attrHandler.priority}else this.__priorityLegendIconHandler.hide();this.hasManualPriority()&&this.__hasResetSymbol?this.__appendResetManualButton(!0):this.__appendResetManualButton(!1),this.setIsEnabled(!this.getIsLocked())}getPriority(){return this.__attrHandler.priority}__processIsEnabled(){super.__processIsEnabled(),this.setIsEnabled(!this.getIsLocked())}__processReadOnly(){super.__processReadOnly(),!0===this.__baFc.getReadOnly()?(this.__closeControlContainer(),this.__baFc.getElement().removeClass("button"),this.__baFc.iconHandler.setIconHeight(100,"%").setIconWidth(100,"%")):(this.__baFc.getElement().addClass("button"),this.__baFc.iconHandler.setIconHeight(90,"%").setIconWidth(90,"%"))}}o.__resetManualButtonName="reset-manual-button",o.__openBaObjectButtonName="open-ba-object-button",o.__buttonsContainerName="buttons",n.BaseRoomControl=o,function(e){e.BaInterfaceDef={name:{type:"string",optional:!0},error:{type:"boolean",optional:!0},priority:{type:"number",optional:!0}},e.BaInterfaceSymbolNames={name:{symbolName:"sName"},error:{symbolName:"bErr_Out"},priority:{symbolName:"eActualPrio_Out"}},e.ErrorIcon=t.Icons.convertIIconDataToIIconAttributes({...t.Icons.Events.Priority.Safety,color:t.Color.RGBAColor.Red}),e.MinimumControlRole=t.BA.Role.eBasic}(o=n.BaseRoomControl||(n.BaseRoomControl={}))}(n.System||(n.System={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("BaseRoomControl","TcHmi.BuildingAutomation.Controls.System",TcHmi.BuildingAutomation.Controls.System.BaseRoomControl);