var TcHmi;!function(e){!function(t){!function(n){!function(i){class a extends n.System.BaseControl{constructor(n,i,s){super(n,i,s),this.__loadBaChildren=!0,this.__loadTexts=!0,this.__baUsedTitle=null,this.__showHeader=null,this.__autoCollapse=null,this.__contentWindow=new t.Components.ContentWindow(this.__id+"-content-window",this),this.__searchField=new t.Components.InputBox(this.__id+"-search-field",this),this.__contextMenu=this.__contentWindow.addMenu(),this.__listContainer=this.__contentWindow.getContentContainer().addClass("list-container"),this.__entrySelectedHandler=async(e,t,n)=>{await this.__onObjectSelectedAsync(n)},this.__cbUsedTitleChangedHandler=e=>{this.setBaUsedTitle(e),this.__contextMenu.close()},this.__searchFieldFocusOutHandler=()=>{let e=this.__searchField.getValue();null!=e&&e.length<=0&&this.__searchField.backgroundStyler.setImage(t.Icons.Standard.Lens.path,!0)},this.__contentViewButtonPressedHandler=async(n,i,s)=>{let o=s.baObjectHandler.baObject;if(null==o)return;let r=await o.getContent();if(null!=r){let n=e.Controls.get(t.Globals.HostRegionName);if(null==n)return void this.logger.warn(`Global host region '${t.Globals.HostRegionName}' was not found!\nMake sure the the content region on your Desktop.view has the name ${t.Globals.HostRegionName}'.`);n.setTargetContent(r)}else null==this.__dialog&&(this.__dialog=new t.Components.DialogWindow(this.__id+"-dialog",this),this.__dialog.setButtons(t.Components.DialogWindow.Buttons.OkCancelSize).layoutHandler.setMaxWidth(a.DefaultContentViewDialogWidth)),await o.tryReadBaVariable(t.BA.BaParameterId.eDescription).then((e=>this.__dialog?.setHeadlineText(e))),t.BA.Helper.getSpecialVisu(o,this,this.__dialog,!0),this.__dialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,(e=>{e.destroy(),this.__dialog?.destroy(),delete this.__dialog})),this.__dialog.open(!1)}}__previnit(){super.__previnit(),this.baObjectHandler=new t.BaObjectHandler(this),this.__element.append(this.__contentWindow.getElement()),this.__contentWindow.setHeadlineText("View name"),this.__searchField.textHandler.setHorizontalAlignment("Left"),this.__searchField.backgroundStyler.setImage(t.Icons.Standard.Lens.path,!0),this.__searchField.setReadOnly(!1),this.__contentWindow.getHeader().append(this.__searchField.getElement()),this.__contextMenu.addRowEntry({controlsHorizontalAlignment:"Right",controls:[{type:t.Components.ComponentType.Combobox,callback:this.__cbUsedTitleChangedHandler,settings:{data:[{text:"InstDescription",value:t.BA.BaParameterId.eInstDescription},{text:"Description",value:t.BA.BaParameterId.eDescription},{text:"SymbolPath",value:t.BA.BaParameterId.eSymbolPath},{text:"ObjectName",value:t.BA.BaParameterId.eObjectName},{text:"InstObjectName",value:t.BA.BaParameterId.eInstObjectName}],layout:{maxWidth:130},readOnly:!1}},{type:t.Components.ComponentType.Button,callback:async()=>{try{null!=this.baObjectHandler.baObject&&await t.Charting.Trend.CollectionConfigurator.openAsync({baView:this.baObjectHandler.baObject.Device.ProjectStructure})}catch(e){t.BaseError.warn(e)}},settings:{layout:{maxWidth:120}},cbOnCreated:e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.NewTrendCollection,(n=>{t.Logger.checkServerResult(t.Logger.Severity.warn,n)&&e.textHandler.setText(n.text)})))}},{type:t.Components.ComponentType.Button,callback:async()=>{try{await t.Charting.Trend.CollectionView.openAsync()}catch(e){t.BaseError.warn(e)}},settings:{layout:{maxWidth:120}},cbOnCreated:e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.TrendCollections,(n=>{t.Logger.checkServerResult(t.Logger.Severity.warn,n)&&e.textHandler.setText(n.text)})))}}]})}__init(){super.__init()}__attach(){super.__attach(),this.__destroyersToCallOnDetach.push(this.__searchField.eventHandler.register(t.Components.InputBox.InputBoxEvents.onFocusOut,this.__searchFieldFocusOutHandler)),this.__destroyersToCallOnDetach.push(this.__searchField.eventHandler.register(t.Components.InputBox.InputBoxEvents.onFocusIn,(()=>{let e=this.__searchField.getValue();(null==e||e.length<=0)&&this.__searchField.backgroundStyler.setImage(null)}))),this.__destroyersToCallOnDetach.push(this.__searchField.eventHandler.register(t.Components.InputBox.InputBoxEvents.onUserInteractionFinished,(async()=>{let e=this.__searchField.getValue();null!=e&&e.length<=0&&this.__searchField.backgroundStyler.setImage(t.Icons.Standard.Lens.path,!0),await this.__onFilterListAsync()})))}__detach(){super.__detach()}destroy(){this.__keepAlive||(null!=this.__destroyOnEntryOpened&&(this.__destroyOnEntryOpened(),delete this.__destroyOnEntryOpened),null!=this.__destroyOnEntryClosed&&(this.__destroyOnEntryClosed(),delete this.__destroyOnEntryClosed),null!=this.__destroyOnEntryContentViewButtonPressed&&(this.__destroyOnEntryContentViewButtonPressed(),delete this.__destroyOnEntryContentViewButtonPressed),null!=this.__destroyWatchProjectStructureText&&(this.__destroyWatchProjectStructureText(),delete this.__destroyWatchProjectStructureText),this.__navigation?.destroy(),this.__contentWindow.destroy(),this.__searchField.destroy(),this.__contextMenu.destroy(),this.__comboboxUsedTitle?.destroy(),this.baObjectHandler.destroy(),super.destroy())}async __onObjectSelectedAsync(e){if(this.busyHandler.getIsBusy()||null==this.__navigation)return;let n=e.baObjectHandler.baObject,i=this.__navigation.baObjectHandler.baObject;null!=n&&null!=i&&n instanceof t.BA.BaView&&n.Children.size>0&&await this.__editEntriesAsync(e.getSublist())}async __onFilterListAsync(){return new Promise(((e,n)=>{if(null==this.baObjectHandler.baObject)return;let i=this.__searchField.getValue()?.toString().toUpperCase();if(null==i||null==this.__baUsedTitle)return;if(this.__navigation&&null==this.__navigation.getCurrentFilter()&&i.length<=0)return;let a=!1;!0===this.__autoCollapse&&(a=!0,this.setAutoCollapse(!1));let s=this.busyHandler.setBusy("Loading attributes and children");this.baObjectHandler.baObject.loadAttributes(!0,!0).then((async()=>{s(),null!=i&&(s=this.busyHandler.setBusy("Filtering children"),await(this.__navigation?.filterChildrenAsync(i)),s()),a&&this.setAutoCollapse(!0),e()})).catch((async e=>{const i="Loading attributes to filter list failed!";await t.Components.DialogWindow.alert(this.logger.warn(i,e)),this.__searchField.setValue(null),this.__searchFieldFocusOutHandler(),s(),n(new t.BaseError(i,{cause:e}))}))}))}async __editEntriesAsync(e){null!=e&&e.baObjectHandler.isLoadingBaObject().then((()=>{let n=e.getEntries();null==this.__loadingCnt&&(this.__loadingCnt=0);for(let e of n.values())this.__loadingCnt++,e.baObjectHandler.isLoadingBaObject().then((async()=>{let n=e.baObjectHandler.baObject;null==n?this.logger.error("BaObject is NULL!"):t.BA.Helper.hasSpecialVisu(n)||null!=await n.getContent()?e.addContentViewButton():e.removeContentViewButton(),null!=this.__loadingCnt&&(this.__loadingCnt--,0===this.__loadingCnt&&(this.__navigation?.setContentViewButtonOffset(this.__navigation.hasEntryWithContentView()),delete this.__loadingCnt))}))}))}processBaObject(){null!=this.baObjectHandler.baObject?(this.baObjectHandler.baObject.IsTop?this.__destroyWatchProjectStructureText=t.Locale.Localization.watchText(t.Locale.LangKey.ProjectStructure,(t=>{this.__contentWindow.setHeadlineText(t.text+" "+this.baObjectHandler.baObject?.Device.Description),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineText"})})):this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eInstDescription,(t=>{this.__contentWindow.setHeadlineText(t),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineText"})})),null==this.__navigationProvider?(this.__navigationProvider=t.Navigation.createOrGetNavigationProvider(this.baObjectHandler.baObject),this.__navigation=this.__navigationProvider.createProjectNavigationListNavigation(this.__id+"-rootView",this,{valueHandler:{autoWrite:!0}})):this.__navigationProvider.setData(this.baObjectHandler.baObject),null!=this.__navigation&&(this.__navigation.setBaUsedTitle(this.__baUsedTitle).setAutoCollapse(this.__autoCollapse),this.__listContainer.append(this.__navigation.getElement()),this.__editEntriesAsync(this.__navigation),this.__destroyOnEntryOpened=this.__navigation.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler),this.__destroyOnEntryClosed=this.__navigation.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryClosed,this.__entrySelectedHandler),this.__destroyOnEntryContentViewButtonPressed=this.__navigation.eventHandler.register(t.Navigation.ProjectNavigationList.ProjectNavigationListEvents.onEntryContentViewButtonPressed,this.__contentViewButtonPressedHandler)),this.busyHandler.checkForBusyChildren()):(this.__contentWindow.setHeadlineText("null"),this.__navigationProvider?.setData(null))}closeAllEntries(){this.__navigation?.closeAllEntries()}setBaObject(e){return this.baObjectHandler.setBaObject(e),this}getBaObject(){return this.baObjectHandler.baObject}setBaUsedTitle(n){if(null==n&&(n=this.getAttributeDefaultValueInternal("BaUsedTitle")),void 0===n)return this;if("string"==typeof n)switch(n){case"Description":n=t.BA.BaParameterId.eDescription;break;case"SymbolPath":n=t.BA.BaParameterId.eSymbolPath;break;case"ObjectName":n=t.BA.BaParameterId.eObjectName;break;case"InstObjectName":n=t.BA.BaParameterId.eInstObjectName;break;default:n=t.BA.BaParameterId.eInstDescription}return n===this.__baUsedTitle||(this.__baUsedTitle=n,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"BaUsedTitle"}),this.__processBaUsedTitle()),this}__processBaUsedTitle(){this.__navigation?.setBaUsedTitle(this.__baUsedTitle),this.__comboboxUsedTitle?.setSelectedValue(this.__baUsedTitle)}getBaUsedTitle(){return this.__baUsedTitle}setShowHeader(t){let n=e.ValueConverter.toBoolean(t);return null==n&&(n=this.getAttributeDefaultValueInternal("ShowHeader")),n===this.__showHeader||(this.__showHeader=n,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowHeader"}),this.__processShowHeader()),this}__processShowHeader(){this.__contentWindow.setShowHeader(this.__showHeader)}getShowHeader(){return this.__showHeader}setAutoCollapse(t){let n=e.ValueConverter.toBoolean(t);return null==n&&(n=this.getAttributeDefaultValueInternal("AutoCollapse")),n===this.__autoCollapse||(this.__autoCollapse=n,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AutoCollapse"}),this.__processAutoCollapse()),this}__processAutoCollapse(){this.__navigation?.setAutoCollapse(this.__autoCollapse)}getAutoCollapse(){return this.__autoCollapse}getHeadlineText(){return this.__contentWindow.getHeadlineText()}}i.ProjectNavigationTextual=a,function(e){e.DefaultContentViewDialogWidth=1e3}(a=i.ProjectNavigationTextual||(i.ProjectNavigationTextual={}))}(n.Management||(n.Management={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("ProjectNavigationTextual","TcHmi.BuildingAutomation.Controls.Management",TcHmi.BuildingAutomation.Controls.Management.ProjectNavigationTextual);